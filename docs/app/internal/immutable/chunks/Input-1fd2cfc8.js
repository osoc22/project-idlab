import{S as _o,i as wo,s as So,N as ei,O as ti,P as ri,q as er,o as dr,M as ni,e as rr,k as jn,c as nr,a as Nr,m as Wn,d as Kt,b as Ve,Q as Ge,g as Pr,K as cr,R as wr,n as Eo,p as bo,T as Fo,U as Vn,t as Ao,h as Po,j as To,E as Yi,V as Sr,G as Co}from"./index-d13a8d77.js";function Bs(r,n){return n.forEach(function(s){s&&typeof s!="string"&&!Array.isArray(s)&&Object.keys(s).forEach(function(o){if(o!=="default"&&!(o in r)){var u=Object.getOwnPropertyDescriptor(s,o);Object.defineProperty(r,o,u.get?u:{enumerable:!0,get:function(){return s[o]}})}})}),Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}var ze=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function js(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function ii(r){if(r.__esModule)return r;var n=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(r).forEach(function(s){var o=Object.getOwnPropertyDescriptor(r,s);Object.defineProperty(n,s,o.get?o:{enumerable:!0,get:function(){return r[s]}})}),n}var Ws={},hr={},oi={exports:{}},_r=typeof Reflect=="object"?Reflect:null,Xi=_r&&typeof _r.apply=="function"?_r.apply:function(n,s,o){return Function.prototype.apply.call(n,s,o)},Qr;_r&&typeof _r.ownKeys=="function"?Qr=_r.ownKeys:Object.getOwnPropertySymbols?Qr=function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:Qr=function(n){return Object.getOwnPropertyNames(n)};function Vs(r){console&&console.warn&&console.warn(r)}var xo=Number.isNaN||function(n){return n!==n};function Ie(){Ie.init.call(this)}oi.exports=Ie;oi.exports.once=Gs;Ie.EventEmitter=Ie;Ie.prototype._events=void 0;Ie.prototype._eventsCount=0;Ie.prototype._maxListeners=void 0;var Qi=10;function cn(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(Ie,"defaultMaxListeners",{enumerable:!0,get:function(){return Qi},set:function(r){if(typeof r!="number"||r<0||xo(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");Qi=r}});Ie.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Ie.prototype.setMaxListeners=function(n){if(typeof n!="number"||n<0||xo(n))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+n+".");return this._maxListeners=n,this};function Ro(r){return r._maxListeners===void 0?Ie.defaultMaxListeners:r._maxListeners}Ie.prototype.getMaxListeners=function(){return Ro(this)};Ie.prototype.emit=function(n){for(var s=[],o=1;o<arguments.length;o++)s.push(arguments[o]);var u=n==="error",l=this._events;if(l!==void 0)u=u&&l.error===void 0;else if(!u)return!1;if(u){var c;if(s.length>0&&(c=s[0]),c instanceof Error)throw c;var g=new Error("Unhandled error."+(c?" ("+c.message+")":""));throw g.context=c,g}var y=l[n];if(y===void 0)return!1;if(typeof y=="function")Xi(y,this,s);else for(var f=y.length,h=Do(y,f),o=0;o<f;++o)Xi(h[o],this,s);return!0};function Io(r,n,s,o){var u,l,c;if(cn(s),l=r._events,l===void 0?(l=r._events=Object.create(null),r._eventsCount=0):(l.newListener!==void 0&&(r.emit("newListener",n,s.listener?s.listener:s),l=r._events),c=l[n]),c===void 0)c=l[n]=s,++r._eventsCount;else if(typeof c=="function"?c=l[n]=o?[s,c]:[c,s]:o?c.unshift(s):c.push(s),u=Ro(r),u>0&&c.length>u&&!c.warned){c.warned=!0;var g=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(n)+" listeners added. Use emitter.setMaxListeners() to increase limit");g.name="MaxListenersExceededWarning",g.emitter=r,g.type=n,g.count=c.length,Vs(g)}return r}Ie.prototype.addListener=function(n,s){return Io(this,n,s,!1)};Ie.prototype.on=Ie.prototype.addListener;Ie.prototype.prependListener=function(n,s){return Io(this,n,s,!0)};function Js(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function ko(r,n,s){var o={fired:!1,wrapFn:void 0,target:r,type:n,listener:s},u=Js.bind(o);return u.listener=s,o.wrapFn=u,u}Ie.prototype.once=function(n,s){return cn(s),this.on(n,ko(this,n,s)),this};Ie.prototype.prependOnceListener=function(n,s){return cn(s),this.prependListener(n,ko(this,n,s)),this};Ie.prototype.removeListener=function(n,s){var o,u,l,c,g;if(cn(s),u=this._events,u===void 0)return this;if(o=u[n],o===void 0)return this;if(o===s||o.listener===s)--this._eventsCount===0?this._events=Object.create(null):(delete u[n],u.removeListener&&this.emit("removeListener",n,o.listener||s));else if(typeof o!="function"){for(l=-1,c=o.length-1;c>=0;c--)if(o[c]===s||o[c].listener===s){g=o[c].listener,l=c;break}if(l<0)return this;l===0?o.shift():qs(o,l),o.length===1&&(u[n]=o[0]),u.removeListener!==void 0&&this.emit("removeListener",n,g||s)}return this};Ie.prototype.off=Ie.prototype.removeListener;Ie.prototype.removeAllListeners=function(n){var s,o,u;if(o=this._events,o===void 0)return this;if(o.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):o[n]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete o[n]),this;if(arguments.length===0){var l=Object.keys(o),c;for(u=0;u<l.length;++u)c=l[u],c!=="removeListener"&&this.removeAllListeners(c);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(s=o[n],typeof s=="function")this.removeListener(n,s);else if(s!==void 0)for(u=s.length-1;u>=0;u--)this.removeListener(n,s[u]);return this};function Uo(r,n,s){var o=r._events;if(o===void 0)return[];var u=o[n];return u===void 0?[]:typeof u=="function"?s?[u.listener||u]:[u]:s?$s(u):Do(u,u.length)}Ie.prototype.listeners=function(n){return Uo(this,n,!0)};Ie.prototype.rawListeners=function(n){return Uo(this,n,!1)};Ie.listenerCount=function(r,n){return typeof r.listenerCount=="function"?r.listenerCount(n):Oo.call(r,n)};Ie.prototype.listenerCount=Oo;function Oo(r){var n=this._events;if(n!==void 0){var s=n[r];if(typeof s=="function")return 1;if(s!==void 0)return s.length}return 0}Ie.prototype.eventNames=function(){return this._eventsCount>0?Qr(this._events):[]};function Do(r,n){for(var s=new Array(n),o=0;o<n;++o)s[o]=r[o];return s}function qs(r,n){for(;n+1<r.length;n++)r[n]=r[n+1];r.pop()}function $s(r){for(var n=new Array(r.length),s=0;s<n.length;++s)n[s]=r[s].listener||r[s];return n}function Gs(r,n){return new Promise(function(s,o){function u(c){r.removeListener(n,l),o(c)}function l(){typeof r.removeListener=="function"&&r.removeListener("error",u),s([].slice.call(arguments))}Ho(r,n,l,{once:!0}),n!=="error"&&zs(r,u,{once:!0})})}function zs(r,n,s){typeof r.on=="function"&&Ho(r,"error",n,s)}function Ho(r,n,s,o){if(typeof r.on=="function")o.once?r.once(n,s):r.on(n,s);else if(typeof r.addEventListener=="function")r.addEventListener(n,function u(l){o.once&&r.removeEventListener(n,u),s(l)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}var xe={},Tt={};Object.defineProperty(Tt,"__esModule",{value:!0});Tt.DEFAULT_SCOPES=Tt.REFRESH_BEFORE_EXPIRATION_SECONDS=Tt.EVENTS=Tt.PREFERRED_SIGNING_ALG=Tt.SOLID_CLIENT_AUTHN_KEY_PREFIX=void 0;Tt.SOLID_CLIENT_AUTHN_KEY_PREFIX="solidClientAuthn:";Tt.PREFERRED_SIGNING_ALG=["ES256","RS256"];Tt.EVENTS={ERROR:"error",LOGIN:"login",LOGOUT:"logout",NEW_REFRESH_TOKEN:"newRefreshToken",SESSION_EXPIRED:"sessionExpired",SESSION_EXTENDED:"sessionExtended",SESSION_RESTORED:"sessionRestore",TIMEOUT_SET:"timeoutSet"};Tt.REFRESH_BEFORE_EXPIRATION_SECONDS=5;const Ys="openid",Xs="offline_access",Qs="webid";Tt.DEFAULT_SCOPES=[Ys,Xs,Qs].join(" ");var si={},ln={};Object.defineProperty(ln,"__esModule",{value:!0});class Qt extends Error{constructor(n,s,o=!0){super(typeof n=="string"?Qt.substituteParams(n,s):Qt.appendErrorIri(Qt.lookupErrorIri(n,s),n,o))}httpResponse(n,s=!0){return this.message=Qt.appendHttpResponseDetails(this.message,n,s),this.httpErrorResponse=n,this}hasHttpResponse(){return this.httpErrorResponse!==void 0}getHttpResponse(){return this.httpErrorResponse}getHttpStatusCode(){if(this.httpErrorResponse===void 0)throw new Qt("This InruptError was not provided with a HTTP response - so we can't get its HTTP Status Code.");return this.httpErrorResponse.status}getHttpStatusText(){if(this.httpErrorResponse===void 0)throw new Qt("This InruptError was not provided with a HTTP response - so we can't get its HTTP Status Text!");return this.httpErrorResponse.statusText}static determineIfVocabTerm(n){return n.strict!==void 0}static lookupErrorIri(n,s){if(Qt.determineIfVocabTerm(n)){const o=s===void 0?n.message:n.messageParams(...s);return o===void 0?`Looked up error message IRI [${n.value}], but found no message value.`:o}return`Error message looked up at: [${n.value}]${s===void 0?"":`, with params [${s.toString()}]`}`}static appendHttpResponseDetails(n,s,o){return o&&typeof s!="undefined"?`${n} HTTP details: status code [${s.status}], status text [${s.statusText}].`:n}static appendErrorIri(n,s,o){return o?`${n} Error IRI: [${s.value}].`:n}static substituteParams(n,s){let o=n;if(s!==void 0){const u=n.split("{{").length-1;if(u!==s.length)throw new Error(`Setting parameters on message [${n}], but it requires [${u}] params and we received [${s.length}].`);for(let l=0;l<s.length;l+=1){const c=`{{${l}}}`;o=o.replace(c,s[l])}}return o}}ln.default=Qt;var Zs=ze&&ze.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(si,"__esModule",{value:!0});const ea=Zs(ln);class ta{constructor(n){this.handleables=n}async getProperHandler(n){const s=await Promise.all(this.handleables.map(o=>o.canHandle(...n)));for(let o=0;o<s.length;o+=1)if(s[o])return this.handleables[o];return null}async canHandle(...n){return await this.getProperHandler(n)!==null}async handle(...n){const s=await this.getProperHandler(n);if(s)return s.handle(...n);throw new ea.default(`[${this.constructor.name}] cannot find a suitable handler for: ${n.map(o=>{try{return JSON.stringify(o)}catch{return o.toString()}}).join(", ")}`)}}si.default=ta;var Er={},br={exports:{}};(function(r,n){var s=typeof self!="undefined"?self:ze,o=function(){function l(){this.fetch=!1,this.DOMException=s.DOMException}return l.prototype=s,new l}();(function(l){(function(c){var g={searchParams:"URLSearchParams"in l,iterable:"Symbol"in l&&"iterator"in Symbol,blob:"FileReader"in l&&"Blob"in l&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in l,arrayBuffer:"ArrayBuffer"in l};function y(Z){return Z&&DataView.prototype.isPrototypeOf(Z)}if(g.arrayBuffer)var f=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],h=ArrayBuffer.isView||function(Z){return Z&&f.indexOf(Object.prototype.toString.call(Z))>-1};function p(Z){if(typeof Z!="string"&&(Z=String(Z)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(Z))throw new TypeError("Invalid character in header field name");return Z.toLowerCase()}function w(Z){return typeof Z!="string"&&(Z=String(Z)),Z}function x(Z){var ae={next:function(){var pe=Z.shift();return{done:pe===void 0,value:pe}}};return g.iterable&&(ae[Symbol.iterator]=function(){return ae}),ae}function F(Z){this.map={},Z instanceof F?Z.forEach(function(ae,pe){this.append(pe,ae)},this):Array.isArray(Z)?Z.forEach(function(ae){this.append(ae[0],ae[1])},this):Z&&Object.getOwnPropertyNames(Z).forEach(function(ae){this.append(ae,Z[ae])},this)}F.prototype.append=function(Z,ae){Z=p(Z),ae=w(ae);var pe=this.map[Z];this.map[Z]=pe?pe+", "+ae:ae},F.prototype.delete=function(Z){delete this.map[p(Z)]},F.prototype.get=function(Z){return Z=p(Z),this.has(Z)?this.map[Z]:null},F.prototype.has=function(Z){return this.map.hasOwnProperty(p(Z))},F.prototype.set=function(Z,ae){this.map[p(Z)]=w(ae)},F.prototype.forEach=function(Z,ae){for(var pe in this.map)this.map.hasOwnProperty(pe)&&Z.call(ae,this.map[pe],pe,this)},F.prototype.keys=function(){var Z=[];return this.forEach(function(ae,pe){Z.push(pe)}),x(Z)},F.prototype.values=function(){var Z=[];return this.forEach(function(ae){Z.push(ae)}),x(Z)},F.prototype.entries=function(){var Z=[];return this.forEach(function(ae,pe){Z.push([pe,ae])}),x(Z)},g.iterable&&(F.prototype[Symbol.iterator]=F.prototype.entries);function P(Z){if(Z.bodyUsed)return Promise.reject(new TypeError("Already read"));Z.bodyUsed=!0}function A(Z){return new Promise(function(ae,pe){Z.onload=function(){ae(Z.result)},Z.onerror=function(){pe(Z.error)}})}function b(Z){var ae=new FileReader,pe=A(ae);return ae.readAsArrayBuffer(Z),pe}function T(Z){var ae=new FileReader,pe=A(ae);return ae.readAsText(Z),pe}function H(Z){for(var ae=new Uint8Array(Z),pe=new Array(ae.length),Ee=0;Ee<ae.length;Ee++)pe[Ee]=String.fromCharCode(ae[Ee]);return pe.join("")}function M(Z){if(Z.slice)return Z.slice(0);var ae=new Uint8Array(Z.byteLength);return ae.set(new Uint8Array(Z)),ae.buffer}function G(){return this.bodyUsed=!1,this._initBody=function(Z){this._bodyInit=Z,Z?typeof Z=="string"?this._bodyText=Z:g.blob&&Blob.prototype.isPrototypeOf(Z)?this._bodyBlob=Z:g.formData&&FormData.prototype.isPrototypeOf(Z)?this._bodyFormData=Z:g.searchParams&&URLSearchParams.prototype.isPrototypeOf(Z)?this._bodyText=Z.toString():g.arrayBuffer&&g.blob&&y(Z)?(this._bodyArrayBuffer=M(Z.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):g.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(Z)||h(Z))?this._bodyArrayBuffer=M(Z):this._bodyText=Z=Object.prototype.toString.call(Z):this._bodyText="",this.headers.get("content-type")||(typeof Z=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):g.searchParams&&URLSearchParams.prototype.isPrototypeOf(Z)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},g.blob&&(this.blob=function(){var Z=P(this);if(Z)return Z;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?P(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(b)}),this.text=function(){var Z=P(this);if(Z)return Z;if(this._bodyBlob)return T(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(H(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},g.formData&&(this.formData=function(){return this.text().then(ie)}),this.json=function(){return this.text().then(JSON.parse)},this}var V=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function j(Z){var ae=Z.toUpperCase();return V.indexOf(ae)>-1?ae:Z}function ne(Z,ae){ae=ae||{};var pe=ae.body;if(Z instanceof ne){if(Z.bodyUsed)throw new TypeError("Already read");this.url=Z.url,this.credentials=Z.credentials,ae.headers||(this.headers=new F(Z.headers)),this.method=Z.method,this.mode=Z.mode,this.signal=Z.signal,!pe&&Z._bodyInit!=null&&(pe=Z._bodyInit,Z.bodyUsed=!0)}else this.url=String(Z);if(this.credentials=ae.credentials||this.credentials||"same-origin",(ae.headers||!this.headers)&&(this.headers=new F(ae.headers)),this.method=j(ae.method||this.method||"GET"),this.mode=ae.mode||this.mode||null,this.signal=ae.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&pe)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(pe)}ne.prototype.clone=function(){return new ne(this,{body:this._bodyInit})};function ie(Z){var ae=new FormData;return Z.trim().split("&").forEach(function(pe){if(pe){var Ee=pe.split("="),Fe=Ee.shift().replace(/\+/g," "),le=Ee.join("=").replace(/\+/g," ");ae.append(decodeURIComponent(Fe),decodeURIComponent(le))}}),ae}function W(Z){var ae=new F,pe=Z.replace(/\r?\n[\t ]+/g," ");return pe.split(/\r?\n/).forEach(function(Ee){var Fe=Ee.split(":"),le=Fe.shift().trim();if(le){var _e=Fe.join(":").trim();ae.append(le,_e)}}),ae}G.call(ne.prototype);function oe(Z,ae){ae||(ae={}),this.type="default",this.status=ae.status===void 0?200:ae.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in ae?ae.statusText:"OK",this.headers=new F(ae.headers),this.url=ae.url||"",this._initBody(Z)}G.call(oe.prototype),oe.prototype.clone=function(){return new oe(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new F(this.headers),url:this.url})},oe.error=function(){var Z=new oe(null,{status:0,statusText:""});return Z.type="error",Z};var Te=[301,302,303,307,308];oe.redirect=function(Z,ae){if(Te.indexOf(ae)===-1)throw new RangeError("Invalid status code");return new oe(null,{status:ae,headers:{location:Z}})},c.DOMException=l.DOMException;try{new c.DOMException}catch{c.DOMException=function(ae,pe){this.message=ae,this.name=pe;var Ee=Error(ae);this.stack=Ee.stack},c.DOMException.prototype=Object.create(Error.prototype),c.DOMException.prototype.constructor=c.DOMException}function be(Z,ae){return new Promise(function(pe,Ee){var Fe=new ne(Z,ae);if(Fe.signal&&Fe.signal.aborted)return Ee(new c.DOMException("Aborted","AbortError"));var le=new XMLHttpRequest;function _e(){le.abort()}le.onload=function(){var Me={status:le.status,statusText:le.statusText,headers:W(le.getAllResponseHeaders()||"")};Me.url="responseURL"in le?le.responseURL:Me.headers.get("X-Request-URL");var qe="response"in le?le.response:le.responseText;pe(new oe(qe,Me))},le.onerror=function(){Ee(new TypeError("Network request failed"))},le.ontimeout=function(){Ee(new TypeError("Network request failed"))},le.onabort=function(){Ee(new c.DOMException("Aborted","AbortError"))},le.open(Fe.method,Fe.url,!0),Fe.credentials==="include"?le.withCredentials=!0:Fe.credentials==="omit"&&(le.withCredentials=!1),"responseType"in le&&g.blob&&(le.responseType="blob"),Fe.headers.forEach(function(Me,qe){le.setRequestHeader(qe,Me)}),Fe.signal&&(Fe.signal.addEventListener("abort",_e),le.onreadystatechange=function(){le.readyState===4&&Fe.signal.removeEventListener("abort",_e)}),le.send(typeof Fe._bodyInit=="undefined"?null:Fe._bodyInit)})}return be.polyfill=!0,l.fetch||(l.fetch=be,l.Headers=F,l.Request=ne,l.Response=oe),c.Headers=F,c.Request=ne,c.Response=oe,c.fetch=be,Object.defineProperty(c,"__esModule",{value:!0}),c})({})})(o),o.fetch.ponyfill=!0,delete o.fetch.polyfill;var u=o;n=u.fetch,n.default=u.fetch,n.fetch=u.fetch,n.Headers=u.Headers,n.Request=u.Request,n.Response=u.Response,r.exports=n})(br,br.exports);var ra=js(br.exports),sd=Bs({__proto__:null,default:ra},[br.exports]),me=crypto;const Ct=r=>r instanceof CryptoKey,na=async(r,n)=>{const s=`SHA-${r.slice(-3)}`;return new Uint8Array(await me.subtle.digest(s,n))};var No=na;const Je=new TextEncoder,Dt=new TextDecoder,tn=2**32;function $t(...r){const n=r.reduce((u,{length:l})=>u+l,0),s=new Uint8Array(n);let o=0;return r.forEach(u=>{s.set(u,o),o+=u.length}),s}function ia(r,n){return $t(Je.encode(r),new Uint8Array([0]),n)}function Jn(r,n,s){if(n<0||n>=tn)throw new RangeError(`value must be >= 0 and <= ${tn-1}. Received ${n}`);r.set([n>>>24,n>>>16,n>>>8,n&255],s)}function Lo(r){const n=Math.floor(r/tn),s=r%tn,o=new Uint8Array(8);return Jn(o,n,0),Jn(o,s,4),o}function ai(r){const n=new Uint8Array(4);return Jn(n,r),n}function kn(r){return $t(ai(r.length),r)}async function oa(r,n,s){const o=Math.ceil((n>>3)/32),u=new Uint8Array(o*32);for(let l=0;l<o;l++){const c=new Uint8Array(4+r.length+s.length);c.set(ai(l+1)),c.set(r,4),c.set(s,4+r.length),u.set(await No("sha256",c),l*32)}return u.slice(0,n>>3)}const ui=r=>{let n=r;typeof n=="string"&&(n=Je.encode(n));const s=32768,o=[];for(let u=0;u<n.length;u+=s)o.push(String.fromCharCode.apply(null,n.subarray(u,u+s)));return btoa(o.join(""))},Ye=r=>ui(r).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),Mo=r=>{const n=atob(r),s=new Uint8Array(n.length);for(let o=0;o<n.length;o++)s[o]=n.charCodeAt(o);return s},rt=r=>{let n=r;n instanceof Uint8Array&&(n=Dt.decode(n)),n=n.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return Mo(n)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};class lt extends Error{constructor(n){var s;super(n),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(s=Error.captureStackTrace)===null||s===void 0||s.call(Error,this,this.constructor)}static get code(){return"ERR_JOSE_GENERIC"}}class xt extends lt{constructor(n,s="unspecified",o="unspecified"){super(n),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=s,this.reason=o}static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}}class qn extends lt{constructor(n,s="unspecified",o="unspecified"){super(n),this.code="ERR_JWT_EXPIRED",this.claim=s,this.reason=o}static get code(){return"ERR_JWT_EXPIRED"}}class rn extends lt{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}}class Pe extends lt{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}}class Lr extends lt{constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}}class ye extends lt{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}}class ke extends lt{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}}class Pt extends lt{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}}class Ko extends lt{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}static get code(){return"ERR_JWK_INVALID"}}class nn extends lt{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}static get code(){return"ERR_JWKS_INVALID"}}class ci extends lt{constructor(){super(...arguments),this.code="ERR_JWKS_NO_MATCHING_KEY",this.message="no applicable key found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_NO_MATCHING_KEY"}}class Bo extends lt{constructor(){super(...arguments),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS",this.message="multiple matching keys found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_MULTIPLE_MATCHING_KEYS"}}class jo extends lt{constructor(){super(...arguments),this.code="ERR_JWKS_TIMEOUT",this.message="request timed out"}static get code(){return"ERR_JWKS_TIMEOUT"}}class li extends lt{constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}var sa=Object.freeze(Object.defineProperty({__proto__:null,JOSEError:lt,JWTClaimValidationFailed:xt,JWTExpired:qn,JOSEAlgNotAllowed:rn,JOSENotSupported:Pe,JWEDecryptionFailed:Lr,JWEInvalid:ye,JWSInvalid:ke,JWTInvalid:Pt,JWKInvalid:Ko,JWKSInvalid:nn,JWKSNoMatchingKey:ci,JWKSMultipleMatchingKeys:Bo,JWKSTimeout:jo,JWSSignatureVerificationFailed:li},Symbol.toStringTag,{value:"Module"})),dn=me.getRandomValues.bind(me);function Wo(r){switch(r){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new Pe(`Unsupported JWE Algorithm: ${r}`)}}var Vo=r=>dn(new Uint8Array(Wo(r)>>3));const aa=(r,n)=>{if(n.length<<3!==Wo(r))throw new ye("Invalid Initialization Vector length")};var Jo=aa;const ua=(r,n)=>{if(r.length<<3!==n)throw new ye("Invalid Content Encryption Key length")};var on=ua;const ca=(r,n)=>{if(!(r instanceof Uint8Array))throw new TypeError("First argument must be a buffer");if(!(n instanceof Uint8Array))throw new TypeError("Second argument must be a buffer");if(r.length!==n.length)throw new TypeError("Input buffers must have the same length");const s=r.length;let o=0,u=-1;for(;++u<s;)o|=r[u]^n[u];return o===0};var la=ca;function pr(){return typeof WebSocketPair=="function"}function ct(r,n="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${n} must be ${r}`)}function Vt(r,n){return r.name===n}function Zr(r){return parseInt(r.name.slice(4),10)}function da(r){switch(r){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function qo(r,n){if(n.length&&!n.some(s=>r.usages.includes(s))){let s="CryptoKey does not support this operation, its usages must include ";if(n.length>2){const o=n.pop();s+=`one of ${n.join(", ")}, or ${o}.`}else n.length===2?s+=`one of ${n[0]} or ${n[1]}.`:s+=`${n[0]}.`;throw new TypeError(s)}}function ha(r,n,...s){switch(n){case"HS256":case"HS384":case"HS512":{if(!Vt(r.algorithm,"HMAC"))throw ct("HMAC");const o=parseInt(n.slice(2),10);if(Zr(r.algorithm.hash)!==o)throw ct(`SHA-${o}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!Vt(r.algorithm,"RSASSA-PKCS1-v1_5"))throw ct("RSASSA-PKCS1-v1_5");const o=parseInt(n.slice(2),10);if(Zr(r.algorithm.hash)!==o)throw ct(`SHA-${o}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!Vt(r.algorithm,"RSA-PSS"))throw ct("RSA-PSS");const o=parseInt(n.slice(2),10);if(Zr(r.algorithm.hash)!==o)throw ct(`SHA-${o}`,"algorithm.hash");break}case(pr()&&"EdDSA"):{if(!Vt(r.algorithm,"NODE-ED25519"))throw ct("NODE-ED25519");break}case"ES256":case"ES384":case"ES512":{if(!Vt(r.algorithm,"ECDSA"))throw ct("ECDSA");const o=da(n);if(r.algorithm.namedCurve!==o)throw ct(o,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}qo(r,s)}function ir(r,n,...s){switch(n){case"A128GCM":case"A192GCM":case"A256GCM":{if(!Vt(r.algorithm,"AES-GCM"))throw ct("AES-GCM");const o=parseInt(n.slice(1,4),10);if(r.algorithm.length!==o)throw ct(o,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if(!Vt(r.algorithm,"AES-KW"))throw ct("AES-KW");const o=parseInt(n.slice(1,4),10);if(r.algorithm.length!==o)throw ct(o,"algorithm.length");break}case"ECDH":if(!Vt(r.algorithm,"ECDH"))throw ct("ECDH");break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if(!Vt(r.algorithm,"PBKDF2"))throw ct("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(!Vt(r.algorithm,"RSA-OAEP"))throw ct("RSA-OAEP");const o=parseInt(n.slice(9),10)||1;if(Zr(r.algorithm.hash)!==o)throw ct(`SHA-${o}`,"algorithm.hash");break}default:throw new TypeError("CryptoKey does not support this operation")}qo(r,s)}var st=(r,...n)=>{let s="Key must be ";if(n.length>2){const o=n.pop();s+=`one of type ${n.join(", ")}, or ${o}.`}else n.length===2?s+=`one of type ${n[0]} or ${n[1]}.`:s+=`of type ${n[0]}.`;return r==null?s+=` Received ${r}`:typeof r=="function"&&r.name?s+=` Received function ${r.name}`:typeof r=="object"&&r!=null&&r.constructor&&r.constructor.name&&(s+=` Received an instance of ${r.constructor.name}`),s},$o=r=>Ct(r);const je=["CryptoKey"];async function fa(r,n,s,o,u,l){if(!(n instanceof Uint8Array))throw new TypeError(st(n,"Uint8Array"));const c=parseInt(r.slice(1,4),10),g=await me.subtle.importKey("raw",n.subarray(c>>3),"AES-CBC",!1,["decrypt"]),y=await me.subtle.importKey("raw",n.subarray(0,c>>3),{hash:`SHA-${c<<1}`,name:"HMAC"},!1,["sign"]),f=$t(l,o,s,Lo(l.length<<3)),h=new Uint8Array((await me.subtle.sign("HMAC",y,f)).slice(0,c>>3));let p;try{p=la(u,h)}catch{}if(!p)throw new Lr;let w;try{w=new Uint8Array(await me.subtle.decrypt({iv:o,name:"AES-CBC"},g,s))}catch{}if(!w)throw new Lr;return w}async function pa(r,n,s,o,u,l){let c;n instanceof Uint8Array?c=await me.subtle.importKey("raw",n,"AES-GCM",!1,["decrypt"]):(ir(n,r,"decrypt"),c=n);try{return new Uint8Array(await me.subtle.decrypt({additionalData:l,iv:o,name:"AES-GCM",tagLength:128},c,$t(s,u)))}catch{throw new Lr}}const ga=async(r,n,s,o,u,l)=>{if(!Ct(n)&&!(n instanceof Uint8Array))throw new TypeError(st(n,...je,"Uint8Array"));switch(Jo(r,o),r){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return n instanceof Uint8Array&&on(n,parseInt(r.slice(-3),10)),fa(r,n,s,o,u,l);case"A128GCM":case"A192GCM":case"A256GCM":return n instanceof Uint8Array&&on(n,parseInt(r.slice(1,4),10)),pa(r,n,s,o,u,l);default:throw new Pe("Unsupported JWE Content Encryption Algorithm")}};var Go=ga;const ya=async()=>{throw new Pe('JWE "zip" (Compression Algorithm) Header Parameter is not supported by your javascript runtime. You need to use the `inflateRaw` decrypt option to provide Inflate Raw implementation.')},va=async()=>{throw new Pe('JWE "zip" (Compression Algorithm) Header Parameter is not supported by your javascript runtime. You need to use the `deflateRaw` encrypt option to provide Deflate Raw implementation.')},ma=(...r)=>{const n=r.filter(Boolean);if(n.length===0||n.length===1)return!0;let s;for(const o of n){const u=Object.keys(o);if(!s||s.size===0){s=new Set(u);continue}for(const l of u){if(s.has(l))return!1;s.add(l)}}return!0};var Mr=ma;function _a(r){return typeof r=="object"&&r!==null}function ot(r){if(!_a(r)||Object.prototype.toString.call(r)!=="[object Object]")return!1;if(Object.getPrototypeOf(r)===null)return!0;let n=r;for(;Object.getPrototypeOf(n)!==null;)n=Object.getPrototypeOf(n);return Object.getPrototypeOf(r)===n}const wa=[{hash:"SHA-256",name:"HMAC"},!0,["sign"]];var hn=wa;function zo(r,n){if(r.algorithm.length!==parseInt(n.slice(1,4),10))throw new TypeError(`Invalid key size for alg: ${n}`)}function Yo(r,n,s){if(Ct(r))return ir(r,n,s),r;if(r instanceof Uint8Array)return me.subtle.importKey("raw",r,"AES-KW",!0,[s]);throw new TypeError(st(r,...je,"Uint8Array"))}const $n=async(r,n,s)=>{const o=await Yo(n,r,"wrapKey");zo(o,r);const u=await me.subtle.importKey("raw",s,...hn);return new Uint8Array(await me.subtle.wrapKey("raw",u,o,"AES-KW"))},Gn=async(r,n,s)=>{const o=await Yo(n,r,"unwrapKey");zo(o,r);const u=await me.subtle.unwrapKey("raw",s,o,"AES-KW",...hn);return new Uint8Array(await me.subtle.exportKey("raw",u))};async function Xo(r,n,s,o,u=new Uint8Array(0),l=new Uint8Array(0)){if(!Ct(r))throw new TypeError(st(r,...je));if(ir(r,"ECDH"),!Ct(n))throw new TypeError(st(n,...je));ir(n,"ECDH","deriveBits");const c=$t(kn(Je.encode(s)),kn(u),kn(l),ai(o)),g=new Uint8Array(await me.subtle.deriveBits({name:"ECDH",public:r},n,Math.ceil(parseInt(n.algorithm.namedCurve.slice(-3),10)/8)<<3));return oa(g,o,c)}async function Sa(r){if(!Ct(r))throw new TypeError(st(r,...je));return me.subtle.generateKey(r.algorithm,!0,["deriveBits"])}function Qo(r){if(!Ct(r))throw new TypeError(st(r,...je));return["P-256","P-384","P-521"].includes(r.algorithm.namedCurve)}function Ea(r){if(!(r instanceof Uint8Array)||r.length<8)throw new ye("PBES2 Salt Input must be 8 or more octets")}function ba(r,n){if(r instanceof Uint8Array)return me.subtle.importKey("raw",r,"PBKDF2",!1,["deriveBits"]);if(Ct(r))return ir(r,n,"deriveBits","deriveKey"),r;throw new TypeError(st(r,...je,"Uint8Array"))}async function Zo(r,n,s,o){Ea(r);const u=ia(n,r),l=parseInt(n.slice(13,16),10),c={hash:`SHA-${n.slice(8,11)}`,iterations:s,name:"PBKDF2",salt:u},g={length:l,name:"AES-KW"},y=await ba(o,n);if(y.usages.includes("deriveBits"))return new Uint8Array(await me.subtle.deriveBits(c,y,l));if(y.usages.includes("deriveKey"))return me.subtle.deriveKey(c,y,g,!1,["wrapKey","unwrapKey"]);throw new TypeError('PBKDF2 key "usages" must include "deriveBits" or "deriveKey"')}const Fa=async(r,n,s,o=2048,u=dn(new Uint8Array(16)))=>{const l=await Zo(u,r,o,n);return{encryptedKey:await $n(r.slice(-6),l,s),p2c:o,p2s:Ye(u)}},Aa=async(r,n,s,o,u)=>{const l=await Zo(u,r,o,n);return Gn(r.slice(-6),l,s)};function sn(r){switch(r){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return"RSA-OAEP";default:throw new Pe(`alg ${r} is not supported either by JOSE or your javascript runtime`)}}var fn=(r,n)=>{if(r.startsWith("RS")||r.startsWith("PS")){const{modulusLength:s}=n.algorithm;if(typeof s!="number"||s<2048)throw new TypeError(`${r} requires key modulusLength to be 2048 bits or larger`)}};const Pa=async(r,n,s)=>{if(!Ct(n))throw new TypeError(st(n,...je));if(ir(n,r,"encrypt","wrapKey"),fn(r,n),n.usages.includes("encrypt"))return new Uint8Array(await me.subtle.encrypt(sn(r),n,s));if(n.usages.includes("wrapKey")){const o=await me.subtle.importKey("raw",s,...hn);return new Uint8Array(await me.subtle.wrapKey("raw",o,n,sn(r)))}throw new TypeError('RSA-OAEP key "usages" must include "encrypt" or "wrapKey" for this operation')},Ta=async(r,n,s)=>{if(!Ct(n))throw new TypeError(st(n,...je));if(ir(n,r,"decrypt","unwrapKey"),fn(r,n),n.usages.includes("decrypt"))return new Uint8Array(await me.subtle.decrypt(sn(r),n,s));if(n.usages.includes("unwrapKey")){const o=await me.subtle.unwrapKey("raw",s,n,sn(r),...hn);return new Uint8Array(await me.subtle.exportKey("raw",o))}throw new TypeError('RSA-OAEP key "usages" must include "decrypt" or "unwrapKey" for this operation')};function di(r){switch(r){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new Pe(`Unsupported JWE Algorithm: ${r}`)}}var lr=r=>dn(new Uint8Array(di(r)>>3)),es=(r,n)=>{const s=(r.match(/.{1,64}/g)||[]).join(`
`);return`-----BEGIN ${n}-----
${s}
-----END ${n}-----`};const ts=async(r,n,s)=>{if(!Ct(s))throw new TypeError(st(s,...je));if(!s.extractable)throw new TypeError("CryptoKey is not extractable");if(s.type!==r)throw new TypeError(`key is not a ${r} key`);return es(ui(new Uint8Array(await me.subtle.exportKey(n,s))),`${r.toUpperCase()} KEY`)},Ca=r=>ts("public","spki",r),xa=r=>ts("private","pkcs8",r),Hr=(r,n,s=0)=>{s===0&&(n.unshift(n.length),n.unshift(6));let o=r.indexOf(n[0],s);if(o===-1)return!1;const u=r.subarray(o,o+n.length);return u.length!==n.length?!1:u.every((l,c)=>l===n[c])||Hr(r,n,o+1)},Zi=r=>{switch(!0){case Hr(r,[42,134,72,206,61,3,1,7]):return"P-256";case Hr(r,[43,129,4,0,34]):return"P-384";case Hr(r,[43,129,4,0,35]):return"P-521";case(pr()&&Hr(r,[43,101,112])):return"Ed25519";default:throw new Pe("Invalid or unsupported EC Key Curve or OKP Key Sub Type")}},rs=async(r,n,s,o,u)=>{var l;let c,g;const y=new Uint8Array(atob(s.replace(r,"")).split("").map(h=>h.charCodeAt(0))),f=n==="spki";switch(o){case"PS256":case"PS384":case"PS512":c={name:"RSA-PSS",hash:`SHA-${o.slice(-3)}`},g=f?["verify"]:["sign"];break;case"RS256":case"RS384":case"RS512":c={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${o.slice(-3)}`},g=f?["verify"]:["sign"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":c={name:"RSA-OAEP",hash:`SHA-${parseInt(o.slice(-3),10)||1}`},g=f?["encrypt","wrapKey"]:["decrypt","unwrapKey"];break;case"ES256":c={name:"ECDSA",namedCurve:"P-256"},g=f?["verify"]:["sign"];break;case"ES384":c={name:"ECDSA",namedCurve:"P-384"},g=f?["verify"]:["sign"];break;case"ES512":c={name:"ECDSA",namedCurve:"P-521"},g=f?["verify"]:["sign"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":c={name:"ECDH",namedCurve:Zi(y)},g=f?[]:["deriveBits"];break;case(pr()&&"EdDSA"):const h=Zi(y).toUpperCase();c={name:`NODE-${h}`,namedCurve:`NODE-${h}`},g=f?["verify"]:["sign"];break;default:throw new Pe('Invalid or unsupported "alg" (Algorithm) value')}return me.subtle.importKey(n,y,c,(l=u==null?void 0:u.extractable)!==null&&l!==void 0?l:!1,g)},Ra=(r,n,s)=>rs(/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g,"pkcs8",r,n,s),ns=(r,n,s)=>rs(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g,"spki",r,n,s);function Ia(r){let n,s;switch(r.kty){case"oct":{switch(r.alg){case"HS256":case"HS384":case"HS512":n={name:"HMAC",hash:`SHA-${r.alg.slice(-3)}`},s=["sign","verify"];break;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":throw new Pe(`${r.alg} keys cannot be imported as CryptoKey instances`);case"A128GCM":case"A192GCM":case"A256GCM":case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":n={name:"AES-GCM"},s=["encrypt","decrypt"];break;case"A128KW":case"A192KW":case"A256KW":n={name:"AES-KW"},s=["wrapKey","unwrapKey"];break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":n={name:"PBKDF2"},s=["deriveBits"];break;default:throw new Pe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"RSA":{switch(r.alg){case"PS256":case"PS384":case"PS512":n={name:"RSA-PSS",hash:`SHA-${r.alg.slice(-3)}`},s=r.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":n={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${r.alg.slice(-3)}`},s=r.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":n={name:"RSA-OAEP",hash:`SHA-${parseInt(r.alg.slice(-3),10)||1}`},s=r.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new Pe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(r.alg){case"ES256":n={name:"ECDSA",namedCurve:"P-256"},s=r.d?["sign"]:["verify"];break;case"ES384":n={name:"ECDSA",namedCurve:"P-384"},s=r.d?["sign"]:["verify"];break;case"ES512":n={name:"ECDSA",namedCurve:"P-521"},s=r.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":n={name:"ECDH",namedCurve:r.crv},s=r.d?["deriveBits"]:[];break;default:throw new Pe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case(pr()&&"OKP"):if(r.alg!=="EdDSA")throw new Pe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value');switch(r.crv){case"Ed25519":n={name:"NODE-ED25519",namedCurve:"NODE-ED25519"},s=r.d?["sign"]:["verify"];break;default:throw new Pe('Invalid or unsupported JWK "crv" (Subtype of Key Pair) Parameter value')}break;default:throw new Pe('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:n,keyUsages:s}}const ka=async r=>{var n,s;const{algorithm:o,keyUsages:u}=Ia(r),l=[o,(n=r.ext)!==null&&n!==void 0?n:!1,(s=r.key_ops)!==null&&s!==void 0?s:u];if(o.name==="PBKDF2")return me.subtle.importKey("raw",rt(r.k),...l);const c={...r};return delete c.alg,me.subtle.importKey("jwk",c,...l)};var eo=ka;function to(r){let n=[],s=0;for(;s<r.length;){let o=is(r.subarray(s));n.push(o),s+=o.byteLength}return n}function is(r){let n=0,s=r[0]&31;if(n++,s===31){for(s=0;r[n]>=128;)s=s*128+r[n]-128,n++;s=s*128+r[n]-128,n++}let o=0;if(r[n]<128)o=r[n],n++;else{let l=r[n]&127;n++,o=0;for(let c=0;c<l;c++)o=o*256+r[n],n++}if(o===128){for(o=0;r[n+o]!==0||r[n+o+1]!==0;)o++;const l=n+o+2;return{byteLength:l,contents:r.subarray(n,n+o),raw:r.subarray(0,l)}}const u=n+o;return{byteLength:u,contents:r.subarray(n,u),raw:r.subarray(0,u)}}function Ua(r){const n=to(to(is(r).contents)[0].contents);return ui(n[n[0].raw[0]===160?6:5].raw)}function Oa(r){const n=r.replace(/(?:-----(?:BEGIN|END) CERTIFICATE-----|\s)/g,""),s=Mo(n);return es(Ua(s),"PUBLIC KEY")}async function Da(r,n,s){if(typeof r!="string"||r.indexOf("-----BEGIN PUBLIC KEY-----")!==0)throw new TypeError('"spki" must be SPKI formatted string');return ns(r,n,s)}async function Ha(r,n,s){if(typeof r!="string"||r.indexOf("-----BEGIN CERTIFICATE-----")!==0)throw new TypeError('"x509" must be X.509 formatted string');const o=Oa(r);return ns(o,n,s)}async function Na(r,n,s){if(typeof r!="string"||r.indexOf("-----BEGIN PRIVATE KEY-----")!==0)throw new TypeError('"pkcs8" must be PCKS8 formatted string');return Ra(r,n,s)}async function pn(r,n,s){if(!ot(r))throw new TypeError("JWK must be an object");if(n||(n=r.alg),typeof n!="string"||!n)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');switch(r.kty){case"oct":if(typeof r.k!="string"||!r.k)throw new TypeError('missing "k" (Key Value) Parameter value');return s!=null||(s=r.ext!==!0),s?eo({...r,alg:n,ext:!1}):rt(r.k);case"RSA":if(r.oth!==void 0)throw new Pe('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return eo({...r,alg:n});default:throw new Pe('Unsupported "kty" (Key Type) Parameter value')}}const La=r=>{if(!(r instanceof Uint8Array)){if(!$o(r))throw new TypeError(st(r,...je,"Uint8Array"));if(r.type!=="secret")throw new TypeError(`${je.join(" or ")} instances for symmetric algorithms must be of type "secret"`)}},Ma=(r,n)=>{if(!$o(r))throw new TypeError(st(r,...je));if(r.type==="secret")throw new TypeError(`${je.join(" or ")} instances for asymmetric algorithms must not be of type "secret"`);if(n==="sign"&&r.type==="public")throw new TypeError(`${je.join(" or ")} instances for asymmetric algorithm signing must be of type "private"`);if(n==="decrypt"&&r.type==="public")throw new TypeError(`${je.join(" or ")} instances for asymmetric algorithm decryption must be of type "private"`);if(r.algorithm&&n==="verify"&&r.type==="private")throw new TypeError(`${je.join(" or ")} instances for asymmetric algorithm verifying must be of type "public"`);if(r.algorithm&&n==="encrypt"&&r.type==="private")throw new TypeError(`${je.join(" or ")} instances for asymmetric algorithm encryption must be of type "public"`)},Ka=(r,n,s)=>{r.startsWith("HS")||r==="dir"||r.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(r)?La(n):Ma(n,s)};var gn=Ka;async function Ba(r,n,s,o,u){if(!(s instanceof Uint8Array))throw new TypeError(st(s,"Uint8Array"));const l=parseInt(r.slice(1,4),10),c=await me.subtle.importKey("raw",s.subarray(l>>3),"AES-CBC",!1,["encrypt"]),g=await me.subtle.importKey("raw",s.subarray(0,l>>3),{hash:`SHA-${l<<1}`,name:"HMAC"},!1,["sign"]),y=new Uint8Array(await me.subtle.encrypt({iv:o,name:"AES-CBC"},c,n)),f=$t(u,o,y,Lo(u.length<<3)),h=new Uint8Array((await me.subtle.sign("HMAC",g,f)).slice(0,l>>3));return{ciphertext:y,tag:h}}async function ja(r,n,s,o,u){let l;s instanceof Uint8Array?l=await me.subtle.importKey("raw",s,"AES-GCM",!1,["encrypt"]):(ir(s,r,"encrypt"),l=s);const c=new Uint8Array(await me.subtle.encrypt({additionalData:u,iv:o,name:"AES-GCM",tagLength:128},l,n)),g=c.slice(-16);return{ciphertext:c.slice(0,-16),tag:g}}const Wa=async(r,n,s,o,u)=>{if(!Ct(s)&&!(s instanceof Uint8Array))throw new TypeError(st(s,...je,"Uint8Array"));switch(Jo(r,o),r){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return s instanceof Uint8Array&&on(s,parseInt(r.slice(-3),10)),Ba(r,n,s,o,u);case"A128GCM":case"A192GCM":case"A256GCM":return s instanceof Uint8Array&&on(s,parseInt(r.slice(1,4),10)),ja(r,n,s,o,u);default:throw new Pe("Unsupported JWE Content Encryption Algorithm")}};var zn=Wa;async function Va(r,n,s,o){const u=r.slice(0,7);o||(o=Vo(u));const{ciphertext:l,tag:c}=await zn(u,s,n,o,new Uint8Array(0));return{encryptedKey:l,iv:Ye(o),tag:Ye(c)}}async function Ja(r,n,s,o,u){const l=r.slice(0,7);return Go(l,n,s,o,u,new Uint8Array(0))}async function qa(r,n,s,o){switch(gn(r,n,"decrypt"),r){case"dir":{if(s!==void 0)throw new ye("Encountered unexpected JWE Encrypted Key");return n}case"ECDH-ES":if(s!==void 0)throw new ye("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!ot(o.epk))throw new ye('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(!Qo(n))throw new Pe("ECDH with the provided key is not allowed or not supported by your javascript runtime");const u=await pn(o.epk,r);let l,c;if(o.apu!==void 0){if(typeof o.apu!="string")throw new ye('JOSE Header "apu" (Agreement PartyUInfo) invalid');l=rt(o.apu)}if(o.apv!==void 0){if(typeof o.apv!="string")throw new ye('JOSE Header "apv" (Agreement PartyVInfo) invalid');c=rt(o.apv)}const g=await Xo(u,n,r==="ECDH-ES"?o.enc:r,r==="ECDH-ES"?di(o.enc):parseInt(r.slice(-5,-2),10),l,c);if(r==="ECDH-ES")return g;if(s===void 0)throw new ye("JWE Encrypted Key missing");return Gn(r.slice(-6),g,s)}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(s===void 0)throw new ye("JWE Encrypted Key missing");return Ta(r,n,s)}case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{if(s===void 0)throw new ye("JWE Encrypted Key missing");if(typeof o.p2c!="number")throw new ye('JOSE Header "p2c" (PBES2 Count) missing or invalid');if(typeof o.p2s!="string")throw new ye('JOSE Header "p2s" (PBES2 Salt) missing or invalid');return Aa(r,n,s,o.p2c,rt(o.p2s))}case"A128KW":case"A192KW":case"A256KW":{if(s===void 0)throw new ye("JWE Encrypted Key missing");return Gn(r,n,s)}case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{if(s===void 0)throw new ye("JWE Encrypted Key missing");if(typeof o.iv!="string")throw new ye('JOSE Header "iv" (Initialization Vector) missing or invalid');if(typeof o.tag!="string")throw new ye('JOSE Header "tag" (Authentication Tag) missing or invalid');const u=rt(o.iv),l=rt(o.tag);return Ja(r,n,s,u,l)}default:throw new Pe('Invalid or unsupported "alg" (JWE Algorithm) header value')}}function Kr(r,n,s,o,u){if(u.crit!==void 0&&o.crit===void 0)throw new r('"crit" (Critical) Header Parameter MUST be integrity protected');if(!o||o.crit===void 0)return new Set;if(!Array.isArray(o.crit)||o.crit.length===0||o.crit.some(c=>typeof c!="string"||c.length===0))throw new r('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let l;s!==void 0?l=new Map([...Object.entries(s),...n.entries()]):l=n;for(const c of o.crit){if(!l.has(c))throw new Pe(`Extension Header Parameter "${c}" is not recognized`);if(u[c]===void 0)throw new r(`Extension Header Parameter "${c}" is missing`);if(l.get(c)&&o[c]===void 0)throw new r(`Extension Header Parameter "${c}" MUST be integrity protected`)}return new Set(o.crit)}const $a=(r,n)=>{if(n!==void 0&&(!Array.isArray(n)||n.some(s=>typeof s!="string")))throw new TypeError(`"${r}" option must be an array of strings`);if(!!n)return new Set(n)};var Yn=$a;async function hi(r,n,s){var o;if(!ot(r))throw new ye("Flattened JWE must be an object");if(r.protected===void 0&&r.header===void 0&&r.unprotected===void 0)throw new ye("JOSE Header missing");if(typeof r.iv!="string")throw new ye("JWE Initialization Vector missing or incorrect type");if(typeof r.ciphertext!="string")throw new ye("JWE Ciphertext missing or incorrect type");if(typeof r.tag!="string")throw new ye("JWE Authentication Tag missing or incorrect type");if(r.protected!==void 0&&typeof r.protected!="string")throw new ye("JWE Protected Header incorrect type");if(r.encrypted_key!==void 0&&typeof r.encrypted_key!="string")throw new ye("JWE Encrypted Key incorrect type");if(r.aad!==void 0&&typeof r.aad!="string")throw new ye("JWE AAD incorrect type");if(r.header!==void 0&&!ot(r.header))throw new ye("JWE Shared Unprotected Header incorrect type");if(r.unprotected!==void 0&&!ot(r.unprotected))throw new ye("JWE Per-Recipient Unprotected Header incorrect type");let u;if(r.protected){const H=rt(r.protected);try{u=JSON.parse(Dt.decode(H))}catch{throw new ye("JWE Protected Header is invalid")}}if(!Mr(u,r.header,r.unprotected))throw new ye("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");const l={...u,...r.header,...r.unprotected};if(Kr(ye,new Map,s==null?void 0:s.crit,u,l),l.zip!==void 0){if(!u||!u.zip)throw new ye('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if(l.zip!=="DEF")throw new Pe('Unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}const{alg:c,enc:g}=l;if(typeof c!="string"||!c)throw new ye("missing JWE Algorithm (alg) in JWE Header");if(typeof g!="string"||!g)throw new ye("missing JWE Encryption Algorithm (enc) in JWE Header");const y=s&&Yn("keyManagementAlgorithms",s.keyManagementAlgorithms),f=s&&Yn("contentEncryptionAlgorithms",s.contentEncryptionAlgorithms);if(y&&!y.has(c))throw new rn('"alg" (Algorithm) Header Parameter not allowed');if(f&&!f.has(g))throw new rn('"enc" (Encryption Algorithm) Header Parameter not allowed');let h;r.encrypted_key!==void 0&&(h=rt(r.encrypted_key));let p=!1;typeof n=="function"&&(n=await n(u,r),p=!0);let w;try{w=await qa(c,n,h,l)}catch(H){if(H instanceof TypeError)throw H;w=lr(g)}const x=rt(r.iv),F=rt(r.tag),P=Je.encode((o=r.protected)!==null&&o!==void 0?o:"");let A;r.aad!==void 0?A=$t(P,Je.encode("."),Je.encode(r.aad)):A=P;let b=await Go(g,w,rt(r.ciphertext),x,F,A);l.zip==="DEF"&&(b=await((s==null?void 0:s.inflateRaw)||ya)(b));const T={plaintext:b};return r.protected!==void 0&&(T.protectedHeader=u),r.aad!==void 0&&(T.additionalAuthenticatedData=rt(r.aad)),r.unprotected!==void 0&&(T.sharedUnprotectedHeader=r.unprotected),r.header!==void 0&&(T.unprotectedHeader=r.header),p?{...T,key:n}:T}async function os(r,n,s){if(r instanceof Uint8Array&&(r=Dt.decode(r)),typeof r!="string")throw new ye("Compact JWE must be a string or Uint8Array");const{0:o,1:u,2:l,3:c,4:g,length:y}=r.split(".");if(y!==5)throw new ye("Invalid Compact JWE");const f=await hi({ciphertext:c,iv:l||void 0,protected:o||void 0,tag:g||void 0,encrypted_key:u||void 0},n,s),h={plaintext:f.plaintext,protectedHeader:f.protectedHeader};return typeof n=="function"?{...h,key:f.key}:h}async function Ga(r,n,s){if(!ot(r))throw new ye("General JWE must be an object");if(!Array.isArray(r.recipients)||!r.recipients.every(ot))throw new ye("JWE Recipients missing or incorrect type");if(!r.recipients.length)throw new ye("JWE Recipients has no members");for(const o of r.recipients)try{return await hi({aad:r.aad,ciphertext:r.ciphertext,encrypted_key:o.encrypted_key,header:o.header,iv:r.iv,protected:r.protected,tag:r.tag,unprotected:r.unprotected},n,s)}catch{}throw new Lr}const za=async r=>{if(r instanceof Uint8Array)return{kty:"oct",k:Ye(r)};if(!Ct(r))throw new TypeError(st(r,...je,"Uint8Array"));if(!r.extractable)throw new TypeError("non-extractable CryptoKey cannot be exported as a JWK");const{ext:n,key_ops:s,alg:o,use:u,...l}=await me.subtle.exportKey("jwk",r);return l};var Ya=za;async function Xa(r){return Ca(r)}async function Qa(r){return xa(r)}async function ss(r){return Ya(r)}async function as(r,n,s,o,u={}){let l,c,g;switch(gn(r,s,"encrypt"),r){case"dir":{g=s;break}case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!Qo(s))throw new Pe("ECDH with the provided key is not allowed or not supported by your javascript runtime");const{apu:y,apv:f}=u;let{epk:h}=u;h||(h=(await Sa(s)).privateKey);const{x:p,y:w,crv:x,kty:F}=await ss(h),P=await Xo(s,h,r==="ECDH-ES"?n:r,r==="ECDH-ES"?di(n):parseInt(r.slice(-5,-2),10),y,f);if(c={epk:{x:p,crv:x,kty:F}},F==="EC"&&(c.epk.y=w),y&&(c.apu=Ye(y)),f&&(c.apv=Ye(f)),r==="ECDH-ES"){g=P;break}g=o||lr(n);const A=r.slice(-6);l=await $n(A,P,g);break}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{g=o||lr(n),l=await Pa(r,s,g);break}case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{g=o||lr(n);const{p2c:y,p2s:f}=u;({encryptedKey:l,...c}=await Fa(r,s,g,y,f));break}case"A128KW":case"A192KW":case"A256KW":{g=o||lr(n),l=await $n(r,s,g);break}case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{g=o||lr(n);const{iv:y}=u;({encryptedKey:l,...c}=await Va(r,s,g,y));break}default:throw new Pe('Invalid or unsupported "alg" (JWE Algorithm) header value')}return{cek:g,encryptedKey:l,parameters:c}}const us=Symbol();class an{constructor(n){if(!(n instanceof Uint8Array))throw new TypeError("plaintext must be an instance of Uint8Array");this._plaintext=n}setKeyManagementParameters(n){if(this._keyManagementParameters)throw new TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=n,this}setProtectedHeader(n){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=n,this}setSharedUnprotectedHeader(n){if(this._sharedUnprotectedHeader)throw new TypeError("setSharedUnprotectedHeader can only be called once");return this._sharedUnprotectedHeader=n,this}setUnprotectedHeader(n){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=n,this}setAdditionalAuthenticatedData(n){return this._aad=n,this}setContentEncryptionKey(n){if(this._cek)throw new TypeError("setContentEncryptionKey can only be called once");return this._cek=n,this}setInitializationVector(n){if(this._iv)throw new TypeError("setInitializationVector can only be called once");return this._iv=n,this}async encrypt(n,s){if(!this._protectedHeader&&!this._unprotectedHeader&&!this._sharedUnprotectedHeader)throw new ye("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");if(!Mr(this._protectedHeader,this._unprotectedHeader,this._sharedUnprotectedHeader))throw new ye("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");const o={...this._protectedHeader,...this._unprotectedHeader,...this._sharedUnprotectedHeader};if(Kr(ye,new Map,s==null?void 0:s.crit,this._protectedHeader,o),o.zip!==void 0){if(!this._protectedHeader||!this._protectedHeader.zip)throw new ye('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if(o.zip!=="DEF")throw new Pe('Unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}const{alg:u,enc:l}=o;if(typeof u!="string"||!u)throw new ye('JWE "alg" (Algorithm) Header Parameter missing or invalid');if(typeof l!="string"||!l)throw new ye('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');let c;if(u==="dir"){if(this._cek)throw new TypeError("setContentEncryptionKey cannot be called when using Direct Encryption")}else if(u==="ECDH-ES"&&this._cek)throw new TypeError("setContentEncryptionKey cannot be called when using Direct Key Agreement");let g;{let F;({cek:g,encryptedKey:c,parameters:F}=await as(u,l,n,this._cek,this._keyManagementParameters)),F&&(s&&us in s?this._unprotectedHeader?this._unprotectedHeader={...this._unprotectedHeader,...F}:this.setUnprotectedHeader(F):this._protectedHeader?this._protectedHeader={...this._protectedHeader,...F}:this.setProtectedHeader(F))}this._iv||(this._iv=Vo(l));let y,f,h;this._protectedHeader?f=Je.encode(Ye(JSON.stringify(this._protectedHeader))):f=Je.encode(""),this._aad?(h=Ye(this._aad),y=$t(f,Je.encode("."),Je.encode(h))):y=f;let p,w;if(o.zip==="DEF"){const F=await((s==null?void 0:s.deflateRaw)||va)(this._plaintext);({ciphertext:p,tag:w}=await zn(l,F,g,this._iv,y))}else({ciphertext:p,tag:w}=await zn(l,this._plaintext,g,this._iv,y));const x={ciphertext:Ye(p),iv:Ye(this._iv),tag:Ye(w)};return c&&(x.encrypted_key=Ye(c)),h&&(x.aad=h),this._protectedHeader&&(x.protected=Dt.decode(f)),this._sharedUnprotectedHeader&&(x.unprotected=this._sharedUnprotectedHeader),this._unprotectedHeader&&(x.header=this._unprotectedHeader),x}}class Za{constructor(n,s,o){this.parent=n,this.key=s,this.options=o}setUnprotectedHeader(n){if(this.unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=n,this}addRecipient(...n){return this.parent.addRecipient(...n)}encrypt(...n){return this.parent.encrypt(...n)}done(){return this.parent}}class eu{constructor(n){this._recipients=[],this._plaintext=n}addRecipient(n,s){const o=new Za(this,n,{crit:s==null?void 0:s.crit});return this._recipients.push(o),o}setProtectedHeader(n){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=n,this}setSharedUnprotectedHeader(n){if(this._unprotectedHeader)throw new TypeError("setSharedUnprotectedHeader can only be called once");return this._unprotectedHeader=n,this}setAdditionalAuthenticatedData(n){return this._aad=n,this}async encrypt(n){var s,o,u;if(!this._recipients.length)throw new ye("at least one recipient must be added");if(n={deflateRaw:n==null?void 0:n.deflateRaw},this._recipients.length===1){const[y]=this._recipients,f=await new an(this._plaintext).setAdditionalAuthenticatedData(this._aad).setProtectedHeader(this._protectedHeader).setSharedUnprotectedHeader(this._unprotectedHeader).setUnprotectedHeader(y.unprotectedHeader).encrypt(y.key,{...y.options,...n});let h={ciphertext:f.ciphertext,iv:f.iv,recipients:[{}],tag:f.tag};return f.aad&&(h.aad=f.aad),f.protected&&(h.protected=f.protected),f.unprotected&&(h.unprotected=f.unprotected),f.encrypted_key&&(h.recipients[0].encrypted_key=f.encrypted_key),f.header&&(h.recipients[0].header=f.header),h}let l;for(let y=0;y<this._recipients.length;y++){const f=this._recipients[y];if(!Mr(this._protectedHeader,this._unprotectedHeader,f.unprotectedHeader))throw new ye("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");const h={...this._protectedHeader,...this._unprotectedHeader,...f.unprotectedHeader},{alg:p}=h;if(typeof p!="string"||!p)throw new ye('JWE "alg" (Algorithm) Header Parameter missing or invalid');if(p==="dir"||p==="ECDH-ES")throw new ye('"dir" and "ECDH-ES" alg may only be used with a single recipient');if(typeof h.enc!="string"||!h.enc)throw new ye('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if(!l)l=h.enc;else if(l!==h.enc)throw new ye('JWE "enc" (Encryption Algorithm) Header Parameter must be the same for all recipients');if(Kr(ye,new Map,f.options.crit,this._protectedHeader,h),h.zip!==void 0&&(!this._protectedHeader||!this._protectedHeader.zip))throw new ye('JWE "zip" (Compression Algorithm) Header MUST be integrity protected')}const c=lr(l);let g={ciphertext:"",iv:"",recipients:[],tag:""};for(let y=0;y<this._recipients.length;y++){const f=this._recipients[y],h={};g.recipients.push(h);const w={...this._protectedHeader,...this._unprotectedHeader,...f.unprotectedHeader}.alg.startsWith("PBES2")?2048+y:void 0;if(y===0){const P=await new an(this._plaintext).setAdditionalAuthenticatedData(this._aad).setContentEncryptionKey(c).setProtectedHeader(this._protectedHeader).setSharedUnprotectedHeader(this._unprotectedHeader).setUnprotectedHeader(f.unprotectedHeader).setKeyManagementParameters({p2c:w}).encrypt(f.key,{...f.options,...n,[us]:!0});g.ciphertext=P.ciphertext,g.iv=P.iv,g.tag=P.tag,P.aad&&(g.aad=P.aad),P.protected&&(g.protected=P.protected),P.unprotected&&(g.unprotected=P.unprotected),h.encrypted_key=P.encrypted_key,P.header&&(h.header=P.header);continue}const{encryptedKey:x,parameters:F}=await as(((s=f.unprotectedHeader)===null||s===void 0?void 0:s.alg)||((o=this._protectedHeader)===null||o===void 0?void 0:o.alg)||((u=this._unprotectedHeader)===null||u===void 0?void 0:u.alg),l,f.key,c,{p2c:w});h.encrypted_key=Ye(x),(f.unprotectedHeader||F)&&(h.header={...f.unprotectedHeader,...F})}return g}}function cs(r,n){const s=`SHA-${r.slice(-3)}`;switch(r){case"HS256":case"HS384":case"HS512":return{hash:s,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:s,name:"RSA-PSS",saltLength:r.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:s,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:s,name:"ECDSA",namedCurve:n.namedCurve};case(pr()&&"EdDSA"):const{namedCurve:o}=n;return{name:o,namedCurve:o};default:throw new Pe(`alg ${r} is not supported either by JOSE or your javascript runtime`)}}function ls(r,n,s){if(Ct(n))return ha(n,r,s),n;if(n instanceof Uint8Array){if(!r.startsWith("HS"))throw new TypeError(st(n,...je));return me.subtle.importKey("raw",n,{hash:`SHA-${r.slice(-3)}`,name:"HMAC"},!1,[s])}throw new TypeError(st(n,...je,"Uint8Array"))}const tu=async(r,n,s,o)=>{const u=await ls(r,n,"verify");fn(r,u);const l=cs(r,u.algorithm);try{return await me.subtle.verify(l,u,s,o)}catch{return!1}};var ru=tu;async function fi(r,n,s){var o;if(!ot(r))throw new ke("Flattened JWS must be an object");if(r.protected===void 0&&r.header===void 0)throw new ke('Flattened JWS must have either of the "protected" or "header" members');if(r.protected!==void 0&&typeof r.protected!="string")throw new ke("JWS Protected Header incorrect type");if(r.payload===void 0)throw new ke("JWS Payload missing");if(typeof r.signature!="string")throw new ke("JWS Signature missing or incorrect type");if(r.header!==void 0&&!ot(r.header))throw new ke("JWS Unprotected Header incorrect type");let u={};if(r.protected){const A=rt(r.protected);try{u=JSON.parse(Dt.decode(A))}catch{throw new ke("JWS Protected Header is invalid")}}if(!Mr(u,r.header))throw new ke("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const l={...u,...r.header},c=Kr(ke,new Map([["b64",!0]]),s==null?void 0:s.crit,u,l);let g=!0;if(c.has("b64")&&(g=u.b64,typeof g!="boolean"))throw new ke('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:y}=l;if(typeof y!="string"||!y)throw new ke('JWS "alg" (Algorithm) Header Parameter missing or invalid');const f=s&&Yn("algorithms",s.algorithms);if(f&&!f.has(y))throw new rn('"alg" (Algorithm) Header Parameter not allowed');if(g){if(typeof r.payload!="string")throw new ke("JWS Payload must be a string")}else if(typeof r.payload!="string"&&!(r.payload instanceof Uint8Array))throw new ke("JWS Payload must be a string or an Uint8Array instance");let h=!1;typeof n=="function"&&(n=await n(u,r),h=!0),gn(y,n,"verify");const p=$t(Je.encode((o=r.protected)!==null&&o!==void 0?o:""),Je.encode("."),typeof r.payload=="string"?Je.encode(r.payload):r.payload),w=rt(r.signature);if(!await ru(y,n,w,p))throw new li;let F;g?F=rt(r.payload):typeof r.payload=="string"?F=Je.encode(r.payload):F=r.payload;const P={payload:F};return r.protected!==void 0&&(P.protectedHeader=u),r.header!==void 0&&(P.unprotectedHeader=r.header),h?{...P,key:n}:P}async function ds(r,n,s){if(r instanceof Uint8Array&&(r=Dt.decode(r)),typeof r!="string")throw new ke("Compact JWS must be a string or Uint8Array");const{0:o,1:u,2:l,length:c}=r.split(".");if(c!==3)throw new ke("Invalid Compact JWS");const g=await fi({payload:u,protected:o,signature:l},n,s),y={payload:g.payload,protectedHeader:g.protectedHeader};return typeof n=="function"?{...y,key:g.key}:y}async function nu(r,n,s){if(!ot(r))throw new ke("General JWS must be an object");if(!Array.isArray(r.signatures)||!r.signatures.every(ot))throw new ke("JWS Signatures missing or incorrect type");for(const o of r.signatures)try{return await fi({header:o.header,payload:r.payload,protected:o.protected,signature:o.signature},n,s)}catch{}throw new li}var en=r=>Math.floor(r.getTime()/1e3);const hs=60,fs=hs*60,pi=fs*24,iu=pi*7,ou=pi*365.25,su=/^(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)$/i;var un=r=>{const n=su.exec(r);if(!n)throw new TypeError("Invalid time period format");const s=parseFloat(n[1]);switch(n[2].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":return Math.round(s);case"minute":case"minutes":case"min":case"mins":case"m":return Math.round(s*hs);case"hour":case"hours":case"hr":case"hrs":case"h":return Math.round(s*fs);case"day":case"days":case"d":return Math.round(s*pi);case"week":case"weeks":case"w":return Math.round(s*iu);default:return Math.round(s*ou)}};const ro=r=>r.toLowerCase().replace(/^application\//,""),au=(r,n)=>typeof r=="string"?n.includes(r):Array.isArray(r)?n.some(Set.prototype.has.bind(new Set(r))):!1;var gi=(r,n,s={})=>{const{typ:o}=s;if(o&&(typeof r.typ!="string"||ro(r.typ)!==ro(o)))throw new xt('unexpected "typ" JWT header value',"typ","check_failed");let u;try{u=JSON.parse(Dt.decode(n))}catch{}if(!ot(u))throw new Pt("JWT Claims Set must be a top-level JSON object");const{issuer:l}=s;if(l&&!(Array.isArray(l)?l:[l]).includes(u.iss))throw new xt('unexpected "iss" claim value',"iss","check_failed");const{subject:c}=s;if(c&&u.sub!==c)throw new xt('unexpected "sub" claim value',"sub","check_failed");const{audience:g}=s;if(g&&!au(u.aud,typeof g=="string"?[g]:g))throw new xt('unexpected "aud" claim value',"aud","check_failed");let y;switch(typeof s.clockTolerance){case"string":y=un(s.clockTolerance);break;case"number":y=s.clockTolerance;break;case"undefined":y=0;break;default:throw new TypeError("Invalid clockTolerance option type")}const{currentDate:f}=s,h=en(f||new Date);if((u.iat!==void 0||s.maxTokenAge)&&typeof u.iat!="number")throw new xt('"iat" claim must be a number',"iat","invalid");if(u.nbf!==void 0){if(typeof u.nbf!="number")throw new xt('"nbf" claim must be a number',"nbf","invalid");if(u.nbf>h+y)throw new xt('"nbf" claim timestamp check failed',"nbf","check_failed")}if(u.exp!==void 0){if(typeof u.exp!="number")throw new xt('"exp" claim must be a number',"exp","invalid");if(u.exp<=h-y)throw new qn('"exp" claim timestamp check failed',"exp","check_failed")}if(s.maxTokenAge){const p=h-u.iat,w=typeof s.maxTokenAge=="number"?s.maxTokenAge:un(s.maxTokenAge);if(p-y>w)throw new qn('"iat" claim timestamp check failed (too far in the past)',"iat","check_failed");if(p<0-y)throw new xt('"iat" claim timestamp check failed (it should be in the past)',"iat","check_failed")}return u};async function uu(r,n,s){var o;const u=await ds(r,n,s);if(((o=u.protectedHeader.crit)===null||o===void 0?void 0:o.includes("b64"))&&u.protectedHeader.b64===!1)throw new Pt("JWTs MUST NOT use unencoded payload");const c={payload:gi(u.protectedHeader,u.payload,s),protectedHeader:u.protectedHeader};return typeof n=="function"?{...c,key:u.key}:c}async function cu(r,n,s){const o=await os(r,n,s),u=gi(o.protectedHeader,o.plaintext,s),{protectedHeader:l}=o;if(l.iss!==void 0&&l.iss!==u.iss)throw new xt('replicated "iss" claim header parameter mismatch',"iss","mismatch");if(l.sub!==void 0&&l.sub!==u.sub)throw new xt('replicated "sub" claim header parameter mismatch',"sub","mismatch");if(l.aud!==void 0&&JSON.stringify(l.aud)!==JSON.stringify(u.aud))throw new xt('replicated "aud" claim header parameter mismatch',"aud","mismatch");const c={payload:u,protectedHeader:l};return typeof n=="function"?{...c,key:o.key}:c}class ps{constructor(n){this._flattened=new an(n)}setContentEncryptionKey(n){return this._flattened.setContentEncryptionKey(n),this}setInitializationVector(n){return this._flattened.setInitializationVector(n),this}setProtectedHeader(n){return this._flattened.setProtectedHeader(n),this}setKeyManagementParameters(n){return this._flattened.setKeyManagementParameters(n),this}async encrypt(n,s){const o=await this._flattened.encrypt(n,s);return[o.protected,o.encrypted_key,o.iv,o.ciphertext,o.tag].join(".")}}const lu=async(r,n,s)=>{const o=await ls(r,n,"sign");fn(r,o);const u=await me.subtle.sign(cs(r,o.algorithm),o,s);return new Uint8Array(u)};var du=lu;class yi{constructor(n){if(!(n instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=n}setProtectedHeader(n){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=n,this}setUnprotectedHeader(n){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=n,this}async sign(n,s){if(!this._protectedHeader&&!this._unprotectedHeader)throw new ke("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!Mr(this._protectedHeader,this._unprotectedHeader))throw new ke("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const o={...this._protectedHeader,...this._unprotectedHeader},u=Kr(ke,new Map([["b64",!0]]),s==null?void 0:s.crit,this._protectedHeader,o);let l=!0;if(u.has("b64")&&(l=this._protectedHeader.b64,typeof l!="boolean"))throw new ke('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:c}=o;if(typeof c!="string"||!c)throw new ke('JWS "alg" (Algorithm) Header Parameter missing or invalid');gn(c,n,"sign");let g=this._payload;l&&(g=Je.encode(Ye(g)));let y;this._protectedHeader?y=Je.encode(Ye(JSON.stringify(this._protectedHeader))):y=Je.encode("");const f=$t(y,Je.encode("."),g),h=await du(c,n,f),p={signature:Ye(h),payload:""};return l&&(p.payload=Dt.decode(g)),this._unprotectedHeader&&(p.header=this._unprotectedHeader),this._protectedHeader&&(p.protected=Dt.decode(y)),p}}class gs{constructor(n){this._flattened=new yi(n)}setProtectedHeader(n){return this._flattened.setProtectedHeader(n),this}async sign(n,s){const o=await this._flattened.sign(n,s);if(o.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${o.protected}.${o.payload}.${o.signature}`}}class hu{constructor(n,s,o){this.parent=n,this.key=s,this.options=o}setProtectedHeader(n){if(this.protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this.protectedHeader=n,this}setUnprotectedHeader(n){if(this.unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=n,this}addSignature(...n){return this.parent.addSignature(...n)}sign(...n){return this.parent.sign(...n)}done(){return this.parent}}class fu{constructor(n){this._signatures=[],this._payload=n}addSignature(n,s){const o=new hu(this,n,s);return this._signatures.push(o),o}async sign(){if(!this._signatures.length)throw new ke("at least one signature must be added");const n={signatures:[],payload:""};for(let s=0;s<this._signatures.length;s++){const o=this._signatures[s],u=new yi(this._payload);u.setProtectedHeader(o.protectedHeader),u.setUnprotectedHeader(o.unprotectedHeader);const{payload:l,...c}=await u.sign(o.key,o.options);if(s===0)n.payload=l;else if(n.payload!==l)throw new ke("inconsistent use of JWS Unencoded Payload Option (RFC7797)");n.signatures.push(c)}return n}}class vi{constructor(n){if(!ot(n))throw new TypeError("JWT Claims Set MUST be an object");this._payload=n}setIssuer(n){return this._payload={...this._payload,iss:n},this}setSubject(n){return this._payload={...this._payload,sub:n},this}setAudience(n){return this._payload={...this._payload,aud:n},this}setJti(n){return this._payload={...this._payload,jti:n},this}setNotBefore(n){return typeof n=="number"?this._payload={...this._payload,nbf:n}:this._payload={...this._payload,nbf:en(new Date)+un(n)},this}setExpirationTime(n){return typeof n=="number"?this._payload={...this._payload,exp:n}:this._payload={...this._payload,exp:en(new Date)+un(n)},this}setIssuedAt(n){return typeof n=="undefined"?this._payload={...this._payload,iat:en(new Date)}:this._payload={...this._payload,iat:n},this}}class pu extends vi{setProtectedHeader(n){return this._protectedHeader=n,this}async sign(n,s){var o;const u=new gs(Je.encode(JSON.stringify(this._payload)));if(u.setProtectedHeader(this._protectedHeader),Array.isArray((o=this._protectedHeader)===null||o===void 0?void 0:o.crit)&&this._protectedHeader.crit.includes("b64")&&this._protectedHeader.b64===!1)throw new Pt("JWTs MUST NOT use unencoded payload");return u.sign(n,s)}}class gu extends vi{setProtectedHeader(n){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=n,this}setKeyManagementParameters(n){if(this._keyManagementParameters)throw new TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=n,this}setContentEncryptionKey(n){if(this._cek)throw new TypeError("setContentEncryptionKey can only be called once");return this._cek=n,this}setInitializationVector(n){if(this._iv)throw new TypeError("setInitializationVector can only be called once");return this._iv=n,this}replicateIssuerAsHeader(){return this._replicateIssuerAsHeader=!0,this}replicateSubjectAsHeader(){return this._replicateSubjectAsHeader=!0,this}replicateAudienceAsHeader(){return this._replicateAudienceAsHeader=!0,this}async encrypt(n,s){const o=new ps(Je.encode(JSON.stringify(this._payload)));return this._replicateIssuerAsHeader&&(this._protectedHeader={...this._protectedHeader,iss:this._payload.iss}),this._replicateSubjectAsHeader&&(this._protectedHeader={...this._protectedHeader,sub:this._payload.sub}),this._replicateAudienceAsHeader&&(this._protectedHeader={...this._protectedHeader,aud:this._payload.aud}),o.setProtectedHeader(this._protectedHeader),this._iv&&o.setInitializationVector(this._iv),this._cek&&o.setContentEncryptionKey(this._cek),this._keyManagementParameters&&o.setKeyManagementParameters(this._keyManagementParameters),o.encrypt(n,s)}}const Zt=(r,n)=>{if(typeof r!="string"||!r)throw new Ko(`${n} missing or invalid`)};async function yu(r,n="sha256"){if(!ot(r))throw new TypeError("JWK must be an object");if(n!=="sha256"&&n!=="sha384"&&n!=="sha512")throw new TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');let s;switch(r.kty){case"EC":Zt(r.crv,'"crv" (Curve) Parameter'),Zt(r.x,'"x" (X Coordinate) Parameter'),Zt(r.y,'"y" (Y Coordinate) Parameter'),s={crv:r.crv,kty:r.kty,x:r.x,y:r.y};break;case"OKP":Zt(r.crv,'"crv" (Subtype of Key Pair) Parameter'),Zt(r.x,'"x" (Public Key) Parameter'),s={crv:r.crv,kty:r.kty,x:r.x};break;case"RSA":Zt(r.e,'"e" (Exponent) Parameter'),Zt(r.n,'"n" (Modulus) Parameter'),s={e:r.e,kty:r.kty,n:r.n};break;case"oct":Zt(r.k,'"k" (Key Value) Parameter'),s={k:r.k,kty:r.kty};break;default:throw new Pe('"kty" (Key Type) Parameter missing or unsupported')}const o=Je.encode(JSON.stringify(s));return Ye(await No(n,o))}async function vu(r,n){const s={...r,...n.header};if(!ot(s.jwk))throw new ke('"jwk" (JSON Web Key) Header Parameter must be a JSON object');const o=await pn({...s.jwk,ext:!0},s.alg,!0);if(o instanceof Uint8Array||o.type!=="public")throw new ke('"jwk" (JSON Web Key) Header Parameter must be a public key');return o}function mu(r){switch(typeof r=="string"&&r.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new Pe('Unsupported "alg" value for a JSON Web Key Set')}}function ys(r){return r&&typeof r=="object"&&Array.isArray(r.keys)&&r.keys.every(_u)}function _u(r){return ot(r)}function wu(r){return typeof structuredClone=="function"?structuredClone(r):JSON.parse(JSON.stringify(r))}class Xn{constructor(n){if(this._cached=new WeakMap,!ys(n))throw new nn("JSON Web Key Set malformed");this._jwks=wu(n)}async getKey(n,s){const{alg:o,kid:u}={...n,...s.header},l=mu(o),c=this._jwks.keys.filter(h=>{let p=l===h.kty;if(p&&typeof u=="string"&&(p=u===h.kid),p&&typeof h.alg=="string"&&(p=o===h.alg),p&&typeof h.use=="string"&&(p=h.use==="sig"),p&&Array.isArray(h.key_ops)&&(p=h.key_ops.includes("verify")),p&&o==="EdDSA"&&(p=h.crv==="Ed25519"||h.crv==="Ed448"),p)switch(o){case"ES256":p=h.crv==="P-256";break;case"ES256K":p=h.crv==="secp256k1";break;case"ES384":p=h.crv==="P-384";break;case"ES512":p=h.crv==="P-521";break}return p}),{0:g,length:y}=c;if(y===0)throw new ci;if(y!==1)throw new Bo;const f=this._cached.get(g)||this._cached.set(g,{}).get(g);if(f[o]===void 0){const h=await pn({...g,ext:!0},o);if(h instanceof Uint8Array||h.type!=="public")throw new nn("JSON Web Key Set members must be public keys");f[o]=h}return f[o]}}function Su(r){return Xn.prototype.getKey.bind(new Xn(r))}const Eu=async(r,n,s)=>{let o,u,l=!1;typeof AbortController=="function"&&(o=new AbortController,u=setTimeout(()=>{l=!0,o.abort()},n));const c=await fetch(r.href,{signal:o?o.signal:void 0,redirect:"manual",headers:s.headers}).catch(g=>{throw l?new jo:g});if(u!==void 0&&clearTimeout(u),c.status!==200)throw new lt("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await c.json()}catch{throw new lt("Failed to parse the JSON Web Key Set HTTP response as JSON")}};var bu=Eu;class no extends Xn{constructor(n,s){if(super({keys:[]}),this._jwks=void 0,!(n instanceof URL))throw new TypeError("url must be an instance of URL");this._url=new URL(n.href),this._options={agent:s==null?void 0:s.agent,headers:s==null?void 0:s.headers},this._timeoutDuration=typeof(s==null?void 0:s.timeoutDuration)=="number"?s==null?void 0:s.timeoutDuration:5e3,this._cooldownDuration=typeof(s==null?void 0:s.cooldownDuration)=="number"?s==null?void 0:s.cooldownDuration:3e4,this._cacheMaxAge=typeof(s==null?void 0:s.cacheMaxAge)=="number"?s==null?void 0:s.cacheMaxAge:6e5}coolingDown(){return typeof this._jwksTimestamp=="number"?Date.now()<this._jwksTimestamp+this._cooldownDuration:!1}fresh(){return typeof this._jwksTimestamp=="number"?Date.now()<this._jwksTimestamp+this._cacheMaxAge:!1}async getKey(n,s){(!this._jwks||!this.fresh())&&await this.reload();try{return await super.getKey(n,s)}catch(o){if(o instanceof ci&&this.coolingDown()===!1)return await this.reload(),super.getKey(n,s);throw o}}async reload(){if(this._pendingFetch&&pr())return new Promise(n=>{const s=()=>{this._pendingFetch===void 0?n():setTimeout(s,5)};s()});this._pendingFetch||(this._pendingFetch=bu(this._url,this._timeoutDuration,this._options).then(n=>{if(!ys(n))throw new nn("JSON Web Key Set malformed");this._jwks={keys:n.keys},this._jwksTimestamp=Date.now(),this._pendingFetch=void 0}).catch(n=>{throw this._pendingFetch=void 0,n})),await this._pendingFetch}}function Fu(r,n){return no.prototype.getKey.bind(new no(r,n))}class Au extends vi{encode(){const n=Ye(JSON.stringify({alg:"none"})),s=Ye(JSON.stringify(this._payload));return`${n}.${s}.`}static decode(n,s){if(typeof n!="string")throw new Pt("Unsecured JWT must be a string");const{0:o,1:u,2:l,length:c}=n.split(".");if(c!==3||l!=="")throw new Pt("Invalid Unsecured JWT");let g;try{if(g=JSON.parse(Dt.decode(rt(o))),g.alg!=="none")throw new Error}catch{throw new Pt("Invalid Unsecured JWT")}return{payload:gi(g,rt(u),s),header:g}}}const Pu=Ye,mi=rt;var Tu=Object.freeze(Object.defineProperty({__proto__:null,encode:Pu,decode:mi},Symbol.toStringTag,{value:"Module"}));function Cu(r){let n;if(typeof r=="string"){const s=r.split(".");(s.length===3||s.length===5)&&([n]=s)}else if(typeof r=="object"&&r)if("protected"in r)n=r.protected;else throw new TypeError("Token does not contain a Protected Header");try{if(typeof n!="string"||!n)throw new Error;const s=JSON.parse(Dt.decode(mi(n)));if(!ot(s))throw new Error;return s}catch{throw new TypeError("Invalid Token or Protected Header formatting")}}function xu(r){if(typeof r!="string")throw new Pt("JWTs must use Compact JWS serialization, JWT must be a string");const{1:n,length:s}=r.split(".");if(s===5)throw new Pt("Only JWTs using Compact JWS serialization can be decoded");if(s!==3)throw new Pt("Invalid JWT");if(!n)throw new Pt("JWTs must contain a payload");let o;try{o=mi(n)}catch{throw new Pt("Failed to parse the base64url encoded payload")}let u;try{u=JSON.parse(Dt.decode(o))}catch{throw new Pt("Failed to parse the decoded payload as JSON")}if(!ot(u))throw new Pt("Invalid JWT Claims Set");return u}async function Ru(r,n){var s;let o,u,l;switch(r){case"HS256":case"HS384":case"HS512":o=parseInt(r.slice(-3),10),u={name:"HMAC",hash:`SHA-${o}`,length:o},l=["sign","verify"];break;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return o=parseInt(r.slice(-3),10),dn(new Uint8Array(o>>3));case"A128KW":case"A192KW":case"A256KW":o=parseInt(r.slice(1,4),10),u={name:"AES-KW",length:o},l=["wrapKey","unwrapKey"];break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":case"A128GCM":case"A192GCM":case"A256GCM":o=parseInt(r.slice(1,4),10),u={name:"AES-GCM",length:o},l=["encrypt","decrypt"];break;default:throw new Pe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return me.subtle.generateKey(u,(s=n==null?void 0:n.extractable)!==null&&s!==void 0?s:!1,l)}function Un(r){var n;const s=(n=r==null?void 0:r.modulusLength)!==null&&n!==void 0?n:2048;if(typeof s!="number"||s<2048)throw new Pe("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");return s}async function Iu(r,n){var s,o;let u,l;switch(r){case"PS256":case"PS384":case"PS512":u={name:"RSA-PSS",hash:`SHA-${r.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:Un(n)},l=["sign","verify"];break;case"RS256":case"RS384":case"RS512":u={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${r.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:Un(n)},l=["sign","verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":u={name:"RSA-OAEP",hash:`SHA-${parseInt(r.slice(-3),10)||1}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:Un(n)},l=["decrypt","unwrapKey","encrypt","wrapKey"];break;case"ES256":u={name:"ECDSA",namedCurve:"P-256"},l=["sign","verify"];break;case"ES384":u={name:"ECDSA",namedCurve:"P-384"},l=["sign","verify"];break;case"ES512":u={name:"ECDSA",namedCurve:"P-521"},l=["sign","verify"];break;case(pr()&&"EdDSA"):switch(n==null?void 0:n.crv){case void 0:case"Ed25519":u={name:"NODE-ED25519",namedCurve:"NODE-ED25519"},l=["sign","verify"];break;default:throw new Pe("Invalid or unsupported crv option provided")}break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":u={name:"ECDH",namedCurve:(s=n==null?void 0:n.crv)!==null&&s!==void 0?s:"P-256"},l=["deriveKey","deriveBits"];break;default:throw new Pe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return me.subtle.generateKey(u,(o=n==null?void 0:n.extractable)!==null&&o!==void 0?o:!1,l)}async function ku(r,n){return Iu(r,n)}async function Uu(r,n){return Ru(r,n)}var Ou=Object.freeze(Object.defineProperty({__proto__:null,errors:sa,base64url:Tu,compactDecrypt:os,flattenedDecrypt:hi,generalDecrypt:Ga,GeneralEncrypt:eu,compactVerify:ds,flattenedVerify:fi,generalVerify:nu,jwtVerify:uu,jwtDecrypt:cu,CompactEncrypt:ps,FlattenedEncrypt:an,CompactSign:gs,FlattenedSign:yi,GeneralSign:fu,SignJWT:pu,EncryptJWT:gu,calculateJwkThumbprint:yu,EmbeddedJWK:vu,createLocalJWKSet:Su,createRemoteJWKSet:Fu,UnsecuredJWT:Au,exportPKCS8:Qa,exportSPKI:Xa,exportJWK:ss,importSPKI:Da,importPKCS8:Na,importX509:Ha,importJWK:pn,decodeProtectedHeader:Cu,decodeJwt:xu,generateKeyPair:ku,generateSecret:Uu},Symbol.toStringTag,{value:"Module"})),_i=ii(Ou);Object.defineProperty(Er,"__esModule",{value:!0});Er.getWebidFromTokenPayload=Er.fetchJwks=void 0;const Du=br.exports,io=_i;async function vs(r,n){const s=await(0,Du.fetch)(r);if(s.status!==200)throw new Error(`Could not fetch JWKS for [${n}] at [${r}]: ${s.status} ${s.statusText}`);let o;try{o=(await s.json()).keys[0]}catch(u){throw new Error(`Malformed JWKS for [${n}] at [${r}]: ${u.message}`)}return o}Er.fetchJwks=vs;async function Hu(r,n,s,o){const u=await vs(n,s);let l;try{const{payload:c}=await(0,io.jwtVerify)(r,await(0,io.importJWK)(u),{issuer:s,audience:o});l=c}catch(c){throw new Error(`Token verification failed: ${c.stack}`)}if(typeof l.webid=="string")return l.webid;if(typeof l.sub!="string")throw new Error(`The token ${JSON.stringify(l)} is invalid: it has no 'webid' claim and no 'sub' claim.`);try{return new URL(l.sub),l.sub}catch(c){throw new Error(`The token has no 'webid' claim, and its 'sub' claim of [${l.sub}] is invalid as a URL - error [${c}].`)}}Er.getWebidFromTokenPayload=Hu;var yn={};Object.defineProperty(yn,"__esModule",{value:!0});yn.isSupportedTokenType=void 0;function Nu(r){return typeof r=="string"&&["DPoP","Bearer"].includes(r)}yn.isSupportedTokenType=Nu;var vn={};Object.defineProperty(vn,"__esModule",{value:!0});vn.USER_SESSION_PREFIX=void 0;vn.USER_SESSION_PREFIX="solidClientAuthenticationUser";var Fr={};Object.defineProperty(Fr,"__esModule",{value:!0});Fr.handleRegistration=Fr.determineSigningAlg=void 0;function oo(r){try{return new URL(r),!0}catch{return!1}}function Lu(r,n){var s;return(s=n.find(o=>r.includes(o)))!==null&&s!==void 0?s:null}Fr.determineSigningAlg=Lu;function Mu(r,n){return r.clientId!==void 0&&!oo(r.clientId)?"static":n.scopesSupported.includes("webid")&&r.clientId!==void 0&&oo(r.clientId)?"solid-oidc":"dynamic"}async function Ku(r,n,s,o){const u=Mu(r,n);return u==="dynamic"?o.getClient({sessionId:r.sessionId,clientName:r.clientName,redirectUrl:r.redirectUrl},n):(await s.setForUser(r.sessionId,{clientId:r.clientId}),r.clientSecret&&await s.setForUser(r.sessionId,{clientSecret:r.clientSecret}),r.clientName&&await s.setForUser(r.sessionId,{clientName:r.clientName}),{clientId:r.clientId,clientSecret:r.clientSecret,clientName:r.clientName,clientType:u})}Fr.handleRegistration=Ku;var Jt={},Bu=ze&&ze.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Jt,"__esModule",{value:!0});Jt.saveSessionInfoToStorage=Jt.loadOidcContextFromStorage=Jt.getSessionIdFromOauthState=void 0;const ju=_i,On=Bu(ln);async function Wu(r,n){return r.getForUser(n,"sessionId")}Jt.getSessionIdFromOauthState=Wu;async function Vu(r,n,s){try{const[o,u,l,c]=await Promise.all([n.getForUser(r,"issuer",{errorIfNull:!0}),n.getForUser(r,"codeVerifier"),n.getForUser(r,"redirectUrl"),n.getForUser(r,"dpop",{errorIfNull:!0})]);await n.deleteForUser(r,"codeVerifier");const g=await s.fetchConfig(o);return{codeVerifier:u,redirectUrl:l,issuerConfig:g,dpop:c==="true"}}catch(o){throw new Error(`Failed to retrieve OIDC context from storage associated with session [${r}]: ${o}`)}}Jt.loadOidcContextFromStorage=Vu;async function Ju(r,n,s,o,u,l,c){u!==void 0&&await r.setForUser(n,{refreshToken:u},{secure:l}),s!==void 0&&await r.setForUser(n,{webId:s},{secure:l}),o!==void 0&&await r.setForUser(n,{isLoggedIn:o},{secure:l}),c!==void 0&&await r.setForUser(n,{publicKey:JSON.stringify(c.publicKey),privateKey:JSON.stringify(await(0,ju.exportJWK)(c.privateKey))},{secure:l})}Jt.saveSessionInfoToStorage=Ju;class qu{constructor(n,s){this.secureStorage=n,this.insecureStorage=s}getKey(n){return`solidClientAuthenticationUser:${n}`}async getUserData(n,s){const o=await(s?this.secureStorage:this.insecureStorage).get(this.getKey(n));if(o===void 0)return{};try{return JSON.parse(o)}catch{throw new On.default(`Data for user [${n}] in [${s?"secure":"unsecure"}] storage is corrupted - expected valid JSON, but got: ${o}`)}}async setUserData(n,s,o){await(o?this.secureStorage:this.insecureStorage).set(this.getKey(n),JSON.stringify(s))}async get(n,s){const o=await(s!=null&&s.secure?this.secureStorage:this.insecureStorage).get(n);if(o===void 0&&(s==null?void 0:s.errorIfNull))throw new On.default(`[${n}] is not stored`);return o}async set(n,s,o){return(o!=null&&o.secure?this.secureStorage:this.insecureStorage).set(n,s)}async delete(n,s){return(s!=null&&s.secure?this.secureStorage:this.insecureStorage).delete(n)}async getForUser(n,s,o){const u=await this.getUserData(n,o==null?void 0:o.secure);let l;if((!u||!u[s])&&(l=void 0),l=u[s],l===void 0&&(o==null?void 0:o.errorIfNull))throw new On.default(`Field [${s}] for user [${n}] is not stored`);return l||void 0}async setForUser(n,s,o){let u;try{u=await this.getUserData(n,o==null?void 0:o.secure)}catch{u={}}await this.setUserData(n,{...u,...s},o==null?void 0:o.secure)}async deleteForUser(n,s,o){const u=await this.getUserData(n,o==null?void 0:o.secure);delete u[s],await this.setUserData(n,u,o==null?void 0:o.secure)}async deleteAllUserData(n,s){await(s!=null&&s.secure?this.secureStorage:this.insecureStorage).delete(this.getKey(n))}}Jt.default=qu;var wi={};Object.defineProperty(wi,"__esModule",{value:!0});class $u{constructor(){this.map={}}async get(n){return this.map[n]||void 0}async set(n,s){this.map[n]=s}async delete(n){delete this.map[n]}}wi.default=$u;var Si={};Object.defineProperty(Si,"__esModule",{value:!0});class Gu extends Error{constructor(n){super(n)}}Si.default=Gu;var Ei={};Object.defineProperty(Ei,"__esModule",{value:!0});class zu extends Error{constructor(n){super(`[${n}] is not implemented`)}}Ei.default=zu;var Br={};Object.defineProperty(Br,"__esModule",{value:!0});Br.InvalidResponseError=void 0;class Yu extends Error{constructor(n){super(`Invalid response from OIDC provider: missing fields ${n}`),this.missingFields=n}}Br.InvalidResponseError=Yu;var jr={};Object.defineProperty(jr,"__esModule",{value:!0});jr.OidcProviderError=void 0;class Xu extends Error{constructor(n,s,o){super(n),this.error=s,this.errorDescription=o}}jr.OidcProviderError=Xu;var fr={},Xr,Qu=new Uint8Array(16);function ms(){if(!Xr&&(Xr=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Xr))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Xr(Qu)}var Zu=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function mn(r){return typeof r=="string"&&Zu.test(r)}var ut=[];for(var Dn=0;Dn<256;++Dn)ut.push((Dn+256).toString(16).substr(1));function _n(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=(ut[r[n+0]]+ut[r[n+1]]+ut[r[n+2]]+ut[r[n+3]]+"-"+ut[r[n+4]]+ut[r[n+5]]+"-"+ut[r[n+6]]+ut[r[n+7]]+"-"+ut[r[n+8]]+ut[r[n+9]]+"-"+ut[r[n+10]]+ut[r[n+11]]+ut[r[n+12]]+ut[r[n+13]]+ut[r[n+14]]+ut[r[n+15]]).toLowerCase();if(!mn(s))throw TypeError("Stringified UUID is invalid");return s}var so,Hn,Nn=0,Ln=0;function ec(r,n,s){var o=n&&s||0,u=n||new Array(16);r=r||{};var l=r.node||so,c=r.clockseq!==void 0?r.clockseq:Hn;if(l==null||c==null){var g=r.random||(r.rng||ms)();l==null&&(l=so=[g[0]|1,g[1],g[2],g[3],g[4],g[5]]),c==null&&(c=Hn=(g[6]<<8|g[7])&16383)}var y=r.msecs!==void 0?r.msecs:Date.now(),f=r.nsecs!==void 0?r.nsecs:Ln+1,h=y-Nn+(f-Ln)/1e4;if(h<0&&r.clockseq===void 0&&(c=c+1&16383),(h<0||y>Nn)&&r.nsecs===void 0&&(f=0),f>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Nn=y,Ln=f,Hn=c,y+=122192928e5;var p=((y&268435455)*1e4+f)%4294967296;u[o++]=p>>>24&255,u[o++]=p>>>16&255,u[o++]=p>>>8&255,u[o++]=p&255;var w=y/4294967296*1e4&268435455;u[o++]=w>>>8&255,u[o++]=w&255,u[o++]=w>>>24&15|16,u[o++]=w>>>16&255,u[o++]=c>>>8|128,u[o++]=c&255;for(var x=0;x<6;++x)u[o+x]=l[x];return n||_n(u)}function _s(r){if(!mn(r))throw TypeError("Invalid UUID");var n,s=new Uint8Array(16);return s[0]=(n=parseInt(r.slice(0,8),16))>>>24,s[1]=n>>>16&255,s[2]=n>>>8&255,s[3]=n&255,s[4]=(n=parseInt(r.slice(9,13),16))>>>8,s[5]=n&255,s[6]=(n=parseInt(r.slice(14,18),16))>>>8,s[7]=n&255,s[8]=(n=parseInt(r.slice(19,23),16))>>>8,s[9]=n&255,s[10]=(n=parseInt(r.slice(24,36),16))/1099511627776&255,s[11]=n/4294967296&255,s[12]=n>>>24&255,s[13]=n>>>16&255,s[14]=n>>>8&255,s[15]=n&255,s}function tc(r){r=unescape(encodeURIComponent(r));for(var n=[],s=0;s<r.length;++s)n.push(r.charCodeAt(s));return n}var rc="6ba7b810-9dad-11d1-80b4-00c04fd430c8",nc="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function ws(r,n,s){function o(u,l,c,g){if(typeof u=="string"&&(u=tc(u)),typeof l=="string"&&(l=_s(l)),l.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var y=new Uint8Array(16+u.length);if(y.set(l),y.set(u,l.length),y=s(y),y[6]=y[6]&15|n,y[8]=y[8]&63|128,c){g=g||0;for(var f=0;f<16;++f)c[g+f]=y[f];return c}return _n(y)}try{o.name=r}catch{}return o.DNS=rc,o.URL=nc,o}function ic(r){if(typeof r=="string"){var n=unescape(encodeURIComponent(r));r=new Uint8Array(n.length);for(var s=0;s<n.length;++s)r[s]=n.charCodeAt(s)}return oc(sc(ac(r),r.length*8))}function oc(r){for(var n=[],s=r.length*32,o="0123456789abcdef",u=0;u<s;u+=8){var l=r[u>>5]>>>u%32&255,c=parseInt(o.charAt(l>>>4&15)+o.charAt(l&15),16);n.push(c)}return n}function Ss(r){return(r+64>>>9<<4)+14+1}function sc(r,n){r[n>>5]|=128<<n%32,r[Ss(n)-1]=n;for(var s=1732584193,o=-271733879,u=-1732584194,l=271733878,c=0;c<r.length;c+=16){var g=s,y=o,f=u,h=l;s=ft(s,o,u,l,r[c],7,-680876936),l=ft(l,s,o,u,r[c+1],12,-389564586),u=ft(u,l,s,o,r[c+2],17,606105819),o=ft(o,u,l,s,r[c+3],22,-1044525330),s=ft(s,o,u,l,r[c+4],7,-176418897),l=ft(l,s,o,u,r[c+5],12,1200080426),u=ft(u,l,s,o,r[c+6],17,-1473231341),o=ft(o,u,l,s,r[c+7],22,-45705983),s=ft(s,o,u,l,r[c+8],7,1770035416),l=ft(l,s,o,u,r[c+9],12,-1958414417),u=ft(u,l,s,o,r[c+10],17,-42063),o=ft(o,u,l,s,r[c+11],22,-1990404162),s=ft(s,o,u,l,r[c+12],7,1804603682),l=ft(l,s,o,u,r[c+13],12,-40341101),u=ft(u,l,s,o,r[c+14],17,-1502002290),o=ft(o,u,l,s,r[c+15],22,1236535329),s=pt(s,o,u,l,r[c+1],5,-165796510),l=pt(l,s,o,u,r[c+6],9,-1069501632),u=pt(u,l,s,o,r[c+11],14,643717713),o=pt(o,u,l,s,r[c],20,-373897302),s=pt(s,o,u,l,r[c+5],5,-701558691),l=pt(l,s,o,u,r[c+10],9,38016083),u=pt(u,l,s,o,r[c+15],14,-660478335),o=pt(o,u,l,s,r[c+4],20,-405537848),s=pt(s,o,u,l,r[c+9],5,568446438),l=pt(l,s,o,u,r[c+14],9,-1019803690),u=pt(u,l,s,o,r[c+3],14,-187363961),o=pt(o,u,l,s,r[c+8],20,1163531501),s=pt(s,o,u,l,r[c+13],5,-1444681467),l=pt(l,s,o,u,r[c+2],9,-51403784),u=pt(u,l,s,o,r[c+7],14,1735328473),o=pt(o,u,l,s,r[c+12],20,-1926607734),s=gt(s,o,u,l,r[c+5],4,-378558),l=gt(l,s,o,u,r[c+8],11,-2022574463),u=gt(u,l,s,o,r[c+11],16,1839030562),o=gt(o,u,l,s,r[c+14],23,-35309556),s=gt(s,o,u,l,r[c+1],4,-1530992060),l=gt(l,s,o,u,r[c+4],11,1272893353),u=gt(u,l,s,o,r[c+7],16,-155497632),o=gt(o,u,l,s,r[c+10],23,-1094730640),s=gt(s,o,u,l,r[c+13],4,681279174),l=gt(l,s,o,u,r[c],11,-358537222),u=gt(u,l,s,o,r[c+3],16,-722521979),o=gt(o,u,l,s,r[c+6],23,76029189),s=gt(s,o,u,l,r[c+9],4,-640364487),l=gt(l,s,o,u,r[c+12],11,-421815835),u=gt(u,l,s,o,r[c+15],16,530742520),o=gt(o,u,l,s,r[c+2],23,-995338651),s=yt(s,o,u,l,r[c],6,-198630844),l=yt(l,s,o,u,r[c+7],10,1126891415),u=yt(u,l,s,o,r[c+14],15,-1416354905),o=yt(o,u,l,s,r[c+5],21,-57434055),s=yt(s,o,u,l,r[c+12],6,1700485571),l=yt(l,s,o,u,r[c+3],10,-1894986606),u=yt(u,l,s,o,r[c+10],15,-1051523),o=yt(o,u,l,s,r[c+1],21,-2054922799),s=yt(s,o,u,l,r[c+8],6,1873313359),l=yt(l,s,o,u,r[c+15],10,-30611744),u=yt(u,l,s,o,r[c+6],15,-1560198380),o=yt(o,u,l,s,r[c+13],21,1309151649),s=yt(s,o,u,l,r[c+4],6,-145523070),l=yt(l,s,o,u,r[c+11],10,-1120210379),u=yt(u,l,s,o,r[c+2],15,718787259),o=yt(o,u,l,s,r[c+9],21,-343485551),s=tr(s,g),o=tr(o,y),u=tr(u,f),l=tr(l,h)}return[s,o,u,l]}function ac(r){if(r.length===0)return[];for(var n=r.length*8,s=new Uint32Array(Ss(n)),o=0;o<n;o+=8)s[o>>5]|=(r[o/8]&255)<<o%32;return s}function tr(r,n){var s=(r&65535)+(n&65535),o=(r>>16)+(n>>16)+(s>>16);return o<<16|s&65535}function uc(r,n){return r<<n|r>>>32-n}function wn(r,n,s,o,u,l){return tr(uc(tr(tr(n,r),tr(o,l)),u),s)}function ft(r,n,s,o,u,l,c){return wn(n&s|~n&o,r,n,u,l,c)}function pt(r,n,s,o,u,l,c){return wn(n&o|s&~o,r,n,u,l,c)}function gt(r,n,s,o,u,l,c){return wn(n^s^o,r,n,u,l,c)}function yt(r,n,s,o,u,l,c){return wn(s^(n|~o),r,n,u,l,c)}var cc=ws("v3",48,ic),lc=cc;function dc(r,n,s){r=r||{};var o=r.random||(r.rng||ms)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,n){s=s||0;for(var u=0;u<16;++u)n[s+u]=o[u];return n}return _n(o)}function hc(r,n,s,o){switch(r){case 0:return n&s^~n&o;case 1:return n^s^o;case 2:return n&s^n&o^s&o;case 3:return n^s^o}}function Mn(r,n){return r<<n|r>>>32-n}function fc(r){var n=[1518500249,1859775393,2400959708,3395469782],s=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof r=="string"){var o=unescape(encodeURIComponent(r));r=[];for(var u=0;u<o.length;++u)r.push(o.charCodeAt(u))}else Array.isArray(r)||(r=Array.prototype.slice.call(r));r.push(128);for(var l=r.length/4+2,c=Math.ceil(l/16),g=new Array(c),y=0;y<c;++y){for(var f=new Uint32Array(16),h=0;h<16;++h)f[h]=r[y*64+h*4]<<24|r[y*64+h*4+1]<<16|r[y*64+h*4+2]<<8|r[y*64+h*4+3];g[y]=f}g[c-1][14]=(r.length-1)*8/Math.pow(2,32),g[c-1][14]=Math.floor(g[c-1][14]),g[c-1][15]=(r.length-1)*8&4294967295;for(var p=0;p<c;++p){for(var w=new Uint32Array(80),x=0;x<16;++x)w[x]=g[p][x];for(var F=16;F<80;++F)w[F]=Mn(w[F-3]^w[F-8]^w[F-14]^w[F-16],1);for(var P=s[0],A=s[1],b=s[2],T=s[3],H=s[4],M=0;M<80;++M){var G=Math.floor(M/20),V=Mn(P,5)+hc(G,A,b,T)+H+n[G]+w[M]>>>0;H=T,T=b,b=Mn(A,30)>>>0,A=P,P=V}s[0]=s[0]+P>>>0,s[1]=s[1]+A>>>0,s[2]=s[2]+b>>>0,s[3]=s[3]+T>>>0,s[4]=s[4]+H>>>0}return[s[0]>>24&255,s[0]>>16&255,s[0]>>8&255,s[0]&255,s[1]>>24&255,s[1]>>16&255,s[1]>>8&255,s[1]&255,s[2]>>24&255,s[2]>>16&255,s[2]>>8&255,s[2]&255,s[3]>>24&255,s[3]>>16&255,s[3]>>8&255,s[3]&255,s[4]>>24&255,s[4]>>16&255,s[4]>>8&255,s[4]&255]}var pc=ws("v5",80,fc),gc=pc,yc="00000000-0000-0000-0000-000000000000";function vc(r){if(!mn(r))throw TypeError("Invalid UUID");return parseInt(r.substr(14,1),16)}var mc=Object.freeze(Object.defineProperty({__proto__:null,v1:ec,v3:lc,v4:dc,v5:gc,NIL:yc,version:vc,validate:mn,stringify:_n,parse:_s},Symbol.toStringTag,{value:"Module"})),bi=ii(mc);Object.defineProperty(fr,"__esModule",{value:!0});fr.generateDpopKeyPair=fr.createDpopHeader=void 0;const Qn=_i,_c=bi,Zn=Tt;function wc(r){const n=new URL(r);return new URL(n.pathname,n.origin).toString()}async function Sc(r,n,s){return new Qn.SignJWT({htu:wc(r),htm:n.toUpperCase(),jti:(0,_c.v4)()}).setProtectedHeader({alg:Zn.PREFERRED_SIGNING_ALG[0],jwk:s.publicKey,typ:"dpop+jwt"}).setIssuedAt().sign(s.privateKey,{})}fr.createDpopHeader=Sc;async function Ec(){const{privateKey:r,publicKey:n}=await(0,Qn.generateKeyPair)(Zn.PREFERRED_SIGNING_ALG[0]),s={privateKey:r,publicKey:await(0,Qn.exportJWK)(n)};return[s.publicKey.alg]=Zn.PREFERRED_SIGNING_ALG,s}fr.generateDpopKeyPair=Ec;var Es={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.buildAuthenticatedFetch=r.DEFAULT_EXPIRATION_TIME_SECONDS=void 0;const n=br.exports,s=Tt,o=fr,u=jr,l=Br;r.DEFAULT_EXPIRATION_TIME_SECONDS=600;function c(x){return[401,403].includes(x)}async function g(x,F,P,A){var b;const T=new n.Headers(A==null?void 0:A.headers);return T.set("Authorization",`DPoP ${F}`),T.set("DPoP",await(0,o.createDpopHeader)(x,(b=A==null?void 0:A.method)!==null&&b!==void 0?b:"get",P)),{...A,headers:T}}async function y(x,F,P,A){if(P!==void 0)return g(x,F,P,A);const b=new n.Headers(A==null?void 0:A.headers);return b.set("Authorization",`Bearer ${F}`),{...A,headers:b}}async function f(x,F,P,A,b){return x(P,await y(P.toString(),F,b,A))}async function h(x,F,P){var A;const b=await x.tokenRefresher.refresh(x.sessionId,x.refreshToken,F);return P==null||P.emit(s.EVENTS.SESSION_EXTENDED,(A=b.expiresIn)!==null&&A!==void 0?A:r.DEFAULT_EXPIRATION_TIME_SECONDS),typeof b.refreshToken=="string"&&(P==null||P.emit(s.EVENTS.NEW_REFRESH_TOKEN,b.refreshToken)),{accessToken:b.accessToken,refreshToken:b.refreshToken,expiresIn:b.expiresIn}}const p=x=>x!==void 0?x-s.REFRESH_BEFORE_EXPIRATION_SECONDS>0?x-s.REFRESH_BEFORE_EXPIRATION_SECONDS:x:r.DEFAULT_EXPIRATION_TIME_SECONDS;async function w(x,F,P){var A;let b=F,T;const H=P==null?void 0:P.refreshOptions;if(H!==void 0){const M=async()=>{var G,V,j,ne;try{const{accessToken:ie,refreshToken:W,expiresIn:oe}=await h(H,P.dpopKey,P.eventEmitter);b=ie,W!==void 0&&(H.refreshToken=W),clearTimeout(T),T=setTimeout(M,p(oe)*1e3),(G=P.eventEmitter)===null||G===void 0||G.emit(s.EVENTS.TIMEOUT_SET,T)}catch(ie){ie instanceof u.OidcProviderError&&((V=P==null?void 0:P.eventEmitter)===null||V===void 0||V.emit(s.EVENTS.ERROR,ie.error,ie.errorDescription),(j=P==null?void 0:P.eventEmitter)===null||j===void 0||j.emit(s.EVENTS.SESSION_EXPIRED)),ie instanceof l.InvalidResponseError&&ie.missingFields.includes("access_token")&&((ne=P==null?void 0:P.eventEmitter)===null||ne===void 0||ne.emit(s.EVENTS.SESSION_EXPIRED))}};T=setTimeout(M,p(P.expiresIn)*1e3),(A=P.eventEmitter)===null||A===void 0||A.emit(s.EVENTS.TIMEOUT_SET,T)}else if(P!==void 0&&P.eventEmitter!==void 0){const M=setTimeout(()=>{P.eventEmitter.emit(s.EVENTS.SESSION_EXPIRED)},p(P.expiresIn)*1e3);P.eventEmitter.emit(s.EVENTS.TIMEOUT_SET,M)}return async(M,G)=>{let V=await f(x,b,M,G,P==null?void 0:P.dpopKey);const j=!V.ok&&!c(V.status);return V.ok||j||V.url!==M&&(P==null?void 0:P.dpopKey)!==void 0&&(V=await f(x,b,V.url,G,P.dpopKey)),V}}r.buildAuthenticatedFetch=w})(Es);var bs={};(function(r){var n=ze&&ze.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(r,"__esModule",{value:!0}),r.mockStorageUtility=r.mockStorage=r.StorageUtilityMock=r.StorageUtilityGetResponse=void 0;const s=n(Jt);r.StorageUtilityGetResponse="getResponse",r.StorageUtilityMock={get:async(l,c)=>r.StorageUtilityGetResponse,set:async(l,c)=>{},delete:async l=>{},getForUser:async(l,c,g)=>r.StorageUtilityGetResponse,setForUser:async(l,c,g)=>{},deleteForUser:async(l,c,g)=>{},deleteAllUserData:async(l,c)=>{}};const o=l=>{const c=l;return{get:async g=>{if(c[g]!==void 0)return typeof c[g]=="string"?c[g]:JSON.stringify(c[g])},set:async(g,y)=>{c[g]=y},delete:async g=>{delete c[g]}}};r.mockStorage=o;const u=(l,c=!1)=>c?new s.default((0,r.mockStorage)(l),(0,r.mockStorage)({})):new s.default((0,r.mockStorage)({}),(0,r.mockStorage)(l));r.mockStorageUtility=u})(bs);(function(r){var n=ze&&ze.__createBinding||(Object.create?function(T,H,M,G){G===void 0&&(G=M);var V=Object.getOwnPropertyDescriptor(H,M);(!V||("get"in V?!H.__esModule:V.writable||V.configurable))&&(V={enumerable:!0,get:function(){return H[M]}}),Object.defineProperty(T,G,V)}:function(T,H,M,G){G===void 0&&(G=M),T[G]=H[M]}),s=ze&&ze.__exportStar||function(T,H){for(var M in T)M!=="default"&&!Object.prototype.hasOwnProperty.call(H,M)&&n(H,T,M)},o=ze&&ze.__importDefault||function(T){return T&&T.__esModule?T:{default:T}};Object.defineProperty(r,"__esModule",{value:!0}),r.StorageUtilityGetResponse=r.StorageUtilityMock=r.mockStorageUtility=r.mockStorage=r.buildAuthenticatedFetch=r.generateDpopKeyPair=r.createDpopHeader=r.OidcProviderError=r.InvalidResponseError=r.NotImplementedError=r.ConfigurationError=r.InMemoryStorage=r.getSessionIdFromOauthState=r.saveSessionInfoToStorage=r.loadOidcContextFromStorage=r.StorageUtility=r.determineSigningAlg=r.handleRegistration=r.USER_SESSION_PREFIX=r.isSupportedTokenType=r.fetchJwks=r.getWebidFromTokenPayload=r.AggregateHandler=void 0,s(Tt,r);var u=si;Object.defineProperty(r,"AggregateHandler",{enumerable:!0,get:function(){return o(u).default}});var l=Er;Object.defineProperty(r,"getWebidFromTokenPayload",{enumerable:!0,get:function(){return l.getWebidFromTokenPayload}}),Object.defineProperty(r,"fetchJwks",{enumerable:!0,get:function(){return l.fetchJwks}});var c=yn;Object.defineProperty(r,"isSupportedTokenType",{enumerable:!0,get:function(){return c.isSupportedTokenType}});var g=vn;Object.defineProperty(r,"USER_SESSION_PREFIX",{enumerable:!0,get:function(){return g.USER_SESSION_PREFIX}});var y=Fr;Object.defineProperty(r,"handleRegistration",{enumerable:!0,get:function(){return y.handleRegistration}}),Object.defineProperty(r,"determineSigningAlg",{enumerable:!0,get:function(){return y.determineSigningAlg}});var f=Jt;Object.defineProperty(r,"StorageUtility",{enumerable:!0,get:function(){return o(f).default}}),Object.defineProperty(r,"loadOidcContextFromStorage",{enumerable:!0,get:function(){return f.loadOidcContextFromStorage}}),Object.defineProperty(r,"saveSessionInfoToStorage",{enumerable:!0,get:function(){return f.saveSessionInfoToStorage}}),Object.defineProperty(r,"getSessionIdFromOauthState",{enumerable:!0,get:function(){return f.getSessionIdFromOauthState}});var h=wi;Object.defineProperty(r,"InMemoryStorage",{enumerable:!0,get:function(){return o(h).default}});var p=Si;Object.defineProperty(r,"ConfigurationError",{enumerable:!0,get:function(){return o(p).default}});var w=Ei;Object.defineProperty(r,"NotImplementedError",{enumerable:!0,get:function(){return o(w).default}});var x=Br;Object.defineProperty(r,"InvalidResponseError",{enumerable:!0,get:function(){return x.InvalidResponseError}});var F=jr;Object.defineProperty(r,"OidcProviderError",{enumerable:!0,get:function(){return F.OidcProviderError}});var P=fr;Object.defineProperty(r,"createDpopHeader",{enumerable:!0,get:function(){return P.createDpopHeader}}),Object.defineProperty(r,"generateDpopKeyPair",{enumerable:!0,get:function(){return P.generateDpopKeyPair}});var A=Es;Object.defineProperty(r,"buildAuthenticatedFetch",{enumerable:!0,get:function(){return A.buildAuthenticatedFetch}});var b=bs;Object.defineProperty(r,"mockStorage",{enumerable:!0,get:function(){return b.mockStorage}}),Object.defineProperty(r,"mockStorageUtility",{enumerable:!0,get:function(){return b.mockStorageUtility}}),Object.defineProperty(r,"StorageUtilityMock",{enumerable:!0,get:function(){return b.StorageUtilityMock}}),Object.defineProperty(r,"StorageUtilityGetResponse",{enumerable:!0,get:function(){return b.StorageUtilityGetResponse}})})(xe);var Wr={},Fi={};Object.defineProperty(Fi,"__esModule",{value:!0});const bc=xe;class Fc extends bc.StorageUtility{constructor(n,s){super(n,s)}}Fi.default=Fc;var Ai={},At={exports:{}};(function(r,n){(function(o,u){r.exports=u()})(ze,function(){return function(s){var o={};function u(l){if(o[l])return o[l].exports;var c=o[l]={i:l,l:!1,exports:{}};return s[l].call(c.exports,c,c.exports,u),c.l=!0,c.exports}return u.m=s,u.c=o,u.d=function(l,c,g){u.o(l,c)||Object.defineProperty(l,c,{enumerable:!0,get:g})},u.r=function(l){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})},u.t=function(l,c){if(1&c&&(l=u(l)),8&c||4&c&&typeof l=="object"&&l&&l.__esModule)return l;var g=Object.create(null);if(u.r(g),Object.defineProperty(g,"default",{enumerable:!0,value:l}),2&c&&typeof l!="string")for(var y in l)u.d(g,y,function(f){return l[f]}.bind(null,y));return g},u.n=function(l){var c=l&&l.__esModule?function(){return l.default}:function(){return l};return u.d(c,"a",c),c},u.o=function(l,c){return Object.prototype.hasOwnProperty.call(l,c)},u.p="",u(u.s=22)}([function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0});var l=function(){function f(h,p){for(var w=0;w<p.length;w++){var x=p[w];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(h,x.key,x)}}return function(h,p,w){return p&&f(h.prototype,p),w&&f(h,w),h}}(),c={debug:function(){},info:function(){},warn:function(){},error:function(){}},g=void 0,y=void 0;(o.Log=function(){function f(){(function(p,w){if(!(p instanceof w))throw new TypeError("Cannot call a class as a function")})(this,f)}return f.reset=function(){y=3,g=c},f.debug=function(){if(y>=4){for(var p=arguments.length,w=Array(p),x=0;x<p;x++)w[x]=arguments[x];g.debug.apply(g,Array.from(w))}},f.info=function(){if(y>=3){for(var p=arguments.length,w=Array(p),x=0;x<p;x++)w[x]=arguments[x];g.info.apply(g,Array.from(w))}},f.warn=function(){if(y>=2){for(var p=arguments.length,w=Array(p),x=0;x<p;x++)w[x]=arguments[x];g.warn.apply(g,Array.from(w))}},f.error=function(){if(y>=1){for(var p=arguments.length,w=Array(p),x=0;x<p;x++)w[x]=arguments[x];g.error.apply(g,Array.from(w))}},l(f,null,[{key:"NONE",get:function(){return 0}},{key:"ERROR",get:function(){return 1}},{key:"WARN",get:function(){return 2}},{key:"INFO",get:function(){return 3}},{key:"DEBUG",get:function(){return 4}},{key:"level",get:function(){return y},set:function(p){if(!(0<=p&&p<=4))throw new Error("Invalid log level");y=p}},{key:"logger",get:function(){return g},set:function(p){if(!p.debug&&p.info&&(p.debug=p.info),!(p.debug&&p.info&&p.warn&&p.error))throw new Error("Invalid logger");g=p}}]),f}()).reset()},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0});var l=function(){function f(h,p){for(var w=0;w<p.length;w++){var x=p[w];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(h,x.key,x)}}return function(h,p,w){return p&&f(h.prototype,p),w&&f(h,w),h}}(),c={setInterval:function(f){function h(p,w){return f.apply(this,arguments)}return h.toString=function(){return f.toString()},h}(function(f,h){return setInterval(f,h)}),clearInterval:function(f){function h(p){return f.apply(this,arguments)}return h.toString=function(){return f.toString()},h}(function(f){return clearInterval(f)})},g=!1,y=null;o.Global=function(){function f(){(function(p,w){if(!(p instanceof w))throw new TypeError("Cannot call a class as a function")})(this,f)}return f._testing=function(){g=!0},f.setXMLHttpRequest=function(p){y=p},l(f,null,[{key:"location",get:function(){if(!g)return location}},{key:"localStorage",get:function(){if(!g&&typeof window!="undefined")return localStorage}},{key:"sessionStorage",get:function(){if(!g&&typeof window!="undefined")return sessionStorage}},{key:"XMLHttpRequest",get:function(){if(!g&&typeof window!="undefined")return y||XMLHttpRequest}},{key:"timer",get:function(){if(!g)return c}}]),f}()},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.MetadataService=void 0;var l=function(){function h(p,w){for(var x=0;x<w.length;x++){var F=w[x];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(p,F.key,F)}}return function(p,w,x){return w&&h(p.prototype,w),x&&h(p,x),p}}(),c=u(0),g=u(7);function y(h,p){if(!(h instanceof p))throw new TypeError("Cannot call a class as a function")}var f=".well-known/openid-configuration";o.MetadataService=function(){function h(p){var w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:g.JsonService;if(y(this,h),!p)throw c.Log.error("MetadataService: No settings passed to MetadataService"),new Error("settings");this._settings=p,this._jsonService=new w(["application/jwk-set+json"])}return h.prototype.resetSigningKeys=function(){this._settings=this._settings||{},this._settings.signingKeys=void 0},h.prototype.getMetadata=function(){var w=this;return this._settings.metadata?(c.Log.debug("MetadataService.getMetadata: Returning metadata from settings"),Promise.resolve(this._settings.metadata)):this.metadataUrl?(c.Log.debug("MetadataService.getMetadata: getting metadata from",this.metadataUrl),this._jsonService.getJson(this.metadataUrl).then(function(x){c.Log.debug("MetadataService.getMetadata: json received");var F=w._settings.metadataSeed||{};return w._settings.metadata=Object.assign({},F,x),w._settings.metadata})):(c.Log.error("MetadataService.getMetadata: No authority or metadataUrl configured on settings"),Promise.reject(new Error("No authority or metadataUrl configured on settings")))},h.prototype.getIssuer=function(){return this._getMetadataProperty("issuer")},h.prototype.getAuthorizationEndpoint=function(){return this._getMetadataProperty("authorization_endpoint")},h.prototype.getUserInfoEndpoint=function(){return this._getMetadataProperty("userinfo_endpoint")},h.prototype.getTokenEndpoint=function(){var w=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];return this._getMetadataProperty("token_endpoint",w)},h.prototype.getCheckSessionIframe=function(){return this._getMetadataProperty("check_session_iframe",!0)},h.prototype.getEndSessionEndpoint=function(){return this._getMetadataProperty("end_session_endpoint",!0)},h.prototype.getRevocationEndpoint=function(){return this._getMetadataProperty("revocation_endpoint",!0)},h.prototype.getKeysEndpoint=function(){return this._getMetadataProperty("jwks_uri",!0)},h.prototype._getMetadataProperty=function(w){var x=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return c.Log.debug("MetadataService.getMetadataProperty for: "+w),this.getMetadata().then(function(F){if(c.Log.debug("MetadataService.getMetadataProperty: metadata recieved"),F[w]===void 0){if(x===!0)return void c.Log.warn("MetadataService.getMetadataProperty: Metadata does not contain optional property "+w);throw c.Log.error("MetadataService.getMetadataProperty: Metadata does not contain property "+w),new Error("Metadata does not contain property "+w)}return F[w]})},h.prototype.getSigningKeys=function(){var w=this;return this._settings.signingKeys?(c.Log.debug("MetadataService.getSigningKeys: Returning signingKeys from settings"),Promise.resolve(this._settings.signingKeys)):this._getMetadataProperty("jwks_uri").then(function(x){return c.Log.debug("MetadataService.getSigningKeys: jwks_uri received",x),w._jsonService.getJson(x).then(function(F){if(c.Log.debug("MetadataService.getSigningKeys: key set received",F),!F.keys)throw c.Log.error("MetadataService.getSigningKeys: Missing keys on keyset"),new Error("Missing keys on keyset");return w._settings.signingKeys=F.keys,w._settings.signingKeys})})},l(h,[{key:"metadataUrl",get:function(){return this._metadataUrl||(this._settings.metadataUrl?this._metadataUrl=this._settings.metadataUrl:(this._metadataUrl=this._settings.authority,this._metadataUrl&&this._metadataUrl.indexOf(f)<0&&(this._metadataUrl[this._metadataUrl.length-1]!=="/"&&(this._metadataUrl+="/"),this._metadataUrl+=f))),this._metadataUrl}}]),h}()},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.UrlUtility=void 0;var l=u(0),c=u(1);o.UrlUtility=function(){function g(){(function(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")})(this,g)}return g.addQueryParam=function(f,h,p){return f.indexOf("?")<0&&(f+="?"),f[f.length-1]!=="?"&&(f+="&"),f+=encodeURIComponent(h),f+="=",f+=encodeURIComponent(p)},g.parseUrlFragment=function(f){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#",p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:c.Global;typeof f!="string"&&(f=p.location.href);var w=f.lastIndexOf(h);w>=0&&(f=f.substr(w+1)),h==="?"&&(w=f.indexOf("#"))>=0&&(f=f.substr(0,w));for(var x,F={},P=/([^&=]+)=([^&]*)/g,A=0;x=P.exec(f);)if(F[decodeURIComponent(x[1])]=decodeURIComponent(x[2].replace(/\+/g," ")),A++>50)return l.Log.error("UrlUtility.parseUrlFragment: response exceeded expected number of parameters",f),{error:"Response exceeded expected number of parameters"};for(var b in F)return F;return{}},g}()},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.JoseUtil=void 0;var l=u(26),c=function(y){return y&&y.__esModule?y:{default:y}}(u(33));o.JoseUtil=(0,c.default)({jws:l.jws,KeyUtil:l.KeyUtil,X509:l.X509,crypto:l.crypto,hextob64u:l.hextob64u,b64tohex:l.b64tohex,AllowedSigningAlgs:l.AllowedSigningAlgs})},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.OidcClientSettings=void 0;var l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(b){return typeof b}:function(b){return b&&typeof Symbol=="function"&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b},c=function(){function b(T,H){for(var M=0;M<H.length;M++){var G=H[M];G.enumerable=G.enumerable||!1,G.configurable=!0,"value"in G&&(G.writable=!0),Object.defineProperty(T,G.key,G)}}return function(T,H,M){return H&&b(T.prototype,H),M&&b(T,M),T}}(),g=u(0),y=u(23),f=u(6),h=u(24),p=u(2);function w(b,T){if(!(b instanceof T))throw new TypeError("Cannot call a class as a function")}var x=".well-known/openid-configuration",F="id_token",P="openid",A="client_secret_post";o.OidcClientSettings=function(){function b(){var T=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},H=T.authority,M=T.metadataUrl,G=T.metadata,V=T.signingKeys,j=T.metadataSeed,ne=T.client_id,ie=T.client_secret,W=T.response_type,oe=W===void 0?F:W,Te=T.scope,be=Te===void 0?P:Te,Z=T.redirect_uri,ae=T.post_logout_redirect_uri,pe=T.client_authentication,Ee=pe===void 0?A:pe,Fe=T.prompt,le=T.display,_e=T.max_age,Me=T.ui_locales,qe=T.acr_values,_t=T.resource,wt=T.response_mode,Rt=T.filterProtocolClaims,Gt=Rt===void 0||Rt,dt=T.loadUserInfo,St=dt===void 0||dt,nt=T.staleStateAge,He=nt===void 0?900:nt,J=T.clockSkew,m=J===void 0?300:J,_=T.clockService,L=_===void 0?new y.ClockService:_,q=T.userInfoJwtIssuer,X=q===void 0?"OP":q,re=T.mergeClaims,he=re!==void 0&&re,ve=T.stateStore,Ce=ve===void 0?new f.WebStorageStateStore:ve,Ae=T.ResponseValidatorCtor,Re=Ae===void 0?h.ResponseValidator:Ae,Et=T.MetadataServiceCtor,Ht=Et===void 0?p.MetadataService:Et,fe=T.extraQueryParams,Ke=fe===void 0?{}:fe,Se=T.extraTokenParams,It=Se===void 0?{}:Se;w(this,b),this._authority=H,this._metadataUrl=M,this._metadata=G,this._metadataSeed=j,this._signingKeys=V,this._client_id=ne,this._client_secret=ie,this._response_type=oe,this._scope=be,this._redirect_uri=Z,this._post_logout_redirect_uri=ae,this._client_authentication=Ee,this._prompt=Fe,this._display=le,this._max_age=_e,this._ui_locales=Me,this._acr_values=qe,this._resource=_t,this._response_mode=wt,this._filterProtocolClaims=!!Gt,this._loadUserInfo=!!St,this._staleStateAge=He,this._clockSkew=m,this._clockService=L,this._userInfoJwtIssuer=X,this._mergeClaims=!!he,this._stateStore=Ce,this._validator=new Re(this),this._metadataService=new Ht(this),this._extraQueryParams=(Ke===void 0?"undefined":l(Ke))==="object"?Ke:{},this._extraTokenParams=(It===void 0?"undefined":l(It))==="object"?It:{}}return b.prototype.getEpochTime=function(){return this._clockService.getEpochTime()},c(b,[{key:"client_id",get:function(){return this._client_id},set:function(H){if(this._client_id)throw g.Log.error("OidcClientSettings.set_client_id: client_id has already been assigned."),new Error("client_id has already been assigned.");this._client_id=H}},{key:"client_secret",get:function(){return this._client_secret}},{key:"response_type",get:function(){return this._response_type}},{key:"scope",get:function(){return this._scope}},{key:"redirect_uri",get:function(){return this._redirect_uri}},{key:"post_logout_redirect_uri",get:function(){return this._post_logout_redirect_uri}},{key:"client_authentication",get:function(){return this._client_authentication}},{key:"prompt",get:function(){return this._prompt}},{key:"display",get:function(){return this._display}},{key:"max_age",get:function(){return this._max_age}},{key:"ui_locales",get:function(){return this._ui_locales}},{key:"acr_values",get:function(){return this._acr_values}},{key:"resource",get:function(){return this._resource}},{key:"response_mode",get:function(){return this._response_mode}},{key:"authority",get:function(){return this._authority},set:function(H){if(this._authority)throw g.Log.error("OidcClientSettings.set_authority: authority has already been assigned."),new Error("authority has already been assigned.");this._authority=H}},{key:"metadataUrl",get:function(){return this._metadataUrl||(this._metadataUrl=this.authority,this._metadataUrl&&this._metadataUrl.indexOf(x)<0&&(this._metadataUrl[this._metadataUrl.length-1]!=="/"&&(this._metadataUrl+="/"),this._metadataUrl+=x)),this._metadataUrl}},{key:"metadata",get:function(){return this._metadata},set:function(H){this._metadata=H}},{key:"metadataSeed",get:function(){return this._metadataSeed},set:function(H){this._metadataSeed=H}},{key:"signingKeys",get:function(){return this._signingKeys},set:function(H){this._signingKeys=H}},{key:"filterProtocolClaims",get:function(){return this._filterProtocolClaims}},{key:"loadUserInfo",get:function(){return this._loadUserInfo}},{key:"staleStateAge",get:function(){return this._staleStateAge}},{key:"clockSkew",get:function(){return this._clockSkew}},{key:"userInfoJwtIssuer",get:function(){return this._userInfoJwtIssuer}},{key:"mergeClaims",get:function(){return this._mergeClaims}},{key:"stateStore",get:function(){return this._stateStore}},{key:"validator",get:function(){return this._validator}},{key:"metadataService",get:function(){return this._metadataService}},{key:"extraQueryParams",get:function(){return this._extraQueryParams},set:function(H){(H===void 0?"undefined":l(H))==="object"?this._extraQueryParams=H:this._extraQueryParams={}}},{key:"extraTokenParams",get:function(){return this._extraTokenParams},set:function(H){(H===void 0?"undefined":l(H))==="object"?this._extraTokenParams=H:this._extraTokenParams={}}}]),b}()},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.WebStorageStateStore=void 0;var l=u(0),c=u(1);function g(y,f){if(!(y instanceof f))throw new TypeError("Cannot call a class as a function")}o.WebStorageStateStore=function(){function y(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=f.prefix,p=h===void 0?"oidc.":h,w=f.store,x=w===void 0?c.Global.localStorage:w;g(this,y),this._store=x,this._prefix=p}return y.prototype.set=function(h,p){return l.Log.debug("WebStorageStateStore.set",h),h=this._prefix+h,this._store.setItem(h,p),Promise.resolve()},y.prototype.get=function(h){l.Log.debug("WebStorageStateStore.get",h),h=this._prefix+h;var p=this._store.getItem(h);return Promise.resolve(p)},y.prototype.remove=function(h){l.Log.debug("WebStorageStateStore.remove",h),h=this._prefix+h;var p=this._store.getItem(h);return this._store.removeItem(h),Promise.resolve(p)},y.prototype.getAllKeys=function(){l.Log.debug("WebStorageStateStore.getAllKeys");for(var h=[],p=0;p<this._store.length;p++){var w=this._store.key(p);w.indexOf(this._prefix)===0&&h.push(w.substr(this._prefix.length))}return Promise.resolve(h)},y}()},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.JsonService=void 0;var l=u(0),c=u(1);function g(y,f){if(!(y instanceof f))throw new TypeError("Cannot call a class as a function")}o.JsonService=function(){function y(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:c.Global.XMLHttpRequest,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;g(this,y),f&&Array.isArray(f)?this._contentTypes=f.slice():this._contentTypes=[],this._contentTypes.push("application/json"),p&&this._contentTypes.push("application/jwt"),this._XMLHttpRequest=h,this._jwtHandler=p}return y.prototype.getJson=function(h,p){var w=this;if(!h)throw l.Log.error("JsonService.getJson: No url passed"),new Error("url");return l.Log.debug("JsonService.getJson, url: ",h),new Promise(function(x,F){var P=new w._XMLHttpRequest;P.open("GET",h);var A=w._contentTypes,b=w._jwtHandler;P.onload=function(){if(l.Log.debug("JsonService.getJson: HTTP response received, status",P.status),P.status===200){var T=P.getResponseHeader("Content-Type");if(T){var H=A.find(function(M){if(T.startsWith(M))return!0});if(H=="application/jwt")return void b(P).then(x,F);if(H)try{return void x(JSON.parse(P.responseText))}catch(M){return l.Log.error("JsonService.getJson: Error parsing JSON response",M.message),void F(M)}}F(Error("Invalid response Content-Type: "+T+", from URL: "+h))}else F(Error(P.statusText+" ("+P.status+")"))},P.onerror=function(){l.Log.error("JsonService.getJson: network error"),F(Error("Network Error"))},p&&(l.Log.debug("JsonService.getJson: token passed, setting Authorization header"),P.setRequestHeader("Authorization","Bearer "+p)),P.send()})},y.prototype.postForm=function(h,p,w){var x=this;if(!h)throw l.Log.error("JsonService.postForm: No url passed"),new Error("url");return l.Log.debug("JsonService.postForm, url: ",h),new Promise(function(F,P){var A=new x._XMLHttpRequest;A.open("POST",h);var b=x._contentTypes;A.onload=function(){if(l.Log.debug("JsonService.postForm: HTTP response received, status",A.status),A.status!==200){if(A.status===400&&(V=A.getResponseHeader("Content-Type"))&&b.find(function(j){if(V.startsWith(j))return!0}))try{var G=JSON.parse(A.responseText);if(G&&G.error)return l.Log.error("JsonService.postForm: Error from server: ",G.error),void P(new Error(G.error))}catch(j){return l.Log.error("JsonService.postForm: Error parsing JSON response",j.message),void P(j)}P(Error(A.statusText+" ("+A.status+")"))}else{var V;if((V=A.getResponseHeader("Content-Type"))&&b.find(function(j){if(V.startsWith(j))return!0}))try{return void F(JSON.parse(A.responseText))}catch(j){return l.Log.error("JsonService.postForm: Error parsing JSON response",j.message),void P(j)}P(Error("Invalid response Content-Type: "+V+", from URL: "+h))}},A.onerror=function(){l.Log.error("JsonService.postForm: network error"),P(Error("Network Error"))};var T="";for(var H in p){var M=p[H];M&&(T.length>0&&(T+="&"),T+=encodeURIComponent(H),T+="=",T+=encodeURIComponent(M))}A.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),w!==void 0&&A.setRequestHeader("Authorization","Basic "+btoa(w)),A.send(T)})},y}()},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.SigninRequest=void 0;var l=u(0),c=u(3),g=u(13);o.SigninRequest=function(){function y(f){var h=f.url,p=f.client_id,w=f.redirect_uri,x=f.response_type,F=f.scope,P=f.authority,A=f.data,b=f.prompt,T=f.display,H=f.max_age,M=f.ui_locales,G=f.id_token_hint,V=f.login_hint,j=f.acr_values,ne=f.resource,ie=f.response_mode,W=f.request,oe=f.request_uri,Te=f.extraQueryParams,be=f.request_type,Z=f.client_secret,ae=f.extraTokenParams,pe=f.skipUserInfo;if(function(_t,wt){if(!(_t instanceof wt))throw new TypeError("Cannot call a class as a function")}(this,y),!h)throw l.Log.error("SigninRequest.ctor: No url passed"),new Error("url");if(!p)throw l.Log.error("SigninRequest.ctor: No client_id passed"),new Error("client_id");if(!w)throw l.Log.error("SigninRequest.ctor: No redirect_uri passed"),new Error("redirect_uri");if(!x)throw l.Log.error("SigninRequest.ctor: No response_type passed"),new Error("response_type");if(!F)throw l.Log.error("SigninRequest.ctor: No scope passed"),new Error("scope");if(!P)throw l.Log.error("SigninRequest.ctor: No authority passed"),new Error("authority");var Ee=y.isOidc(x),Fe=y.isCode(x);ie||(ie=y.isCode(x)?"query":null),this.state=new g.SigninState({nonce:Ee,data:A,client_id:p,authority:P,redirect_uri:w,code_verifier:Fe,request_type:be,response_mode:ie,client_secret:Z,scope:F,extraTokenParams:ae,skipUserInfo:pe}),h=c.UrlUtility.addQueryParam(h,"client_id",p),h=c.UrlUtility.addQueryParam(h,"redirect_uri",w),h=c.UrlUtility.addQueryParam(h,"response_type",x),h=c.UrlUtility.addQueryParam(h,"scope",F),h=c.UrlUtility.addQueryParam(h,"state",this.state.id),Ee&&(h=c.UrlUtility.addQueryParam(h,"nonce",this.state.nonce)),Fe&&(h=c.UrlUtility.addQueryParam(h,"code_challenge",this.state.code_challenge),h=c.UrlUtility.addQueryParam(h,"code_challenge_method","S256"));var le={prompt:b,display:T,max_age:H,ui_locales:M,id_token_hint:G,login_hint:V,acr_values:j,resource:ne,request:W,request_uri:oe,response_mode:ie};for(var _e in le)le[_e]&&(h=c.UrlUtility.addQueryParam(h,_e,le[_e]));for(var Me in Te)h=c.UrlUtility.addQueryParam(h,Me,Te[Me]);this.url=h}return y.isOidc=function(h){return!!h.split(/\s+/g).filter(function(p){return p==="id_token"})[0]},y.isOAuth=function(h){return!!h.split(/\s+/g).filter(function(p){return p==="token"})[0]},y.isCode=function(h){return!!h.split(/\s+/g).filter(function(p){return p==="code"})[0]},y}()},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.State=void 0;var l=function(){function f(h,p){for(var w=0;w<p.length;w++){var x=p[w];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(h,x.key,x)}}return function(h,p,w){return p&&f(h.prototype,p),w&&f(h,w),h}}(),c=u(0),g=function(h){return h&&h.__esModule?h:{default:h}}(u(14));function y(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")}o.State=function(){function f(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},p=h.id,w=h.data,x=h.created,F=h.request_type;y(this,f),this._id=p||(0,g.default)(),this._data=w,this._created=typeof x=="number"&&x>0?x:parseInt(Date.now()/1e3),this._request_type=F}return f.prototype.toStorageString=function(){return c.Log.debug("State.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type})},f.fromStorageString=function(p){return c.Log.debug("State.fromStorageString"),new f(JSON.parse(p))},f.clearStaleState=function(p,w){var x=Date.now()/1e3-w;return p.getAllKeys().then(function(F){c.Log.debug("State.clearStaleState: got keys",F);for(var P=[],A=function(M){var G=F[M];T=p.get(G).then(function(V){var j=!1;if(V)try{var ne=f.fromStorageString(V);c.Log.debug("State.clearStaleState: got item from key: ",G,ne.created),ne.created<=x&&(j=!0)}catch(ie){c.Log.error("State.clearStaleState: Error parsing state for key",G,ie.message),j=!0}else c.Log.debug("State.clearStaleState: no item in storage for key: ",G),j=!0;if(j)return c.Log.debug("State.clearStaleState: removed item for key: ",G),p.remove(G)}),P.push(T)},b=0;b<F.length;b++){var T;A(b)}return c.Log.debug("State.clearStaleState: waiting on promise count:",P.length),Promise.all(P)})},l(f,[{key:"id",get:function(){return this._id}},{key:"data",get:function(){return this._data}},{key:"created",get:function(){return this._created}},{key:"request_type",get:function(){return this._request_type}}]),f}()},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.OidcClient=void 0;var l=function(){function A(b,T){for(var H=0;H<T.length;H++){var M=T[H];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(b,M.key,M)}}return function(b,T,H){return T&&A(b.prototype,T),H&&A(b,H),b}}(),c=u(0),g=u(5),y=u(12),f=u(8),h=u(34),p=u(35),w=u(36),x=u(13),F=u(9);function P(A,b){if(!(A instanceof b))throw new TypeError("Cannot call a class as a function")}o.OidcClient=function(){function A(){var b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};P(this,A),b instanceof g.OidcClientSettings?this._settings=b:this._settings=new g.OidcClientSettings(b)}return A.prototype.createSigninRequest=function(){var T=this,H=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},M=H.response_type,G=H.scope,V=H.redirect_uri,j=H.data,ne=H.state,ie=H.prompt,W=H.display,oe=H.max_age,Te=H.ui_locales,be=H.id_token_hint,Z=H.login_hint,ae=H.acr_values,pe=H.resource,Ee=H.request,Fe=H.request_uri,le=H.response_mode,_e=H.extraQueryParams,Me=H.extraTokenParams,qe=H.request_type,_t=H.skipUserInfo,wt=arguments[1];c.Log.debug("OidcClient.createSigninRequest");var Rt=this._settings.client_id;M=M||this._settings.response_type,G=G||this._settings.scope,V=V||this._settings.redirect_uri,ie=ie||this._settings.prompt,W=W||this._settings.display,oe=oe||this._settings.max_age,Te=Te||this._settings.ui_locales,ae=ae||this._settings.acr_values,pe=pe||this._settings.resource,le=le||this._settings.response_mode,_e=_e||this._settings.extraQueryParams,Me=Me||this._settings.extraTokenParams;var Gt=this._settings.authority;return f.SigninRequest.isCode(M)&&M!=="code"?Promise.reject(new Error("OpenID Connect hybrid flow is not supported")):this._metadataService.getAuthorizationEndpoint().then(function(dt){c.Log.debug("OidcClient.createSigninRequest: Received authorization endpoint",dt);var St=new f.SigninRequest({url:dt,client_id:Rt,redirect_uri:V,response_type:M,scope:G,data:j||ne,authority:Gt,prompt:ie,display:W,max_age:oe,ui_locales:Te,id_token_hint:be,login_hint:Z,acr_values:ae,resource:pe,request:Ee,request_uri:Fe,extraQueryParams:_e,extraTokenParams:Me,request_type:qe,response_mode:le,client_secret:T._settings.client_secret,skipUserInfo:_t}),nt=St.state;return(wt=wt||T._stateStore).set(nt.id,nt.toStorageString()).then(function(){return St})})},A.prototype.readSigninResponseState=function(T,H){var M=arguments.length>2&&arguments[2]!==void 0&&arguments[2];c.Log.debug("OidcClient.readSigninResponseState");var G=this._settings.response_mode==="query"||!this._settings.response_mode&&f.SigninRequest.isCode(this._settings.response_type),V=G?"?":"#",j=new h.SigninResponse(T,V);if(!j.state)return c.Log.error("OidcClient.readSigninResponseState: No state in response"),Promise.reject(new Error("No state in response"));H=H||this._stateStore;var ne=M?H.remove.bind(H):H.get.bind(H);return ne(j.state).then(function(ie){if(!ie)throw c.Log.error("OidcClient.readSigninResponseState: No matching state found in storage"),new Error("No matching state found in storage");return{state:x.SigninState.fromStorageString(ie),response:j}})},A.prototype.processSigninResponse=function(T,H){var M=this;return c.Log.debug("OidcClient.processSigninResponse"),this.readSigninResponseState(T,H,!0).then(function(G){var V=G.state,j=G.response;return c.Log.debug("OidcClient.processSigninResponse: Received state from storage; validating response"),M._validator.validateSigninResponse(V,j)})},A.prototype.createSignoutRequest=function(){var T=this,H=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},M=H.id_token_hint,G=H.data,V=H.state,j=H.post_logout_redirect_uri,ne=H.extraQueryParams,ie=H.request_type,W=arguments[1];return c.Log.debug("OidcClient.createSignoutRequest"),j=j||this._settings.post_logout_redirect_uri,ne=ne||this._settings.extraQueryParams,this._metadataService.getEndSessionEndpoint().then(function(oe){if(!oe)throw c.Log.error("OidcClient.createSignoutRequest: No end session endpoint url returned"),new Error("no end session endpoint");c.Log.debug("OidcClient.createSignoutRequest: Received end session endpoint",oe);var Te=new p.SignoutRequest({url:oe,id_token_hint:M,post_logout_redirect_uri:j,data:G||V,extraQueryParams:ne,request_type:ie}),be=Te.state;return be&&(c.Log.debug("OidcClient.createSignoutRequest: Signout request has state to persist"),(W=W||T._stateStore).set(be.id,be.toStorageString())),Te})},A.prototype.readSignoutResponseState=function(T,H){var M=arguments.length>2&&arguments[2]!==void 0&&arguments[2];c.Log.debug("OidcClient.readSignoutResponseState");var G=new w.SignoutResponse(T);if(!G.state)return c.Log.debug("OidcClient.readSignoutResponseState: No state in response"),G.error?(c.Log.warn("OidcClient.readSignoutResponseState: Response was error: ",G.error),Promise.reject(new y.ErrorResponse(G))):Promise.resolve({state:void 0,response:G});var V=G.state;H=H||this._stateStore;var j=M?H.remove.bind(H):H.get.bind(H);return j(V).then(function(ne){if(!ne)throw c.Log.error("OidcClient.readSignoutResponseState: No matching state found in storage"),new Error("No matching state found in storage");return{state:F.State.fromStorageString(ne),response:G}})},A.prototype.processSignoutResponse=function(T,H){var M=this;return c.Log.debug("OidcClient.processSignoutResponse"),this.readSignoutResponseState(T,H,!0).then(function(G){var V=G.state,j=G.response;return V?(c.Log.debug("OidcClient.processSignoutResponse: Received state from storage; validating response"),M._validator.validateSignoutResponse(V,j)):(c.Log.debug("OidcClient.processSignoutResponse: No state from storage; skipping validating response"),j)})},A.prototype.clearStaleState=function(T){return c.Log.debug("OidcClient.clearStaleState"),T=T||this._stateStore,F.State.clearStaleState(T,this.settings.staleStateAge)},l(A,[{key:"_stateStore",get:function(){return this.settings.stateStore}},{key:"_validator",get:function(){return this.settings.validator}},{key:"_metadataService",get:function(){return this.settings.metadataService}},{key:"settings",get:function(){return this._settings}},{key:"metadataService",get:function(){return this._metadataService}}]),A}()},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.TokenClient=void 0;var l=u(7),c=u(2),g=u(0);function y(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")}o.TokenClient=function(){function f(h){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:l.JsonService,w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:c.MetadataService;if(y(this,f),!h)throw g.Log.error("TokenClient.ctor: No settings passed"),new Error("settings");this._settings=h,this._jsonService=new p,this._metadataService=new w(this._settings)}return f.prototype.exchangeCode=function(){var p=this,w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(w=Object.assign({},w)).grant_type=w.grant_type||"authorization_code",w.client_id=w.client_id||this._settings.client_id,w.client_secret=w.client_secret||this._settings.client_secret,w.redirect_uri=w.redirect_uri||this._settings.redirect_uri;var x=void 0,F=w._client_authentication||this._settings._client_authentication;return delete w._client_authentication,w.code?w.redirect_uri?w.code_verifier?w.client_id?w.client_secret||F!="client_secret_basic"?(F=="client_secret_basic"&&(x=w.client_id+":"+w.client_secret,delete w.client_id,delete w.client_secret),this._metadataService.getTokenEndpoint(!1).then(function(P){return g.Log.debug("TokenClient.exchangeCode: Received token endpoint"),p._jsonService.postForm(P,w,x).then(function(A){return g.Log.debug("TokenClient.exchangeCode: response received"),A})})):(g.Log.error("TokenClient.exchangeCode: No client_secret passed"),Promise.reject(new Error("A client_secret is required"))):(g.Log.error("TokenClient.exchangeCode: No client_id passed"),Promise.reject(new Error("A client_id is required"))):(g.Log.error("TokenClient.exchangeCode: No code_verifier passed"),Promise.reject(new Error("A code_verifier is required"))):(g.Log.error("TokenClient.exchangeCode: No redirect_uri passed"),Promise.reject(new Error("A redirect_uri is required"))):(g.Log.error("TokenClient.exchangeCode: No code passed"),Promise.reject(new Error("A code is required")))},f.prototype.exchangeRefreshToken=function(){var p=this,w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(w=Object.assign({},w)).grant_type=w.grant_type||"refresh_token",w.client_id=w.client_id||this._settings.client_id,w.client_secret=w.client_secret||this._settings.client_secret;var x=void 0,F=w._client_authentication||this._settings._client_authentication;return delete w._client_authentication,w.refresh_token?w.client_id?(F=="client_secret_basic"&&(x=w.client_id+":"+w.client_secret,delete w.client_id,delete w.client_secret),this._metadataService.getTokenEndpoint(!1).then(function(P){return g.Log.debug("TokenClient.exchangeRefreshToken: Received token endpoint"),p._jsonService.postForm(P,w,x).then(function(A){return g.Log.debug("TokenClient.exchangeRefreshToken: response received"),A})})):(g.Log.error("TokenClient.exchangeRefreshToken: No client_id passed"),Promise.reject(new Error("A client_id is required"))):(g.Log.error("TokenClient.exchangeRefreshToken: No refresh_token passed"),Promise.reject(new Error("A refresh_token is required")))},f}()},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.ErrorResponse=void 0;var l=u(0);function c(y,f){if(!(y instanceof f))throw new TypeError("Cannot call a class as a function")}function g(y,f){if(!y)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!f||typeof f!="object"&&typeof f!="function"?y:f}o.ErrorResponse=function(y){function f(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},p=h.error,w=h.error_description,x=h.error_uri,F=h.state,P=h.session_state;if(c(this,f),!p)throw l.Log.error("No error passed to ErrorResponse"),new Error("error");var A=g(this,y.call(this,w||p));return A.name="ErrorResponse",A.error=p,A.error_description=w,A.error_uri=x,A.state=F,A.session_state=P,A}return function(p,w){if(typeof w!="function"&&w!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof w);p.prototype=Object.create(w&&w.prototype,{constructor:{value:p,enumerable:!1,writable:!0,configurable:!0}}),w&&(Object.setPrototypeOf?Object.setPrototypeOf(p,w):p.__proto__=w)}(f,y),f}(Error)},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.SigninState=void 0;var l=function(){function w(x,F){for(var P=0;P<F.length;P++){var A=F[P];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(x,A.key,A)}}return function(x,F,P){return F&&w(x.prototype,F),P&&w(x,P),x}}(),c=u(0),g=u(9),y=u(4),f=function(x){return x&&x.__esModule?x:{default:x}}(u(14));function h(w,x){if(!(w instanceof x))throw new TypeError("Cannot call a class as a function")}function p(w,x){if(!w)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!x||typeof x!="object"&&typeof x!="function"?w:x}o.SigninState=function(w){function x(){var F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},P=F.nonce,A=F.authority,b=F.client_id,T=F.redirect_uri,H=F.code_verifier,M=F.response_mode,G=F.client_secret,V=F.scope,j=F.extraTokenParams,ne=F.skipUserInfo;h(this,x);var ie=p(this,w.call(this,arguments[0]));if(P===!0?ie._nonce=(0,f.default)():P&&(ie._nonce=P),H===!0?ie._code_verifier=(0,f.default)()+(0,f.default)()+(0,f.default)():H&&(ie._code_verifier=H),ie.code_verifier){var W=y.JoseUtil.hashString(ie.code_verifier,"SHA256");ie._code_challenge=y.JoseUtil.hexToBase64Url(W)}return ie._redirect_uri=T,ie._authority=A,ie._client_id=b,ie._response_mode=M,ie._client_secret=G,ie._scope=V,ie._extraTokenParams=j,ie._skipUserInfo=ne,ie}return function(P,A){if(typeof A!="function"&&A!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof A);P.prototype=Object.create(A&&A.prototype,{constructor:{value:P,enumerable:!1,writable:!0,configurable:!0}}),A&&(Object.setPrototypeOf?Object.setPrototypeOf(P,A):P.__proto__=A)}(x,w),x.prototype.toStorageString=function(){return c.Log.debug("SigninState.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,nonce:this.nonce,code_verifier:this.code_verifier,redirect_uri:this.redirect_uri,authority:this.authority,client_id:this.client_id,response_mode:this.response_mode,client_secret:this.client_secret,scope:this.scope,extraTokenParams:this.extraTokenParams,skipUserInfo:this.skipUserInfo})},x.fromStorageString=function(P){return c.Log.debug("SigninState.fromStorageString"),new x(JSON.parse(P))},l(x,[{key:"nonce",get:function(){return this._nonce}},{key:"authority",get:function(){return this._authority}},{key:"client_id",get:function(){return this._client_id}},{key:"redirect_uri",get:function(){return this._redirect_uri}},{key:"code_verifier",get:function(){return this._code_verifier}},{key:"code_challenge",get:function(){return this._code_challenge}},{key:"response_mode",get:function(){return this._response_mode}},{key:"client_secret",get:function(){return this._client_secret}},{key:"scope",get:function(){return this._scope}},{key:"extraTokenParams",get:function(){return this._extraTokenParams}},{key:"skipUserInfo",get:function(){return this._skipUserInfo}}]),x}(g.State)},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(){return(l!="undefined"&&l!==null&&l.getRandomValues!==void 0?c:g)().replace(/-/g,"")};var l=typeof window!="undefined"?window.crypto||window.msCrypto:null;function c(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(y){return(y^l.getRandomValues(new Uint8Array(1))[0]&15>>y/4).toString(16)})}function g(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(y){return(y^16*Math.random()>>y/4).toString(16)})}s.exports=o.default},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.User=void 0;var l=function(){function g(y,f){for(var h=0;h<f.length;h++){var p=f[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(y,p.key,p)}}return function(y,f,h){return f&&g(y.prototype,f),h&&g(y,h),y}}(),c=u(0);o.User=function(){function g(y){var f=y.id_token,h=y.session_state,p=y.access_token,w=y.refresh_token,x=y.token_type,F=y.scope,P=y.profile,A=y.expires_at,b=y.state;(function(H,M){if(!(H instanceof M))throw new TypeError("Cannot call a class as a function")})(this,g),this.id_token=f,this.session_state=h,this.access_token=p,this.refresh_token=w,this.token_type=x,this.scope=F,this.profile=P,this.expires_at=A,this.state=b}return g.prototype.toStorageString=function(){return c.Log.debug("User.toStorageString"),JSON.stringify({id_token:this.id_token,session_state:this.session_state,access_token:this.access_token,refresh_token:this.refresh_token,token_type:this.token_type,scope:this.scope,profile:this.profile,expires_at:this.expires_at})},g.fromStorageString=function(f){return c.Log.debug("User.fromStorageString"),new g(JSON.parse(f))},l(g,[{key:"expires_in",get:function(){if(this.expires_at){var f=parseInt(Date.now()/1e3);return this.expires_at-f}},set:function(f){var h=parseInt(f);if(typeof h=="number"&&h>0){var p=parseInt(Date.now()/1e3);this.expires_at=p+h}}},{key:"expired",get:function(){var f=this.expires_in;if(f!==void 0)return f<=0}},{key:"scopes",get:function(){return(this.scope||"").split(" ")}}]),g}()},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.AccessTokenEvents=void 0;var l=u(0),c=u(46);function g(y,f){if(!(y instanceof f))throw new TypeError("Cannot call a class as a function")}o.AccessTokenEvents=function(){function y(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=f.accessTokenExpiringNotificationTime,p=h===void 0?60:h,w=f.accessTokenExpiringTimer,x=w===void 0?new c.Timer("Access token expiring"):w,F=f.accessTokenExpiredTimer,P=F===void 0?new c.Timer("Access token expired"):F;g(this,y),this._accessTokenExpiringNotificationTime=p,this._accessTokenExpiring=x,this._accessTokenExpired=P}return y.prototype.load=function(h){if(h.access_token&&h.expires_in!==void 0){var p=h.expires_in;if(l.Log.debug("AccessTokenEvents.load: access token present, remaining duration:",p),p>0){var w=p-this._accessTokenExpiringNotificationTime;w<=0&&(w=1),l.Log.debug("AccessTokenEvents.load: registering expiring timer in:",w),this._accessTokenExpiring.init(w)}else l.Log.debug("AccessTokenEvents.load: canceling existing expiring timer becase we're past expiration."),this._accessTokenExpiring.cancel();var x=p+1;l.Log.debug("AccessTokenEvents.load: registering expired timer in:",x),this._accessTokenExpired.init(x)}else this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()},y.prototype.unload=function(){l.Log.debug("AccessTokenEvents.unload: canceling existing access token timers"),this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()},y.prototype.addAccessTokenExpiring=function(h){this._accessTokenExpiring.addHandler(h)},y.prototype.removeAccessTokenExpiring=function(h){this._accessTokenExpiring.removeHandler(h)},y.prototype.addAccessTokenExpired=function(h){this._accessTokenExpired.addHandler(h)},y.prototype.removeAccessTokenExpired=function(h){this._accessTokenExpired.removeHandler(h)},y}()},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.Event=void 0;var l=u(0);o.Event=function(){function c(g){(function(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")})(this,c),this._name=g,this._callbacks=[]}return c.prototype.addHandler=function(y){this._callbacks.push(y)},c.prototype.removeHandler=function(y){var f=this._callbacks.findIndex(function(h){return h===y});f>=0&&this._callbacks.splice(f,1)},c.prototype.raise=function(){l.Log.debug("Event: Raising event: "+this._name);for(var y=0;y<this._callbacks.length;y++){var f;(f=this._callbacks)[y].apply(f,arguments)}},c}()},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.SessionMonitor=void 0;var l=function(){function h(p,w){for(var x=0;x<w.length;x++){var F=w[x];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(p,F.key,F)}}return function(p,w,x){return w&&h(p.prototype,w),x&&h(p,x),p}}(),c=u(0),g=u(19),y=u(1);function f(h,p){if(!(h instanceof p))throw new TypeError("Cannot call a class as a function")}o.SessionMonitor=function(){function h(p){var w=this,x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:g.CheckSessionIFrame,F=arguments.length>2&&arguments[2]!==void 0?arguments[2]:y.Global.timer;if(f(this,h),!p)throw c.Log.error("SessionMonitor.ctor: No user manager passed to SessionMonitor"),new Error("userManager");this._userManager=p,this._CheckSessionIFrameCtor=x,this._timer=F,this._userManager.events.addUserLoaded(this._start.bind(this)),this._userManager.events.addUserUnloaded(this._stop.bind(this)),Promise.resolve(this._userManager.getUser().then(function(P){P?w._start(P):w._settings.monitorAnonymousSession&&w._userManager.querySessionStatus().then(function(A){var b={session_state:A.session_state};A.sub&&A.sid&&(b.profile={sub:A.sub,sid:A.sid}),w._start(b)}).catch(function(A){c.Log.error("SessionMonitor ctor: error from querySessionStatus:",A.message)})}).catch(function(P){c.Log.error("SessionMonitor ctor: error from getUser:",P.message)}))}return h.prototype._start=function(w){var x=this,F=w.session_state;F&&(w.profile?(this._sub=w.profile.sub,this._sid=w.profile.sid,c.Log.debug("SessionMonitor._start: session_state:",F,", sub:",this._sub)):(this._sub=void 0,this._sid=void 0,c.Log.debug("SessionMonitor._start: session_state:",F,", anonymous user")),this._checkSessionIFrame?this._checkSessionIFrame.start(F):this._metadataService.getCheckSessionIframe().then(function(P){if(P){c.Log.debug("SessionMonitor._start: Initializing check session iframe");var A=x._client_id,b=x._checkSessionInterval,T=x._stopCheckSessionOnError;x._checkSessionIFrame=new x._CheckSessionIFrameCtor(x._callback.bind(x),A,P,b,T),x._checkSessionIFrame.load().then(function(){x._checkSessionIFrame.start(F)})}else c.Log.warn("SessionMonitor._start: No check session iframe found in the metadata")}).catch(function(P){c.Log.error("SessionMonitor._start: Error from getCheckSessionIframe:",P.message)}))},h.prototype._stop=function(){var w=this;if(this._sub=void 0,this._sid=void 0,this._checkSessionIFrame&&(c.Log.debug("SessionMonitor._stop"),this._checkSessionIFrame.stop()),this._settings.monitorAnonymousSession)var x=this._timer.setInterval(function(){w._timer.clearInterval(x),w._userManager.querySessionStatus().then(function(F){var P={session_state:F.session_state};F.sub&&F.sid&&(P.profile={sub:F.sub,sid:F.sid}),w._start(P)}).catch(function(F){c.Log.error("SessionMonitor: error from querySessionStatus:",F.message)})},1e3)},h.prototype._callback=function(){var w=this;this._userManager.querySessionStatus().then(function(x){var F=!0;x?x.sub===w._sub?(F=!1,w._checkSessionIFrame.start(x.session_state),x.sid===w._sid?c.Log.debug("SessionMonitor._callback: Same sub still logged in at OP, restarting check session iframe; session_state:",x.session_state):(c.Log.debug("SessionMonitor._callback: Same sub still logged in at OP, session state has changed, restarting check session iframe; session_state:",x.session_state),w._userManager.events._raiseUserSessionChanged())):c.Log.debug("SessionMonitor._callback: Different subject signed into OP:",x.sub):c.Log.debug("SessionMonitor._callback: Subject no longer signed into OP"),F&&(w._sub?(c.Log.debug("SessionMonitor._callback: SessionMonitor._callback; raising signed out event"),w._userManager.events._raiseUserSignedOut()):(c.Log.debug("SessionMonitor._callback: SessionMonitor._callback; raising signed in event"),w._userManager.events._raiseUserSignedIn()))}).catch(function(x){w._sub&&(c.Log.debug("SessionMonitor._callback: Error calling queryCurrentSigninSession; raising signed out event",x.message),w._userManager.events._raiseUserSignedOut())})},l(h,[{key:"_settings",get:function(){return this._userManager.settings}},{key:"_metadataService",get:function(){return this._userManager.metadataService}},{key:"_client_id",get:function(){return this._settings.client_id}},{key:"_checkSessionInterval",get:function(){return this._settings.checkSessionInterval}},{key:"_stopCheckSessionOnError",get:function(){return this._settings.stopCheckSessionOnError}}]),h}()},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.CheckSessionIFrame=void 0;var l=u(0);function c(g,y){if(!(g instanceof y))throw new TypeError("Cannot call a class as a function")}o.CheckSessionIFrame=function(){function g(y,f,h,p){var w=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];c(this,g),this._callback=y,this._client_id=f,this._url=h,this._interval=p||2e3,this._stopOnError=w;var x=h.indexOf("/",h.indexOf("//")+2);this._frame_origin=h.substr(0,x),this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="absolute",this._frame.style.display="none",this._frame.width=0,this._frame.height=0,this._frame.src=h}return g.prototype.load=function(){var f=this;return new Promise(function(h){f._frame.onload=function(){h()},window.document.body.appendChild(f._frame),f._boundMessageEvent=f._message.bind(f),window.addEventListener("message",f._boundMessageEvent,!1)})},g.prototype._message=function(f){f.origin===this._frame_origin&&f.source===this._frame.contentWindow&&(f.data==="error"?(l.Log.error("CheckSessionIFrame: error message from check session op iframe"),this._stopOnError&&this.stop()):f.data==="changed"?(l.Log.debug("CheckSessionIFrame: changed message from check session op iframe"),this.stop(),this._callback()):l.Log.debug("CheckSessionIFrame: "+f.data+" message from check session op iframe"))},g.prototype.start=function(f){var h=this;if(this._session_state!==f){l.Log.debug("CheckSessionIFrame.start"),this.stop(),this._session_state=f;var p=function(){h._frame.contentWindow.postMessage(h._client_id+" "+h._session_state,h._frame_origin)};p(),this._timer=window.setInterval(p,this._interval)}},g.prototype.stop=function(){this._session_state=null,this._timer&&(l.Log.debug("CheckSessionIFrame.stop"),window.clearInterval(this._timer),this._timer=null)},g}()},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.TokenRevocationClient=void 0;var l=u(0),c=u(2),g=u(1);function y(p,w){if(!(p instanceof w))throw new TypeError("Cannot call a class as a function")}var f="access_token",h="refresh_token";o.TokenRevocationClient=function(){function p(w){var x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:g.Global.XMLHttpRequest,F=arguments.length>2&&arguments[2]!==void 0?arguments[2]:c.MetadataService;if(y(this,p),!w)throw l.Log.error("TokenRevocationClient.ctor: No settings provided"),new Error("No settings provided.");this._settings=w,this._XMLHttpRequestCtor=x,this._metadataService=new F(this._settings)}return p.prototype.revoke=function(x,F){var P=this,A=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"access_token";if(!x)throw l.Log.error("TokenRevocationClient.revoke: No token provided"),new Error("No token provided.");if(A!==f&&A!=h)throw l.Log.error("TokenRevocationClient.revoke: Invalid token type"),new Error("Invalid token type.");return this._metadataService.getRevocationEndpoint().then(function(b){if(b){l.Log.debug("TokenRevocationClient.revoke: Revoking "+A);var T=P._settings.client_id,H=P._settings.client_secret;return P._revoke(b,T,H,x,A)}if(F)throw l.Log.error("TokenRevocationClient.revoke: Revocation not supported"),new Error("Revocation not supported")})},p.prototype._revoke=function(x,F,P,A,b){var T=this;return new Promise(function(H,M){var G=new T._XMLHttpRequestCtor;G.open("POST",x),G.onload=function(){l.Log.debug("TokenRevocationClient.revoke: HTTP response received, status",G.status),G.status===200?H():M(Error(G.statusText+" ("+G.status+")"))},G.onerror=function(){l.Log.debug("TokenRevocationClient.revoke: Network Error."),M("Network Error")};var V="client_id="+encodeURIComponent(F);P&&(V+="&client_secret="+encodeURIComponent(P)),V+="&token_type_hint="+encodeURIComponent(b),V+="&token="+encodeURIComponent(A),G.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),G.send(V)})},p}()},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.CordovaPopupWindow=void 0;var l=function(){function g(y,f){for(var h=0;h<f.length;h++){var p=f[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(y,p.key,p)}}return function(y,f,h){return f&&g(y.prototype,f),h&&g(y,h),y}}(),c=u(0);o.CordovaPopupWindow=function(){function g(y){var f=this;(function(p,w){if(!(p instanceof w))throw new TypeError("Cannot call a class as a function")})(this,g),this._promise=new Promise(function(h,p){f._resolve=h,f._reject=p}),this.features=y.popupWindowFeatures||"location=no,toolbar=no,zoom=no",this.target=y.popupWindowTarget||"_blank",this.redirect_uri=y.startUrl,c.Log.debug("CordovaPopupWindow.ctor: redirect_uri: "+this.redirect_uri)}return g.prototype._isInAppBrowserInstalled=function(f){return["cordova-plugin-inappbrowser","cordova-plugin-inappbrowser.inappbrowser","org.apache.cordova.inappbrowser"].some(function(h){return f.hasOwnProperty(h)})},g.prototype.navigate=function(f){if(f&&f.url){if(!window.cordova)return this._error("cordova is undefined");var h=window.cordova.require("cordova/plugin_list").metadata;if(this._isInAppBrowserInstalled(h)===!1)return this._error("InAppBrowser plugin not found");this._popup=cordova.InAppBrowser.open(f.url,this.target,this.features),this._popup?(c.Log.debug("CordovaPopupWindow.navigate: popup successfully created"),this._exitCallbackEvent=this._exitCallback.bind(this),this._loadStartCallbackEvent=this._loadStartCallback.bind(this),this._popup.addEventListener("exit",this._exitCallbackEvent,!1),this._popup.addEventListener("loadstart",this._loadStartCallbackEvent,!1)):this._error("Error opening popup window")}else this._error("No url provided");return this.promise},g.prototype._loadStartCallback=function(f){f.url.indexOf(this.redirect_uri)===0&&this._success({url:f.url})},g.prototype._exitCallback=function(f){this._error(f)},g.prototype._success=function(f){this._cleanup(),c.Log.debug("CordovaPopupWindow: Successful response from cordova popup window"),this._resolve(f)},g.prototype._error=function(f){this._cleanup(),c.Log.error(f),this._reject(new Error(f))},g.prototype.close=function(){this._cleanup()},g.prototype._cleanup=function(){this._popup&&(c.Log.debug("CordovaPopupWindow: cleaning up popup"),this._popup.removeEventListener("exit",this._exitCallbackEvent,!1),this._popup.removeEventListener("loadstart",this._loadStartCallbackEvent,!1),this._popup.close()),this._popup=null},l(g,[{key:"promise",get:function(){return this._promise}}]),g}()},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0});var l=u(0),c=u(10),g=u(5),y=u(6),f=u(37),h=u(38),p=u(16),w=u(2),x=u(48),F=u(49),P=u(19),A=u(20),b=u(18),T=u(1),H=u(15),M=u(50);o.default={Version:M.Version,Log:l.Log,OidcClient:c.OidcClient,OidcClientSettings:g.OidcClientSettings,WebStorageStateStore:y.WebStorageStateStore,InMemoryWebStorage:f.InMemoryWebStorage,UserManager:h.UserManager,AccessTokenEvents:p.AccessTokenEvents,MetadataService:w.MetadataService,CordovaPopupNavigator:x.CordovaPopupNavigator,CordovaIFrameNavigator:F.CordovaIFrameNavigator,CheckSessionIFrame:P.CheckSessionIFrame,TokenRevocationClient:A.TokenRevocationClient,SessionMonitor:b.SessionMonitor,Global:T.Global,User:H.User},s.exports=o.default},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.ClockService=function(){function l(){(function(g,y){if(!(g instanceof y))throw new TypeError("Cannot call a class as a function")})(this,l)}return l.prototype.getEpochTime=function(){return Promise.resolve(Date.now()/1e3|0)},l}()},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.ResponseValidator=void 0;var l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(F){return typeof F}:function(F){return F&&typeof Symbol=="function"&&F.constructor===Symbol&&F!==Symbol.prototype?"symbol":typeof F},c=u(0),g=u(2),y=u(25),f=u(11),h=u(12),p=u(4);function w(F,P){if(!(F instanceof P))throw new TypeError("Cannot call a class as a function")}var x=["nonce","at_hash","iat","nbf","exp","aud","iss","c_hash"];o.ResponseValidator=function(){function F(P){var A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:g.MetadataService,b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:y.UserInfoService,T=arguments.length>3&&arguments[3]!==void 0?arguments[3]:p.JoseUtil,H=arguments.length>4&&arguments[4]!==void 0?arguments[4]:f.TokenClient;if(w(this,F),!P)throw c.Log.error("ResponseValidator.ctor: No settings passed to ResponseValidator"),new Error("settings");this._settings=P,this._metadataService=new A(this._settings),this._userInfoService=new b(this._settings),this._joseUtil=T,this._tokenClient=new H(this._settings)}return F.prototype.validateSigninResponse=function(A,b){var T=this;return c.Log.debug("ResponseValidator.validateSigninResponse"),this._processSigninParams(A,b).then(function(H){return c.Log.debug("ResponseValidator.validateSigninResponse: state processed"),T._validateTokens(A,H).then(function(M){return c.Log.debug("ResponseValidator.validateSigninResponse: tokens validated"),T._processClaims(A,M).then(function(G){return c.Log.debug("ResponseValidator.validateSigninResponse: claims processed"),G})})})},F.prototype.validateSignoutResponse=function(A,b){return A.id!==b.state?(c.Log.error("ResponseValidator.validateSignoutResponse: State does not match"),Promise.reject(new Error("State does not match"))):(c.Log.debug("ResponseValidator.validateSignoutResponse: state validated"),b.state=A.data,b.error?(c.Log.warn("ResponseValidator.validateSignoutResponse: Response was error",b.error),Promise.reject(new h.ErrorResponse(b))):Promise.resolve(b))},F.prototype._processSigninParams=function(A,b){if(A.id!==b.state)return c.Log.error("ResponseValidator._processSigninParams: State does not match"),Promise.reject(new Error("State does not match"));if(!A.client_id)return c.Log.error("ResponseValidator._processSigninParams: No client_id on state"),Promise.reject(new Error("No client_id on state"));if(!A.authority)return c.Log.error("ResponseValidator._processSigninParams: No authority on state"),Promise.reject(new Error("No authority on state"));if(this._settings.authority){if(this._settings.authority&&this._settings.authority!==A.authority)return c.Log.error("ResponseValidator._processSigninParams: authority mismatch on settings vs. signin state"),Promise.reject(new Error("authority mismatch on settings vs. signin state"))}else this._settings.authority=A.authority;if(this._settings.client_id){if(this._settings.client_id&&this._settings.client_id!==A.client_id)return c.Log.error("ResponseValidator._processSigninParams: client_id mismatch on settings vs. signin state"),Promise.reject(new Error("client_id mismatch on settings vs. signin state"))}else this._settings.client_id=A.client_id;return c.Log.debug("ResponseValidator._processSigninParams: state validated"),b.state=A.data,b.error?(c.Log.warn("ResponseValidator._processSigninParams: Response was error",b.error),Promise.reject(new h.ErrorResponse(b))):A.nonce&&!b.id_token?(c.Log.error("ResponseValidator._processSigninParams: Expecting id_token in response"),Promise.reject(new Error("No id_token in response"))):!A.nonce&&b.id_token?(c.Log.error("ResponseValidator._processSigninParams: Not expecting id_token in response"),Promise.reject(new Error("Unexpected id_token in response"))):A.code_verifier&&!b.code?(c.Log.error("ResponseValidator._processSigninParams: Expecting code in response"),Promise.reject(new Error("No code in response"))):!A.code_verifier&&b.code?(c.Log.error("ResponseValidator._processSigninParams: Not expecting code in response"),Promise.reject(new Error("Unexpected code in response"))):(b.scope||(b.scope=A.scope),Promise.resolve(b))},F.prototype._processClaims=function(A,b){var T=this;if(b.isOpenIdConnect){if(c.Log.debug("ResponseValidator._processClaims: response is OIDC, processing claims"),b.profile=this._filterProtocolClaims(b.profile),A.skipUserInfo!==!0&&this._settings.loadUserInfo&&b.access_token)return c.Log.debug("ResponseValidator._processClaims: loading user info"),this._userInfoService.getClaims(b.access_token).then(function(H){return c.Log.debug("ResponseValidator._processClaims: user info claims received from user info endpoint"),H.sub!==b.profile.sub?(c.Log.error("ResponseValidator._processClaims: sub from user info endpoint does not match sub in id_token"),Promise.reject(new Error("sub from user info endpoint does not match sub in id_token"))):(b.profile=T._mergeClaims(b.profile,H),c.Log.debug("ResponseValidator._processClaims: user info claims received, updated profile:",b.profile),b)});c.Log.debug("ResponseValidator._processClaims: not loading user info")}else c.Log.debug("ResponseValidator._processClaims: response is not OIDC, not processing claims");return Promise.resolve(b)},F.prototype._mergeClaims=function(A,b){var T=Object.assign({},A);for(var H in b){var M=b[H];Array.isArray(M)||(M=[M]);for(var G=0;G<M.length;G++){var V=M[G];T[H]?Array.isArray(T[H])?T[H].indexOf(V)<0&&T[H].push(V):T[H]!==V&&((V===void 0?"undefined":l(V))==="object"&&this._settings.mergeClaims?T[H]=this._mergeClaims(T[H],V):T[H]=[T[H],V]):T[H]=V}}return T},F.prototype._filterProtocolClaims=function(A){c.Log.debug("ResponseValidator._filterProtocolClaims, incoming claims:",A);var b=Object.assign({},A);return this._settings._filterProtocolClaims?(x.forEach(function(T){delete b[T]}),c.Log.debug("ResponseValidator._filterProtocolClaims: protocol claims filtered",b)):c.Log.debug("ResponseValidator._filterProtocolClaims: protocol claims not filtered"),b},F.prototype._validateTokens=function(A,b){return b.code?(c.Log.debug("ResponseValidator._validateTokens: Validating code"),this._processCode(A,b)):b.id_token?b.access_token?(c.Log.debug("ResponseValidator._validateTokens: Validating id_token and access_token"),this._validateIdTokenAndAccessToken(A,b)):(c.Log.debug("ResponseValidator._validateTokens: Validating id_token"),this._validateIdToken(A,b)):(c.Log.debug("ResponseValidator._validateTokens: No code to process or id_token to validate"),Promise.resolve(b))},F.prototype._processCode=function(A,b){var T=this,H={client_id:A.client_id,client_secret:A.client_secret,code:b.code,redirect_uri:A.redirect_uri,code_verifier:A.code_verifier};return A.extraTokenParams&&l(A.extraTokenParams)==="object"&&Object.assign(H,A.extraTokenParams),this._tokenClient.exchangeCode(H).then(function(M){for(var G in M)b[G]=M[G];return b.id_token?(c.Log.debug("ResponseValidator._processCode: token response successful, processing id_token"),T._validateIdTokenAttributes(A,b)):(c.Log.debug("ResponseValidator._processCode: token response successful, returning response"),b)})},F.prototype._validateIdTokenAttributes=function(A,b){var T=this;return this._metadataService.getIssuer().then(function(H){var M=A.client_id,G=T._settings.clockSkew;return c.Log.debug("ResponseValidator._validateIdTokenAttributes: Validaing JWT attributes; using clock skew (in seconds) of: ",G),T._settings.getEpochTime().then(function(V){return T._joseUtil.validateJwtAttributes(b.id_token,H,M,G,V).then(function(j){return A.nonce&&A.nonce!==j.nonce?(c.Log.error("ResponseValidator._validateIdTokenAttributes: Invalid nonce in id_token"),Promise.reject(new Error("Invalid nonce in id_token"))):j.sub?(b.profile=j,b):(c.Log.error("ResponseValidator._validateIdTokenAttributes: No sub present in id_token"),Promise.reject(new Error("No sub present in id_token")))})})})},F.prototype._validateIdTokenAndAccessToken=function(A,b){var T=this;return this._validateIdToken(A,b).then(function(H){return T._validateAccessToken(H)})},F.prototype._getSigningKeyForJwt=function(A){var b=this;return this._metadataService.getSigningKeys().then(function(T){var H=A.header.kid;if(!T)return c.Log.error("ResponseValidator._validateIdToken: No signing keys from metadata"),Promise.reject(new Error("No signing keys from metadata"));c.Log.debug("ResponseValidator._validateIdToken: Received signing keys");var M=void 0;if(H)M=T.filter(function(G){return G.kid===H})[0];else{if((T=b._filterByAlg(T,A.header.alg)).length>1)return c.Log.error("ResponseValidator._validateIdToken: No kid found in id_token and more than one key found in metadata"),Promise.reject(new Error("No kid found in id_token and more than one key found in metadata"));M=T[0]}return Promise.resolve(M)})},F.prototype._getSigningKeyForJwtWithSingleRetry=function(A){var b=this;return this._getSigningKeyForJwt(A).then(function(T){return T?Promise.resolve(T):(b._metadataService.resetSigningKeys(),b._getSigningKeyForJwt(A))})},F.prototype._validateIdToken=function(A,b){var T=this;if(!A.nonce)return c.Log.error("ResponseValidator._validateIdToken: No nonce on state"),Promise.reject(new Error("No nonce on state"));var H=this._joseUtil.parseJwt(b.id_token);return H&&H.header&&H.payload?A.nonce!==H.payload.nonce?(c.Log.error("ResponseValidator._validateIdToken: Invalid nonce in id_token"),Promise.reject(new Error("Invalid nonce in id_token"))):this._metadataService.getIssuer().then(function(M){return c.Log.debug("ResponseValidator._validateIdToken: Received issuer"),T._getSigningKeyForJwtWithSingleRetry(H).then(function(G){if(!G)return c.Log.error("ResponseValidator._validateIdToken: No key matching kid or alg found in signing keys"),Promise.reject(new Error("No key matching kid or alg found in signing keys"));var V=A.client_id,j=T._settings.clockSkew;return c.Log.debug("ResponseValidator._validateIdToken: Validaing JWT; using clock skew (in seconds) of: ",j),T._joseUtil.validateJwt(b.id_token,G,M,V,j).then(function(){return c.Log.debug("ResponseValidator._validateIdToken: JWT validation successful"),H.payload.sub?(b.profile=H.payload,b):(c.Log.error("ResponseValidator._validateIdToken: No sub present in id_token"),Promise.reject(new Error("No sub present in id_token")))})})}):(c.Log.error("ResponseValidator._validateIdToken: Failed to parse id_token",H),Promise.reject(new Error("Failed to parse id_token")))},F.prototype._filterByAlg=function(A,b){var T=null;if(b.startsWith("RS"))T="RSA";else if(b.startsWith("PS"))T="PS";else{if(!b.startsWith("ES"))return c.Log.debug("ResponseValidator._filterByAlg: alg not supported: ",b),[];T="EC"}return c.Log.debug("ResponseValidator._filterByAlg: Looking for keys that match kty: ",T),A=A.filter(function(H){return H.kty===T}),c.Log.debug("ResponseValidator._filterByAlg: Number of keys that match kty: ",T,A.length),A},F.prototype._validateAccessToken=function(A){if(!A.profile)return c.Log.error("ResponseValidator._validateAccessToken: No profile loaded from id_token"),Promise.reject(new Error("No profile loaded from id_token"));if(!A.profile.at_hash)return c.Log.error("ResponseValidator._validateAccessToken: No at_hash in id_token"),Promise.reject(new Error("No at_hash in id_token"));if(!A.id_token)return c.Log.error("ResponseValidator._validateAccessToken: No id_token"),Promise.reject(new Error("No id_token"));var b=this._joseUtil.parseJwt(A.id_token);if(!b||!b.header)return c.Log.error("ResponseValidator._validateAccessToken: Failed to parse id_token",b),Promise.reject(new Error("Failed to parse id_token"));var T=b.header.alg;if(!T||T.length!==5)return c.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",T),Promise.reject(new Error("Unsupported alg: "+T));var H=T.substr(2,3);if(!H)return c.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",T,H),Promise.reject(new Error("Unsupported alg: "+T));if((H=parseInt(H))!==256&&H!==384&&H!==512)return c.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",T,H),Promise.reject(new Error("Unsupported alg: "+T));var M="sha"+H,G=this._joseUtil.hashString(A.access_token,M);if(!G)return c.Log.error("ResponseValidator._validateAccessToken: access_token hash failed:",M),Promise.reject(new Error("Failed to validate at_hash"));var V=G.substr(0,G.length/2),j=this._joseUtil.hexToBase64Url(V);return j!==A.profile.at_hash?(c.Log.error("ResponseValidator._validateAccessToken: Failed to validate at_hash",j,A.profile.at_hash),Promise.reject(new Error("Failed to validate at_hash"))):(c.Log.debug("ResponseValidator._validateAccessToken: success"),Promise.resolve(A))},F}()},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.UserInfoService=void 0;var l=u(7),c=u(2),g=u(0),y=u(4);function f(h,p){if(!(h instanceof p))throw new TypeError("Cannot call a class as a function")}o.UserInfoService=function(){function h(p){var w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:l.JsonService,x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:c.MetadataService,F=arguments.length>3&&arguments[3]!==void 0?arguments[3]:y.JoseUtil;if(f(this,h),!p)throw g.Log.error("UserInfoService.ctor: No settings passed"),new Error("settings");this._settings=p,this._jsonService=new w(void 0,void 0,this._getClaimsFromJwt.bind(this)),this._metadataService=new x(this._settings),this._joseUtil=F}return h.prototype.getClaims=function(w){var x=this;return w?this._metadataService.getUserInfoEndpoint().then(function(F){return g.Log.debug("UserInfoService.getClaims: received userinfo url",F),x._jsonService.getJson(F,w).then(function(P){return g.Log.debug("UserInfoService.getClaims: claims received",P),P})}):(g.Log.error("UserInfoService.getClaims: No token passed"),Promise.reject(new Error("A token is required")))},h.prototype._getClaimsFromJwt=function(w){var x=this;try{var F=this._joseUtil.parseJwt(w.responseText);if(!F||!F.header||!F.payload)return g.Log.error("UserInfoService._getClaimsFromJwt: Failed to parse JWT",F),Promise.reject(new Error("Failed to parse id_token"));var P=F.header.kid,A=void 0;switch(this._settings.userInfoJwtIssuer){case"OP":A=this._metadataService.getIssuer();break;case"ANY":A=Promise.resolve(F.payload.iss);break;default:A=Promise.resolve(this._settings.userInfoJwtIssuer)}return A.then(function(b){return g.Log.debug("UserInfoService._getClaimsFromJwt: Received issuer:"+b),x._metadataService.getSigningKeys().then(function(T){if(!T)return g.Log.error("UserInfoService._getClaimsFromJwt: No signing keys from metadata"),Promise.reject(new Error("No signing keys from metadata"));g.Log.debug("UserInfoService._getClaimsFromJwt: Received signing keys");var H=void 0;if(P)H=T.filter(function(V){return V.kid===P})[0];else{if((T=x._filterByAlg(T,F.header.alg)).length>1)return g.Log.error("UserInfoService._getClaimsFromJwt: No kid found in id_token and more than one key found in metadata"),Promise.reject(new Error("No kid found in id_token and more than one key found in metadata"));H=T[0]}if(!H)return g.Log.error("UserInfoService._getClaimsFromJwt: No key matching kid or alg found in signing keys"),Promise.reject(new Error("No key matching kid or alg found in signing keys"));var M=x._settings.client_id,G=x._settings.clockSkew;return g.Log.debug("UserInfoService._getClaimsFromJwt: Validaing JWT; using clock skew (in seconds) of: ",G),x._joseUtil.validateJwt(w.responseText,H,b,M,G,void 0,!0).then(function(){return g.Log.debug("UserInfoService._getClaimsFromJwt: JWT validation successful"),F.payload})})})}catch(b){return g.Log.error("UserInfoService._getClaimsFromJwt: Error parsing JWT response",b.message),void reject(b)}},h.prototype._filterByAlg=function(w,x){var F=null;if(x.startsWith("RS"))F="RSA";else if(x.startsWith("PS"))F="PS";else{if(!x.startsWith("ES"))return g.Log.debug("UserInfoService._filterByAlg: alg not supported: ",x),[];F="EC"}return g.Log.debug("UserInfoService._filterByAlg: Looking for keys that match kty: ",F),w=w.filter(function(P){return P.kty===F}),g.Log.debug("UserInfoService._filterByAlg: Number of keys that match kty: ",F,w.length),w},h}()},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.AllowedSigningAlgs=o.b64tohex=o.hextob64u=o.crypto=o.X509=o.KeyUtil=o.jws=void 0;var l=u(27);o.jws=l.jws,o.KeyUtil=l.KEYUTIL,o.X509=l.X509,o.crypto=l.crypto,o.hextob64u=l.hextob64u,o.b64tohex=l.b64tohex,o.AllowedSigningAlgs=["RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"]},function(s,o,u){(function(l){Object.defineProperty(o,"__esModule",{value:!0});var c,g,y,f,h,p,w,x,F,P,A,b=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},T={userAgent:!1},H={},M=M||(c=Math,y=(g={}).lib={},f=y.Base=function(){function t(){}return{extend:function(i){t.prototype=this;var a=new t;return i&&a.mixIn(i),a.hasOwnProperty("init")||(a.init=function(){a.$super.init.apply(this,arguments)}),a.init.prototype=a,a.$super=this,a},create:function(){var i=this.extend();return i.init.apply(i,arguments),i},init:function(){},mixIn:function(i){for(var a in i)i.hasOwnProperty(a)&&(this[a]=i[a]);i.hasOwnProperty("toString")&&(this.toString=i.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),h=y.WordArray=f.extend({init:function(e,i){e=this.words=e||[],this.sigBytes=i!=null?i:4*e.length},toString:function(e){return(e||w).stringify(this)},concat:function(e){var i=this.words,a=e.words,d=this.sigBytes,v=e.sigBytes;if(this.clamp(),d%4)for(var E=0;E<v;E++){var k=a[E>>>2]>>>24-E%4*8&255;i[d+E>>>2]|=k<<24-(d+E)%4*8}else for(E=0;E<v;E+=4)i[d+E>>>2]=a[E>>>2];return this.sigBytes+=v,this},clamp:function(){var e=this.words,i=this.sigBytes;e[i>>>2]&=4294967295<<32-i%4*8,e.length=c.ceil(i/4)},clone:function(){var e=f.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var i=[],a=0;a<e;a+=4)i.push(4294967296*c.random()|0);return new h.init(i,e)}}),p=g.enc={},w=p.Hex={stringify:function(e){for(var i=e.words,a=e.sigBytes,d=[],v=0;v<a;v++){var E=i[v>>>2]>>>24-v%4*8&255;d.push((E>>>4).toString(16)),d.push((15&E).toString(16))}return d.join("")},parse:function(e){for(var i=e.length,a=[],d=0;d<i;d+=2)a[d>>>3]|=parseInt(e.substr(d,2),16)<<24-d%8*4;return new h.init(a,i/2)}},x=p.Latin1={stringify:function(e){for(var i=e.words,a=e.sigBytes,d=[],v=0;v<a;v++){var E=i[v>>>2]>>>24-v%4*8&255;d.push(String.fromCharCode(E))}return d.join("")},parse:function(e){for(var i=e.length,a=[],d=0;d<i;d++)a[d>>>2]|=(255&e.charCodeAt(d))<<24-d%4*8;return new h.init(a,i)}},F=p.Utf8={stringify:function(e){try{return decodeURIComponent(escape(x.stringify(e)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(e){return x.parse(unescape(encodeURIComponent(e)))}},P=y.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new h.init,this._nDataBytes=0},_append:function(e){typeof e=="string"&&(e=F.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var i=this._data,a=i.words,d=i.sigBytes,v=this.blockSize,E=d/(4*v),k=(E=e?c.ceil(E):c.max((0|E)-this._minBufferSize,0))*v,R=c.min(4*k,d);if(k){for(var I=0;I<k;I+=v)this._doProcessBlock(a,I);var U=a.splice(0,k);i.sigBytes-=R}return new h.init(U,R)},clone:function(){var e=f.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),y.Hasher=P.extend({cfg:f.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){P.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(i,a){return new e.init(a).finalize(i)}},_createHmacHelper:function(e){return function(i,a){return new A.HMAC.init(e,a).finalize(i)}}}),A=g.algo={},g);(function(t){var e,i=(e=M).lib,a=i.Base,d=i.WordArray;(e=e.x64={}).Word=a.extend({init:function(E,k){this.high=E,this.low=k}}),e.WordArray=a.extend({init:function(E,k){E=this.words=E||[],this.sigBytes=k!=null?k:8*E.length},toX32:function(){for(var E=this.words,k=E.length,R=[],I=0;I<k;I++){var U=E[I];R.push(U.high),R.push(U.low)}return d.create(R,this.sigBytes)},clone:function(){for(var E=a.clone.call(this),k=E.words=this.words.slice(0),R=k.length,I=0;I<R;I++)k[I]=k[I].clone();return E}})})(),function(){var t=M,e=t.lib.WordArray;t.enc.Base64={stringify:function(a){var d=a.words,v=a.sigBytes,E=this._map;a.clamp(),a=[];for(var k=0;k<v;k+=3)for(var R=(d[k>>>2]>>>24-k%4*8&255)<<16|(d[k+1>>>2]>>>24-(k+1)%4*8&255)<<8|d[k+2>>>2]>>>24-(k+2)%4*8&255,I=0;4>I&&k+.75*I<v;I++)a.push(E.charAt(R>>>6*(3-I)&63));if(d=E.charAt(64))for(;a.length%4;)a.push(d);return a.join("")},parse:function(a){var d=a.length,v=this._map;(E=v.charAt(64))&&(E=a.indexOf(E))!=-1&&(d=E);for(var E=[],k=0,R=0;R<d;R++)if(R%4){var I=v.indexOf(a.charAt(R-1))<<R%4*2,U=v.indexOf(a.charAt(R))>>>6-R%4*2;E[k>>>2]|=(I|U)<<24-k%4*8,k++}return e.create(E,k)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(t){for(var e=M,i=(d=e.lib).WordArray,a=d.Hasher,d=e.algo,v=[],E=[],k=function(Q){return 4294967296*(Q-(0|Q))|0},R=2,I=0;64>I;){var U;e:{U=R;for(var D=t.sqrt(U),B=2;B<=D;B++)if(!(U%B)){U=!1;break e}U=!0}U&&(8>I&&(v[I]=k(t.pow(R,.5))),E[I]=k(t.pow(R,1/3)),I++),R++}var $=[];d=d.SHA256=a.extend({_doReset:function(){this._hash=new i.init(v.slice(0))},_doProcessBlock:function(Q,ee){for(var S=this._hash.words,O=S[0],N=S[1],K=S[2],Y=S[3],te=S[4],de=S[5],se=S[6],we=S[7],ce=0;64>ce;ce++){if(16>ce)$[ce]=0|Q[ee+ce];else{var ge=$[ce-15],Ue=$[ce-2];$[ce]=((ge<<25|ge>>>7)^(ge<<14|ge>>>18)^ge>>>3)+$[ce-7]+((Ue<<15|Ue>>>17)^(Ue<<13|Ue>>>19)^Ue>>>10)+$[ce-16]}ge=we+((te<<26|te>>>6)^(te<<21|te>>>11)^(te<<7|te>>>25))+(te&de^~te&se)+E[ce]+$[ce],Ue=((O<<30|O>>>2)^(O<<19|O>>>13)^(O<<10|O>>>22))+(O&N^O&K^N&K),we=se,se=de,de=te,te=Y+ge|0,Y=K,K=N,N=O,O=ge+Ue|0}S[0]=S[0]+O|0,S[1]=S[1]+N|0,S[2]=S[2]+K|0,S[3]=S[3]+Y|0,S[4]=S[4]+te|0,S[5]=S[5]+de|0,S[6]=S[6]+se|0,S[7]=S[7]+we|0},_doFinalize:function(){var Q=this._data,ee=Q.words,S=8*this._nDataBytes,O=8*Q.sigBytes;return ee[O>>>5]|=128<<24-O%32,ee[14+(O+64>>>9<<4)]=t.floor(S/4294967296),ee[15+(O+64>>>9<<4)]=S,Q.sigBytes=4*ee.length,this._process(),this._hash},clone:function(){var Q=a.clone.call(this);return Q._hash=this._hash.clone(),Q}}),e.SHA256=a._createHelper(d),e.HmacSHA256=a._createHmacHelper(d)}(Math),function(){function t(){return a.create.apply(a,arguments)}for(var e=M,i=e.lib.Hasher,a=(v=e.x64).Word,d=v.WordArray,v=e.algo,E=[t(1116352408,3609767458),t(1899447441,602891725),t(3049323471,3964484399),t(3921009573,2173295548),t(961987163,4081628472),t(1508970993,3053834265),t(2453635748,2937671579),t(2870763221,3664609560),t(3624381080,2734883394),t(310598401,1164996542),t(607225278,1323610764),t(1426881987,3590304994),t(1925078388,4068182383),t(2162078206,991336113),t(2614888103,633803317),t(3248222580,3479774868),t(3835390401,2666613458),t(4022224774,944711139),t(264347078,2341262773),t(604807628,2007800933),t(770255983,1495990901),t(1249150122,1856431235),t(1555081692,3175218132),t(1996064986,2198950837),t(2554220882,3999719339),t(2821834349,766784016),t(2952996808,2566594879),t(3210313671,3203337956),t(3336571891,1034457026),t(3584528711,2466948901),t(113926993,3758326383),t(338241895,168717936),t(666307205,1188179964),t(773529912,1546045734),t(1294757372,1522805485),t(1396182291,2643833823),t(1695183700,2343527390),t(1986661051,1014477480),t(2177026350,1206759142),t(2456956037,344077627),t(2730485921,1290863460),t(2820302411,3158454273),t(3259730800,3505952657),t(3345764771,106217008),t(3516065817,3606008344),t(3600352804,1432725776),t(4094571909,1467031594),t(275423344,851169720),t(430227734,3100823752),t(506948616,1363258195),t(659060556,3750685593),t(883997877,3785050280),t(958139571,3318307427),t(1322822218,3812723403),t(1537002063,2003034995),t(1747873779,3602036899),t(1955562222,1575990012),t(2024104815,1125592928),t(2227730452,2716904306),t(2361852424,442776044),t(2428436474,593698344),t(2756734187,3733110249),t(3204031479,2999351573),t(3329325298,3815920427),t(3391569614,3928383900),t(3515267271,566280711),t(3940187606,3454069534),t(4118630271,4000239992),t(116418474,1914138554),t(174292421,2731055270),t(289380356,3203993006),t(460393269,320620315),t(685471733,587496836),t(852142971,1086792851),t(1017036298,365543100),t(1126000580,2618297676),t(1288033470,3409855158),t(1501505948,4234509866),t(1607167915,987167468),t(1816402316,1246189591)],k=[],R=0;80>R;R++)k[R]=t();v=v.SHA512=i.extend({_doReset:function(){this._hash=new d.init([new a.init(1779033703,4089235720),new a.init(3144134277,2227873595),new a.init(1013904242,4271175723),new a.init(2773480762,1595750129),new a.init(1359893119,2917565137),new a.init(2600822924,725511199),new a.init(528734635,4215389547),new a.init(1541459225,327033209)])},_doProcessBlock:function(U,D){for(var B=(N=this._hash.words)[0],$=N[1],z=N[2],Q=N[3],ee=N[4],S=N[5],O=N[6],N=N[7],K=B.high,Y=B.low,te=$.high,de=$.low,se=z.high,we=z.low,ce=Q.high,ge=Q.low,Ue=ee.high,Ne=ee.low,De=S.high,Ft=S.low,ht=O.high,vt=O.low,We=N.high,et=N.low,at=K,mt=Y,Rr=te,gr=de,Ir=se,yr=we,xn=ce,kr=ge,Lt=Ue,Ut=Ne,zr=De,Ur=Ft,Yr=ht,Or=vt,Rn=We,Dr=et,Mt=0;80>Mt;Mt++){var sr=k[Mt];if(16>Mt)var Yt=sr.high=0|U[D+2*Mt],Le=sr.low=0|U[D+2*Mt+1];else{Yt=((Le=(Yt=k[Mt-15]).high)>>>1|(Xt=Yt.low)<<31)^(Le>>>8|Xt<<24)^Le>>>7;var Xt=(Xt>>>1|Le<<31)^(Xt>>>8|Le<<24)^(Xt>>>7|Le<<25),vr=((Le=(vr=k[Mt-2]).high)>>>19|(tt=vr.low)<<13)^(Le<<3|tt>>>29)^Le>>>6,tt=(tt>>>19|Le<<13)^(tt<<3|Le>>>29)^(tt>>>6|Le<<26),In=(Le=k[Mt-7]).high,ar=(ur=k[Mt-16]).high,ur=ur.low;Yt=(Yt=(Yt=Yt+In+((Le=Xt+Le.low)>>>0<Xt>>>0?1:0))+vr+((Le=Le+tt)>>>0<tt>>>0?1:0))+ar+((Le=Le+ur)>>>0<ur>>>0?1:0),sr.high=Yt,sr.low=Le}In=Lt&zr^~Lt&Yr,ur=Ut&Ur^~Ut&Or,sr=at&Rr^at&Ir^Rr&Ir;var Ms=mt&gr^mt&yr^gr&yr,Ks=(Xt=(at>>>28|mt<<4)^(at<<30|mt>>>2)^(at<<25|mt>>>7),vr=(mt>>>28|at<<4)^(mt<<30|at>>>2)^(mt<<25|at>>>7),(tt=E[Mt]).high),zi=tt.low;ar=Rn+((Lt>>>14|Ut<<18)^(Lt>>>18|Ut<<14)^(Lt<<23|Ut>>>9))+((tt=Dr+((Ut>>>14|Lt<<18)^(Ut>>>18|Lt<<14)^(Ut<<23|Lt>>>9)))>>>0<Dr>>>0?1:0),Rn=Yr,Dr=Or,Yr=zr,Or=Ur,zr=Lt,Ur=Ut,Lt=xn+(ar=(ar=(ar=ar+In+((tt=tt+ur)>>>0<ur>>>0?1:0))+Ks+((tt=tt+zi)>>>0<zi>>>0?1:0))+Yt+((tt=tt+Le)>>>0<Le>>>0?1:0))+((Ut=kr+tt|0)>>>0<kr>>>0?1:0)|0,xn=Ir,kr=yr,Ir=Rr,yr=gr,Rr=at,gr=mt,at=ar+(sr=Xt+sr+((Le=vr+Ms)>>>0<vr>>>0?1:0))+((mt=tt+Le|0)>>>0<tt>>>0?1:0)|0}Y=B.low=Y+mt,B.high=K+at+(Y>>>0<mt>>>0?1:0),de=$.low=de+gr,$.high=te+Rr+(de>>>0<gr>>>0?1:0),we=z.low=we+yr,z.high=se+Ir+(we>>>0<yr>>>0?1:0),ge=Q.low=ge+kr,Q.high=ce+xn+(ge>>>0<kr>>>0?1:0),Ne=ee.low=Ne+Ut,ee.high=Ue+Lt+(Ne>>>0<Ut>>>0?1:0),Ft=S.low=Ft+Ur,S.high=De+zr+(Ft>>>0<Ur>>>0?1:0),vt=O.low=vt+Or,O.high=ht+Yr+(vt>>>0<Or>>>0?1:0),et=N.low=et+Dr,N.high=We+Rn+(et>>>0<Dr>>>0?1:0)},_doFinalize:function(){var U=this._data,D=U.words,B=8*this._nDataBytes,$=8*U.sigBytes;return D[$>>>5]|=128<<24-$%32,D[30+($+128>>>10<<5)]=Math.floor(B/4294967296),D[31+($+128>>>10<<5)]=B,U.sigBytes=4*D.length,this._process(),this._hash.toX32()},clone:function(){var U=i.clone.call(this);return U._hash=this._hash.clone(),U},blockSize:32}),e.SHA512=i._createHelper(v),e.HmacSHA512=i._createHmacHelper(v)}(),function(){var t=M,e=(d=t.x64).Word,i=d.WordArray,a=(d=t.algo).SHA512,d=d.SHA384=a.extend({_doReset:function(){this._hash=new i.init([new e.init(3418070365,3238371032),new e.init(1654270250,914150663),new e.init(2438529370,812702999),new e.init(355462360,4144912697),new e.init(1731405415,4290775857),new e.init(2394180231,1750603025),new e.init(3675008525,1694076839),new e.init(1203062813,3204075428)])},_doFinalize:function(){var E=a._doFinalize.call(this);return E.sigBytes-=16,E}});t.SHA384=a._createHelper(d),t.HmacSHA384=a._createHmacHelper(d)}();/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */var G,V="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function j(t){var e,i,a="";for(e=0;e+3<=t.length;e+=3)i=parseInt(t.substring(e,e+3),16),a+=V.charAt(i>>6)+V.charAt(63&i);for(e+1==t.length?(i=parseInt(t.substring(e,e+1),16),a+=V.charAt(i<<2)):e+2==t.length&&(i=parseInt(t.substring(e,e+2),16),a+=V.charAt(i>>2)+V.charAt((3&i)<<4)),"=";(3&a.length)>0;)a+="=";return a}function ne(t){var e,i,a,d="",v=0;for(e=0;e<t.length&&t.charAt(e)!="=";++e)(a=V.indexOf(t.charAt(e)))<0||(v==0?(d+=ae(a>>2),i=3&a,v=1):v==1?(d+=ae(i<<2|a>>4),i=15&a,v=2):v==2?(d+=ae(i),d+=ae(a>>2),i=3&a,v=3):(d+=ae(i<<2|a>>4),d+=ae(15&a),v=0));return v==1&&(d+=ae(i<<2)),d}function ie(t){var e,i=ne(t),a=new Array;for(e=0;2*e<i.length;++e)a[e]=parseInt(i.substring(2*e,2*e+2),16);return a}function W(t,e,i){t!=null&&(typeof t=="number"?this.fromNumber(t,e,i):e==null&&typeof t!="string"?this.fromString(t,256):this.fromString(t,e))}function oe(){return new W(null)}T.appName=="Microsoft Internet Explorer"?(W.prototype.am=function(e,i,a,d,v,E){for(var k=32767&i,R=i>>15;--E>=0;){var I=32767&this[e],U=this[e++]>>15,D=R*I+U*k;v=((I=k*I+((32767&D)<<15)+a[d]+(1073741823&v))>>>30)+(D>>>15)+R*U+(v>>>30),a[d++]=1073741823&I}return v},G=30):T.appName!="Netscape"?(W.prototype.am=function(e,i,a,d,v,E){for(;--E>=0;){var k=i*this[e++]+a[d]+v;v=Math.floor(k/67108864),a[d++]=67108863&k}return v},G=26):(W.prototype.am=function(e,i,a,d,v,E){for(var k=16383&i,R=i>>14;--E>=0;){var I=16383&this[e],U=this[e++]>>14,D=R*I+U*k;v=((I=k*I+((16383&D)<<14)+a[d]+v)>>28)+(D>>14)+R*U,a[d++]=268435455&I}return v},G=28),W.prototype.DB=G,W.prototype.DM=(1<<G)-1,W.prototype.DV=1<<G,W.prototype.FV=Math.pow(2,52),W.prototype.F1=52-G,W.prototype.F2=2*G-52;var Te,be,Z=new Array;for(Te="0".charCodeAt(0),be=0;be<=9;++be)Z[Te++]=be;for(Te="a".charCodeAt(0),be=10;be<36;++be)Z[Te++]=be;for(Te="A".charCodeAt(0),be=10;be<36;++be)Z[Te++]=be;function ae(t){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(t)}function pe(t,e){var i=Z[t.charCodeAt(e)];return i==null?-1:i}function Ee(t){var e=oe();return e.fromInt(t),e}function Fe(t){var e,i=1;return(e=t>>>16)!=0&&(t=e,i+=16),(e=t>>8)!=0&&(t=e,i+=8),(e=t>>4)!=0&&(t=e,i+=4),(e=t>>2)!=0&&(t=e,i+=2),(e=t>>1)!=0&&(t=e,i+=1),i}function le(t){this.m=t}function _e(t){this.m=t,this.mp=t.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function Me(t,e){return t&e}function qe(t,e){return t|e}function _t(t,e){return t^e}function wt(t,e){return t&~e}function Rt(t){if(t==0)return-1;var e=0;return(65535&t)==0&&(t>>=16,e+=16),(255&t)==0&&(t>>=8,e+=8),(15&t)==0&&(t>>=4,e+=4),(3&t)==0&&(t>>=2,e+=2),(1&t)==0&&++e,e}function Gt(t){for(var e=0;t!=0;)t&=t-1,++e;return e}function dt(){}function St(t){return t}function nt(t){this.r2=oe(),this.q3=oe(),W.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}le.prototype.convert=function(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e},le.prototype.revert=function(e){return e},le.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},le.prototype.mulTo=function(e,i,a){e.multiplyTo(i,a),this.reduce(a)},le.prototype.sqrTo=function(e,i){e.squareTo(i),this.reduce(i)},_e.prototype.convert=function(e){var i=oe();return e.abs().dlShiftTo(this.m.t,i),i.divRemTo(this.m,null,i),e.s<0&&i.compareTo(W.ZERO)>0&&this.m.subTo(i,i),i},_e.prototype.revert=function(e){var i=oe();return e.copyTo(i),this.reduce(i),i},_e.prototype.reduce=function(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var i=0;i<this.m.t;++i){var a=32767&e[i],d=a*this.mpl+((a*this.mph+(e[i]>>15)*this.mpl&this.um)<<15)&e.DM;for(e[a=i+this.m.t]+=this.m.am(0,d,e,i,0,this.m.t);e[a]>=e.DV;)e[a]-=e.DV,e[++a]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)},_e.prototype.mulTo=function(e,i,a){e.multiplyTo(i,a),this.reduce(a)},_e.prototype.sqrTo=function(e,i){e.squareTo(i),this.reduce(i)},W.prototype.copyTo=function(e){for(var i=this.t-1;i>=0;--i)e[i]=this[i];e.t=this.t,e.s=this.s},W.prototype.fromInt=function(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0},W.prototype.fromString=function(e,i){var a;if(i==16)a=4;else if(i==8)a=3;else if(i==256)a=8;else if(i==2)a=1;else if(i==32)a=5;else{if(i!=4)return void this.fromRadix(e,i);a=2}this.t=0,this.s=0;for(var d=e.length,v=!1,E=0;--d>=0;){var k=a==8?255&e[d]:pe(e,d);k<0?e.charAt(d)=="-"&&(v=!0):(v=!1,E==0?this[this.t++]=k:E+a>this.DB?(this[this.t-1]|=(k&(1<<this.DB-E)-1)<<E,this[this.t++]=k>>this.DB-E):this[this.t-1]|=k<<E,(E+=a)>=this.DB&&(E-=this.DB))}a==8&&(128&e[0])!=0&&(this.s=-1,E>0&&(this[this.t-1]|=(1<<this.DB-E)-1<<E)),this.clamp(),v&&W.ZERO.subTo(this,this)},W.prototype.clamp=function(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t},W.prototype.dlShiftTo=function(e,i){var a;for(a=this.t-1;a>=0;--a)i[a+e]=this[a];for(a=e-1;a>=0;--a)i[a]=0;i.t=this.t+e,i.s=this.s},W.prototype.drShiftTo=function(e,i){for(var a=e;a<this.t;++a)i[a-e]=this[a];i.t=Math.max(this.t-e,0),i.s=this.s},W.prototype.lShiftTo=function(e,i){var a,d=e%this.DB,v=this.DB-d,E=(1<<v)-1,k=Math.floor(e/this.DB),R=this.s<<d&this.DM;for(a=this.t-1;a>=0;--a)i[a+k+1]=this[a]>>v|R,R=(this[a]&E)<<d;for(a=k-1;a>=0;--a)i[a]=0;i[k]=R,i.t=this.t+k+1,i.s=this.s,i.clamp()},W.prototype.rShiftTo=function(e,i){i.s=this.s;var a=Math.floor(e/this.DB);if(a>=this.t)i.t=0;else{var d=e%this.DB,v=this.DB-d,E=(1<<d)-1;i[0]=this[a]>>d;for(var k=a+1;k<this.t;++k)i[k-a-1]|=(this[k]&E)<<v,i[k-a]=this[k]>>d;d>0&&(i[this.t-a-1]|=(this.s&E)<<v),i.t=this.t-a,i.clamp()}},W.prototype.subTo=function(e,i){for(var a=0,d=0,v=Math.min(e.t,this.t);a<v;)d+=this[a]-e[a],i[a++]=d&this.DM,d>>=this.DB;if(e.t<this.t){for(d-=e.s;a<this.t;)d+=this[a],i[a++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=this.s;a<e.t;)d-=e[a],i[a++]=d&this.DM,d>>=this.DB;d-=e.s}i.s=d<0?-1:0,d<-1?i[a++]=this.DV+d:d>0&&(i[a++]=d),i.t=a,i.clamp()},W.prototype.multiplyTo=function(e,i){var a=this.abs(),d=e.abs(),v=a.t;for(i.t=v+d.t;--v>=0;)i[v]=0;for(v=0;v<d.t;++v)i[v+a.t]=a.am(0,d[v],i,v,0,a.t);i.s=0,i.clamp(),this.s!=e.s&&W.ZERO.subTo(i,i)},W.prototype.squareTo=function(e){for(var i=this.abs(),a=e.t=2*i.t;--a>=0;)e[a]=0;for(a=0;a<i.t-1;++a){var d=i.am(a,i[a],e,2*a,0,1);(e[a+i.t]+=i.am(a+1,2*i[a],e,2*a+1,d,i.t-a-1))>=i.DV&&(e[a+i.t]-=i.DV,e[a+i.t+1]=1)}e.t>0&&(e[e.t-1]+=i.am(a,i[a],e,2*a,0,1)),e.s=0,e.clamp()},W.prototype.divRemTo=function(e,i,a){var d=e.abs();if(!(d.t<=0)){var v=this.abs();if(v.t<d.t)return i!=null&&i.fromInt(0),void(a!=null&&this.copyTo(a));a==null&&(a=oe());var E=oe(),k=this.s,R=e.s,I=this.DB-Fe(d[d.t-1]);I>0?(d.lShiftTo(I,E),v.lShiftTo(I,a)):(d.copyTo(E),v.copyTo(a));var U=E.t,D=E[U-1];if(D!=0){var B=D*(1<<this.F1)+(U>1?E[U-2]>>this.F2:0),$=this.FV/B,z=(1<<this.F1)/B,Q=1<<this.F2,ee=a.t,S=ee-U,O=i==null?oe():i;for(E.dlShiftTo(S,O),a.compareTo(O)>=0&&(a[a.t++]=1,a.subTo(O,a)),W.ONE.dlShiftTo(U,O),O.subTo(E,E);E.t<U;)E[E.t++]=0;for(;--S>=0;){var N=a[--ee]==D?this.DM:Math.floor(a[ee]*$+(a[ee-1]+Q)*z);if((a[ee]+=E.am(0,N,a,S,0,U))<N)for(E.dlShiftTo(S,O),a.subTo(O,a);a[ee]<--N;)a.subTo(O,a)}i!=null&&(a.drShiftTo(U,i),k!=R&&W.ZERO.subTo(i,i)),a.t=U,a.clamp(),I>0&&a.rShiftTo(I,a),k<0&&W.ZERO.subTo(a,a)}}},W.prototype.invDigit=function(){if(this.t<1)return 0;var e=this[0];if((1&e)==0)return 0;var i=3&e;return(i=(i=(i=(i=i*(2-(15&e)*i)&15)*(2-(255&e)*i)&255)*(2-((65535&e)*i&65535))&65535)*(2-e*i%this.DV)%this.DV)>0?this.DV-i:-i},W.prototype.isEven=function(){return(this.t>0?1&this[0]:this.s)==0},W.prototype.exp=function(e,i){if(e>4294967295||e<1)return W.ONE;var a=oe(),d=oe(),v=i.convert(this),E=Fe(e)-1;for(v.copyTo(a);--E>=0;)if(i.sqrTo(a,d),(e&1<<E)>0)i.mulTo(d,v,a);else{var k=a;a=d,d=k}return i.revert(a)},W.prototype.toString=function(e){if(this.s<0)return"-"+this.negate().toString(e);var i;if(e==16)i=4;else if(e==8)i=3;else if(e==2)i=1;else if(e==32)i=5;else{if(e!=4)return this.toRadix(e);i=2}var a,d=(1<<i)-1,v=!1,E="",k=this.t,R=this.DB-k*this.DB%i;if(k-- >0)for(R<this.DB&&(a=this[k]>>R)>0&&(v=!0,E=ae(a));k>=0;)R<i?(a=(this[k]&(1<<R)-1)<<i-R,a|=this[--k]>>(R+=this.DB-i)):(a=this[k]>>(R-=i)&d,R<=0&&(R+=this.DB,--k)),a>0&&(v=!0),v&&(E+=ae(a));return v?E:"0"},W.prototype.negate=function(){var e=oe();return W.ZERO.subTo(this,e),e},W.prototype.abs=function(){return this.s<0?this.negate():this},W.prototype.compareTo=function(e){var i=this.s-e.s;if(i!=0)return i;var a=this.t;if((i=a-e.t)!=0)return this.s<0?-i:i;for(;--a>=0;)if((i=this[a]-e[a])!=0)return i;return 0},W.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+Fe(this[this.t-1]^this.s&this.DM)},W.prototype.mod=function(e){var i=oe();return this.abs().divRemTo(e,null,i),this.s<0&&i.compareTo(W.ZERO)>0&&e.subTo(i,i),i},W.prototype.modPowInt=function(e,i){var a;return a=e<256||i.isEven()?new le(i):new _e(i),this.exp(e,a)},W.ZERO=Ee(0),W.ONE=Ee(1),dt.prototype.convert=St,dt.prototype.revert=St,dt.prototype.mulTo=function(e,i,a){e.multiplyTo(i,a)},dt.prototype.sqrTo=function(e,i){e.squareTo(i)},nt.prototype.convert=function(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var i=oe();return e.copyTo(i),this.reduce(i),i},nt.prototype.revert=function(e){return e},nt.prototype.reduce=function(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)},nt.prototype.mulTo=function(e,i,a){e.multiplyTo(i,a),this.reduce(a)},nt.prototype.sqrTo=function(e,i){e.squareTo(i),this.reduce(i)};var He=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],J=(1<<26)/He[He.length-1];/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function m(){this.i=0,this.j=0,this.S=new Array}W.prototype.chunkSize=function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},W.prototype.toRadix=function(e){if(e==null&&(e=10),this.signum()==0||e<2||e>36)return"0";var i=this.chunkSize(e),a=Math.pow(e,i),d=Ee(a),v=oe(),E=oe(),k="";for(this.divRemTo(d,v,E);v.signum()>0;)k=(a+E.intValue()).toString(e).substr(1)+k,v.divRemTo(d,v,E);return E.intValue().toString(e)+k},W.prototype.fromRadix=function(e,i){this.fromInt(0),i==null&&(i=10);for(var a=this.chunkSize(i),d=Math.pow(i,a),v=!1,E=0,k=0,R=0;R<e.length;++R){var I=pe(e,R);I<0?e.charAt(R)=="-"&&this.signum()==0&&(v=!0):(k=i*k+I,++E>=a&&(this.dMultiply(d),this.dAddOffset(k,0),E=0,k=0))}E>0&&(this.dMultiply(Math.pow(i,E)),this.dAddOffset(k,0)),v&&W.ZERO.subTo(this,this)},W.prototype.fromNumber=function(e,i,a){if(typeof i=="number")if(e<2)this.fromInt(1);else for(this.fromNumber(e,a),this.testBit(e-1)||this.bitwiseTo(W.ONE.shiftLeft(e-1),qe,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(i);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(W.ONE.shiftLeft(e-1),this);else{var d=new Array,v=7&e;d.length=1+(e>>3),i.nextBytes(d),v>0?d[0]&=(1<<v)-1:d[0]=0,this.fromString(d,256)}},W.prototype.bitwiseTo=function(e,i,a){var d,v,E=Math.min(e.t,this.t);for(d=0;d<E;++d)a[d]=i(this[d],e[d]);if(e.t<this.t){for(v=e.s&this.DM,d=E;d<this.t;++d)a[d]=i(this[d],v);a.t=this.t}else{for(v=this.s&this.DM,d=E;d<e.t;++d)a[d]=i(v,e[d]);a.t=e.t}a.s=i(this.s,e.s),a.clamp()},W.prototype.changeBit=function(e,i){var a=W.ONE.shiftLeft(e);return this.bitwiseTo(a,i,a),a},W.prototype.addTo=function(e,i){for(var a=0,d=0,v=Math.min(e.t,this.t);a<v;)d+=this[a]+e[a],i[a++]=d&this.DM,d>>=this.DB;if(e.t<this.t){for(d+=e.s;a<this.t;)d+=this[a],i[a++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=this.s;a<e.t;)d+=e[a],i[a++]=d&this.DM,d>>=this.DB;d+=e.s}i.s=d<0?-1:0,d>0?i[a++]=d:d<-1&&(i[a++]=this.DV+d),i.t=a,i.clamp()},W.prototype.dMultiply=function(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},W.prototype.dAddOffset=function(e,i){if(e!=0){for(;this.t<=i;)this[this.t++]=0;for(this[i]+=e;this[i]>=this.DV;)this[i]-=this.DV,++i>=this.t&&(this[this.t++]=0),++this[i]}},W.prototype.multiplyLowerTo=function(e,i,a){var d,v=Math.min(this.t+e.t,i);for(a.s=0,a.t=v;v>0;)a[--v]=0;for(d=a.t-this.t;v<d;++v)a[v+this.t]=this.am(0,e[v],a,v,0,this.t);for(d=Math.min(e.t,i);v<d;++v)this.am(0,e[v],a,v,0,i-v);a.clamp()},W.prototype.multiplyUpperTo=function(e,i,a){--i;var d=a.t=this.t+e.t-i;for(a.s=0;--d>=0;)a[d]=0;for(d=Math.max(i-this.t,0);d<e.t;++d)a[this.t+d-i]=this.am(i-d,e[d],a,0,0,this.t+d-i);a.clamp(),a.drShiftTo(1,a)},W.prototype.modInt=function(e){if(e<=0)return 0;var i=this.DV%e,a=this.s<0?e-1:0;if(this.t>0)if(i==0)a=this[0]%e;else for(var d=this.t-1;d>=0;--d)a=(i*a+this[d])%e;return a},W.prototype.millerRabin=function(e){var i=this.subtract(W.ONE),a=i.getLowestSetBit();if(a<=0)return!1;var d=i.shiftRight(a);(e=e+1>>1)>He.length&&(e=He.length);for(var v=oe(),E=0;E<e;++E){v.fromInt(He[Math.floor(Math.random()*He.length)]);var k=v.modPow(d,this);if(k.compareTo(W.ONE)!=0&&k.compareTo(i)!=0){for(var R=1;R++<a&&k.compareTo(i)!=0;)if((k=k.modPowInt(2,this)).compareTo(W.ONE)==0)return!1;if(k.compareTo(i)!=0)return!1}}return!0},W.prototype.clone=function(){var e=oe();return this.copyTo(e),e},W.prototype.intValue=function(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},W.prototype.byteValue=function(){return this.t==0?this.s:this[0]<<24>>24},W.prototype.shortValue=function(){return this.t==0?this.s:this[0]<<16>>16},W.prototype.signum=function(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1},W.prototype.toByteArray=function(){var e=this.t,i=new Array;i[0]=this.s;var a,d=this.DB-e*this.DB%8,v=0;if(e-- >0)for(d<this.DB&&(a=this[e]>>d)!=(this.s&this.DM)>>d&&(i[v++]=a|this.s<<this.DB-d);e>=0;)d<8?(a=(this[e]&(1<<d)-1)<<8-d,a|=this[--e]>>(d+=this.DB-8)):(a=this[e]>>(d-=8)&255,d<=0&&(d+=this.DB,--e)),(128&a)!=0&&(a|=-256),v==0&&(128&this.s)!=(128&a)&&++v,(v>0||a!=this.s)&&(i[v++]=a);return i},W.prototype.equals=function(e){return this.compareTo(e)==0},W.prototype.min=function(e){return this.compareTo(e)<0?this:e},W.prototype.max=function(e){return this.compareTo(e)>0?this:e},W.prototype.and=function(e){var i=oe();return this.bitwiseTo(e,Me,i),i},W.prototype.or=function(e){var i=oe();return this.bitwiseTo(e,qe,i),i},W.prototype.xor=function(e){var i=oe();return this.bitwiseTo(e,_t,i),i},W.prototype.andNot=function(e){var i=oe();return this.bitwiseTo(e,wt,i),i},W.prototype.not=function(){for(var e=oe(),i=0;i<this.t;++i)e[i]=this.DM&~this[i];return e.t=this.t,e.s=~this.s,e},W.prototype.shiftLeft=function(e){var i=oe();return e<0?this.rShiftTo(-e,i):this.lShiftTo(e,i),i},W.prototype.shiftRight=function(e){var i=oe();return e<0?this.lShiftTo(-e,i):this.rShiftTo(e,i),i},W.prototype.getLowestSetBit=function(){for(var e=0;e<this.t;++e)if(this[e]!=0)return e*this.DB+Rt(this[e]);return this.s<0?this.t*this.DB:-1},W.prototype.bitCount=function(){for(var e=0,i=this.s&this.DM,a=0;a<this.t;++a)e+=Gt(this[a]^i);return e},W.prototype.testBit=function(e){var i=Math.floor(e/this.DB);return i>=this.t?this.s!=0:(this[i]&1<<e%this.DB)!=0},W.prototype.setBit=function(e){return this.changeBit(e,qe)},W.prototype.clearBit=function(e){return this.changeBit(e,wt)},W.prototype.flipBit=function(e){return this.changeBit(e,_t)},W.prototype.add=function(e){var i=oe();return this.addTo(e,i),i},W.prototype.subtract=function(e){var i=oe();return this.subTo(e,i),i},W.prototype.multiply=function(e){var i=oe();return this.multiplyTo(e,i),i},W.prototype.divide=function(e){var i=oe();return this.divRemTo(e,i,null),i},W.prototype.remainder=function(e){var i=oe();return this.divRemTo(e,null,i),i},W.prototype.divideAndRemainder=function(e){var i=oe(),a=oe();return this.divRemTo(e,i,a),new Array(i,a)},W.prototype.modPow=function(e,i){var a,d,v=e.bitLength(),E=Ee(1);if(v<=0)return E;a=v<18?1:v<48?3:v<144?4:v<768?5:6,d=v<8?new le(i):i.isEven()?new nt(i):new _e(i);var k=new Array,R=3,I=a-1,U=(1<<a)-1;if(k[1]=d.convert(this),a>1){var D=oe();for(d.sqrTo(k[1],D);R<=U;)k[R]=oe(),d.mulTo(D,k[R-2],k[R]),R+=2}var B,$,z=e.t-1,Q=!0,ee=oe();for(v=Fe(e[z])-1;z>=0;){for(v>=I?B=e[z]>>v-I&U:(B=(e[z]&(1<<v+1)-1)<<I-v,z>0&&(B|=e[z-1]>>this.DB+v-I)),R=a;(1&B)==0;)B>>=1,--R;if((v-=R)<0&&(v+=this.DB,--z),Q)k[B].copyTo(E),Q=!1;else{for(;R>1;)d.sqrTo(E,ee),d.sqrTo(ee,E),R-=2;R>0?d.sqrTo(E,ee):($=E,E=ee,ee=$),d.mulTo(ee,k[B],E)}for(;z>=0&&(e[z]&1<<v)==0;)d.sqrTo(E,ee),$=E,E=ee,ee=$,--v<0&&(v=this.DB-1,--z)}return d.revert(E)},W.prototype.modInverse=function(e){var i=e.isEven();if(this.isEven()&&i||e.signum()==0)return W.ZERO;for(var a=e.clone(),d=this.clone(),v=Ee(1),E=Ee(0),k=Ee(0),R=Ee(1);a.signum()!=0;){for(;a.isEven();)a.rShiftTo(1,a),i?(v.isEven()&&E.isEven()||(v.addTo(this,v),E.subTo(e,E)),v.rShiftTo(1,v)):E.isEven()||E.subTo(e,E),E.rShiftTo(1,E);for(;d.isEven();)d.rShiftTo(1,d),i?(k.isEven()&&R.isEven()||(k.addTo(this,k),R.subTo(e,R)),k.rShiftTo(1,k)):R.isEven()||R.subTo(e,R),R.rShiftTo(1,R);a.compareTo(d)>=0?(a.subTo(d,a),i&&v.subTo(k,v),E.subTo(R,E)):(d.subTo(a,d),i&&k.subTo(v,k),R.subTo(E,R))}return d.compareTo(W.ONE)!=0?W.ZERO:R.compareTo(e)>=0?R.subtract(e):R.signum()<0?(R.addTo(e,R),R.signum()<0?R.add(e):R):R},W.prototype.pow=function(e){return this.exp(e,new dt)},W.prototype.gcd=function(e){var i=this.s<0?this.negate():this.clone(),a=e.s<0?e.negate():e.clone();if(i.compareTo(a)<0){var d=i;i=a,a=d}var v=i.getLowestSetBit(),E=a.getLowestSetBit();if(E<0)return i;for(v<E&&(E=v),E>0&&(i.rShiftTo(E,i),a.rShiftTo(E,a));i.signum()>0;)(v=i.getLowestSetBit())>0&&i.rShiftTo(v,i),(v=a.getLowestSetBit())>0&&a.rShiftTo(v,a),i.compareTo(a)>=0?(i.subTo(a,i),i.rShiftTo(1,i)):(a.subTo(i,a),a.rShiftTo(1,a));return E>0&&a.lShiftTo(E,a),a},W.prototype.isProbablePrime=function(e){var i,a=this.abs();if(a.t==1&&a[0]<=He[He.length-1]){for(i=0;i<He.length;++i)if(a[0]==He[i])return!0;return!1}if(a.isEven())return!1;for(i=1;i<He.length;){for(var d=He[i],v=i+1;v<He.length&&d<J;)d*=He[v++];for(d=a.modInt(d);i<v;)if(d%He[i++]==0)return!1}return a.millerRabin(e)},W.prototype.square=function(){var e=oe();return this.squareTo(e),e},m.prototype.init=function(e){var i,a,d;for(i=0;i<256;++i)this.S[i]=i;for(a=0,i=0;i<256;++i)a=a+this.S[i]+e[i%e.length]&255,d=this.S[i],this.S[i]=this.S[a],this.S[a]=d;this.i=0,this.j=0},m.prototype.next=function(){var e;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,e=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=e,this.S[e+this.S[this.i]&255]};var _,L,q;/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function X(){(function(e){L[q++]^=255&e,L[q++]^=e>>8&255,L[q++]^=e>>16&255,L[q++]^=e>>24&255,q>=256&&(q-=256)})(new Date().getTime())}if(L==null){var re;if(L=new Array,q=0,H!==void 0&&(H.crypto!==void 0||H.msCrypto!==void 0)){var he=H.crypto||H.msCrypto;if(he.getRandomValues){var ve=new Uint8Array(32);for(he.getRandomValues(ve),re=0;re<32;++re)L[q++]=ve[re]}else if(T.appName=="Netscape"&&T.appVersion<"5"){var Ce=H.crypto.random(32);for(re=0;re<Ce.length;++re)L[q++]=255&Ce.charCodeAt(re)}}for(;q<256;)re=Math.floor(65536*Math.random()),L[q++]=re>>>8,L[q++]=255&re;q=0,X()}function Ae(){if(_==null){for(X(),(_=function(){return new m}()).init(L),q=0;q<L.length;++q)L[q]=0;q=0}return _.next()}function Re(){}/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function Et(t,e){return new W(t,e)}function Ht(t,e,i){for(var a="",d=0;a.length<e;)a+=i(String.fromCharCode.apply(String,t.concat([(4278190080&d)>>24,(16711680&d)>>16,(65280&d)>>8,255&d]))),d+=1;return a}function fe(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function Ke(t,e){this.x=e,this.q=t}function Se(t,e,i,a){this.curve=t,this.x=e,this.y=i,this.z=a==null?W.ONE:a,this.zinv=null}function It(t,e,i){this.q=t,this.a=this.fromBigInteger(e),this.b=this.fromBigInteger(i),this.infinity=new Se(this,null,null)}Re.prototype.nextBytes=function(e){var i;for(i=0;i<e.length;++i)e[i]=Ae()},fe.prototype.doPublic=function(e){return e.modPowInt(this.e,this.n)},fe.prototype.setPublic=function(e,i){if(this.isPublic=!0,this.isPrivate=!1,typeof e!="string")this.n=e,this.e=i;else{if(!(e!=null&&i!=null&&e.length>0&&i.length>0))throw"Invalid RSA public key";this.n=Et(e,16),this.e=parseInt(i,16)}},fe.prototype.encrypt=function(e){var i=function(E,k){if(k<E.length+11)throw"Message too long for RSA";for(var R=new Array,I=E.length-1;I>=0&&k>0;){var U=E.charCodeAt(I--);U<128?R[--k]=U:U>127&&U<2048?(R[--k]=63&U|128,R[--k]=U>>6|192):(R[--k]=63&U|128,R[--k]=U>>6&63|128,R[--k]=U>>12|224)}R[--k]=0;for(var D=new Re,B=new Array;k>2;){for(B[0]=0;B[0]==0;)D.nextBytes(B);R[--k]=B[0]}return R[--k]=2,R[--k]=0,new W(R)}(e,this.n.bitLength()+7>>3);if(i==null)return null;var a=this.doPublic(i);if(a==null)return null;var d=a.toString(16);return(1&d.length)==0?d:"0"+d},fe.prototype.encryptOAEP=function(e,i,a){var d=function(R,I,U,D){var B=C.crypto.MessageDigest,$=C.crypto.Util,z=null;if(U||(U="sha1"),typeof U=="string"&&(z=B.getCanonicalAlgName(U),D=B.getHashLength(z),U=function(se){return kt($.hashHex(jt(se),z))}),R.length+2*D+2>I)throw"Message too long for RSA";var Q,ee="";for(Q=0;Q<I-R.length-2*D-2;Q+=1)ee+="\0";var S=U("")+ee+""+R,O=new Array(D);new Re().nextBytes(O);var N=Ht(O,S.length,U),K=[];for(Q=0;Q<S.length;Q+=1)K[Q]=S.charCodeAt(Q)^N.charCodeAt(Q);var Y=Ht(K,O.length,U),te=[0];for(Q=0;Q<O.length;Q+=1)te[Q+1]=O[Q]^Y.charCodeAt(Q);return new W(te.concat(K))}(e,this.n.bitLength()+7>>3,i,a);if(d==null)return null;var v=this.doPublic(d);if(v==null)return null;var E=v.toString(16);return(1&E.length)==0?E:"0"+E},fe.prototype.type="RSA",Ke.prototype.equals=function(e){return e==this||this.q.equals(e.q)&&this.x.equals(e.x)},Ke.prototype.toBigInteger=function(){return this.x},Ke.prototype.negate=function(){return new Ke(this.q,this.x.negate().mod(this.q))},Ke.prototype.add=function(e){return new Ke(this.q,this.x.add(e.toBigInteger()).mod(this.q))},Ke.prototype.subtract=function(e){return new Ke(this.q,this.x.subtract(e.toBigInteger()).mod(this.q))},Ke.prototype.multiply=function(e){return new Ke(this.q,this.x.multiply(e.toBigInteger()).mod(this.q))},Ke.prototype.square=function(){return new Ke(this.q,this.x.square().mod(this.q))},Ke.prototype.divide=function(e){return new Ke(this.q,this.x.multiply(e.toBigInteger().modInverse(this.q)).mod(this.q))},Se.prototype.getX=function(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))},Se.prototype.getY=function(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))},Se.prototype.equals=function(e){return e==this||(this.isInfinity()?e.isInfinity():e.isInfinity()?this.isInfinity():!!e.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(e.z)).mod(this.curve.q).equals(W.ZERO)&&e.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(e.z)).mod(this.curve.q).equals(W.ZERO))},Se.prototype.isInfinity=function(){return this.x==null&&this.y==null||this.z.equals(W.ZERO)&&!this.y.toBigInteger().equals(W.ZERO)},Se.prototype.negate=function(){return new Se(this.curve,this.x,this.y.negate(),this.z)},Se.prototype.add=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;var i=e.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(e.z)).mod(this.curve.q),a=e.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(e.z)).mod(this.curve.q);if(W.ZERO.equals(a))return W.ZERO.equals(i)?this.twice():this.curve.getInfinity();var d=new W("3"),v=this.x.toBigInteger(),E=this.y.toBigInteger(),k=(e.x.toBigInteger(),e.y.toBigInteger(),a.square()),R=k.multiply(a),I=v.multiply(k),U=i.square().multiply(this.z),D=U.subtract(I.shiftLeft(1)).multiply(e.z).subtract(R).multiply(a).mod(this.curve.q),B=I.multiply(d).multiply(i).subtract(E.multiply(R)).subtract(U.multiply(i)).multiply(e.z).add(i.multiply(R)).mod(this.curve.q),$=R.multiply(this.z).multiply(e.z).mod(this.curve.q);return new Se(this.curve,this.curve.fromBigInteger(D),this.curve.fromBigInteger(B),$)},Se.prototype.twice=function(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var e=new W("3"),i=this.x.toBigInteger(),a=this.y.toBigInteger(),d=a.multiply(this.z),v=d.multiply(a).mod(this.curve.q),E=this.curve.a.toBigInteger(),k=i.square().multiply(e);W.ZERO.equals(E)||(k=k.add(this.z.square().multiply(E)));var R=(k=k.mod(this.curve.q)).square().subtract(i.shiftLeft(3).multiply(v)).shiftLeft(1).multiply(d).mod(this.curve.q),I=k.multiply(e).multiply(i).subtract(v.shiftLeft(1)).shiftLeft(2).multiply(v).subtract(k.square().multiply(k)).mod(this.curve.q),U=d.square().multiply(d).shiftLeft(3).mod(this.curve.q);return new Se(this.curve,this.curve.fromBigInteger(R),this.curve.fromBigInteger(I),U)},Se.prototype.multiply=function(e){if(this.isInfinity())return this;if(e.signum()==0)return this.curve.getInfinity();var i,a=e,d=a.multiply(new W("3")),v=this.negate(),E=this,k=this.curve.q.subtract(e),R=k.multiply(new W("3")),I=new Se(this.curve,this.x,this.y),U=I.negate();for(i=d.bitLength()-2;i>0;--i){E=E.twice();var D=d.testBit(i);D!=a.testBit(i)&&(E=E.add(D?this:v))}for(i=R.bitLength()-2;i>0;--i){I=I.twice();var B=R.testBit(i);B!=k.testBit(i)&&(I=I.add(B?I:U))}return E},Se.prototype.multiplyTwo=function(e,i,a){var d;d=e.bitLength()>a.bitLength()?e.bitLength()-1:a.bitLength()-1;for(var v=this.curve.getInfinity(),E=this.add(i);d>=0;)v=v.twice(),e.testBit(d)?v=a.testBit(d)?v.add(E):v.add(this):a.testBit(d)&&(v=v.add(i)),--d;return v},It.prototype.getQ=function(){return this.q},It.prototype.getA=function(){return this.a},It.prototype.getB=function(){return this.b},It.prototype.equals=function(e){return e==this||this.q.equals(e.q)&&this.a.equals(e.a)&&this.b.equals(e.b)},It.prototype.getInfinity=function(){return this.infinity},It.prototype.fromBigInteger=function(e){return new Ke(this.q,e)},It.prototype.decodePointHex=function(e){switch(parseInt(e.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:return null;case 4:case 6:case 7:var i=(e.length-2)/2,a=e.substr(2,i),d=e.substr(i+2,i);return new Se(this,this.fromBigInteger(new W(a,16)),this.fromBigInteger(new W(d,16)));default:return null}},Ke.prototype.getByteLength=function(){return Math.floor((this.toBigInteger().bitLength()+7)/8)},Se.prototype.getEncoded=function(t){var e=function(E,k){var R=E.toByteArrayUnsigned();if(k<R.length)R=R.slice(R.length-k);else for(;k>R.length;)R.unshift(0);return R},i=this.getX().toBigInteger(),a=this.getY().toBigInteger(),d=e(i,32);return t?a.isEven()?d.unshift(2):d.unshift(3):(d.unshift(4),d=d.concat(e(a,32))),d},Se.decodeFrom=function(t,e){e[0];var i=e.length-1,a=e.slice(1,1+i/2),d=e.slice(1+i/2,1+i);a.unshift(0),d.unshift(0);var v=new W(a),E=new W(d);return new Se(t,t.fromBigInteger(v),t.fromBigInteger(E))},Se.decodeFromHex=function(t,e){e.substr(0,2);var i=e.length-2,a=e.substr(2,i/2),d=e.substr(2+i/2,i/2),v=new W(a,16),E=new W(d,16);return new Se(t,t.fromBigInteger(v),t.fromBigInteger(E))},Se.prototype.add2D=function(t){if(this.isInfinity())return t;if(t.isInfinity())return this;if(this.x.equals(t.x))return this.y.equals(t.y)?this.twice():this.curve.getInfinity();var e=t.x.subtract(this.x),i=t.y.subtract(this.y).divide(e),a=i.square().subtract(this.x).subtract(t.x),d=i.multiply(this.x.subtract(a)).subtract(this.y);return new Se(this.curve,a,d)},Se.prototype.twice2D=function(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var t=this.curve.fromBigInteger(W.valueOf(2)),e=this.curve.fromBigInteger(W.valueOf(3)),i=this.x.square().multiply(e).add(this.curve.a).divide(this.y.multiply(t)),a=i.square().subtract(this.x.multiply(t)),d=i.multiply(this.x.subtract(a)).subtract(this.y);return new Se(this.curve,a,d)},Se.prototype.multiply2D=function(t){if(this.isInfinity())return this;if(t.signum()==0)return this.curve.getInfinity();var e,i=t,a=i.multiply(new W("3")),d=this.negate(),v=this;for(e=a.bitLength()-2;e>0;--e){v=v.twice();var E=a.testBit(e);E!=i.testBit(e)&&(v=v.add2D(E?this:d))}return v},Se.prototype.isOnCurve=function(){var t=this.getX().toBigInteger(),e=this.getY().toBigInteger(),i=this.curve.getA().toBigInteger(),a=this.curve.getB().toBigInteger(),d=this.curve.getQ(),v=e.multiply(e).mod(d),E=t.multiply(t).multiply(t).add(i.multiply(t)).add(a).mod(d);return v.equals(E)},Se.prototype.toString=function(){return"("+this.getX().toBigInteger().toString()+","+this.getY().toBigInteger().toString()+")"},Se.prototype.validate=function(){var t=this.curve.getQ();if(this.isInfinity())throw new Error("Point is at infinity.");var e=this.getX().toBigInteger(),i=this.getY().toBigInteger();if(e.compareTo(W.ONE)<0||e.compareTo(t.subtract(W.ONE))>0)throw new Error("x coordinate out of bounds");if(i.compareTo(W.ONE)<0||i.compareTo(t.subtract(W.ONE))>0)throw new Error("y coordinate out of bounds");if(!this.isOnCurve())throw new Error("Point is not on the curve.");if(this.multiply(t).isInfinity())throw new Error("Point is not a scalar multiple of G.");return!0};/*! Mike Samuel (c) 2009 | code.google.com/p/json-sans-eval
 */var Oi=function(){var t=new RegExp('(?:false|true|null|[\\{\\}\\[\\]]|(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)|(?:"(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))*"))',"g"),e=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),i={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"};function a(E,k,R){return k?i[k]:String.fromCharCode(parseInt(R,16))}var d=new String(""),v=Object.hasOwnProperty;return function(E,k){var R,I,U=E.match(t),D=U[0],B=!1;D==="{"?R={}:D==="["?R=[]:(R=[],B=!0);for(var $=[R],z=1-B,Q=U.length;z<Q;++z){var ee;switch((D=U[z]).charCodeAt(0)){default:(ee=$[0])[I||ee.length]=+D,I=void 0;break;case 34:if((D=D.substring(1,D.length-1)).indexOf("\\")!==-1&&(D=D.replace(e,a)),ee=$[0],!I){if(!(ee instanceof Array)){I=D||d;break}I=ee.length}ee[I]=D,I=void 0;break;case 91:ee=$[0],$.unshift(ee[I||ee.length]=[]),I=void 0;break;case 93:$.shift();break;case 102:(ee=$[0])[I||ee.length]=!1,I=void 0;break;case 110:(ee=$[0])[I||ee.length]=null,I=void 0;break;case 116:(ee=$[0])[I||ee.length]=!0,I=void 0;break;case 123:ee=$[0],$.unshift(ee[I||ee.length]={}),I=void 0;break;case 125:$.shift()}}if(B){if($.length!==1)throw new Error;R=R[0]}else if($.length)throw new Error;return k&&(R=function S(O,N){var K=O[N];if(K&&(K===void 0?"undefined":b(K))==="object"){var Y=null;for(var te in K)if(v.call(K,te)&&K!==O){var de=S(K,te);de!==void 0?K[te]=de:(Y||(Y=[]),Y.push(te))}if(Y)for(var se=Y.length;--se>=0;)delete K[Y[se]]}return k.call(O,N,K)}({"":R},"")),R}}();C!==void 0&&C||(o.KJUR=C={}),C.asn1!==void 0&&C.asn1||(C.asn1={}),C.asn1.ASN1Util=new function(){this.integerToByteHex=function(t){var e=t.toString(16);return e.length%2==1&&(e="0"+e),e},this.bigIntToMinTwosComplementsHex=function(t){var e=t.toString(16);if(e.substr(0,1)!="-")e.length%2==1?e="0"+e:e.match(/^[0-7]/)||(e="00"+e);else{var i=e.substr(1).length;i%2==1?i+=1:e.match(/^[0-7]/)||(i+=2);for(var a="",d=0;d<i;d++)a+="f";e=new W(a,16).xor(t).add(W.ONE).toString(16).replace(/^-/,"")}return e},this.getPEMStringFromHex=function(t,e){return bt(t,e)},this.newObject=function(t){var e=C.asn1,i=e.ASN1Object,a=e.DERBoolean,d=e.DERInteger,v=e.DERBitString,E=e.DEROctetString,k=e.DERNull,R=e.DERObjectIdentifier,I=e.DEREnumerated,U=e.DERUTF8String,D=e.DERNumericString,B=e.DERPrintableString,$=e.DERTeletexString,z=e.DERIA5String,Q=e.DERUTCTime,ee=e.DERGeneralizedTime,S=e.DERVisibleString,O=e.DERBMPString,N=e.DERSequence,K=e.DERSet,Y=e.DERTaggedObject,te=e.ASN1Util.newObject;if(t instanceof e.ASN1Object)return t;var de=Object.keys(t);if(de.length!=1)throw new Error("key of param shall be only one.");var se=de[0];if(":asn1:bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:visstr:bmpstr:seq:set:tag:".indexOf(":"+se+":")==-1)throw new Error("undefined key: "+se);if(se=="bool")return new a(t[se]);if(se=="int")return new d(t[se]);if(se=="bitstr")return new v(t[se]);if(se=="octstr")return new E(t[se]);if(se=="null")return new k(t[se]);if(se=="oid")return new R(t[se]);if(se=="enum")return new I(t[se]);if(se=="utf8str")return new U(t[se]);if(se=="numstr")return new D(t[se]);if(se=="prnstr")return new B(t[se]);if(se=="telstr")return new $(t[se]);if(se=="ia5str")return new z(t[se]);if(se=="utctime")return new Q(t[se]);if(se=="gentime")return new ee(t[se]);if(se=="visstr")return new S(t[se]);if(se=="bmpstr")return new O(t[se]);if(se=="asn1")return new i(t[se]);if(se=="seq"){for(var we=t[se],ce=[],ge=0;ge<we.length;ge++){var Ue=te(we[ge]);ce.push(Ue)}return new N({array:ce})}if(se=="set"){for(we=t[se],ce=[],ge=0;ge<we.length;ge++)Ue=te(we[ge]),ce.push(Ue);return new K({array:ce})}if(se=="tag"){var Ne=t[se];if(Object.prototype.toString.call(Ne)==="[object Array]"&&Ne.length==3){var De=te(Ne[2]);return new Y({tag:Ne[0],explicit:Ne[1],obj:De})}return new Y(Ne)}},this.jsonToASN1HEX=function(t){return this.newObject(t).getEncodedHex()}},C.asn1.ASN1Util.oidHexToInt=function(t){for(var e="",i=parseInt(t.substr(0,2),16),a=(e=Math.floor(i/40)+"."+i%40,""),d=2;d<t.length;d+=2){var v=("00000000"+parseInt(t.substr(d,2),16).toString(2)).slice(-8);a+=v.substr(1,7),v.substr(0,1)=="0"&&(e=e+"."+new W(a,2).toString(10),a="")}return e},C.asn1.ASN1Util.oidIntToHex=function(t){var e=function(R){var I=R.toString(16);return I.length==1&&(I="0"+I),I},i=function(R){var I="",U=new W(R,10).toString(2),D=7-U.length%7;D==7&&(D=0);for(var B="",$=0;$<D;$++)B+="0";for(U=B+U,$=0;$<U.length-1;$+=7){var z=U.substr($,7);$!=U.length-7&&(z="1"+z),I+=e(parseInt(z,2))}return I};if(!t.match(/^[0-9.]+$/))throw"malformed oid string: "+t;var a="",d=t.split("."),v=40*parseInt(d[0])+parseInt(d[1]);a+=e(v),d.splice(0,2);for(var E=0;E<d.length;E++)a+=i(d[E]);return a},C.asn1.ASN1Object=function(t){this.params=null,this.getLengthHexFromValue=function(){if(this.hV===void 0||this.hV==null)throw new Error("this.hV is null or undefined");if(this.hV.length%2==1)throw new Error("value hex must be even length: n="+0+",v="+this.hV);var e=this.hV.length/2,i=e.toString(16);if(i.length%2==1&&(i="0"+i),e<128)return i;var a=i.length/2;if(a>15)throw"ASN.1 length too long to represent by 8x: n = "+e.toString(16);return(128+a).toString(16)+i},this.getEncodedHex=function(){return(this.hTLV==null||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getValueHex=function(){return this.getEncodedHex(),this.hV},this.getFreshValueHex=function(){return""},this.setByParam=function(e){this.params=e},t!=null&&t.tlv!=null&&(this.hTLV=t.tlv,this.isModified=!1)},C.asn1.DERAbstractString=function(t){C.asn1.DERAbstractString.superclass.constructor.call(this),this.getString=function(){return this.s},this.setString=function(e){this.hTLV=null,this.isModified=!0,this.s=e,this.hV=An(this.s).toLowerCase()},this.setStringHex=function(e){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=e},this.getFreshValueHex=function(){return this.hV},t!==void 0&&(typeof t=="string"?this.setString(t):t.str!==void 0?this.setString(t.str):t.hex!==void 0&&this.setStringHex(t.hex))},Be(C.asn1.DERAbstractString,C.asn1.ASN1Object),C.asn1.DERAbstractTime=function(t){C.asn1.DERAbstractTime.superclass.constructor.call(this),this.localDateToUTC=function(e){var i=e.getTime()+6e4*e.getTimezoneOffset();return new Date(i)},this.formatDate=function(e,i,a){var d=this.zeroPadding,v=this.localDateToUTC(e),E=String(v.getFullYear());i=="utc"&&(E=E.substr(2,2));var k=E+d(String(v.getMonth()+1),2)+d(String(v.getDate()),2)+d(String(v.getHours()),2)+d(String(v.getMinutes()),2)+d(String(v.getSeconds()),2);if(a===!0){var R=v.getMilliseconds();if(R!=0){var I=d(String(R),3);k=k+"."+(I=I.replace(/[0]+$/,""))}}return k+"Z"},this.zeroPadding=function(e,i){return e.length>=i?e:new Array(i-e.length+1).join("0")+e},this.getString=function(){return this.s},this.setString=function(e){this.hTLV=null,this.isModified=!0,this.s=e,this.hV=zt(e)},this.setByDateValue=function(e,i,a,d,v,E){var k=new Date(Date.UTC(e,i-1,a,d,v,E,0));this.setByDate(k)},this.getFreshValueHex=function(){return this.hV}},Be(C.asn1.DERAbstractTime,C.asn1.ASN1Object),C.asn1.DERAbstractStructured=function(t){C.asn1.DERAbstractString.superclass.constructor.call(this),this.setByASN1ObjectArray=function(e){this.hTLV=null,this.isModified=!0,this.asn1Array=e},this.appendASN1Object=function(e){this.hTLV=null,this.isModified=!0,this.asn1Array.push(e)},this.asn1Array=new Array,t!==void 0&&t.array!==void 0&&(this.asn1Array=t.array)},Be(C.asn1.DERAbstractStructured,C.asn1.ASN1Object),C.asn1.DERBoolean=function(t){C.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",this.hTLV=t==0?"010100":"0101ff"},Be(C.asn1.DERBoolean,C.asn1.ASN1Object),C.asn1.DERInteger=function(t){C.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.setByBigInteger=function(e){this.hTLV=null,this.isModified=!0,this.hV=C.asn1.ASN1Util.bigIntToMinTwosComplementsHex(e)},this.setByInteger=function(e){var i=new W(String(e),10);this.setByBigInteger(i)},this.setValueHex=function(e){this.hV=e},this.getFreshValueHex=function(){return this.hV},t!==void 0&&(t.bigint!==void 0?this.setByBigInteger(t.bigint):t.int!==void 0?this.setByInteger(t.int):typeof t=="number"?this.setByInteger(t):t.hex!==void 0&&this.setValueHex(t.hex))},Be(C.asn1.DERInteger,C.asn1.ASN1Object),C.asn1.DERBitString=function(t){if(t!==void 0&&t.obj!==void 0){var e=C.asn1.ASN1Util.newObject(t.obj);t.hex="00"+e.getEncodedHex()}C.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(i){this.hTLV=null,this.isModified=!0,this.hV=i},this.setUnusedBitsAndHexValue=function(i,a){if(i<0||7<i)throw"unused bits shall be from 0 to 7: u = "+i;var d="0"+i;this.hTLV=null,this.isModified=!0,this.hV=d+a},this.setByBinaryString=function(i){var a=8-(i=i.replace(/0+$/,"")).length%8;a==8&&(a=0);for(var d=0;d<=a;d++)i+="0";var v="";for(d=0;d<i.length-1;d+=8){var E=i.substr(d,8),k=parseInt(E,2).toString(16);k.length==1&&(k="0"+k),v+=k}this.hTLV=null,this.isModified=!0,this.hV="0"+a+v},this.setByBooleanArray=function(i){for(var a="",d=0;d<i.length;d++)i[d]==1?a+="1":a+="0";this.setByBinaryString(a)},this.newFalseArray=function(i){for(var a=new Array(i),d=0;d<i;d++)a[d]=!1;return a},this.getFreshValueHex=function(){return this.hV},t!==void 0&&(typeof t=="string"&&t.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(t):t.hex!==void 0?this.setHexValueIncludingUnusedBits(t.hex):t.bin!==void 0?this.setByBinaryString(t.bin):t.array!==void 0&&this.setByBooleanArray(t.array))},Be(C.asn1.DERBitString,C.asn1.ASN1Object),C.asn1.DEROctetString=function(t){if(t!==void 0&&t.obj!==void 0){var e=C.asn1.ASN1Util.newObject(t.obj);t.hex=e.getEncodedHex()}C.asn1.DEROctetString.superclass.constructor.call(this,t),this.hT="04"},Be(C.asn1.DEROctetString,C.asn1.DERAbstractString),C.asn1.DERNull=function(){C.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},Be(C.asn1.DERNull,C.asn1.ASN1Object),C.asn1.DERObjectIdentifier=function(t){C.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(e){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=e},this.setValueOidString=function(e){var i=function(d){var v=function(B){var $=B.toString(16);return $.length==1&&($="0"+$),$},E=function(B){var $="",z=parseInt(B,10).toString(2),Q=7-z.length%7;Q==7&&(Q=0);for(var ee="",S=0;S<Q;S++)ee+="0";for(z=ee+z,S=0;S<z.length-1;S+=7){var O=z.substr(S,7);S!=z.length-7&&(O="1"+O),$+=v(parseInt(O,2))}return $};try{if(!d.match(/^[0-9.]+$/))return null;var k="",R=d.split("."),I=40*parseInt(R[0],10)+parseInt(R[1],10);k+=v(I),R.splice(0,2);for(var U=0;U<R.length;U++)k+=E(R[U]);return k}catch{return null}}(e);if(i==null)throw new Error("malformed oid string: "+e);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=i},this.setValueName=function(e){var i=C.asn1.x509.OID.name2oid(e);if(i==="")throw new Error("DERObjectIdentifier oidName undefined: "+e);this.setValueOidString(i)},this.setValueNameOrOid=function(e){e.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(e):this.setValueName(e)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(e){typeof e=="string"?this.setValueNameOrOid(e):e.oid!==void 0?this.setValueNameOrOid(e.oid):e.name!==void 0?this.setValueNameOrOid(e.name):e.hex!==void 0&&this.setValueHex(e.hex)},t!==void 0&&this.setByParam(t)},Be(C.asn1.DERObjectIdentifier,C.asn1.ASN1Object),C.asn1.DEREnumerated=function(t){C.asn1.DEREnumerated.superclass.constructor.call(this),this.hT="0a",this.setByBigInteger=function(e){this.hTLV=null,this.isModified=!0,this.hV=C.asn1.ASN1Util.bigIntToMinTwosComplementsHex(e)},this.setByInteger=function(e){var i=new W(String(e),10);this.setByBigInteger(i)},this.setValueHex=function(e){this.hV=e},this.getFreshValueHex=function(){return this.hV},t!==void 0&&(t.int!==void 0?this.setByInteger(t.int):typeof t=="number"?this.setByInteger(t):t.hex!==void 0&&this.setValueHex(t.hex))},Be(C.asn1.DEREnumerated,C.asn1.ASN1Object),C.asn1.DERUTF8String=function(t){C.asn1.DERUTF8String.superclass.constructor.call(this,t),this.hT="0c"},Be(C.asn1.DERUTF8String,C.asn1.DERAbstractString),C.asn1.DERNumericString=function(t){C.asn1.DERNumericString.superclass.constructor.call(this,t),this.hT="12"},Be(C.asn1.DERNumericString,C.asn1.DERAbstractString),C.asn1.DERPrintableString=function(t){C.asn1.DERPrintableString.superclass.constructor.call(this,t),this.hT="13"},Be(C.asn1.DERPrintableString,C.asn1.DERAbstractString),C.asn1.DERTeletexString=function(t){C.asn1.DERTeletexString.superclass.constructor.call(this,t),this.hT="14"},Be(C.asn1.DERTeletexString,C.asn1.DERAbstractString),C.asn1.DERIA5String=function(t){C.asn1.DERIA5String.superclass.constructor.call(this,t),this.hT="16"},Be(C.asn1.DERIA5String,C.asn1.DERAbstractString),C.asn1.DERVisibleString=function(t){C.asn1.DERIA5String.superclass.constructor.call(this,t),this.hT="1a"},Be(C.asn1.DERVisibleString,C.asn1.DERAbstractString),C.asn1.DERBMPString=function(t){C.asn1.DERBMPString.superclass.constructor.call(this,t),this.hT="1e"},Be(C.asn1.DERBMPString,C.asn1.DERAbstractString),C.asn1.DERUTCTime=function(t){C.asn1.DERUTCTime.superclass.constructor.call(this,t),this.hT="17",this.setByDate=function(e){this.hTLV=null,this.isModified=!0,this.date=e,this.s=this.formatDate(this.date,"utc"),this.hV=zt(this.s)},this.getFreshValueHex=function(){return this.date===void 0&&this.s===void 0&&(this.date=new Date,this.s=this.formatDate(this.date,"utc"),this.hV=zt(this.s)),this.hV},t!==void 0&&(t.str!==void 0?this.setString(t.str):typeof t=="string"&&t.match(/^[0-9]{12}Z$/)?this.setString(t):t.hex!==void 0?this.setStringHex(t.hex):t.date!==void 0&&this.setByDate(t.date))},Be(C.asn1.DERUTCTime,C.asn1.DERAbstractTime),C.asn1.DERGeneralizedTime=function(t){C.asn1.DERGeneralizedTime.superclass.constructor.call(this,t),this.hT="18",this.withMillis=!1,this.setByDate=function(e){this.hTLV=null,this.isModified=!0,this.date=e,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=zt(this.s)},this.getFreshValueHex=function(){return this.date===void 0&&this.s===void 0&&(this.date=new Date,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=zt(this.s)),this.hV},t!==void 0&&(t.str!==void 0?this.setString(t.str):typeof t=="string"&&t.match(/^[0-9]{14}Z$/)?this.setString(t):t.hex!==void 0?this.setStringHex(t.hex):t.date!==void 0&&this.setByDate(t.date),t.millis===!0&&(this.withMillis=!0))},Be(C.asn1.DERGeneralizedTime,C.asn1.DERAbstractTime),C.asn1.DERSequence=function(t){C.asn1.DERSequence.superclass.constructor.call(this,t),this.hT="30",this.getFreshValueHex=function(){for(var e="",i=0;i<this.asn1Array.length;i++)e+=this.asn1Array[i].getEncodedHex();return this.hV=e,this.hV}},Be(C.asn1.DERSequence,C.asn1.DERAbstractStructured),C.asn1.DERSet=function(t){C.asn1.DERSet.superclass.constructor.call(this,t),this.hT="31",this.sortFlag=!0,this.getFreshValueHex=function(){for(var e=new Array,i=0;i<this.asn1Array.length;i++){var a=this.asn1Array[i];e.push(a.getEncodedHex())}return this.sortFlag==1&&e.sort(),this.hV=e.join(""),this.hV},t!==void 0&&t.sortflag!==void 0&&t.sortflag==0&&(this.sortFlag=!1)},Be(C.asn1.DERSet,C.asn1.DERAbstractStructured),C.asn1.DERTaggedObject=function(t){C.asn1.DERTaggedObject.superclass.constructor.call(this);var e=C.asn1;this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.setASN1Object=function(i,a,d){this.hT=a,this.isExplicit=i,this.asn1Object=d,this.isExplicit?(this.hV=this.asn1Object.getEncodedHex(),this.hTLV=null,this.isModified=!0):(this.hV=null,this.hTLV=d.getEncodedHex(),this.hTLV=this.hTLV.replace(/^../,a),this.isModified=!1)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(i){i.tag!=null&&(this.hT=i.tag),i.explicit!=null&&(this.isExplicit=i.explicit),i.tage!=null&&(this.hT=i.tage,this.isExplicit=!0),i.tagi!=null&&(this.hT=i.tagi,this.isExplicit=!1),i.obj!=null&&(i.obj instanceof e.ASN1Object?(this.asn1Object=i.obj,this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)):b(i.obj)=="object"&&(this.asn1Object=e.ASN1Util.newObject(i.obj),this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)))},t!=null&&this.setByParam(t)},Be(C.asn1.DERTaggedObject,C.asn1.ASN1Object);var C,Cr,Nt,ue=new function(){};function Di(t){for(var e=new Array,i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e}function Hi(t){for(var e="",i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return e}function Vr(t){for(var e="",i=0;i<t.length;i++){var a=t[i].toString(16);a.length==1&&(a="0"+a),e+=a}return e}function zt(t){return Vr(Di(t))}function Jr(t){return t=(t=(t=t.replace(/\=/g,"")).replace(/\+/g,"-")).replace(/\//g,"_")}function xr(t){return t.length%4==2?t+="==":t.length%4==3&&(t+="="),t=(t=t.replace(/-/g,"+")).replace(/_/g,"/")}function Xe(t){return t.length%2==1&&(t="0"+t),Jr(j(t))}function Oe(t){return ne(xr(t))}function An(t){return qr(Gr(t))}function Qe(t){return decodeURIComponent($r(t))}function kt(t){for(var e="",i=0;i<t.length-1;i+=2)e+=String.fromCharCode(parseInt(t.substr(i,2),16));return e}function jt(t){for(var e="",i=0;i<t.length;i++)e+=("0"+t.charCodeAt(i).toString(16)).slice(-2);return e}function Ni(t){return j(t)}function Li(t){var e=Ni(t).replace(/(.{64})/g,`$1\r
`);return e=e.replace(/\r\n$/,"")}function Mi(t){return ne(t.replace(/[^0-9A-Za-z\/+=]*/g,""))}function bt(t,e){return"-----BEGIN "+e+`-----\r
`+Li(t)+`\r
-----END `+e+`-----\r
`}function Wt(t,e){if(t.indexOf("-----BEGIN ")==-1)throw"can't find PEM header: "+e;return Mi(t=e!==void 0?(t=t.replace(new RegExp("^[^]*-----BEGIN "+e+"-----"),"")).replace(new RegExp("-----END "+e+"-----[^]*$"),""):(t=t.replace(/^[^]*-----BEGIN [^-]+-----/,"")).replace(/-----END [^-]+-----[^]*$/,""))}function Pn(t){var e,i,a,d,v,E,k,R,I,U,D;if(D=t.match(/^(\d{2}|\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(|\.\d+)Z$/))return R=D[1],e=parseInt(R),R.length===2&&(50<=e&&e<100?e=1900+e:0<=e&&e<50&&(e=2e3+e)),i=parseInt(D[2])-1,a=parseInt(D[3]),d=parseInt(D[4]),v=parseInt(D[5]),E=parseInt(D[6]),k=0,(I=D[7])!==""&&(U=(I.substr(1)+"00").substr(0,3),k=parseInt(U)),Date.UTC(e,i,a,d,v,E,k);throw"unsupported zulu format: "+t}function Ki(t){return~~(Pn(t)/1e3)}function qr(t){return t.replace(/%/g,"")}function $r(t){return t.replace(/(..)/g,"%$1")}function Bi(t){var e="malformed IPv6 address";if(!t.match(/^[0-9A-Fa-f:]+$/))throw e;var i=(t=t.toLowerCase()).split(":").length-1;if(i<2)throw e;var a=":".repeat(7-i+2),d=(t=t.replace("::",a)).split(":");if(d.length!=8)throw e;for(var v=0;v<8;v++)d[v]=("0000"+d[v]).slice(-4);return d.join("")}function ji(t){if(!t.match(/^[0-9A-Fa-f]{32}$/))throw"malformed IPv6 address octet";for(var e=(t=t.toLowerCase()).match(/.{1,4}/g),i=0;i<8;i++)e[i]=e[i].replace(/^0+/,""),e[i]==""&&(e[i]="0");var a=(t=":"+e.join(":")+":").match(/:(0:){2,}/g);if(a===null)return t.slice(1,-1);var d="";for(i=0;i<a.length;i++)a[i].length>d.length&&(d=a[i]);return(t=t.replace(d,"::")).slice(1,-1)}function Tn(t){var e="malformed hex value";if(!t.match(/^([0-9A-Fa-f][0-9A-Fa-f]){1,}$/))throw e;if(t.length!=8)return t.length==32?ji(t):t;try{return parseInt(t.substr(0,2),16)+"."+parseInt(t.substr(2,2),16)+"."+parseInt(t.substr(4,2),16)+"."+parseInt(t.substr(6,2),16)}catch{throw e}}function Wi(t){return t.match(/.{4}/g).map(function(i){var a=parseInt(i.substr(0,2),16),d=parseInt(i.substr(2),16);if(a==0&d<128)return String.fromCharCode(d);if(a<8){var v=128|63&d;return Qe((192|(7&a)<<3|(192&d)>>6).toString(16)+v.toString(16))}v=128|(15&a)<<2|(192&d)>>6;var E=128|63&d;return Qe((224|(240&a)>>4).toString(16)+v.toString(16)+E.toString(16))}).join("")}function Gr(t){for(var e=encodeURIComponent(t),i="",a=0;a<e.length;a++)e[a]=="%"?(i+=e.substr(a,3),a+=2):i=i+"%"+zt(e[a]);return i}function Vi(t){return!(t.length%2!=0||!t.match(/^[0-9a-f]+$/)&&!t.match(/^[0-9A-F]+$/))}function Cn(t){return t.length%2==1?"0"+t:t.substr(0,1)>"7"?"00"+t:t}ue.getLblen=function(t,e){if(t.substr(e+2,1)!="8")return 1;var i=parseInt(t.substr(e+3,1));return i==0?-1:0<i&&i<10?i+1:-2},ue.getL=function(t,e){var i=ue.getLblen(t,e);return i<1?"":t.substr(e+2,2*i)},ue.getVblen=function(t,e){var i;return(i=ue.getL(t,e))==""?-1:(i.substr(0,1)==="8"?new W(i.substr(2),16):new W(i,16)).intValue()},ue.getVidx=function(t,e){var i=ue.getLblen(t,e);return i<0?i:e+2*(i+1)},ue.getV=function(t,e){var i=ue.getVidx(t,e),a=ue.getVblen(t,e);return t.substr(i,2*a)},ue.getTLV=function(t,e){return t.substr(e,2)+ue.getL(t,e)+ue.getV(t,e)},ue.getTLVblen=function(t,e){return 2+2*ue.getLblen(t,e)+2*ue.getVblen(t,e)},ue.getNextSiblingIdx=function(t,e){return ue.getVidx(t,e)+2*ue.getVblen(t,e)},ue.getChildIdx=function(t,e){var i,a,d,v=ue,E=[];i=v.getVidx(t,e),a=2*v.getVblen(t,e),t.substr(e,2)=="03"&&(i+=2,a-=2),d=0;for(var k=i;d<=a;){var R=v.getTLVblen(t,k);if((d+=R)<=a&&E.push(k),k+=R,d>=a)break}return E},ue.getNthChildIdx=function(t,e,i){return ue.getChildIdx(t,e)[i]},ue.getIdxbyList=function(t,e,i,a){var d,v,E=ue;return i.length==0?a!==void 0&&t.substr(e,2)!==a?-1:e:(d=i.shift())>=(v=E.getChildIdx(t,e)).length?-1:E.getIdxbyList(t,v[d],i,a)},ue.getIdxbyListEx=function(t,e,i,a){var d,v,E=ue;if(i.length==0)return a!==void 0&&t.substr(e,2)!==a?-1:e;d=i.shift(),v=E.getChildIdx(t,e);for(var k=0,R=0;R<v.length;R++){var I=t.substr(v[R],2);if(typeof d=="number"&&!E.isContextTag(I)&&k==d||typeof d=="string"&&E.isContextTag(I,d))return E.getIdxbyListEx(t,v[R],i,a);E.isContextTag(I)||k++}return-1},ue.getTLVbyList=function(t,e,i,a){var d=ue,v=d.getIdxbyList(t,e,i,a);return v==-1||v>=t.length?null:d.getTLV(t,v)},ue.getTLVbyListEx=function(t,e,i,a){var d=ue,v=d.getIdxbyListEx(t,e,i,a);return v==-1?null:d.getTLV(t,v)},ue.getVbyList=function(t,e,i,a,d){var v,E,k=ue;return(v=k.getIdxbyList(t,e,i,a))==-1||v>=t.length?null:(E=k.getV(t,v),d===!0&&(E=E.substr(2)),E)},ue.getVbyListEx=function(t,e,i,a,d){var v,E,k=ue;return(v=k.getIdxbyListEx(t,e,i,a))==-1?null:(E=k.getV(t,v),t.substr(v,2)=="03"&&d!==!1&&(E=E.substr(2)),E)},ue.getInt=function(t,e,i){i==null&&(i=-1);try{var a=t.substr(e,2);if(a!="02"&&a!="03")return i;var d=ue.getV(t,e);return a=="02"?parseInt(d,16):function(E){try{var k=E.substr(0,2);if(k=="00")return parseInt(E.substr(2),16);var R=parseInt(k,16),I=E.substr(2),U=parseInt(I,16).toString(2);return U=="0"&&(U="00000000"),U=U.slice(0,0-R),parseInt(U,2)}catch{return-1}}(d)}catch{return i}},ue.getOID=function(t,e,i){i==null&&(i=null);try{return t.substr(e,2)!="06"?i:function(d){if(!Vi(d))return null;try{var v=[],E=d.substr(0,2),k=parseInt(E,16);v[0]=new String(Math.floor(k/40)),v[1]=new String(k%40);for(var R=d.substr(2),I=[],U=0;U<R.length/2;U++)I.push(parseInt(R.substr(2*U,2),16));var D=[],B="";for(U=0;U<I.length;U++)128&I[U]?B+=Ji((127&I[U]).toString(2),7):(B+=Ji((127&I[U]).toString(2),7),D.push(new String(parseInt(B,2))),B="");var $=v.join(".");return D.length>0&&($=$+"."+D.join(".")),$}catch{return null}}(ue.getV(t,e))}catch{return i}},ue.getOIDName=function(t,e,i){i==null&&(i=null);try{var a=ue.getOID(t,e,i);if(a==i)return i;var d=C.asn1.x509.OID.oid2name(a);return d==""?a:d}catch{return i}},ue.getString=function(t,e,i){i==null&&(i=null);try{return kt(ue.getV(t,e))}catch{return i}},ue.hextooidstr=function(t){var e=function(B,$){return B.length>=$?B:new Array($-B.length+1).join("0")+B},i=[],a=t.substr(0,2),d=parseInt(a,16);i[0]=new String(Math.floor(d/40)),i[1]=new String(d%40);for(var v=t.substr(2),E=[],k=0;k<v.length/2;k++)E.push(parseInt(v.substr(2*k,2),16));var R=[],I="";for(k=0;k<E.length;k++)128&E[k]?I+=e((127&E[k]).toString(2),7):(I+=e((127&E[k]).toString(2),7),R.push(new String(parseInt(I,2))),I="");var U=i.join(".");return R.length>0&&(U=U+"."+R.join(".")),U},ue.dump=function(t,e,i,a){var d=ue,v=d.getV,E=d.dump,k=d.getChildIdx,R=t;t instanceof C.asn1.ASN1Object&&(R=t.getEncodedHex());var I=function(se,we){return se.length<=2*we?se:se.substr(0,we)+"..(total "+se.length/2+"bytes).."+se.substr(se.length-we,we)};e===void 0&&(e={ommit_long_octet:32}),i===void 0&&(i=0),a===void 0&&(a="");var U,D=e.ommit_long_octet;if((U=R.substr(i,2))=="01")return(B=v(R,i))=="00"?a+`BOOLEAN FALSE
`:a+`BOOLEAN TRUE
`;if(U=="02")return a+"INTEGER "+I(B=v(R,i),D)+`
`;if(U=="03"){var B=v(R,i);if(d.isASN1HEX(B.substr(2))){var $=a+`BITSTRING, encapsulates
`;return $+=E(B.substr(2),e,0,a+"  ")}return a+"BITSTRING "+I(B,D)+`
`}if(U=="04")return B=v(R,i),d.isASN1HEX(B)?($=a+`OCTETSTRING, encapsulates
`,$+=E(B,e,0,a+"  ")):a+"OCTETSTRING "+I(B,D)+`
`;if(U=="05")return a+`NULL
`;if(U=="06"){var z=v(R,i),Q=C.asn1.ASN1Util.oidHexToInt(z),ee=C.asn1.x509.OID.oid2name(Q),S=Q.replace(/\./g," ");return ee!=""?a+"ObjectIdentifier "+ee+" ("+S+`)
`:a+"ObjectIdentifier ("+S+`)
`}if(U=="0a")return a+"ENUMERATED "+parseInt(v(R,i))+`
`;if(U=="0c")return a+"UTF8String '"+Qe(v(R,i))+`'
`;if(U=="13")return a+"PrintableString '"+Qe(v(R,i))+`'
`;if(U=="14")return a+"TeletexString '"+Qe(v(R,i))+`'
`;if(U=="16")return a+"IA5String '"+Qe(v(R,i))+`'
`;if(U=="17")return a+"UTCTime "+Qe(v(R,i))+`
`;if(U=="18")return a+"GeneralizedTime "+Qe(v(R,i))+`
`;if(U=="1a")return a+"VisualString '"+Qe(v(R,i))+`'
`;if(U=="1e")return a+"BMPString '"+Wi(v(R,i))+`'
`;if(U=="30"){if(R.substr(i,4)=="3000")return a+`SEQUENCE {}
`;$=a+`SEQUENCE
`;var O=e;if(((Y=k(R,i)).length==2||Y.length==3)&&R.substr(Y[0],2)=="06"&&R.substr(Y[Y.length-1],2)=="04"){ee=d.oidname(v(R,Y[0]));var N=JSON.parse(JSON.stringify(e));N.x509ExtName=ee,O=N}for(var K=0;K<Y.length;K++)$+=E(R,O,Y[K],a+"  ");return $}if(U=="31"){$=a+`SET
`;var Y=k(R,i);for(K=0;K<Y.length;K++)$+=E(R,e,Y[K],a+"  ");return $}if((128&(U=parseInt(U,16)))!=0){var te=31&U;if((32&U)!=0){for($=a+"["+te+`]
`,Y=k(R,i),K=0;K<Y.length;K++)$+=E(R,e,Y[K],a+"  ");return $}if(B=v(R,i),ue.isASN1HEX(B)){var $=a+"["+te+`]
`;return $+=E(B,e,0,a+"  ")}return(B.substr(0,8)=="68747470"||e.x509ExtName==="subjectAltName"&&te==2)&&(B=Qe(B)),$=a+"["+te+"] "+B+`
`}return a+"UNKNOWN("+U+") "+v(R,i)+`
`},ue.isContextTag=function(t,e){var i,a;t=t.toLowerCase();try{i=parseInt(t,16)}catch{return-1}if(e===void 0)return(192&i)==128;try{return e.match(/^\[[0-9]+\]$/)!=null&&!((a=parseInt(e.substr(1,e.length-1),10))>31)&&(192&i)==128&&(31&i)==a}catch{return!1}},ue.isASN1HEX=function(t){var e=ue;if(t.length%2==1)return!1;var i=e.getVblen(t,0),a=t.substr(0,2),d=e.getL(t,0);return t.length-a.length-d.length==2*i},ue.checkStrictDER=function(t,e,i,a,d){var v=ue;if(i===void 0){if(typeof t!="string")throw new Error("not hex string");if(t=t.toLowerCase(),!C.lang.String.isHex(t))throw new Error("not hex string");i=t.length,d=(a=t.length/2)<128?1:Math.ceil(a.toString(16))+1}if(v.getL(t,e).length>2*d)throw new Error("L of TLV too long: idx="+e);var E=v.getVblen(t,e);if(E>a)throw new Error("value of L too long than hex: idx="+e);var k=v.getTLV(t,e),R=k.length-2-v.getL(t,e).length;if(R!==2*E)throw new Error("V string length and L's value not the same:"+R+"/"+2*E);if(e===0&&t.length!=k.length)throw new Error("total length and TLV length unmatch:"+t.length+"!="+k.length);var I=t.substr(e,2);if(I==="02"){var U=v.getVidx(t,e);if(t.substr(U,2)=="00"&&t.charCodeAt(U+2)<56)throw new Error("not least zeros for DER INTEGER")}if(32&parseInt(I,16)){for(var D=v.getVblen(t,e),B=0,$=v.getChildIdx(t,e),z=0;z<$.length;z++)B+=v.getTLV(t,$[z]).length,v.checkStrictDER(t,$[z],i,a,d);if(2*D!=B)throw new Error("sum of children's TLV length and L unmatch: "+2*D+"!="+B)}},ue.oidname=function(t){var e=C.asn1;C.lang.String.isHex(t)&&(t=e.ASN1Util.oidHexToInt(t));var i=e.x509.OID.oid2name(t);return i===""&&(i=t),i},C!==void 0&&C||(o.KJUR=C={}),C.lang!==void 0&&C.lang||(C.lang={}),C.lang.String=function(){},typeof l=="function"?(o.utf8tob64u=Cr=function(e){return Jr(l.from(e,"utf8").toString("base64"))},o.b64utoutf8=Nt=function(e){return l.from(xr(e),"base64").toString("utf8")}):(o.utf8tob64u=Cr=function(e){return Xe(qr(Gr(e)))},o.b64utoutf8=Nt=function(e){return decodeURIComponent($r(Oe(e)))}),C.lang.String.isInteger=function(t){return!!t.match(/^[0-9]+$/)||!!t.match(/^-[0-9]+$/)},C.lang.String.isHex=function(t){return Vi(t)},C.lang.String.isBase64=function(t){return!(!(t=t.replace(/\s+/g,"")).match(/^[0-9A-Za-z+\/]+={0,3}$/)||t.length%4!=0)},C.lang.String.isBase64URL=function(t){return!t.match(/[+/=]/)&&(t=xr(t),C.lang.String.isBase64(t))},C.lang.String.isIntegerArray=function(t){return!!(t=t.replace(/\s+/g,"")).match(/^\[[0-9,]+\]$/)},C.lang.String.isPrintable=function(t){return t.match(/^[0-9A-Za-z '()+,-./:=?]*$/)!==null},C.lang.String.isIA5=function(t){return t.match(/^[\x20-\x21\x23-\x7f]*$/)!==null},C.lang.String.isMail=function(t){return t.match(/^[A-Za-z0-9]{1}[A-Za-z0-9_.-]*@{1}[A-Za-z0-9_.-]{1,}\.[A-Za-z0-9]{1,}$/)!==null};var Ji=function(e,i,a){return a==null&&(a="0"),e.length>=i?e:new Array(i-e.length+1).join(a)+e};function Be(t,e){var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t,t.superclass=e.prototype,e.prototype.constructor==Object.prototype.constructor&&(e.prototype.constructor=e)}C!==void 0&&C||(o.KJUR=C={}),C.crypto!==void 0&&C.crypto||(C.crypto={}),C.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHAwithRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:M.algo.MD5,sha1:M.algo.SHA1,sha224:M.algo.SHA224,sha256:M.algo.SHA256,sha384:M.algo.SHA384,sha512:M.algo.SHA512,ripemd160:M.algo.RIPEMD160},this.getDigestInfoHex=function(t,e){if(this.DIGESTINFOHEAD[e]===void 0)throw"alg not supported in Util.DIGESTINFOHEAD: "+e;return this.DIGESTINFOHEAD[e]+t},this.getPaddedDigestInfoHex=function(t,e,i){var a=this.getDigestInfoHex(t,e),d=i/4;if(a.length+22>d)throw"key is too short for SigAlg: keylen="+i+","+e;for(var v="0001",E="00"+a,k="",R=d-v.length-E.length,I=0;I<R;I+=2)k+="ff";return v+k+E},this.hashString=function(t,e){return new C.crypto.MessageDigest({alg:e}).digestString(t)},this.hashHex=function(t,e){return new C.crypto.MessageDigest({alg:e}).digestHex(t)},this.sha1=function(t){return this.hashString(t,"sha1")},this.sha256=function(t){return this.hashString(t,"sha256")},this.sha256Hex=function(t){return this.hashHex(t,"sha256")},this.sha512=function(t){return this.hashString(t,"sha512")},this.sha512Hex=function(t){return this.hashHex(t,"sha512")},this.isKey=function(t){return t instanceof fe||t instanceof C.crypto.DSA||t instanceof C.crypto.ECDSA}},C.crypto.Util.md5=function(t){return new C.crypto.MessageDigest({alg:"md5",prov:"cryptojs"}).digestString(t)},C.crypto.Util.ripemd160=function(t){return new C.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"}).digestString(t)},C.crypto.Util.SECURERANDOMGEN=new Re,C.crypto.Util.getRandomHexOfNbytes=function(t){var e=new Array(t);return C.crypto.Util.SECURERANDOMGEN.nextBytes(e),Vr(e)},C.crypto.Util.getRandomBigIntegerOfNbytes=function(t){return new W(C.crypto.Util.getRandomHexOfNbytes(t),16)},C.crypto.Util.getRandomHexOfNbits=function(t){var e=t%8,i=new Array((t-e)/8+1);return C.crypto.Util.SECURERANDOMGEN.nextBytes(i),i[0]=(255<<e&255^255)&i[0],Vr(i)},C.crypto.Util.getRandomBigIntegerOfNbits=function(t){return new W(C.crypto.Util.getRandomHexOfNbits(t),16)},C.crypto.Util.getRandomBigIntegerZeroToMax=function(t){for(var e=t.bitLength();;){var i=C.crypto.Util.getRandomBigIntegerOfNbits(e);if(t.compareTo(i)!=-1)return i}},C.crypto.Util.getRandomBigIntegerMinToMax=function(t,e){var i=t.compareTo(e);if(i==1)throw"biMin is greater than biMax";if(i==0)return t;var a=e.subtract(t);return C.crypto.Util.getRandomBigIntegerZeroToMax(a).add(t)},C.crypto.MessageDigest=function(t){this.setAlgAndProvider=function(e,i){if((e=C.crypto.MessageDigest.getCanonicalAlgName(e))!==null&&i===void 0&&(i=C.crypto.Util.DEFAULTPROVIDER[e]),":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(e)!=-1&&i=="cryptojs"){try{this.md=C.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[e].create()}catch(a){throw"setAlgAndProvider hash alg set fail alg="+e+"/"+a}this.updateString=function(a){this.md.update(a)},this.updateHex=function(a){var d=M.enc.Hex.parse(a);this.md.update(d)},this.digest=function(){return this.md.finalize().toString(M.enc.Hex)},this.digestString=function(a){return this.updateString(a),this.digest()},this.digestHex=function(a){return this.updateHex(a),this.digest()}}if(":sha256:".indexOf(e)!=-1&&i=="sjcl"){try{this.md=new sjcl.hash.sha256}catch(a){throw"setAlgAndProvider hash alg set fail alg="+e+"/"+a}this.updateString=function(a){this.md.update(a)},this.updateHex=function(a){var d=sjcl.codec.hex.toBits(a);this.md.update(d)},this.digest=function(){var a=this.md.finalize();return sjcl.codec.hex.fromBits(a)},this.digestString=function(a){return this.updateString(a),this.digest()},this.digestHex=function(a){return this.updateHex(a),this.digest()}}},this.updateString=function(e){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(e){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(e){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(e){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},t!==void 0&&t.alg!==void 0&&(this.algName=t.alg,t.prov===void 0&&(this.provName=C.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))},C.crypto.MessageDigest.getCanonicalAlgName=function(t){return typeof t=="string"&&(t=(t=t.toLowerCase()).replace(/-/,"")),t},C.crypto.MessageDigest.getHashLength=function(t){var e=C.crypto.MessageDigest,i=e.getCanonicalAlgName(t);if(e.HASHLENGTH[i]===void 0)throw"not supported algorithm: "+t;return e.HASHLENGTH[i]},C.crypto.MessageDigest.HASHLENGTH={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,ripemd160:20},C.crypto.Mac=function(t){this.setAlgAndProvider=function(e,i){if((e=e.toLowerCase())==null&&(e="hmacsha1"),(e=e.toLowerCase()).substr(0,4)!="hmac")throw"setAlgAndProvider unsupported HMAC alg: "+e;i===void 0&&(i=C.crypto.Util.DEFAULTPROVIDER[e]),this.algProv=e+"/"+i;var a=e.substr(4);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(a)!=-1&&i=="cryptojs"){try{var d=C.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[a];this.mac=M.algo.HMAC.create(d,this.pass)}catch(v){throw"setAlgAndProvider hash alg set fail hashAlg="+a+"/"+v}this.updateString=function(v){this.mac.update(v)},this.updateHex=function(v){var E=M.enc.Hex.parse(v);this.mac.update(E)},this.doFinal=function(){return this.mac.finalize().toString(M.enc.Hex)},this.doFinalString=function(v){return this.updateString(v),this.doFinal()},this.doFinalHex=function(v){return this.updateHex(v),this.doFinal()}}},this.updateString=function(e){throw"updateString(str) not supported for this alg/prov: "+this.algProv},this.updateHex=function(e){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv},this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv},this.doFinalString=function(e){throw"digestString(str) not supported for this alg/prov: "+this.algProv},this.doFinalHex=function(e){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv},this.setPassword=function(e){if(typeof e=="string"){var i=e;return e.length%2!=1&&e.match(/^[0-9A-Fa-f]+$/)||(i=jt(e)),void(this.pass=M.enc.Hex.parse(i))}if((e===void 0?"undefined":b(e))!="object")throw"KJUR.crypto.Mac unsupported password type: "+e;if(i=null,e.hex!==void 0){if(e.hex.length%2!=0||!e.hex.match(/^[0-9A-Fa-f]+$/))throw"Mac: wrong hex password: "+e.hex;i=e.hex}if(e.utf8!==void 0&&(i=An(e.utf8)),e.rstr!==void 0&&(i=jt(e.rstr)),e.b64!==void 0&&(i=ne(e.b64)),e.b64u!==void 0&&(i=Oe(e.b64u)),i==null)throw"KJUR.crypto.Mac unsupported password type: "+e;this.pass=M.enc.Hex.parse(i)},t!==void 0&&(t.pass!==void 0&&this.setPassword(t.pass),t.alg!==void 0&&(this.algName=t.alg,t.prov===void 0&&(this.provName=C.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))},C.crypto.Signature=function(t){var e=null;if(this._setAlgNames=function(){var i=this.algName.match(/^(.+)with(.+)$/);i&&(this.mdAlgName=i[1].toLowerCase(),this.pubkeyAlgName=i[2].toLowerCase(),this.pubkeyAlgName=="rsaandmgf1"&&this.mdAlgName=="sha"&&(this.mdAlgName="sha1"))},this._zeroPaddingOfSignature=function(i,a){for(var d="",v=a/4-i.length,E=0;E<v;E++)d+="0";return d+i},this.setAlgAndProvider=function(i,a){if(this._setAlgNames(),a!="cryptojs/jsrsa")throw new Error("provider not supported: "+a);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)!=-1){try{this.md=new C.crypto.MessageDigest({alg:this.mdAlgName})}catch(d){throw new Error("setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+d)}this.init=function(d,v){var E=null;try{E=v===void 0?$e.getKey(d):$e.getKey(d,v)}catch(k){throw"init failed:"+k}if(E.isPrivate===!0)this.prvKey=E,this.state="SIGN";else{if(E.isPublic!==!0)throw"init failed.:"+E;this.pubKey=E,this.state="VERIFY"}},this.updateString=function(d){this.md.updateString(d)},this.updateHex=function(d){this.md.updateHex(d)},this.sign=function(){if(this.sHashHex=this.md.digest(),this.prvKey===void 0&&this.ecprvhex!==void 0&&this.eccurvename!==void 0&&C.crypto.ECDSA!==void 0&&(this.prvKey=new C.crypto.ECDSA({curve:this.eccurvename,prv:this.ecprvhex})),this.prvKey instanceof fe&&this.pubkeyAlgName==="rsaandmgf1")this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if(this.prvKey instanceof fe&&this.pubkeyAlgName==="rsa")this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof C.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else{if(!(this.prvKey instanceof C.crypto.DSA))throw"Signature: unsupported private key alg: "+this.pubkeyAlgName;this.hSign=this.prvKey.signWithMessageHash(this.sHashHex)}return this.hSign},this.signString=function(d){return this.updateString(d),this.sign()},this.signHex=function(d){return this.updateHex(d),this.sign()},this.verify=function(d){if(this.sHashHex=this.md.digest(),this.pubKey===void 0&&this.ecpubhex!==void 0&&this.eccurvename!==void 0&&C.crypto.ECDSA!==void 0&&(this.pubKey=new C.crypto.ECDSA({curve:this.eccurvename,pub:this.ecpubhex})),this.pubKey instanceof fe&&this.pubkeyAlgName==="rsaandmgf1")return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,d,this.mdAlgName,this.pssSaltLen);if(this.pubKey instanceof fe&&this.pubkeyAlgName==="rsa")return this.pubKey.verifyWithMessageHash(this.sHashHex,d);if(C.crypto.ECDSA!==void 0&&this.pubKey instanceof C.crypto.ECDSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,d);if(C.crypto.DSA!==void 0&&this.pubKey instanceof C.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,d);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(i,a){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.updateString=function(i){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(i){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName},this.signString=function(i){throw"digestString(str) not supported for this alg:prov="+this.algProvName},this.signHex=function(i){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(i){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},this.initParams=t,t!==void 0&&(t.alg!==void 0&&(this.algName=t.alg,t.prov===void 0?this.provName=C.crypto.Util.DEFAULTPROVIDER[this.algName]:this.provName=t.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),t.psssaltlen!==void 0&&(this.pssSaltLen=t.psssaltlen),t.prvkeypem!==void 0)){if(t.prvkeypas!==void 0)throw"both prvkeypem and prvkeypas parameters not supported";try{e=$e.getKey(t.prvkeypem),this.init(e)}catch(i){throw"fatal error to load pem private key: "+i}}},C.crypto.Cipher=function(t){},C.crypto.Cipher.encrypt=function(t,e,i){if(e instanceof fe&&e.isPublic){var a=C.crypto.Cipher.getAlgByKeyAndName(e,i);if(a==="RSA")return e.encrypt(t);if(a==="RSAOAEP")return e.encryptOAEP(t,"sha1");var d=a.match(/^RSAOAEP(\d+)$/);if(d!==null)return e.encryptOAEP(t,"sha"+d[1]);throw"Cipher.encrypt: unsupported algorithm for RSAKey: "+i}throw"Cipher.encrypt: unsupported key or algorithm"},C.crypto.Cipher.decrypt=function(t,e,i){if(e instanceof fe&&e.isPrivate){var a=C.crypto.Cipher.getAlgByKeyAndName(e,i);if(a==="RSA")return e.decrypt(t);if(a==="RSAOAEP")return e.decryptOAEP(t,"sha1");var d=a.match(/^RSAOAEP(\d+)$/);if(d!==null)return e.decryptOAEP(t,"sha"+d[1]);throw"Cipher.decrypt: unsupported algorithm for RSAKey: "+i}throw"Cipher.decrypt: unsupported key or algorithm"},C.crypto.Cipher.getAlgByKeyAndName=function(t,e){if(t instanceof fe){if(":RSA:RSAOAEP:RSAOAEP224:RSAOAEP256:RSAOAEP384:RSAOAEP512:".indexOf(e)!=-1)return e;if(e==null)return"RSA";throw"getAlgByKeyAndName: not supported algorithm name for RSAKey: "+e}throw"getAlgByKeyAndName: not supported algorithm name: "+e},C.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040023":"secp521r1","2b81040022":"secp384r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}},C!==void 0&&C||(o.KJUR=C={}),C.crypto!==void 0&&C.crypto||(C.crypto={}),C.crypto.ECDSA=function(t){var e=Error,i=W,a=Se,d=C.crypto.ECDSA,v=C.crypto.ECParameterDB,E=d.getName,k=ue,R=k.getVbyListEx,I=k.isASN1HEX,U=new Re;this.type="EC",this.isPrivate=!1,this.isPublic=!1,this.getBigRandom=function(D){return new i(D.bitLength(),U).mod(D.subtract(i.ONE)).add(i.ONE)},this.setNamedCurve=function(D){this.ecparams=v.getByName(D),this.prvKeyHex=null,this.pubKeyHex=null,this.curveName=D},this.setPrivateKeyHex=function(D){this.isPrivate=!0,this.prvKeyHex=D},this.setPublicKeyHex=function(D){this.isPublic=!0,this.pubKeyHex=D},this.getPublicKeyXYHex=function(){var D=this.pubKeyHex;if(D.substr(0,2)!=="04")throw"this method supports uncompressed format(04) only";var B=this.ecparams.keylen/4;if(D.length!==2+2*B)throw"malformed public key hex length";var $={};return $.x=D.substr(2,B),$.y=D.substr(2+B),$},this.getShortNISTPCurveName=function(){var D=this.curveName;return D==="secp256r1"||D==="NIST P-256"||D==="P-256"||D==="prime256v1"?"P-256":D==="secp384r1"||D==="NIST P-384"||D==="P-384"?"P-384":null},this.generateKeyPairHex=function(){var D=this.ecparams.n,B=this.getBigRandom(D),$=this.ecparams.G.multiply(B),z=$.getX().toBigInteger(),Q=$.getY().toBigInteger(),ee=this.ecparams.keylen/4,S=("0000000000"+B.toString(16)).slice(-ee),O="04"+("0000000000"+z.toString(16)).slice(-ee)+("0000000000"+Q.toString(16)).slice(-ee);return this.setPrivateKeyHex(S),this.setPublicKeyHex(O),{ecprvhex:S,ecpubhex:O}},this.signWithMessageHash=function(D){return this.signHex(D,this.prvKeyHex)},this.signHex=function(D,B){var $=new i(B,16),z=this.ecparams.n,Q=new i(D.substring(0,this.ecparams.keylen/4),16);do var ee=this.getBigRandom(z),S=this.ecparams.G.multiply(ee).getX().toBigInteger().mod(z);while(S.compareTo(i.ZERO)<=0);var O=ee.modInverse(z).multiply(Q.add($.multiply(S))).mod(z);return d.biRSSigToASN1Sig(S,O)},this.sign=function(D,B){var $=B,z=this.ecparams.n,Q=i.fromByteArrayUnsigned(D);do var ee=this.getBigRandom(z),S=this.ecparams.G.multiply(ee).getX().toBigInteger().mod(z);while(S.compareTo(W.ZERO)<=0);var O=ee.modInverse(z).multiply(Q.add($.multiply(S))).mod(z);return this.serializeSig(S,O)},this.verifyWithMessageHash=function(D,B){return this.verifyHex(D,B,this.pubKeyHex)},this.verifyHex=function(D,B,$){try{var z,Q,ee=d.parseSigHex(B);z=ee.r,Q=ee.s;var S=a.decodeFromHex(this.ecparams.curve,$),O=new i(D.substring(0,this.ecparams.keylen/4),16);return this.verifyRaw(O,z,Q,S)}catch{return!1}},this.verify=function(D,B,$){var z,Q,ee;if(Bitcoin.Util.isArray(B)){var S=this.parseSig(B);z=S.r,Q=S.s}else{if((B===void 0?"undefined":b(B))!=="object"||!B.r||!B.s)throw"Invalid value for signature";z=B.r,Q=B.s}if($ instanceof Se)ee=$;else{if(!Bitcoin.Util.isArray($))throw"Invalid format for pubkey value, must be byte array or ECPointFp";ee=a.decodeFrom(this.ecparams.curve,$)}var O=i.fromByteArrayUnsigned(D);return this.verifyRaw(O,z,Q,ee)},this.verifyRaw=function(D,B,$,z){var Q=this.ecparams.n,ee=this.ecparams.G;if(B.compareTo(i.ONE)<0||B.compareTo(Q)>=0||$.compareTo(i.ONE)<0||$.compareTo(Q)>=0)return!1;var S=$.modInverse(Q),O=D.multiply(S).mod(Q),N=B.multiply(S).mod(Q);return ee.multiply(O).add(z.multiply(N)).getX().toBigInteger().mod(Q).equals(B)},this.serializeSig=function(D,B){var $=D.toByteArraySigned(),z=B.toByteArraySigned(),Q=[];return Q.push(2),Q.push($.length),(Q=Q.concat($)).push(2),Q.push(z.length),(Q=Q.concat(z)).unshift(Q.length),Q.unshift(48),Q},this.parseSig=function(D){var B;if(D[0]!=48)throw new Error("Signature not a valid DERSequence");if(D[B=2]!=2)throw new Error("First element in signature must be a DERInteger");var $=D.slice(B+2,B+2+D[B+1]);if(D[B+=2+D[B+1]]!=2)throw new Error("Second element in signature must be a DERInteger");var z=D.slice(B+2,B+2+D[B+1]);return B+=2+D[B+1],{r:i.fromByteArrayUnsigned($),s:i.fromByteArrayUnsigned(z)}},this.parseSigCompact=function(D){if(D.length!==65)throw"Signature has the wrong length";var B=D[0]-27;if(B<0||B>7)throw"Invalid signature type";var $=this.ecparams.n;return{r:i.fromByteArrayUnsigned(D.slice(1,33)).mod($),s:i.fromByteArrayUnsigned(D.slice(33,65)).mod($),i:B}},this.readPKCS5PrvKeyHex=function(D){if(I(D)===!1)throw new Error("not ASN.1 hex string");var B,$,z;try{B=R(D,0,["[0]",0],"06"),$=R(D,0,[1],"04");try{z=R(D,0,["[1]",0],"03")}catch{}}catch{throw new Error("malformed PKCS#1/5 plain ECC private key")}if(this.curveName=E(B),this.curveName===void 0)throw"unsupported curve name";this.setNamedCurve(this.curveName),this.setPublicKeyHex(z),this.setPrivateKeyHex($),this.isPublic=!1},this.readPKCS8PrvKeyHex=function(D){if(I(D)===!1)throw new e("not ASN.1 hex string");var B,$,z;try{R(D,0,[1,0],"06"),B=R(D,0,[1,1],"06"),$=R(D,0,[2,0,1],"04");try{z=R(D,0,[2,0,"[1]",0],"03")}catch{}}catch{throw new e("malformed PKCS#8 plain ECC private key")}if(this.curveName=E(B),this.curveName===void 0)throw new e("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(z),this.setPrivateKeyHex($),this.isPublic=!1},this.readPKCS8PubKeyHex=function(D){if(I(D)===!1)throw new e("not ASN.1 hex string");var B,$;try{R(D,0,[0,0],"06"),B=R(D,0,[0,1],"06"),$=R(D,0,[1],"03")}catch{throw new e("malformed PKCS#8 ECC public key")}if(this.curveName=E(B),this.curveName===null)throw new e("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex($)},this.readCertPubKeyHex=function(D,B){if(I(D)===!1)throw new e("not ASN.1 hex string");var $,z;try{$=R(D,0,[0,5,0,1],"06"),z=R(D,0,[0,5,1],"03")}catch{throw new e("malformed X.509 certificate ECC public key")}if(this.curveName=E($),this.curveName===null)throw new e("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(z)},t!==void 0&&t.curve!==void 0&&(this.curveName=t.curve),this.curveName===void 0&&(this.curveName="secp256r1"),this.setNamedCurve(this.curveName),t!==void 0&&(t.prv!==void 0&&this.setPrivateKeyHex(t.prv),t.pub!==void 0&&this.setPublicKeyHex(t.pub))},C.crypto.ECDSA.parseSigHex=function(t){var e=C.crypto.ECDSA.parseSigHexInHexRS(t);return{r:new W(e.r,16),s:new W(e.s,16)}},C.crypto.ECDSA.parseSigHexInHexRS=function(t){var e=ue,i=e.getChildIdx,a=e.getV;if(e.checkStrictDER(t,0),t.substr(0,2)!="30")throw new Error("signature is not a ASN.1 sequence");var d=i(t,0);if(d.length!=2)throw new Error("signature shall have two elements");var v=d[0],E=d[1];if(t.substr(v,2)!="02")throw new Error("1st item not ASN.1 integer");if(t.substr(E,2)!="02")throw new Error("2nd item not ASN.1 integer");return{r:a(t,v),s:a(t,E)}},C.crypto.ECDSA.asn1SigToConcatSig=function(t){var e=C.crypto.ECDSA.parseSigHexInHexRS(t),i=e.r,a=e.s;if(i.substr(0,2)=="00"&&i.length%32==2&&(i=i.substr(2)),a.substr(0,2)=="00"&&a.length%32==2&&(a=a.substr(2)),i.length%32==30&&(i="00"+i),a.length%32==30&&(a="00"+a),i.length%32!=0)throw"unknown ECDSA sig r length error";if(a.length%32!=0)throw"unknown ECDSA sig s length error";return i+a},C.crypto.ECDSA.concatSigToASN1Sig=function(t){if(t.length/2*8%128!=0)throw"unknown ECDSA concatinated r-s sig  length error";var e=t.substr(0,t.length/2),i=t.substr(t.length/2);return C.crypto.ECDSA.hexRSSigToASN1Sig(e,i)},C.crypto.ECDSA.hexRSSigToASN1Sig=function(t,e){var i=new W(t,16),a=new W(e,16);return C.crypto.ECDSA.biRSSigToASN1Sig(i,a)},C.crypto.ECDSA.biRSSigToASN1Sig=function(t,e){var i=C.asn1,a=new i.DERInteger({bigint:t}),d=new i.DERInteger({bigint:e});return new i.DERSequence({array:[a,d]}).getEncodedHex()},C.crypto.ECDSA.getName=function(t){return t==="2b8104001f"?"secp192k1":t==="2a8648ce3d030107"?"secp256r1":t==="2b8104000a"?"secp256k1":t==="2b81040021"?"secp224r1":t==="2b81040022"?"secp384r1":"|secp256r1|NIST P-256|P-256|prime256v1|".indexOf(t)!==-1?"secp256r1":"|secp256k1|".indexOf(t)!==-1?"secp256k1":"|secp224r1|NIST P-224|P-224|".indexOf(t)!==-1?"secp224r1":"|secp384r1|NIST P-384|P-384|".indexOf(t)!==-1?"secp384r1":null},C!==void 0&&C||(o.KJUR=C={}),C.crypto!==void 0&&C.crypto||(C.crypto={}),C.crypto.ECParameterDB=new function(){var t={},e={};function i(a){return new W(a,16)}this.getByName=function(a){var d=a;if(e[d]!==void 0&&(d=e[a]),t[d]!==void 0)return t[d];throw"unregistered EC curve name: "+d},this.regist=function(a,d,v,E,k,R,I,U,D,B,$,z){t[a]={};var Q=i(v),ee=i(E),S=i(k),O=i(R),N=i(I),K=new It(Q,ee,S),Y=K.decodePointHex("04"+U+D);t[a].name=a,t[a].keylen=d,t[a].curve=K,t[a].G=Y,t[a].n=O,t[a].h=N,t[a].oid=$,t[a].info=z;for(var te=0;te<B.length;te++)e[B[te]]=a}},C.crypto.ECParameterDB.regist("secp128r1",128,"FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFC","E87579C11079F43DD824993C2CEE5ED3","FFFFFFFE0000000075A30D1B9038A115","1","161FF7528B899B2D0C28607CA52C5B86","CF5AC8395BAFEB13C02DA292DDED7A83",[],"","secp128r1 : SECG curve over a 128 bit prime field"),C.crypto.ECParameterDB.regist("secp160k1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFAC73","0","7","0100000000000000000001B8FA16DFAB9ACA16B6B3","1","3B4C382CE37AA192A4019E763036F4F5DD4D7EBB","938CF935318FDCED6BC28286531733C3F03C4FEE",[],"","secp160k1 : SECG curve over a 160 bit prime field"),C.crypto.ECParameterDB.regist("secp160r1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFC","1C97BEFC54BD7A8B65ACF89F81D4D4ADC565FA45","0100000000000000000001F4C8F927AED3CA752257","1","4A96B5688EF573284664698968C38BB913CBFC82","23A628553168947D59DCC912042351377AC5FB32",[],"","secp160r1 : SECG curve over a 160 bit prime field"),C.crypto.ECParameterDB.regist("secp192k1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFEE37","0","3","FFFFFFFFFFFFFFFFFFFFFFFE26F2FC170F69466A74DEFD8D","1","DB4FF10EC057E9AE26B07D0280B7F4341DA5D1B1EAE06C7D","9B2F2F6D9C5628A7844163D015BE86344082AA88D95E2F9D",[]),C.crypto.ECParameterDB.regist("secp192r1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC","64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1","FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831","1","188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF1012","07192B95FFC8DA78631011ED6B24CDD573F977A11E794811",[]),C.crypto.ECParameterDB.regist("secp224r1",224,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE","B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4","FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D","1","B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21","BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34",[]),C.crypto.ECParameterDB.regist("secp256k1",256,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F","0","7","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141","1","79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798","483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8",[]),C.crypto.ECParameterDB.regist("secp256r1",256,"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC","5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B","FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551","1","6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296","4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5",["NIST P-256","P-256","prime256v1"]),C.crypto.ECParameterDB.regist("secp384r1",384,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFC","B3312FA7E23EE7E4988E056BE3F82D19181D9C6EFE8141120314088F5013875AC656398D8A2ED19D2A85C8EDD3EC2AEF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC7634D81F4372DDF581A0DB248B0A77AECEC196ACCC52973","1","AA87CA22BE8B05378EB1C71EF320AD746E1D3B628BA79B9859F741E082542A385502F25DBF55296C3A545E3872760AB7","3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f",["NIST P-384","P-384"]),C.crypto.ECParameterDB.regist("secp521r1",521,"1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC","051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409","1","C6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66","011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650",["NIST P-521","P-521"]);var $e=function(){var t=function(I,U,D){return e(M.AES,I,U,D)},e=function(I,U,D,B){var $=M.enc.Hex.parse(U),z=M.enc.Hex.parse(D),Q=M.enc.Hex.parse(B),ee={};ee.key=z,ee.iv=Q,ee.ciphertext=$;var S=I.decrypt(ee,z,{iv:Q});return M.enc.Hex.stringify(S)},i=function(I,U,D){return a(M.AES,I,U,D)},a=function(I,U,D,B){var $=M.enc.Hex.parse(U),z=M.enc.Hex.parse(D),Q=M.enc.Hex.parse(B),ee=I.encrypt($,z,{iv:Q}),S=M.enc.Hex.parse(ee.toString());return M.enc.Base64.stringify(S)},d={"AES-256-CBC":{proc:t,eproc:i,keylen:32,ivlen:16},"AES-192-CBC":{proc:t,eproc:i,keylen:24,ivlen:16},"AES-128-CBC":{proc:t,eproc:i,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:function(I,U,D){return e(M.TripleDES,I,U,D)},eproc:function(I,U,D){return a(M.TripleDES,I,U,D)},keylen:24,ivlen:8},"DES-CBC":{proc:function(I,U,D){return e(M.DES,I,U,D)},eproc:function(I,U,D){return a(M.DES,I,U,D)},keylen:8,ivlen:8}},v=function(I){var U={},D=I.match(new RegExp("DEK-Info: ([^,]+),([0-9A-Fa-f]+)","m"));D&&(U.cipher=D[1],U.ivsalt=D[2]);var B=I.match(new RegExp("-----BEGIN ([A-Z]+) PRIVATE KEY-----"));B&&(U.type=B[1]);var $=-1,z=0;I.indexOf(`\r
\r
`)!=-1&&($=I.indexOf(`\r
\r
`),z=2),I.indexOf(`

`)!=-1&&($=I.indexOf(`

`),z=1);var Q=I.indexOf("-----END");if($!=-1&&Q!=-1){var ee=I.substring($+2*z,Q-z);ee=ee.replace(/\s+/g,""),U.data=ee}return U},E=function(I,U,D){for(var B=D.substring(0,16),$=M.enc.Hex.parse(B),z=M.enc.Utf8.parse(U),Q=d[I].keylen+d[I].ivlen,ee="",S=null;;){var O=M.algo.MD5.create();if(S!=null&&O.update(S),O.update(z),O.update($),S=O.finalize(),(ee+=M.enc.Hex.stringify(S)).length>=2*Q)break}var N={};return N.keyhex=ee.substr(0,2*d[I].keylen),N.ivhex=ee.substr(2*d[I].keylen,2*d[I].ivlen),N},k=function(I,U,D,B){var $=M.enc.Base64.parse(I),z=M.enc.Hex.stringify($);return(0,d[U].proc)(z,D,B)};return{version:"1.0.0",parsePKCS5PEM:function(I){return v(I)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(I,U,D){return E(I,U,D)},decryptKeyB64:function(I,U,D,B){return k(I,U,D,B)},getDecryptedKeyHex:function(I,U){var D=v(I),B=D.cipher,$=D.ivsalt,z=D.data,Q=E(B,U,$).keyhex;return k(z,B,Q,$)},getEncryptedPKCS5PEMFromPrvKeyHex:function(I,U,D,B,$){var z="";if(B!==void 0&&B!=null||(B="AES-256-CBC"),d[B]===void 0)throw new Error("KEYUTIL unsupported algorithm: "+B);$!==void 0&&$!=null||($=function(S){var O=M.lib.WordArray.random(S);return M.enc.Hex.stringify(O)}(d[B].ivlen).toUpperCase());var Q=function(S,O,N,K){return(0,d[O].eproc)(S,N,K)}(U,B,E(B,D,$).keyhex,$);return z="-----BEGIN "+I+` PRIVATE KEY-----\r
`,z+=`Proc-Type: 4,ENCRYPTED\r
`,z+="DEK-Info: "+B+","+$+`\r
`,z+=`\r
`,z+=Q.replace(/(.{64})/g,`$1\r
`),z+=`\r
-----END `+I+` PRIVATE KEY-----\r
`},parseHexOfEncryptedPKCS8:function(I){var U=ue,D=U.getChildIdx,B=U.getV,$={},z=D(I,0);if(z.length!=2)throw new Error("malformed format: SEQUENCE(0).items != 2: "+z.length);$.ciphertext=B(I,z[1]);var Q=D(I,z[0]);if(Q.length!=2)throw new Error("malformed format: SEQUENCE(0.0).items != 2: "+Q.length);if(B(I,Q[0])!="2a864886f70d01050d")throw new Error("this only supports pkcs5PBES2");var ee=D(I,Q[1]);if(Q.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1).items != 2: "+ee.length);var S=D(I,ee[1]);if(S.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1.1).items != 2: "+S.length);if(B(I,S[0])!="2a864886f70d0307")throw"this only supports TripleDES";$.encryptionSchemeAlg="TripleDES",$.encryptionSchemeIV=B(I,S[1]);var O=D(I,ee[0]);if(O.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1.0).items != 2: "+O.length);if(B(I,O[0])!="2a864886f70d01050c")throw new Error("this only supports pkcs5PBKDF2");var N=D(I,O[1]);if(N.length<2)throw new Error("malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+N.length);$.pbkdf2Salt=B(I,N[0]);var K=B(I,N[1]);try{$.pbkdf2Iter=parseInt(K,16)}catch{throw new Error("malformed format pbkdf2Iter: "+K)}return $},getPBKDF2KeyHexFromParam:function(I,U){var D=M.enc.Hex.parse(I.pbkdf2Salt),B=I.pbkdf2Iter,$=M.PBKDF2(U,D,{keySize:6,iterations:B});return M.enc.Hex.stringify($)},_getPlainPKCS8HexFromEncryptedPKCS8PEM:function(I,U){var D=Wt(I,"ENCRYPTED PRIVATE KEY"),B=this.parseHexOfEncryptedPKCS8(D),$=$e.getPBKDF2KeyHexFromParam(B,U),z={};z.ciphertext=M.enc.Hex.parse(B.ciphertext);var Q=M.enc.Hex.parse($),ee=M.enc.Hex.parse(B.encryptionSchemeIV),S=M.TripleDES.decrypt(z,Q,{iv:ee});return M.enc.Hex.stringify(S)},getKeyFromEncryptedPKCS8PEM:function(I,U){var D=this._getPlainPKCS8HexFromEncryptedPKCS8PEM(I,U);return this.getKeyFromPlainPrivatePKCS8Hex(D)},parsePlainPrivatePKCS8Hex:function(I){var U=ue,D=U.getChildIdx,B=U.getV,$={algparam:null};if(I.substr(0,2)!="30")throw new Error("malformed plain PKCS8 private key(code:001)");var z=D(I,0);if(z.length<3)throw new Error("malformed plain PKCS8 private key(code:002)");if(I.substr(z[1],2)!="30")throw new Error("malformed PKCS8 private key(code:003)");var Q=D(I,z[1]);if(Q.length!=2)throw new Error("malformed PKCS8 private key(code:004)");if(I.substr(Q[0],2)!="06")throw new Error("malformed PKCS8 private key(code:005)");if($.algoid=B(I,Q[0]),I.substr(Q[1],2)=="06"&&($.algparam=B(I,Q[1])),I.substr(z[2],2)!="04")throw new Error("malformed PKCS8 private key(code:006)");return $.keyidx=U.getVidx(I,z[2]),$},getKeyFromPlainPrivatePKCS8PEM:function(I){var U=Wt(I,"PRIVATE KEY");return this.getKeyFromPlainPrivatePKCS8Hex(U)},getKeyFromPlainPrivatePKCS8Hex:function(I){var U,D=this.parsePlainPrivatePKCS8Hex(I);if(D.algoid=="2a864886f70d010101")U=new fe;else if(D.algoid=="2a8648ce380401")U=new C.crypto.DSA;else{if(D.algoid!="2a8648ce3d0201")throw new Error("unsupported private key algorithm");U=new C.crypto.ECDSA}return U.readPKCS8PrvKeyHex(I),U},_getKeyFromPublicPKCS8Hex:function(I){var U,D=ue.getVbyList(I,0,[0,0],"06");if(D==="2a864886f70d010101")U=new fe;else if(D==="2a8648ce380401")U=new C.crypto.DSA;else{if(D!=="2a8648ce3d0201")throw new Error("unsupported PKCS#8 public key hex");U=new C.crypto.ECDSA}return U.readPKCS8PubKeyHex(I),U},parsePublicRawRSAKeyHex:function(I){var U=ue,D=U.getChildIdx,B=U.getV,$={};if(I.substr(0,2)!="30")throw new Error("malformed RSA key(code:001)");var z=D(I,0);if(z.length!=2)throw new Error("malformed RSA key(code:002)");if(I.substr(z[0],2)!="02")throw new Error("malformed RSA key(code:003)");if($.n=B(I,z[0]),I.substr(z[1],2)!="02")throw new Error("malformed RSA key(code:004)");return $.e=B(I,z[1]),$},parsePublicPKCS8Hex:function(I){var U=ue,D=U.getChildIdx,B=U.getV,$={algparam:null},z=D(I,0);if(z.length!=2)throw new Error("outer DERSequence shall have 2 elements: "+z.length);var Q=z[0];if(I.substr(Q,2)!="30")throw new Error("malformed PKCS8 public key(code:001)");var ee=D(I,Q);if(ee.length!=2)throw new Error("malformed PKCS8 public key(code:002)");if(I.substr(ee[0],2)!="06")throw new Error("malformed PKCS8 public key(code:003)");if($.algoid=B(I,ee[0]),I.substr(ee[1],2)=="06"?$.algparam=B(I,ee[1]):I.substr(ee[1],2)=="30"&&($.algparam={},$.algparam.p=U.getVbyList(I,ee[1],[0],"02"),$.algparam.q=U.getVbyList(I,ee[1],[1],"02"),$.algparam.g=U.getVbyList(I,ee[1],[2],"02")),I.substr(z[1],2)!="03")throw new Error("malformed PKCS8 public key(code:004)");return $.key=B(I,z[1]).substr(2),$}}}();$e.getKey=function(t,e,i){var a=(ee=ue).getChildIdx,d=(ee.getV,ee.getVbyList),v=C.crypto,E=v.ECDSA,k=v.DSA,R=fe,I=Wt,U=$e;if(R!==void 0&&t instanceof R||E!==void 0&&t instanceof E||k!==void 0&&t instanceof k)return t;if(t.curve!==void 0&&t.xy!==void 0&&t.d===void 0)return new E({pub:t.xy,curve:t.curve});if(t.curve!==void 0&&t.d!==void 0)return new E({prv:t.d,curve:t.curve});if(t.kty===void 0&&t.n!==void 0&&t.e!==void 0&&t.d===void 0)return(ge=new R).setPublic(t.n,t.e),ge;if(t.kty===void 0&&t.n!==void 0&&t.e!==void 0&&t.d!==void 0&&t.p!==void 0&&t.q!==void 0&&t.dp!==void 0&&t.dq!==void 0&&t.co!==void 0&&t.qi===void 0)return(ge=new R).setPrivateEx(t.n,t.e,t.d,t.p,t.q,t.dp,t.dq,t.co),ge;if(t.kty===void 0&&t.n!==void 0&&t.e!==void 0&&t.d!==void 0&&t.p===void 0)return(ge=new R).setPrivate(t.n,t.e,t.d),ge;if(t.p!==void 0&&t.q!==void 0&&t.g!==void 0&&t.y!==void 0&&t.x===void 0)return(ge=new k).setPublic(t.p,t.q,t.g,t.y),ge;if(t.p!==void 0&&t.q!==void 0&&t.g!==void 0&&t.y!==void 0&&t.x!==void 0)return(ge=new k).setPrivate(t.p,t.q,t.g,t.y,t.x),ge;if(t.kty==="RSA"&&t.n!==void 0&&t.e!==void 0&&t.d===void 0)return(ge=new R).setPublic(Oe(t.n),Oe(t.e)),ge;if(t.kty==="RSA"&&t.n!==void 0&&t.e!==void 0&&t.d!==void 0&&t.p!==void 0&&t.q!==void 0&&t.dp!==void 0&&t.dq!==void 0&&t.qi!==void 0)return(ge=new R).setPrivateEx(Oe(t.n),Oe(t.e),Oe(t.d),Oe(t.p),Oe(t.q),Oe(t.dp),Oe(t.dq),Oe(t.qi)),ge;if(t.kty==="RSA"&&t.n!==void 0&&t.e!==void 0&&t.d!==void 0)return(ge=new R).setPrivate(Oe(t.n),Oe(t.e),Oe(t.d)),ge;if(t.kty==="EC"&&t.crv!==void 0&&t.x!==void 0&&t.y!==void 0&&t.d===void 0){var D=(ce=new E({curve:t.crv})).ecparams.keylen/4,B="04"+("0000000000"+Oe(t.x)).slice(-D)+("0000000000"+Oe(t.y)).slice(-D);return ce.setPublicKeyHex(B),ce}if(t.kty==="EC"&&t.crv!==void 0&&t.x!==void 0&&t.y!==void 0&&t.d!==void 0){D=(ce=new E({curve:t.crv})).ecparams.keylen/4,B="04"+("0000000000"+Oe(t.x)).slice(-D)+("0000000000"+Oe(t.y)).slice(-D);var $=("0000000000"+Oe(t.d)).slice(-D);return ce.setPublicKeyHex(B),ce.setPrivateKeyHex($),ce}if(i==="pkcs5prv"){var z,Q=t,ee=ue;if((z=a(Q,0)).length===9)(ge=new R).readPKCS5PrvKeyHex(Q);else if(z.length===6)(ge=new k).readPKCS5PrvKeyHex(Q);else{if(!(z.length>2&&Q.substr(z[1],2)==="04"))throw new Error("unsupported PKCS#1/5 hexadecimal key");(ge=new E).readPKCS5PrvKeyHex(Q)}return ge}if(i==="pkcs8prv")return ge=U.getKeyFromPlainPrivatePKCS8Hex(t);if(i==="pkcs8pub")return U._getKeyFromPublicPKCS8Hex(t);if(i==="x509pub")return Ze.getPublicKeyFromCertHex(t);if(t.indexOf("-END CERTIFICATE-",0)!=-1||t.indexOf("-END X509 CERTIFICATE-",0)!=-1||t.indexOf("-END TRUSTED CERTIFICATE-",0)!=-1)return Ze.getPublicKeyFromCertPEM(t);if(t.indexOf("-END PUBLIC KEY-")!=-1){var S=Wt(t,"PUBLIC KEY");return U._getKeyFromPublicPKCS8Hex(S)}if(t.indexOf("-END RSA PRIVATE KEY-")!=-1&&t.indexOf("4,ENCRYPTED")==-1){var O=I(t,"RSA PRIVATE KEY");return U.getKey(O,null,"pkcs5prv")}if(t.indexOf("-END DSA PRIVATE KEY-")!=-1&&t.indexOf("4,ENCRYPTED")==-1){var N=d(De=I(t,"DSA PRIVATE KEY"),0,[1],"02"),K=d(De,0,[2],"02"),Y=d(De,0,[3],"02"),te=d(De,0,[4],"02"),de=d(De,0,[5],"02");return(ge=new k).setPrivate(new W(N,16),new W(K,16),new W(Y,16),new W(te,16),new W(de,16)),ge}if(t.indexOf("-END EC PRIVATE KEY-")!=-1&&t.indexOf("4,ENCRYPTED")==-1)return O=I(t,"EC PRIVATE KEY"),U.getKey(O,null,"pkcs5prv");if(t.indexOf("-END PRIVATE KEY-")!=-1)return U.getKeyFromPlainPrivatePKCS8PEM(t);if(t.indexOf("-END RSA PRIVATE KEY-")!=-1&&t.indexOf("4,ENCRYPTED")!=-1){var se=U.getDecryptedKeyHex(t,e),we=new fe;return we.readPKCS5PrvKeyHex(se),we}if(t.indexOf("-END EC PRIVATE KEY-")!=-1&&t.indexOf("4,ENCRYPTED")!=-1){var ce,ge=d(De=U.getDecryptedKeyHex(t,e),0,[1],"04"),Ue=d(De,0,[2,0],"06"),Ne=d(De,0,[3,0],"03").substr(2);if(C.crypto.OID.oidhex2name[Ue]===void 0)throw new Error("undefined OID(hex) in KJUR.crypto.OID: "+Ue);return(ce=new E({curve:C.crypto.OID.oidhex2name[Ue]})).setPublicKeyHex(Ne),ce.setPrivateKeyHex(ge),ce.isPublic=!1,ce}if(t.indexOf("-END DSA PRIVATE KEY-")!=-1&&t.indexOf("4,ENCRYPTED")!=-1){var De;return N=d(De=U.getDecryptedKeyHex(t,e),0,[1],"02"),K=d(De,0,[2],"02"),Y=d(De,0,[3],"02"),te=d(De,0,[4],"02"),de=d(De,0,[5],"02"),(ge=new k).setPrivate(new W(N,16),new W(K,16),new W(Y,16),new W(te,16),new W(de,16)),ge}if(t.indexOf("-END ENCRYPTED PRIVATE KEY-")!=-1)return U.getKeyFromEncryptedPKCS8PEM(t,e);throw new Error("not supported argument")},$e.generateKeypair=function(t,e){if(t=="RSA"){var i=e;(E=new fe).generate(i,"10001"),E.isPrivate=!0,E.isPublic=!0;var a=new fe,d=E.n.toString(16),v=E.e.toString(16);return a.setPublic(d,v),a.isPrivate=!1,a.isPublic=!0,(k={}).prvKeyObj=E,k.pubKeyObj=a,k}if(t=="EC"){var E,k,R=e,I=new C.crypto.ECDSA({curve:R}).generateKeyPairHex();return(E=new C.crypto.ECDSA({curve:R})).setPublicKeyHex(I.ecpubhex),E.setPrivateKeyHex(I.ecprvhex),E.isPrivate=!0,E.isPublic=!1,(a=new C.crypto.ECDSA({curve:R})).setPublicKeyHex(I.ecpubhex),a.isPrivate=!1,a.isPublic=!0,(k={}).prvKeyObj=E,k.pubKeyObj=a,k}throw new Error("unknown algorithm: "+t)},$e.getPEM=function(t,e,i,a,d,v){var E=C,k=E.asn1,R=k.DERObjectIdentifier,I=k.DERInteger,U=k.ASN1Util.newObject,D=k.x509.SubjectPublicKeyInfo,B=E.crypto,$=B.DSA,z=B.ECDSA,Q=fe;function ee(ce){return U({seq:[{int:0},{int:{bigint:ce.n}},{int:ce.e},{int:{bigint:ce.d}},{int:{bigint:ce.p}},{int:{bigint:ce.q}},{int:{bigint:ce.dmp1}},{int:{bigint:ce.dmq1}},{int:{bigint:ce.coeff}}]})}function S(ce){return U({seq:[{int:1},{octstr:{hex:ce.prvKeyHex}},{tag:["a0",!0,{oid:{name:ce.curveName}}]},{tag:["a1",!0,{bitstr:{hex:"00"+ce.pubKeyHex}}]}]})}function O(ce){return U({seq:[{int:0},{int:{bigint:ce.p}},{int:{bigint:ce.q}},{int:{bigint:ce.g}},{int:{bigint:ce.y}},{int:{bigint:ce.x}}]})}if((Q!==void 0&&t instanceof Q||$!==void 0&&t instanceof $||z!==void 0&&t instanceof z)&&t.isPublic==1&&(e===void 0||e=="PKCS8PUB"))return bt(te=new D(t).getEncodedHex(),"PUBLIC KEY");if(e=="PKCS1PRV"&&Q!==void 0&&t instanceof Q&&(i===void 0||i==null)&&t.isPrivate==1)return bt(te=ee(t).getEncodedHex(),"RSA PRIVATE KEY");if(e=="PKCS1PRV"&&z!==void 0&&t instanceof z&&(i===void 0||i==null)&&t.isPrivate==1){var N=new R({name:t.curveName}).getEncodedHex(),K=S(t).getEncodedHex(),Y="";return Y+=bt(N,"EC PARAMETERS"),Y+=bt(K,"EC PRIVATE KEY")}if(e=="PKCS1PRV"&&$!==void 0&&t instanceof $&&(i===void 0||i==null)&&t.isPrivate==1)return bt(te=O(t).getEncodedHex(),"DSA PRIVATE KEY");if(e=="PKCS5PRV"&&Q!==void 0&&t instanceof Q&&i!==void 0&&i!=null&&t.isPrivate==1){var te=ee(t).getEncodedHex();return a===void 0&&(a="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",te,i,a,v)}if(e=="PKCS5PRV"&&z!==void 0&&t instanceof z&&i!==void 0&&i!=null&&t.isPrivate==1)return te=S(t).getEncodedHex(),a===void 0&&(a="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("EC",te,i,a,v);if(e=="PKCS5PRV"&&$!==void 0&&t instanceof $&&i!==void 0&&i!=null&&t.isPrivate==1)return te=O(t).getEncodedHex(),a===void 0&&(a="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("DSA",te,i,a,v);var de=function(ge,Ue){var Ne=se(ge,Ue);return new U({seq:[{seq:[{oid:{name:"pkcs5PBES2"}},{seq:[{seq:[{oid:{name:"pkcs5PBKDF2"}},{seq:[{octstr:{hex:Ne.pbkdf2Salt}},{int:Ne.pbkdf2Iter}]}]},{seq:[{oid:{name:"des-EDE3-CBC"}},{octstr:{hex:Ne.encryptionSchemeIV}}]}]}]},{octstr:{hex:Ne.ciphertext}}]}).getEncodedHex()},se=function(ge,Ue){var Ne=M.lib.WordArray.random(8),De=M.lib.WordArray.random(8),Ft=M.PBKDF2(Ue,Ne,{keySize:6,iterations:100}),ht=M.enc.Hex.parse(ge),vt=M.TripleDES.encrypt(ht,Ft,{iv:De})+"",We={};return We.ciphertext=vt,We.pbkdf2Salt=M.enc.Hex.stringify(Ne),We.pbkdf2Iter=100,We.encryptionSchemeAlg="DES-EDE3-CBC",We.encryptionSchemeIV=M.enc.Hex.stringify(De),We};if(e=="PKCS8PRV"&&Q!=null&&t instanceof Q&&t.isPrivate==1){var we=ee(t).getEncodedHex();return te=U({seq:[{int:0},{seq:[{oid:{name:"rsaEncryption"}},{null:!0}]},{octstr:{hex:we}}]}).getEncodedHex(),i===void 0||i==null?bt(te,"PRIVATE KEY"):bt(K=de(te,i),"ENCRYPTED PRIVATE KEY")}if(e=="PKCS8PRV"&&z!==void 0&&t instanceof z&&t.isPrivate==1)return we=new U({seq:[{int:1},{octstr:{hex:t.prvKeyHex}},{tag:["a1",!0,{bitstr:{hex:"00"+t.pubKeyHex}}]}]}).getEncodedHex(),te=U({seq:[{int:0},{seq:[{oid:{name:"ecPublicKey"}},{oid:{name:t.curveName}}]},{octstr:{hex:we}}]}).getEncodedHex(),i===void 0||i==null?bt(te,"PRIVATE KEY"):bt(K=de(te,i),"ENCRYPTED PRIVATE KEY");if(e=="PKCS8PRV"&&$!==void 0&&t instanceof $&&t.isPrivate==1)return we=new I({bigint:t.x}).getEncodedHex(),te=U({seq:[{int:0},{seq:[{oid:{name:"dsa"}},{seq:[{int:{bigint:t.p}},{int:{bigint:t.q}},{int:{bigint:t.g}}]}]},{octstr:{hex:we}}]}).getEncodedHex(),i===void 0||i==null?bt(te,"PRIVATE KEY"):bt(K=de(te,i),"ENCRYPTED PRIVATE KEY");throw new Error("unsupported object nor format")},$e.getKeyFromCSRPEM=function(t){var e=Wt(t,"CERTIFICATE REQUEST");return $e.getKeyFromCSRHex(e)},$e.getKeyFromCSRHex=function(t){var e=$e.parseCSRHex(t);return $e.getKey(e.p8pubkeyhex,null,"pkcs8pub")},$e.parseCSRHex=function(t){var e=ue,i=e.getChildIdx,a=e.getTLV,d={},v=t;if(v.substr(0,2)!="30")throw new Error("malformed CSR(code:001)");var E=i(v,0);if(E.length<1)throw new Error("malformed CSR(code:002)");if(v.substr(E[0],2)!="30")throw new Error("malformed CSR(code:003)");var k=i(v,E[0]);if(k.length<3)throw new Error("malformed CSR(code:004)");return d.p8pubkeyhex=a(v,k[2]),d},$e.getKeyID=function(t){var e=$e,i=ue;typeof t=="string"&&t.indexOf("BEGIN ")!=-1&&(t=e.getKey(t));var a=Wt(e.getPEM(t)),d=i.getIdxbyList(a,0,[1]),v=i.getV(a,d).substring(2);return C.crypto.Util.hashHex(v,"sha1")},$e.getJWKFromKey=function(t){var e={};if(t instanceof fe&&t.isPrivate)return e.kty="RSA",e.n=Xe(t.n.toString(16)),e.e=Xe(t.e.toString(16)),e.d=Xe(t.d.toString(16)),e.p=Xe(t.p.toString(16)),e.q=Xe(t.q.toString(16)),e.dp=Xe(t.dmp1.toString(16)),e.dq=Xe(t.dmq1.toString(16)),e.qi=Xe(t.coeff.toString(16)),e;if(t instanceof fe&&t.isPublic)return e.kty="RSA",e.n=Xe(t.n.toString(16)),e.e=Xe(t.e.toString(16)),e;if(t instanceof C.crypto.ECDSA&&t.isPrivate){if((a=t.getShortNISTPCurveName())!=="P-256"&&a!=="P-384")throw new Error("unsupported curve name for JWT: "+a);var i=t.getPublicKeyXYHex();return e.kty="EC",e.crv=a,e.x=Xe(i.x),e.y=Xe(i.y),e.d=Xe(t.prvKeyHex),e}if(t instanceof C.crypto.ECDSA&&t.isPublic){var a;if((a=t.getShortNISTPCurveName())!=="P-256"&&a!=="P-384")throw new Error("unsupported curve name for JWT: "+a);return i=t.getPublicKeyXYHex(),e.kty="EC",e.crv=a,e.x=Xe(i.x),e.y=Xe(i.y),e}throw new Error("not supported key object")},fe.getPosArrayOfChildrenFromHex=function(t){return ue.getChildIdx(t,0)},fe.getHexValueArrayOfChildrenFromHex=function(t){var e,i=ue.getV,a=i(t,(e=fe.getPosArrayOfChildrenFromHex(t))[0]),d=i(t,e[1]),v=i(t,e[2]),E=i(t,e[3]),k=i(t,e[4]),R=i(t,e[5]),I=i(t,e[6]),U=i(t,e[7]),D=i(t,e[8]);return(e=new Array).push(a,d,v,E,k,R,I,U,D),e},fe.prototype.readPrivateKeyFromPEMString=function(t){var e=Wt(t),i=fe.getHexValueArrayOfChildrenFromHex(e);this.setPrivateEx(i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8])},fe.prototype.readPKCS5PrvKeyHex=function(t){var e=fe.getHexValueArrayOfChildrenFromHex(t);this.setPrivateEx(e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},fe.prototype.readPKCS8PrvKeyHex=function(t){var e,i,a,d,v,E,k,R,I=ue,U=I.getVbyListEx;if(I.isASN1HEX(t)===!1)throw new Error("not ASN.1 hex string");try{e=U(t,0,[2,0,1],"02"),i=U(t,0,[2,0,2],"02"),a=U(t,0,[2,0,3],"02"),d=U(t,0,[2,0,4],"02"),v=U(t,0,[2,0,5],"02"),E=U(t,0,[2,0,6],"02"),k=U(t,0,[2,0,7],"02"),R=U(t,0,[2,0,8],"02")}catch{throw new Error("malformed PKCS#8 plain RSA private key")}this.setPrivateEx(e,i,a,d,v,E,k,R)},fe.prototype.readPKCS5PubKeyHex=function(t){var e=ue,i=e.getV;if(e.isASN1HEX(t)===!1)throw new Error("keyHex is not ASN.1 hex string");var a=e.getChildIdx(t,0);if(a.length!==2||t.substr(a[0],2)!=="02"||t.substr(a[1],2)!=="02")throw new Error("wrong hex for PKCS#5 public key");var d=i(t,a[0]),v=i(t,a[1]);this.setPublic(d,v)},fe.prototype.readPKCS8PubKeyHex=function(t){var e=ue;if(e.isASN1HEX(t)===!1)throw new Error("not ASN.1 hex string");if(e.getTLVbyListEx(t,0,[0,0])!=="06092a864886f70d010101")throw new Error("not PKCS8 RSA public key");var i=e.getTLVbyListEx(t,0,[1,0]);this.readPKCS5PubKeyHex(i)},fe.prototype.readCertPubKeyHex=function(t,e){var i,a;(i=new Ze).readCertHex(t),a=i.getPublicKeyHex(),this.readPKCS8PubKeyHex(a)};function qi(t,e){for(var i="",a=e/4-t.length,d=0;d<a;d++)i+="0";return i+t}function $i(t,e,i){for(var a="",d=0;a.length<e;)a+=kt(i(jt(t+String.fromCharCode.apply(String,[(4278190080&d)>>24,(16711680&d)>>16,(65280&d)>>8,255&d])))),d+=1;return a}function Gi(t){for(var e in C.crypto.Util.DIGESTINFOHEAD){var i=C.crypto.Util.DIGESTINFOHEAD[e],a=i.length;if(t.substring(0,a)==i)return[e,t.substring(a)]}return[]}function Ze(t){var e,i=ue,a=i.getChildIdx,d=i.getV,v=i.getTLV,E=i.getVbyList,k=i.getVbyListEx,R=i.getTLVbyList,I=i.getTLVbyListEx,U=i.getIdxbyList,D=i.getIdxbyListEx,B=i.getVidx,$=i.getInt,z=i.oidname,Q=i.hextooidstr,ee=Wt;try{e=C.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV}catch{}this.HEX2STAG={"0c":"utf8",13:"prn",16:"ia5","1a":"vis","1e":"bmp"},this.hex=null,this.version=0,this.foffset=0,this.aExtInfo=null,this.getVersion=function(){if(this.hex===null||this.version!==0)return this.version;var S=R(this.hex,0,[0,0]);if(S.substr(0,2)=="a0"){var O=R(S,0,[0]),N=$(O,0);if(N<0||2<N)throw new Error("malformed version field");return this.version=N+1,this.version}return this.version=1,this.foffset=-1,1},this.getSerialNumberHex=function(){return k(this.hex,0,[0,0],"02")},this.getSignatureAlgorithmField=function(){var S=I(this.hex,0,[0,1]);return this.getAlgorithmIdentifierName(S)},this.getAlgorithmIdentifierName=function(S){for(var O in e)if(S===e[O])return O;return z(k(S,0,[0],"06"))},this.getIssuer=function(){return this.getX500Name(this.getIssuerHex())},this.getIssuerHex=function(){return R(this.hex,0,[0,3+this.foffset],"30")},this.getIssuerString=function(){return this.getIssuer().str},this.getSubject=function(){return this.getX500Name(this.getSubjectHex())},this.getSubjectHex=function(){return R(this.hex,0,[0,5+this.foffset],"30")},this.getSubjectString=function(){return this.getSubject().str},this.getNotBefore=function(){var S=E(this.hex,0,[0,4+this.foffset,0]);return S=S.replace(/(..)/g,"%$1"),S=decodeURIComponent(S)},this.getNotAfter=function(){var S=E(this.hex,0,[0,4+this.foffset,1]);return S=S.replace(/(..)/g,"%$1"),S=decodeURIComponent(S)},this.getPublicKeyHex=function(){return i.getTLVbyList(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyIdx=function(){return U(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyContentIdx=function(){var S=this.getPublicKeyIdx();return U(this.hex,S,[1,0],"30")},this.getPublicKey=function(){return $e.getKey(this.getPublicKeyHex(),null,"pkcs8pub")},this.getSignatureAlgorithmName=function(){var S=R(this.hex,0,[1],"30");return this.getAlgorithmIdentifierName(S)},this.getSignatureValueHex=function(){return E(this.hex,0,[2],"03",!0)},this.verifySignature=function(S){var O=this.getSignatureAlgorithmField(),N=this.getSignatureValueHex(),K=R(this.hex,0,[0],"30"),Y=new C.crypto.Signature({alg:O});return Y.init(S),Y.updateHex(K),Y.verify(N)},this.parseExt=function(S){var O,N,K;if(S===void 0){if(K=this.hex,this.version!==3)return-1;O=U(K,0,[0,7,0],"30"),N=a(K,O)}else{K=Wt(S);var Y=U(K,0,[0,3,0,0],"06");if(d(K,Y)!="2a864886f70d01090e")return void(this.aExtInfo=new Array);O=U(K,0,[0,3,0,1,0],"30"),N=a(K,O),this.hex=K}this.aExtInfo=new Array;for(var te=0;te<N.length;te++){var de={critical:!1},se=0;a(K,N[te]).length===3&&(de.critical=!0,se=1),de.oid=i.hextooidstr(E(K,N[te],[0],"06"));var we=U(K,N[te],[1+se]);de.vidx=B(K,we),this.aExtInfo.push(de)}},this.getExtInfo=function(S){var O=this.aExtInfo,N=S;if(S.match(/^[0-9.]+$/)||(N=C.asn1.x509.OID.name2oid(S)),N!==""){for(var K=0;K<O.length;K++)if(O[K].oid===N)return O[K]}},this.getExtBasicConstraints=function(S,O){if(S===void 0&&O===void 0){var N=this.getExtInfo("basicConstraints");if(N===void 0)return;S=v(this.hex,N.vidx),O=N.critical}var K={extname:"basicConstraints"};if(O&&(K.critical=!0),S==="3000")return K;if(S==="30030101ff")return K.cA=!0,K;if(S.substr(0,12)==="30060101ff02"){var Y=d(S,10),te=parseInt(Y,16);return K.cA=!0,K.pathLen=te,K}throw new Error("hExtV parse error: "+S)},this.getExtKeyUsage=function(S,O){if(S===void 0&&O===void 0){var N=this.getExtInfo("keyUsage");if(N===void 0)return;S=v(this.hex,N.vidx),O=N.critical}var K={extname:"keyUsage"};return O&&(K.critical=!0),K.names=this.getExtKeyUsageString(S).split(","),K},this.getExtKeyUsageBin=function(S){if(S===void 0){var O=this.getExtInfo("keyUsage");if(O===void 0)return"";S=v(this.hex,O.vidx)}if(S.length!=8&&S.length!=10)throw new Error("malformed key usage value: "+S);var N="000000000000000"+parseInt(S.substr(6),16).toString(2);return S.length==8&&(N=N.slice(-8)),S.length==10&&(N=N.slice(-16)),(N=N.replace(/0+$/,""))==""&&(N="0"),N},this.getExtKeyUsageString=function(S){for(var O=this.getExtKeyUsageBin(S),N=new Array,K=0;K<O.length;K++)O.substr(K,1)=="1"&&N.push(Ze.KEYUSAGE_NAME[K]);return N.join(",")},this.getExtSubjectKeyIdentifier=function(S,O){if(S===void 0&&O===void 0){var N=this.getExtInfo("subjectKeyIdentifier");if(N===void 0)return;S=v(this.hex,N.vidx),O=N.critical}var K={extname:"subjectKeyIdentifier"};O&&(K.critical=!0);var Y=d(S,0);return K.kid={hex:Y},K},this.getExtAuthorityKeyIdentifier=function(S,O){if(S===void 0&&O===void 0){var N=this.getExtInfo("authorityKeyIdentifier");if(N===void 0)return;S=v(this.hex,N.vidx),O=N.critical}var K={extname:"authorityKeyIdentifier"};O&&(K.critical=!0);for(var Y=a(S,0),te=0;te<Y.length;te++){var de=S.substr(Y[te],2);if(de==="80"&&(K.kid={hex:d(S,Y[te])}),de==="a1"){var se=v(S,Y[te]),we=this.getGeneralNames(se);K.issuer=we[0].dn}de==="82"&&(K.sn={hex:d(S,Y[te])})}return K},this.getExtExtKeyUsage=function(S,O){if(S===void 0&&O===void 0){var N=this.getExtInfo("extKeyUsage");if(N===void 0)return;S=v(this.hex,N.vidx),O=N.critical}var K={extname:"extKeyUsage",array:[]};O&&(K.critical=!0);for(var Y=a(S,0),te=0;te<Y.length;te++)K.array.push(z(d(S,Y[te])));return K},this.getExtExtKeyUsageName=function(){var S=this.getExtInfo("extKeyUsage");if(S===void 0)return S;var O=new Array,N=v(this.hex,S.vidx);if(N==="")return O;for(var K=a(N,0),Y=0;Y<K.length;Y++)O.push(z(d(N,K[Y])));return O},this.getExtSubjectAltName=function(S,O){if(S===void 0&&O===void 0){var N=this.getExtInfo("subjectAltName");if(N===void 0)return;S=v(this.hex,N.vidx),O=N.critical}var K={extname:"subjectAltName",array:[]};return O&&(K.critical=!0),K.array=this.getGeneralNames(S),K},this.getExtIssuerAltName=function(S,O){if(S===void 0&&O===void 0){var N=this.getExtInfo("issuerAltName");if(N===void 0)return;S=v(this.hex,N.vidx),O=N.critical}var K={extname:"issuerAltName",array:[]};return O&&(K.critical=!0),K.array=this.getGeneralNames(S),K},this.getGeneralNames=function(S){for(var O=a(S,0),N=[],K=0;K<O.length;K++){var Y=this.getGeneralName(v(S,O[K]));Y!==void 0&&N.push(Y)}return N},this.getGeneralName=function(S){var O=S.substr(0,2),N=d(S,0),K=kt(N);return O=="81"?{rfc822:K}:O=="82"?{dns:K}:O=="86"?{uri:K}:O=="87"?{ip:Tn(N)}:O=="a4"?{dn:this.getX500Name(N)}:void 0},this.getExtSubjectAltName2=function(){var S,O,N,K=this.getExtInfo("subjectAltName");if(K===void 0)return K;for(var Y=new Array,te=v(this.hex,K.vidx),de=a(te,0),se=0;se<de.length;se++)N=te.substr(de[se],2),S=d(te,de[se]),N==="81"&&(O=Qe(S),Y.push(["MAIL",O])),N==="82"&&(O=Qe(S),Y.push(["DNS",O])),N==="84"&&(O=Ze.hex2dn(S,0),Y.push(["DN",O])),N==="86"&&(O=Qe(S),Y.push(["URI",O])),N==="87"&&(O=Tn(S),Y.push(["IP",O]));return Y},this.getExtCRLDistributionPoints=function(S,O){if(S===void 0&&O===void 0){var N=this.getExtInfo("cRLDistributionPoints");if(N===void 0)return;S=v(this.hex,N.vidx),O=N.critical}var K={extname:"cRLDistributionPoints",array:[]};O&&(K.critical=!0);for(var Y=a(S,0),te=0;te<Y.length;te++){var de=v(S,Y[te]);K.array.push(this.getDistributionPoint(de))}return K},this.getDistributionPoint=function(S){for(var O={},N=a(S,0),K=0;K<N.length;K++){var Y=S.substr(N[K],2),te=v(S,N[K]);Y=="a0"&&(O.dpname=this.getDistributionPointName(te))}return O},this.getDistributionPointName=function(S){for(var O={},N=a(S,0),K=0;K<N.length;K++){var Y=S.substr(N[K],2),te=v(S,N[K]);Y=="a0"&&(O.full=this.getGeneralNames(te))}return O},this.getExtCRLDistributionPointsURI=function(){var S=this.getExtInfo("cRLDistributionPoints");if(S===void 0)return S;for(var O=new Array,N=a(this.hex,S.vidx),K=0;K<N.length;K++)try{var Y=Qe(E(this.hex,N[K],[0,0,0],"86"));O.push(Y)}catch{}return O},this.getExtAIAInfo=function(){var S=this.getExtInfo("authorityInfoAccess");if(S===void 0)return S;for(var O={ocsp:[],caissuer:[]},N=a(this.hex,S.vidx),K=0;K<N.length;K++){var Y=E(this.hex,N[K],[0],"06"),te=E(this.hex,N[K],[1],"86");Y==="2b06010505073001"&&O.ocsp.push(Qe(te)),Y==="2b06010505073002"&&O.caissuer.push(Qe(te))}return O},this.getExtAuthorityInfoAccess=function(S,O){if(S===void 0&&O===void 0){var N=this.getExtInfo("authorityInfoAccess");if(N===void 0)return;S=v(this.hex,N.vidx),O=N.critical}var K={extname:"authorityInfoAccess",array:[]};O&&(K.critical=!0);for(var Y=a(S,0),te=0;te<Y.length;te++){var de=k(S,Y[te],[0],"06"),se=Qe(E(S,Y[te],[1],"86"));if(de=="2b06010505073001")K.array.push({ocsp:se});else{if(de!="2b06010505073002")throw new Error("unknown method: "+de);K.array.push({caissuer:se})}}return K},this.getExtCertificatePolicies=function(S,O){if(S===void 0&&O===void 0){var N=this.getExtInfo("certificatePolicies");if(N===void 0)return;S=v(this.hex,N.vidx),O=N.critical}var K={extname:"certificatePolicies",array:[]};O&&(K.critical=!0);for(var Y=a(S,0),te=0;te<Y.length;te++){var de=v(S,Y[te]),se=this.getPolicyInformation(de);K.array.push(se)}return K},this.getPolicyInformation=function(S){var O={},N=E(S,0,[0],"06");O.policyoid=z(N);var K=D(S,0,[1],"30");if(K!=-1){O.array=[];for(var Y=a(S,K),te=0;te<Y.length;te++){var de=v(S,Y[te]),se=this.getPolicyQualifierInfo(de);O.array.push(se)}}return O},this.getPolicyQualifierInfo=function(S){var O={},N=E(S,0,[0],"06");if(N==="2b06010505070201"){var K=k(S,0,[1],"16");O.cps=kt(K)}else if(N==="2b06010505070202"){var Y=R(S,0,[1],"30");O.unotice=this.getUserNotice(Y)}return O},this.getUserNotice=function(S){for(var O={},N=a(S,0),K=0;K<N.length;K++){var Y=v(S,N[K]);Y.substr(0,2)!="30"&&(O.exptext=this.getDisplayText(Y))}return O},this.getDisplayText=function(S){var O={};return O.type={"0c":"utf8",16:"ia5","1a":"vis","1e":"bmp"}[S.substr(0,2)],O.str=kt(d(S,0)),O},this.getExtCRLNumber=function(S,O){var N={extname:"cRLNumber"};if(O&&(N.critical=!0),S.substr(0,2)=="02")return N.num={hex:d(S,0)},N;throw new Error("hExtV parse error: "+S)},this.getExtCRLReason=function(S,O){var N={extname:"cRLReason"};if(O&&(N.critical=!0),S.substr(0,2)=="0a")return N.code=parseInt(d(S,0),16),N;throw new Error("hExtV parse error: "+S)},this.getExtOcspNonce=function(S,O){var N={extname:"ocspNonce"};O&&(N.critical=!0);var K=d(S,0);return N.hex=K,N},this.getExtOcspNoCheck=function(S,O){var N={extname:"ocspNoCheck"};return O&&(N.critical=!0),N},this.getExtAdobeTimeStamp=function(S,O){if(S===void 0&&O===void 0){var N=this.getExtInfo("adobeTimeStamp");if(N===void 0)return;S=v(this.hex,N.vidx),O=N.critical}var K={extname:"adobeTimeStamp"};O&&(K.critical=!0);var Y=a(S,0);if(Y.length>1){var te=v(S,Y[1]),de=this.getGeneralName(te);de.uri!=null&&(K.uri=de.uri)}if(Y.length>2){var se=v(S,Y[2]);se=="0101ff"&&(K.reqauth=!0),se=="010100"&&(K.reqauth=!1)}return K},this.getX500NameRule=function(S){for(var O=null,N=[],K=0;K<S.length;K++)for(var Y=S[K],te=0;te<Y.length;te++)N.push(Y[te]);for(K=0;K<N.length;K++){var de=N[K],se=de.ds,we=de.value,ce=de.type;if(se!="prn"&&se!="utf8"&&se!="ia5")return"mixed";if(se=="ia5"){if(ce!="CN")return"mixed";if(C.lang.String.isMail(we))continue;return"mixed"}if(ce=="C"){if(se=="prn")continue;return"mixed"}if(O==null)O=se;else if(O!==se)return"mixed"}return O==null?"prn":O},this.getX500Name=function(S){var O=this.getX500NameArray(S);return{array:O,str:this.dnarraytostr(O)}},this.getX500NameArray=function(S){for(var O=[],N=a(S,0),K=0;K<N.length;K++)O.push(this.getRDN(v(S,N[K])));return O},this.getRDN=function(S){for(var O=[],N=a(S,0),K=0;K<N.length;K++)O.push(this.getAttrTypeAndValue(v(S,N[K])));return O},this.getAttrTypeAndValue=function(S){var O={type:null,value:null,ds:null},N=a(S,0),K=E(S,N[0],[],"06"),Y=E(S,N[1],[]),te=C.asn1.ASN1Util.oidHexToInt(K);return O.type=C.asn1.x509.OID.oid2atype(te),O.ds=this.HEX2STAG[S.substr(N[1],2)],O.ds!="bmp"?O.value=Qe(Y):O.value=Wi(Y),O},this.readCertPEM=function(S){this.readCertHex(ee(S))},this.readCertHex=function(S){this.hex=S,this.getVersion();try{U(this.hex,0,[0,7],"a3"),this.parseExt()}catch{}},this.getParam=function(){var S={};return S.version=this.getVersion(),S.serial={hex:this.getSerialNumberHex()},S.sigalg=this.getSignatureAlgorithmField(),S.issuer=this.getIssuer(),S.notbefore=this.getNotBefore(),S.notafter=this.getNotAfter(),S.subject=this.getSubject(),S.sbjpubkey=bt(this.getPublicKeyHex(),"PUBLIC KEY"),this.aExtInfo.length>0&&(S.ext=this.getExtParamArray()),S.sighex=this.getSignatureValueHex(),S},this.getExtParamArray=function(S){S==null&&D(this.hex,0,[0,"[3]"])!=-1&&(S=I(this.hex,0,[0,"[3]",0],"30"));for(var O=[],N=a(S,0),K=0;K<N.length;K++){var Y=v(S,N[K]),te=this.getExtParam(Y);te!=null&&O.push(te)}return O},this.getExtParam=function(S){var O=a(S,0).length;if(O!=2&&O!=3)throw new Error("wrong number elements in Extension: "+O+" "+S);var N=Q(E(S,0,[0],"06")),K=!1;O==3&&R(S,0,[1])=="0101ff"&&(K=!0);var Y=R(S,0,[O-1,0]),te=void 0;if(N=="2.5.29.14"?te=this.getExtSubjectKeyIdentifier(Y,K):N=="2.5.29.15"?te=this.getExtKeyUsage(Y,K):N=="2.5.29.17"?te=this.getExtSubjectAltName(Y,K):N=="2.5.29.18"?te=this.getExtIssuerAltName(Y,K):N=="2.5.29.19"?te=this.getExtBasicConstraints(Y,K):N=="2.5.29.31"?te=this.getExtCRLDistributionPoints(Y,K):N=="2.5.29.32"?te=this.getExtCertificatePolicies(Y,K):N=="2.5.29.35"?te=this.getExtAuthorityKeyIdentifier(Y,K):N=="2.5.29.37"?te=this.getExtExtKeyUsage(Y,K):N=="1.3.6.1.5.5.7.1.1"?te=this.getExtAuthorityInfoAccess(Y,K):N=="2.5.29.20"?te=this.getExtCRLNumber(Y,K):N=="2.5.29.21"?te=this.getExtCRLReason(Y,K):N=="1.3.6.1.5.5.7.48.1.2"?te=this.getExtOcspNonce(Y,K):N=="1.3.6.1.5.5.7.48.1.5"?te=this.getExtOcspNoCheck(Y,K):N=="1.2.840.113583.1.1.9.1"&&(te=this.getExtAdobeTimeStamp(Y,K)),te!=null)return te;var de={extname:N,extn:Y};return K&&(de.critical=!0),de},this.findExt=function(S,O){for(var N=0;N<S.length;N++)if(S[N].extname==O)return S[N];return null},this.updateExtCDPFullURI=function(S,O){var N=this.findExt(S,"cRLDistributionPoints");if(N!=null&&N.array!=null){for(var K=N.array,Y=0;Y<K.length;Y++)if(K[Y].dpname!=null&&K[Y].dpname.full!=null)for(var te=K[Y].dpname.full,de=0;de<te.length;de++){var se=te[Y];se.uri!=null&&(se.uri=O)}}},this.updateExtAIAOCSP=function(S,O){var N=this.findExt(S,"authorityInfoAccess");if(N!=null&&N.array!=null)for(var K=N.array,Y=0;Y<K.length;Y++)K[Y].ocsp!=null&&(K[Y].ocsp=O)},this.updateExtAIACAIssuer=function(S,O){var N=this.findExt(S,"authorityInfoAccess");if(N!=null&&N.array!=null)for(var K=N.array,Y=0;Y<K.length;Y++)K[Y].caissuer!=null&&(K[Y].caissuer=O)},this.dnarraytostr=function(S){return"/"+S.map(function(O){return function(K){return K.map(function(Y){return function(de){return de.type+"="+de.value}(Y).replace(/\+/,"\\+")}).join("+")}(O).replace(/\//,"\\/")}).join("/")},this.getInfo=function(){var S,O,N,K=function(Ft){return JSON.stringify(Ft.array).replace(/[\[\]\{\}\"]/g,"")},Y=function(Ft){for(var ht="",vt=Ft.array,We=0;We<vt.length;We++){var et=vt[We];if(ht+="    policy oid: "+et.policyoid+`
`,et.array!==void 0)for(var at=0;at<et.array.length;at++){var mt=et.array[at];mt.cps!==void 0&&(ht+="    cps: "+mt.cps+`
`)}}return ht},te=function(Ft){for(var ht="",vt=Ft.array,We=0;We<vt.length;We++){var et=vt[We];try{et.dpname.full[0].uri!==void 0&&(ht+="    "+et.dpname.full[0].uri+`
`)}catch{}try{et.dname.full[0].dn.hex!==void 0&&(ht+="    "+Ze.hex2dn(et.dpname.full[0].dn.hex)+`
`)}catch{}}return ht},de=function(Ft){for(var ht="",vt=Ft.array,We=0;We<vt.length;We++){var et=vt[We];et.caissuer!==void 0&&(ht+="    caissuer: "+et.caissuer+`
`),et.ocsp!==void 0&&(ht+="    ocsp: "+et.ocsp+`
`)}return ht};if(S=`Basic Fields
`,S+="  serial number: "+this.getSerialNumberHex()+`
`,S+="  signature algorithm: "+this.getSignatureAlgorithmField()+`
`,S+="  issuer: "+this.getIssuerString()+`
`,S+="  notBefore: "+this.getNotBefore()+`
`,S+="  notAfter: "+this.getNotAfter()+`
`,S+="  subject: "+this.getSubjectString()+`
`,S+=`  subject public key info: 
`,S+="    key algorithm: "+(O=this.getPublicKey()).type+`
`,O.type==="RSA"&&(S+="    n="+Cn(O.n.toString(16)).substr(0,16)+`...
`,S+="    e="+Cn(O.e.toString(16))+`
`),(N=this.aExtInfo)!=null){S+=`X509v3 Extensions:
`;for(var se=0;se<N.length;se++){var we=N[se],ce=C.asn1.x509.OID.oid2name(we.oid);ce===""&&(ce=we.oid);var ge="";if(we.critical===!0&&(ge="CRITICAL"),S+="  "+ce+" "+ge+`:
`,ce==="basicConstraints"){var Ue=this.getExtBasicConstraints();Ue.cA===void 0?S+=`    {}
`:(S+="    cA=true",Ue.pathLen!==void 0&&(S+=", pathLen="+Ue.pathLen),S+=`
`)}else if(ce==="keyUsage")S+="    "+this.getExtKeyUsageString()+`
`;else if(ce==="subjectKeyIdentifier")S+="    "+this.getExtSubjectKeyIdentifier().kid.hex+`
`;else if(ce==="authorityKeyIdentifier"){var Ne=this.getExtAuthorityKeyIdentifier();Ne.kid!==void 0&&(S+="    kid="+Ne.kid.hex+`
`)}else ce==="extKeyUsage"?S+="    "+this.getExtExtKeyUsage().array.join(", ")+`
`:ce==="subjectAltName"?S+="    "+K(this.getExtSubjectAltName())+`
`:ce==="cRLDistributionPoints"?S+=te(this.getExtCRLDistributionPoints()):ce==="authorityInfoAccess"?S+=de(this.getExtAuthorityInfoAccess()):ce==="certificatePolicies"&&(S+=Y(this.getExtCertificatePolicies()))}}return S+="signature algorithm: "+this.getSignatureAlgorithmName()+`
`,S+="signature: "+this.getSignatureValueHex().substr(0,16)+`...
`},typeof t=="string"&&(t.indexOf("-----BEGIN")!=-1?this.readCertPEM(t):C.lang.String.isHex(t)&&this.readCertHex(t))}fe.prototype.sign=function(t,e){var i=function(d){return C.crypto.Util.hashString(d,e)}(t);return this.signWithMessageHash(i,e)},fe.prototype.signWithMessageHash=function(t,e){var i=Et(C.crypto.Util.getPaddedDigestInfoHex(t,e,this.n.bitLength()),16);return qi(this.doPrivate(i).toString(16),this.n.bitLength())},fe.prototype.signPSS=function(t,e,i){var a=function(v){return C.crypto.Util.hashHex(v,e)}(jt(t));return i===void 0&&(i=-1),this.signWithMessageHashPSS(a,e,i)},fe.prototype.signWithMessageHashPSS=function(t,e,i){var a,d=kt(t),v=d.length,E=this.n.bitLength()-1,k=Math.ceil(E/8),R=function(S){return C.crypto.Util.hashHex(S,e)};if(i===-1||i===void 0)i=v;else if(i===-2)i=k-v-2;else if(i<-2)throw new Error("invalid salt length");if(k<v+i+2)throw new Error("data too long");var I="";i>0&&(I=new Array(i),new Re().nextBytes(I),I=String.fromCharCode.apply(String,I));var U=kt(R(jt("\0\0\0\0\0\0\0\0"+d+I))),D=[];for(a=0;a<k-i-v-2;a+=1)D[a]=0;var B=String.fromCharCode.apply(String,D)+""+I,$=$i(U,B.length,R),z=[];for(a=0;a<B.length;a+=1)z[a]=B.charCodeAt(a)^$.charCodeAt(a);var Q=65280>>8*k-E&255;for(z[0]&=~Q,a=0;a<v;a++)z.push(U.charCodeAt(a));return z.push(188),qi(this.doPrivate(new W(z)).toString(16),this.n.bitLength())},fe.prototype.verify=function(t,e){if((e=e.toLowerCase()).match(/^[0-9a-f]+$/)==null)return!1;var i=Et(e,16),a=this.n.bitLength();if(i.bitLength()>a)return!1;var d=this.doPublic(i).toString(16);if(d.length+3!=a/4)return!1;var v=Gi(d.replace(/^1f+00/,""));if(v.length==0)return!1;var E=v[0];return v[1]==function(R){return C.crypto.Util.hashString(R,E)}(t)},fe.prototype.verifyWithMessageHash=function(t,e){if(e.length!=Math.ceil(this.n.bitLength()/4))return!1;var i=Et(e,16);if(i.bitLength()>this.n.bitLength())return 0;var a=Gi(this.doPublic(i).toString(16).replace(/^1f+00/,""));return a.length==0?!1:(a[0],a[1]==t)},fe.prototype.verifyPSS=function(t,e,i,a){var d=function(E){return C.crypto.Util.hashHex(E,i)}(jt(t));return a===void 0&&(a=-1),this.verifyWithMessageHashPSS(d,e,i,a)},fe.prototype.verifyWithMessageHashPSS=function(t,e,i,a){if(e.length!=Math.ceil(this.n.bitLength()/4))return!1;var d,v=new W(e,16),E=function(N){return C.crypto.Util.hashHex(N,i)},k=kt(t),R=k.length,I=this.n.bitLength()-1,U=Math.ceil(I/8);if(a===-1||a===void 0)a=R;else if(a===-2)a=U-R-2;else if(a<-2)throw new Error("invalid salt length");if(U<R+a+2)throw new Error("data too long");var D=this.doPublic(v).toByteArray();for(d=0;d<D.length;d+=1)D[d]&=255;for(;D.length<U;)D.unshift(0);if(D[U-1]!==188)throw new Error("encoded message does not end in 0xbc");var B=(D=String.fromCharCode.apply(String,D)).substr(0,U-R-1),$=D.substr(B.length,R),z=65280>>8*U-I&255;if((B.charCodeAt(0)&z)!=0)throw new Error("bits beyond keysize not zero");var Q=$i($,B.length,E),ee=[];for(d=0;d<B.length;d+=1)ee[d]=B.charCodeAt(d)^Q.charCodeAt(d);ee[0]&=~z;var S=U-R-a-2;for(d=0;d<S;d+=1)if(ee[d]!==0)throw new Error("leftmost octets not zero");if(ee[S]!==1)throw new Error("0x01 marker not found");return $===kt(E(jt("\0\0\0\0\0\0\0\0"+k+String.fromCharCode.apply(String,ee.slice(-a)))))},fe.SALT_LEN_HLEN=-1,fe.SALT_LEN_MAX=-2,fe.SALT_LEN_RECOVER=-2,Ze.hex2dn=function(t,e){e===void 0&&(e=0);var i=new Ze;return ue.getTLV(t,e),i.getX500Name(t).str},Ze.hex2rdn=function(t,e){if(e===void 0&&(e=0),t.substr(e,2)!=="31")throw new Error("malformed RDN");for(var i=new Array,a=ue.getChildIdx(t,e),d=0;d<a.length;d++)i.push(Ze.hex2attrTypeValue(t,a[d]));return(i=i.map(function(v){return v.replace("+","\\+")})).join("+")},Ze.hex2attrTypeValue=function(t,e){var i=ue,a=i.getV;if(e===void 0&&(e=0),t.substr(e,2)!=="30")throw new Error("malformed attribute type and value");var d=i.getChildIdx(t,e);d.length!==2||t.substr(d[0],2);var v=a(t,d[0]),E=C.asn1.ASN1Util.oidHexToInt(v);return C.asn1.x509.OID.oid2atype(E)+"="+kt(a(t,d[1]))},Ze.getPublicKeyFromCertHex=function(t){var e=new Ze;return e.readCertHex(t),e.getPublicKey()},Ze.getPublicKeyFromCertPEM=function(t){var e=new Ze;return e.readCertPEM(t),e.getPublicKey()},Ze.getPublicKeyInfoPropOfCertPEM=function(t){var e,i,a=ue.getVbyList,d={};return d.algparam=null,(e=new Ze).readCertPEM(t),i=e.getPublicKeyHex(),d.keyhex=a(i,0,[1],"03").substr(2),d.algoid=a(i,0,[0,0],"06"),d.algoid==="2a8648ce3d0201"&&(d.algparam=a(i,0,[0,1],"06")),d},Ze.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"],C!==void 0&&C||(o.KJUR=C={}),C.jws!==void 0&&C.jws||(C.jws={}),C.jws.JWS=function(){var t=C.jws.JWS.isSafeJSONString;this.parseJWS=function(e,i){if(this.parsedJWS===void 0||!i&&this.parsedJWS.sigvalH===void 0){var a=e.match(/^([^.]+)\.([^.]+)\.([^.]+)$/);if(a==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var d=a[1],v=a[2],E=a[3],k=d+"."+v;if(this.parsedJWS={},this.parsedJWS.headB64U=d,this.parsedJWS.payloadB64U=v,this.parsedJWS.sigvalB64U=E,this.parsedJWS.si=k,!i){var R=Oe(E),I=Et(R,16);this.parsedJWS.sigvalH=R,this.parsedJWS.sigvalBI=I}var U=Nt(d),D=Nt(v);if(this.parsedJWS.headS=U,this.parsedJWS.payloadS=D,!t(U,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+U}}},C.jws.JWS.sign=function(t,e,i,a,d){var v,E,k,R=C,I=R.jws.JWS,U=I.readSafeJSONString,D=I.isSafeJSONString,B=R.crypto,$=(B.ECDSA,B.Mac),z=B.Signature,Q=JSON;if(typeof e!="string"&&(e===void 0?"undefined":b(e))!="object")throw"spHeader must be JSON string or object: "+e;if((e===void 0?"undefined":b(e))=="object"&&(E=e,v=Q.stringify(E)),typeof e=="string"){if(!D(v=e))throw"JWS Head is not safe JSON string: "+v;E=U(v)}if(k=i,(i===void 0?"undefined":b(i))=="object"&&(k=Q.stringify(i)),t!=""&&t!=null||E.alg===void 0||(t=E.alg),t!=""&&t!=null&&E.alg===void 0&&(E.alg=t,v=Q.stringify(E)),t!==E.alg)throw"alg and sHeader.alg doesn't match: "+t+"!="+E.alg;var ee=null;if(I.jwsalg2sigalg[t]===void 0)throw"unsupported alg name: "+t;ee=I.jwsalg2sigalg[t];var S=Cr(v)+"."+Cr(k),O="";if(ee.substr(0,4)=="Hmac"){if(a===void 0)throw"mac key shall be specified for HS* alg";var N=new $({alg:ee,prov:"cryptojs",pass:a});N.updateString(S),O=N.doFinal()}else if(ee.indexOf("withECDSA")!=-1){(Y=new z({alg:ee})).init(a,d),Y.updateString(S);var K=Y.sign();O=C.crypto.ECDSA.asn1SigToConcatSig(K)}else{var Y;ee!="none"&&((Y=new z({alg:ee})).init(a,d),Y.updateString(S),O=Y.sign())}return S+"."+Xe(O)},C.jws.JWS.verify=function(t,e,i){var a,d=C,v=d.jws.JWS,E=v.readSafeJSONString,k=d.crypto,R=k.ECDSA,I=k.Mac,U=k.Signature;b(fe)!==void 0&&(a=fe);var D=t.split(".");if(D.length!==3)return!1;var B=D[0]+"."+D[1],$=Oe(D[2]),z=E(Nt(D[0])),Q=null,ee=null;if(z.alg===void 0)throw"algorithm not specified in header";if(ee=(Q=z.alg).substr(0,2),i!=null&&Object.prototype.toString.call(i)==="[object Array]"&&i.length>0&&(":"+i.join(":")+":").indexOf(":"+Q+":")==-1)throw"algorithm '"+Q+"' not accepted in the list";if(Q!="none"&&e===null)throw"key shall be specified to verify.";if(typeof e=="string"&&e.indexOf("-----BEGIN ")!=-1&&(e=$e.getKey(e)),!(ee!="RS"&&ee!="PS"||e instanceof a))throw"key shall be a RSAKey obj for RS* and PS* algs";if(ee=="ES"&&!(e instanceof R))throw"key shall be a ECDSA obj for ES* algs";var S=null;if(v.jwsalg2sigalg[z.alg]===void 0)throw"unsupported alg name: "+Q;if((S=v.jwsalg2sigalg[Q])=="none")throw"not supported";if(S.substr(0,4)=="Hmac"){if(e===void 0)throw"hexadecimal key shall be specified for HMAC";var O=new I({alg:S,pass:e});return O.updateString(B),$==O.doFinal()}if(S.indexOf("withECDSA")!=-1){var N,K=null;try{K=R.concatSigToASN1Sig($)}catch{return!1}return(N=new U({alg:S})).init(e),N.updateString(B),N.verify(K)}return(N=new U({alg:S})).init(e),N.updateString(B),N.verify($)},C.jws.JWS.parse=function(t){var e,i,a,d=t.split("."),v={};if(d.length!=2&&d.length!=3)throw"malformed sJWS: wrong number of '.' splitted elements";return e=d[0],i=d[1],d.length==3&&(a=d[2]),v.headerObj=C.jws.JWS.readSafeJSONString(Nt(e)),v.payloadObj=C.jws.JWS.readSafeJSONString(Nt(i)),v.headerPP=JSON.stringify(v.headerObj,null,"  "),v.payloadObj==null?v.payloadPP=Nt(i):v.payloadPP=JSON.stringify(v.payloadObj,null,"  "),a!==void 0&&(v.sigHex=Oe(a)),v},C.jws.JWS.verifyJWT=function(t,e,i){var a=C.jws,d=a.JWS,v=d.readSafeJSONString,E=d.inArray,k=d.includedArray,R=t.split("."),I=R[0],U=R[1],D=(Oe(R[2]),v(Nt(I))),B=v(Nt(U));if(D.alg===void 0)return!1;if(i.alg===void 0)throw"acceptField.alg shall be specified";if(!E(D.alg,i.alg)||B.iss!==void 0&&b(i.iss)==="object"&&!E(B.iss,i.iss)||B.sub!==void 0&&b(i.sub)==="object"&&!E(B.sub,i.sub))return!1;if(B.aud!==void 0&&b(i.aud)==="object"){if(typeof B.aud=="string"){if(!E(B.aud,i.aud))return!1}else if(b(B.aud)=="object"&&!k(B.aud,i.aud))return!1}var $=a.IntDate.getNow();return i.verifyAt!==void 0&&typeof i.verifyAt=="number"&&($=i.verifyAt),i.gracePeriod!==void 0&&typeof i.gracePeriod=="number"||(i.gracePeriod=0),!(B.exp!==void 0&&typeof B.exp=="number"&&B.exp+i.gracePeriod<$)&&!(B.nbf!==void 0&&typeof B.nbf=="number"&&$<B.nbf-i.gracePeriod)&&!(B.iat!==void 0&&typeof B.iat=="number"&&$<B.iat-i.gracePeriod)&&(B.jti===void 0||i.jti===void 0||B.jti===i.jti)&&!!d.verify(t,e,i.alg)},C.jws.JWS.includedArray=function(t,e){var i=C.jws.JWS.inArray;if(t===null||(t===void 0?"undefined":b(t))!=="object"||typeof t.length!="number")return!1;for(var a=0;a<t.length;a++)if(!i(t[a],e))return!1;return!0},C.jws.JWS.inArray=function(t,e){if(e===null||(e===void 0?"undefined":b(e))!=="object"||typeof e.length!="number")return!1;for(var i=0;i<e.length;i++)if(e[i]==t)return!0;return!1},C.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS384:"HmacSHA384",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"},C.jws.JWS.isSafeJSONString=function(t,e,i){var a=null;try{return((a=Oi(t))===void 0?"undefined":b(a))!="object"||a.constructor===Array?0:(e&&(e[i]=a),1)}catch{return 0}},C.jws.JWS.readSafeJSONString=function(t){var e=null;try{return((e=Oi(t))===void 0?"undefined":b(e))!="object"||e.constructor===Array?null:e}catch{return null}},C.jws.JWS.getEncodedSignatureValueFromJWS=function(t){var e=t.match(/^[^.]+\.[^.]+\.([^.]+)$/);if(e==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return e[1]},C.jws.JWS.getJWKthumbprint=function(t){if(t.kty!=="RSA"&&t.kty!=="EC"&&t.kty!=="oct")throw"unsupported algorithm for JWK Thumprint";var e="{";if(t.kty==="RSA"){if(typeof t.n!="string"||typeof t.e!="string")throw"wrong n and e value for RSA key";e+='"e":"'+t.e+'",',e+='"kty":"'+t.kty+'",',e+='"n":"'+t.n+'"}'}else if(t.kty==="EC"){if(typeof t.crv!="string"||typeof t.x!="string"||typeof t.y!="string")throw"wrong crv, x and y value for EC key";e+='"crv":"'+t.crv+'",',e+='"kty":"'+t.kty+'",',e+='"x":"'+t.x+'",',e+='"y":"'+t.y+'"}'}else if(t.kty==="oct"){if(typeof t.k!="string")throw"wrong k value for oct(symmetric) key";e+='"kty":"'+t.kty+'",',e+='"k":"'+t.k+'"}'}var i=jt(e);return Xe(C.crypto.Util.hashHex(i,"sha256"))},C.jws.IntDate={},C.jws.IntDate.get=function(t){var e=C.jws.IntDate,i=e.getNow,a=e.getZulu;if(t=="now")return i();if(t=="now + 1hour")return i()+3600;if(t=="now + 1day")return i()+86400;if(t=="now + 1month")return i()+2592e3;if(t=="now + 1year")return i()+31536e3;if(t.match(/Z$/))return a(t);if(t.match(/^[0-9]+$/))return parseInt(t);throw"unsupported format: "+t},C.jws.IntDate.getZulu=function(t){return Ki(t)},C.jws.IntDate.getNow=function(){return~~(new Date/1e3)},C.jws.IntDate.intDate2UTCString=function(t){return new Date(1e3*t).toUTCString()},C.jws.IntDate.intDate2Zulu=function(t){var e=new Date(1e3*t);return("0000"+e.getUTCFullYear()).slice(-4)+("00"+(e.getUTCMonth()+1)).slice(-2)+("00"+e.getUTCDate()).slice(-2)+("00"+e.getUTCHours()).slice(-2)+("00"+e.getUTCMinutes()).slice(-2)+("00"+e.getUTCSeconds()).slice(-2)+"Z"},o.SecureRandom=Re,o.rng_seed_time=X,o.BigInteger=W,o.RSAKey=fe;var xs=C.crypto.EDSA;o.EDSA=xs;var Rs=C.crypto.DSA;o.DSA=Rs;var Is=C.crypto.Signature;o.Signature=Is;var ks=C.crypto.MessageDigest;o.MessageDigest=ks;var Us=C.crypto.Mac;o.Mac=Us;var Os=C.crypto.Cipher;o.Cipher=Os,o.KEYUTIL=$e,o.ASN1HEX=ue,o.X509=Ze,o.CryptoJS=M,o.b64tohex=ne,o.b64toBA=ie,o.stoBA=Di,o.BAtos=Hi,o.BAtohex=Vr,o.stohex=zt,o.stob64=function(e){return j(zt(e))},o.stob64u=function(e){return Jr(j(zt(e)))},o.b64utos=function(e){return Hi(ie(xr(e)))},o.b64tob64u=Jr,o.b64utob64=xr,o.hex2b64=j,o.hextob64u=Xe,o.b64utohex=Oe,o.utf8tob64u=Cr,o.b64utoutf8=Nt,o.utf8tob64=function(e){return j(qr(Gr(e)))},o.b64toutf8=function(e){return decodeURIComponent($r(ne(e)))},o.utf8tohex=An,o.hextoutf8=Qe,o.hextorstr=kt,o.rstrtohex=jt,o.hextob64=Ni,o.hextob64nl=Li,o.b64nltohex=Mi,o.hextopem=bt,o.pemtohex=Wt,o.hextoArrayBuffer=function(e){if(e.length%2!=0)throw"input is not even length";if(e.match(/^[0-9A-Fa-f]+$/)==null)throw"input is not hexadecimal";for(var i=new ArrayBuffer(e.length/2),a=new DataView(i),d=0;d<e.length/2;d++)a.setUint8(d,parseInt(e.substr(2*d,2),16));return i},o.ArrayBuffertohex=function(e){for(var i="",a=new DataView(e),d=0;d<e.byteLength;d++)i+=("00"+a.getUint8(d).toString(16)).slice(-2);return i},o.zulutomsec=Pn,o.zulutosec=Ki,o.zulutodate=function(e){return new Date(Pn(e))},o.datetozulu=function(e,i,a){var d,v=e.getUTCFullYear();if(i){if(v<1950||2049<v)throw"not proper year for UTCTime: "+v;d=(""+v).slice(-2)}else d=("000"+v).slice(-4);if(d+=("0"+(e.getUTCMonth()+1)).slice(-2),d+=("0"+e.getUTCDate()).slice(-2),d+=("0"+e.getUTCHours()).slice(-2),d+=("0"+e.getUTCMinutes()).slice(-2),d+=("0"+e.getUTCSeconds()).slice(-2),a){var E=e.getUTCMilliseconds();E!==0&&(d+="."+(E=(E=("00"+E).slice(-3)).replace(/0+$/g,"")))}return d+="Z"},o.uricmptohex=qr,o.hextouricmp=$r,o.ipv6tohex=Bi,o.hextoipv6=ji,o.hextoip=Tn,o.iptohex=function(e){var i="malformed IP address";if(!(e=e.toLowerCase(e)).match(/^[0-9.]+$/)){if(e.match(/^[0-9a-f:]+$/)&&e.indexOf(":")!==-1)return Bi(e);throw i}var a=e.split(".");if(a.length!==4)throw i;var d="";try{for(var v=0;v<4;v++)d+=("0"+parseInt(a[v]).toString(16)).slice(-2);return d}catch{throw i}},o.encodeURIComponentAll=Gr,o.newline_toUnix=function(e){return e=e.replace(/\r\n/gm,`
`)},o.newline_toDos=function(e){return e=(e=e.replace(/\r\n/gm,`
`)).replace(/\n/gm,`\r
`)},o.hextoposhex=Cn,o.intarystrtohex=function(e){e=(e=(e=e.replace(/^\s*\[\s*/,"")).replace(/\s*\]\s*$/,"")).replace(/\s*/g,"");try{return e.split(/,/).map(function(i,a,d){var v=parseInt(i);if(v<0||255<v)throw"integer not in range 0-255";return("00"+v.toString(16)).slice(-2)}).join("")}catch(i){throw"malformed integer array string: "+i}},o.strdiffidx=function(e,i){var a=e.length;e.length>i.length&&(a=i.length);for(var d=0;d<a;d++)if(e.charCodeAt(d)!=i.charCodeAt(d))return d;return e.length!=i.length?a:-1},o.KJUR=C;var Ds=C.crypto;o.crypto=Ds;var Hs=C.asn1;o.asn1=Hs;var Ns=C.jws;o.jws=Ns;var Ls=C.lang;o.lang=Ls}).call(this,u(28).Buffer)},function(s,o,u){(function(l){/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */var c=u(30),g=u(31),y=u(32);function f(){return p.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function h(J,m){if(f()<m)throw new RangeError("Invalid typed array length");return p.TYPED_ARRAY_SUPPORT?(J=new Uint8Array(m)).__proto__=p.prototype:(J===null&&(J=new p(m)),J.length=m),J}function p(J,m,_){if(!(p.TYPED_ARRAY_SUPPORT||this instanceof p))return new p(J,m,_);if(typeof J=="number"){if(typeof m=="string")throw new Error("If encoding is specified then the first argument must be a string");return F(this,J)}return w(this,J,m,_)}function w(J,m,_,L){if(typeof m=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer!="undefined"&&m instanceof ArrayBuffer?function(X,re,he,ve){if(re.byteLength,he<0||re.byteLength<he)throw new RangeError("'offset' is out of bounds");if(re.byteLength<he+(ve||0))throw new RangeError("'length' is out of bounds");return re=he===void 0&&ve===void 0?new Uint8Array(re):ve===void 0?new Uint8Array(re,he):new Uint8Array(re,he,ve),p.TYPED_ARRAY_SUPPORT?(X=re).__proto__=p.prototype:X=P(X,re),X}(J,m,_,L):typeof m=="string"?function(X,re,he){if(typeof he=="string"&&he!==""||(he="utf8"),!p.isEncoding(he))throw new TypeError('"encoding" must be a valid string encoding');var ve=0|b(re,he),Ce=(X=h(X,ve)).write(re,he);return Ce!==ve&&(X=X.slice(0,Ce)),X}(J,m,_):function(X,re){if(p.isBuffer(re)){var he=0|A(re.length);return(X=h(X,he)).length===0||re.copy(X,0,0,he),X}if(re){if(typeof ArrayBuffer!="undefined"&&re.buffer instanceof ArrayBuffer||"length"in re)return typeof re.length!="number"||function(Ce){return Ce!=Ce}(re.length)?h(X,0):P(X,re);if(re.type==="Buffer"&&y(re.data))return P(X,re.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(J,m)}function x(J){if(typeof J!="number")throw new TypeError('"size" argument must be a number');if(J<0)throw new RangeError('"size" argument must not be negative')}function F(J,m){if(x(m),J=h(J,m<0?0:0|A(m)),!p.TYPED_ARRAY_SUPPORT)for(var _=0;_<m;++_)J[_]=0;return J}function P(J,m){var _=m.length<0?0:0|A(m.length);J=h(J,_);for(var L=0;L<_;L+=1)J[L]=255&m[L];return J}function A(J){if(J>=f())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+f().toString(16)+" bytes");return 0|J}function b(J,m){if(p.isBuffer(J))return J.length;if(typeof ArrayBuffer!="undefined"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(J)||J instanceof ArrayBuffer))return J.byteLength;typeof J!="string"&&(J=""+J);var _=J.length;if(_===0)return 0;for(var L=!1;;)switch(m){case"ascii":case"latin1":case"binary":return _;case"utf8":case"utf-8":case void 0:return St(J).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*_;case"hex":return _>>>1;case"base64":return nt(J).length;default:if(L)return St(J).length;m=(""+m).toLowerCase(),L=!0}}function T(J,m,_){var L=!1;if((m===void 0||m<0)&&(m=0),m>this.length||((_===void 0||_>this.length)&&(_=this.length),_<=0)||(_>>>=0)<=(m>>>=0))return"";for(J||(J="utf8");;)switch(J){case"hex":return Ee(this,m,_);case"utf8":case"utf-8":return be(this,m,_);case"ascii":return ae(this,m,_);case"latin1":case"binary":return pe(this,m,_);case"base64":return Te(this,m,_);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Fe(this,m,_);default:if(L)throw new TypeError("Unknown encoding: "+J);J=(J+"").toLowerCase(),L=!0}}function H(J,m,_){var L=J[m];J[m]=J[_],J[_]=L}function M(J,m,_,L,q){if(J.length===0)return-1;if(typeof _=="string"?(L=_,_=0):_>2147483647?_=2147483647:_<-2147483648&&(_=-2147483648),_=+_,isNaN(_)&&(_=q?0:J.length-1),_<0&&(_=J.length+_),_>=J.length){if(q)return-1;_=J.length-1}else if(_<0){if(!q)return-1;_=0}if(typeof m=="string"&&(m=p.from(m,L)),p.isBuffer(m))return m.length===0?-1:G(J,m,_,L,q);if(typeof m=="number")return m&=255,p.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?q?Uint8Array.prototype.indexOf.call(J,m,_):Uint8Array.prototype.lastIndexOf.call(J,m,_):G(J,[m],_,L,q);throw new TypeError("val must be string, number or Buffer")}function G(J,m,_,L,q){var X,re=1,he=J.length,ve=m.length;if(L!==void 0&&((L=String(L).toLowerCase())==="ucs2"||L==="ucs-2"||L==="utf16le"||L==="utf-16le")){if(J.length<2||m.length<2)return-1;re=2,he/=2,ve/=2,_/=2}function Ce(Ht,fe){return re===1?Ht[fe]:Ht.readUInt16BE(fe*re)}if(q){var Ae=-1;for(X=_;X<he;X++)if(Ce(J,X)===Ce(m,Ae===-1?0:X-Ae)){if(Ae===-1&&(Ae=X),X-Ae+1===ve)return Ae*re}else Ae!==-1&&(X-=X-Ae),Ae=-1}else for(_+ve>he&&(_=he-ve),X=_;X>=0;X--){for(var Re=!0,Et=0;Et<ve;Et++)if(Ce(J,X+Et)!==Ce(m,Et)){Re=!1;break}if(Re)return X}return-1}function V(J,m,_,L){_=Number(_)||0;var q=J.length-_;L?(L=Number(L))>q&&(L=q):L=q;var X=m.length;if(X%2!=0)throw new TypeError("Invalid hex string");L>X/2&&(L=X/2);for(var re=0;re<L;++re){var he=parseInt(m.substr(2*re,2),16);if(isNaN(he))return re;J[_+re]=he}return re}function j(J,m,_,L){return He(St(m,J.length-_),J,_,L)}function ne(J,m,_,L){return He(function(X){for(var re=[],he=0;he<X.length;++he)re.push(255&X.charCodeAt(he));return re}(m),J,_,L)}function ie(J,m,_,L){return ne(J,m,_,L)}function W(J,m,_,L){return He(nt(m),J,_,L)}function oe(J,m,_,L){return He(function(X,re){for(var he,ve,Ce,Ae=[],Re=0;Re<X.length&&!((re-=2)<0);++Re)ve=(he=X.charCodeAt(Re))>>8,Ce=he%256,Ae.push(Ce),Ae.push(ve);return Ae}(m,J.length-_),J,_,L)}function Te(J,m,_){return m===0&&_===J.length?c.fromByteArray(J):c.fromByteArray(J.slice(m,_))}function be(J,m,_){_=Math.min(J.length,_);for(var L=[],q=m;q<_;){var X,re,he,ve,Ce=J[q],Ae=null,Re=Ce>239?4:Ce>223?3:Ce>191?2:1;if(q+Re<=_)switch(Re){case 1:Ce<128&&(Ae=Ce);break;case 2:(192&(X=J[q+1]))==128&&(ve=(31&Ce)<<6|63&X)>127&&(Ae=ve);break;case 3:X=J[q+1],re=J[q+2],(192&X)==128&&(192&re)==128&&(ve=(15&Ce)<<12|(63&X)<<6|63&re)>2047&&(ve<55296||ve>57343)&&(Ae=ve);break;case 4:X=J[q+1],re=J[q+2],he=J[q+3],(192&X)==128&&(192&re)==128&&(192&he)==128&&(ve=(15&Ce)<<18|(63&X)<<12|(63&re)<<6|63&he)>65535&&ve<1114112&&(Ae=ve)}Ae===null?(Ae=65533,Re=1):Ae>65535&&(Ae-=65536,L.push(Ae>>>10&1023|55296),Ae=56320|1023&Ae),L.push(Ae),q+=Re}return function(Ht){var fe=Ht.length;if(fe<=Z)return String.fromCharCode.apply(String,Ht);for(var Ke="",Se=0;Se<fe;)Ke+=String.fromCharCode.apply(String,Ht.slice(Se,Se+=Z));return Ke}(L)}o.Buffer=p,o.SlowBuffer=function(m){return+m!=m&&(m=0),p.alloc(+m)},o.INSPECT_MAX_BYTES=50,p.TYPED_ARRAY_SUPPORT=l.TYPED_ARRAY_SUPPORT!==void 0?l.TYPED_ARRAY_SUPPORT:function(){try{var m=new Uint8Array(1);return m.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},m.foo()===42&&typeof m.subarray=="function"&&m.subarray(1,1).byteLength===0}catch{return!1}}(),o.kMaxLength=f(),p.poolSize=8192,p._augment=function(J){return J.__proto__=p.prototype,J},p.from=function(J,m,_){return w(null,J,m,_)},p.TYPED_ARRAY_SUPPORT&&(p.prototype.__proto__=Uint8Array.prototype,p.__proto__=Uint8Array,typeof Symbol!="undefined"&&Symbol.species&&p[Symbol.species]===p&&Object.defineProperty(p,Symbol.species,{value:null,configurable:!0})),p.alloc=function(J,m,_){return function(q,X,re,he){return x(X),X<=0?h(q,X):re!==void 0?typeof he=="string"?h(q,X).fill(re,he):h(q,X).fill(re):h(q,X)}(null,J,m,_)},p.allocUnsafe=function(J){return F(null,J)},p.allocUnsafeSlow=function(J){return F(null,J)},p.isBuffer=function(m){return!(m==null||!m._isBuffer)},p.compare=function(m,_){if(!p.isBuffer(m)||!p.isBuffer(_))throw new TypeError("Arguments must be Buffers");if(m===_)return 0;for(var L=m.length,q=_.length,X=0,re=Math.min(L,q);X<re;++X)if(m[X]!==_[X]){L=m[X],q=_[X];break}return L<q?-1:q<L?1:0},p.isEncoding=function(m){switch(String(m).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},p.concat=function(m,_){if(!y(m))throw new TypeError('"list" argument must be an Array of Buffers');if(m.length===0)return p.alloc(0);var L;if(_===void 0)for(_=0,L=0;L<m.length;++L)_+=m[L].length;var q=p.allocUnsafe(_),X=0;for(L=0;L<m.length;++L){var re=m[L];if(!p.isBuffer(re))throw new TypeError('"list" argument must be an Array of Buffers');re.copy(q,X),X+=re.length}return q},p.byteLength=b,p.prototype._isBuffer=!0,p.prototype.swap16=function(){var m=this.length;if(m%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var _=0;_<m;_+=2)H(this,_,_+1);return this},p.prototype.swap32=function(){var m=this.length;if(m%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var _=0;_<m;_+=4)H(this,_,_+3),H(this,_+1,_+2);return this},p.prototype.swap64=function(){var m=this.length;if(m%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var _=0;_<m;_+=8)H(this,_,_+7),H(this,_+1,_+6),H(this,_+2,_+5),H(this,_+3,_+4);return this},p.prototype.toString=function(){var m=0|this.length;return m===0?"":arguments.length===0?be(this,0,m):T.apply(this,arguments)},p.prototype.equals=function(m){if(!p.isBuffer(m))throw new TypeError("Argument must be a Buffer");return this===m||p.compare(this,m)===0},p.prototype.inspect=function(){var m="",_=o.INSPECT_MAX_BYTES;return this.length>0&&(m=this.toString("hex",0,_).match(/.{2}/g).join(" "),this.length>_&&(m+=" ... ")),"<Buffer "+m+">"},p.prototype.compare=function(m,_,L,q,X){if(!p.isBuffer(m))throw new TypeError("Argument must be a Buffer");if(_===void 0&&(_=0),L===void 0&&(L=m?m.length:0),q===void 0&&(q=0),X===void 0&&(X=this.length),_<0||L>m.length||q<0||X>this.length)throw new RangeError("out of range index");if(q>=X&&_>=L)return 0;if(q>=X)return-1;if(_>=L)return 1;if(this===m)return 0;for(var re=(X>>>=0)-(q>>>=0),he=(L>>>=0)-(_>>>=0),ve=Math.min(re,he),Ce=this.slice(q,X),Ae=m.slice(_,L),Re=0;Re<ve;++Re)if(Ce[Re]!==Ae[Re]){re=Ce[Re],he=Ae[Re];break}return re<he?-1:he<re?1:0},p.prototype.includes=function(m,_,L){return this.indexOf(m,_,L)!==-1},p.prototype.indexOf=function(m,_,L){return M(this,m,_,L,!0)},p.prototype.lastIndexOf=function(m,_,L){return M(this,m,_,L,!1)},p.prototype.write=function(m,_,L,q){if(_===void 0)q="utf8",L=this.length,_=0;else if(L===void 0&&typeof _=="string")q=_,L=this.length,_=0;else{if(!isFinite(_))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");_|=0,isFinite(L)?(L|=0,q===void 0&&(q="utf8")):(q=L,L=void 0)}var X=this.length-_;if((L===void 0||L>X)&&(L=X),m.length>0&&(L<0||_<0)||_>this.length)throw new RangeError("Attempt to write outside buffer bounds");q||(q="utf8");for(var re=!1;;)switch(q){case"hex":return V(this,m,_,L);case"utf8":case"utf-8":return j(this,m,_,L);case"ascii":return ne(this,m,_,L);case"latin1":case"binary":return ie(this,m,_,L);case"base64":return W(this,m,_,L);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return oe(this,m,_,L);default:if(re)throw new TypeError("Unknown encoding: "+q);q=(""+q).toLowerCase(),re=!0}},p.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Z=4096;function ae(J,m,_){var L="";_=Math.min(J.length,_);for(var q=m;q<_;++q)L+=String.fromCharCode(127&J[q]);return L}function pe(J,m,_){var L="";_=Math.min(J.length,_);for(var q=m;q<_;++q)L+=String.fromCharCode(J[q]);return L}function Ee(J,m,_){var L=J.length;(!m||m<0)&&(m=0),(!_||_<0||_>L)&&(_=L);for(var q="",X=m;X<_;++X)q+=dt(J[X]);return q}function Fe(J,m,_){for(var L=J.slice(m,_),q="",X=0;X<L.length;X+=2)q+=String.fromCharCode(L[X]+256*L[X+1]);return q}function le(J,m,_){if(J%1!=0||J<0)throw new RangeError("offset is not uint");if(J+m>_)throw new RangeError("Trying to access beyond buffer length")}function _e(J,m,_,L,q,X){if(!p.isBuffer(J))throw new TypeError('"buffer" argument must be a Buffer instance');if(m>q||m<X)throw new RangeError('"value" argument is out of bounds');if(_+L>J.length)throw new RangeError("Index out of range")}function Me(J,m,_,L){m<0&&(m=65535+m+1);for(var q=0,X=Math.min(J.length-_,2);q<X;++q)J[_+q]=(m&255<<8*(L?q:1-q))>>>8*(L?q:1-q)}function qe(J,m,_,L){m<0&&(m=4294967295+m+1);for(var q=0,X=Math.min(J.length-_,4);q<X;++q)J[_+q]=m>>>8*(L?q:3-q)&255}function _t(J,m,_,L,q,X){if(_+L>J.length)throw new RangeError("Index out of range");if(_<0)throw new RangeError("Index out of range")}function wt(J,m,_,L,q){return q||_t(J,0,_,4),g.write(J,m,_,L,23,4),_+4}function Rt(J,m,_,L,q){return q||_t(J,0,_,8),g.write(J,m,_,L,52,8),_+8}p.prototype.slice=function(m,_){var L,q=this.length;if((m=~~m)<0?(m+=q)<0&&(m=0):m>q&&(m=q),(_=_===void 0?q:~~_)<0?(_+=q)<0&&(_=0):_>q&&(_=q),_<m&&(_=m),p.TYPED_ARRAY_SUPPORT)(L=this.subarray(m,_)).__proto__=p.prototype;else{var X=_-m;L=new p(X,void 0);for(var re=0;re<X;++re)L[re]=this[re+m]}return L},p.prototype.readUIntLE=function(m,_,L){m|=0,_|=0,L||le(m,_,this.length);for(var q=this[m],X=1,re=0;++re<_&&(X*=256);)q+=this[m+re]*X;return q},p.prototype.readUIntBE=function(m,_,L){m|=0,_|=0,L||le(m,_,this.length);for(var q=this[m+--_],X=1;_>0&&(X*=256);)q+=this[m+--_]*X;return q},p.prototype.readUInt8=function(m,_){return _||le(m,1,this.length),this[m]},p.prototype.readUInt16LE=function(m,_){return _||le(m,2,this.length),this[m]|this[m+1]<<8},p.prototype.readUInt16BE=function(m,_){return _||le(m,2,this.length),this[m]<<8|this[m+1]},p.prototype.readUInt32LE=function(m,_){return _||le(m,4,this.length),(this[m]|this[m+1]<<8|this[m+2]<<16)+16777216*this[m+3]},p.prototype.readUInt32BE=function(m,_){return _||le(m,4,this.length),16777216*this[m]+(this[m+1]<<16|this[m+2]<<8|this[m+3])},p.prototype.readIntLE=function(m,_,L){m|=0,_|=0,L||le(m,_,this.length);for(var q=this[m],X=1,re=0;++re<_&&(X*=256);)q+=this[m+re]*X;return q>=(X*=128)&&(q-=Math.pow(2,8*_)),q},p.prototype.readIntBE=function(m,_,L){m|=0,_|=0,L||le(m,_,this.length);for(var q=_,X=1,re=this[m+--q];q>0&&(X*=256);)re+=this[m+--q]*X;return re>=(X*=128)&&(re-=Math.pow(2,8*_)),re},p.prototype.readInt8=function(m,_){return _||le(m,1,this.length),128&this[m]?-1*(255-this[m]+1):this[m]},p.prototype.readInt16LE=function(m,_){_||le(m,2,this.length);var L=this[m]|this[m+1]<<8;return 32768&L?4294901760|L:L},p.prototype.readInt16BE=function(m,_){_||le(m,2,this.length);var L=this[m+1]|this[m]<<8;return 32768&L?4294901760|L:L},p.prototype.readInt32LE=function(m,_){return _||le(m,4,this.length),this[m]|this[m+1]<<8|this[m+2]<<16|this[m+3]<<24},p.prototype.readInt32BE=function(m,_){return _||le(m,4,this.length),this[m]<<24|this[m+1]<<16|this[m+2]<<8|this[m+3]},p.prototype.readFloatLE=function(m,_){return _||le(m,4,this.length),g.read(this,m,!0,23,4)},p.prototype.readFloatBE=function(m,_){return _||le(m,4,this.length),g.read(this,m,!1,23,4)},p.prototype.readDoubleLE=function(m,_){return _||le(m,8,this.length),g.read(this,m,!0,52,8)},p.prototype.readDoubleBE=function(m,_){return _||le(m,8,this.length),g.read(this,m,!1,52,8)},p.prototype.writeUIntLE=function(m,_,L,q){m=+m,_|=0,L|=0,q||_e(this,m,_,L,Math.pow(2,8*L)-1,0);var X=1,re=0;for(this[_]=255&m;++re<L&&(X*=256);)this[_+re]=m/X&255;return _+L},p.prototype.writeUIntBE=function(m,_,L,q){m=+m,_|=0,L|=0,q||_e(this,m,_,L,Math.pow(2,8*L)-1,0);var X=L-1,re=1;for(this[_+X]=255&m;--X>=0&&(re*=256);)this[_+X]=m/re&255;return _+L},p.prototype.writeUInt8=function(m,_,L){return m=+m,_|=0,L||_e(this,m,_,1,255,0),p.TYPED_ARRAY_SUPPORT||(m=Math.floor(m)),this[_]=255&m,_+1},p.prototype.writeUInt16LE=function(m,_,L){return m=+m,_|=0,L||_e(this,m,_,2,65535,0),p.TYPED_ARRAY_SUPPORT?(this[_]=255&m,this[_+1]=m>>>8):Me(this,m,_,!0),_+2},p.prototype.writeUInt16BE=function(m,_,L){return m=+m,_|=0,L||_e(this,m,_,2,65535,0),p.TYPED_ARRAY_SUPPORT?(this[_]=m>>>8,this[_+1]=255&m):Me(this,m,_,!1),_+2},p.prototype.writeUInt32LE=function(m,_,L){return m=+m,_|=0,L||_e(this,m,_,4,4294967295,0),p.TYPED_ARRAY_SUPPORT?(this[_+3]=m>>>24,this[_+2]=m>>>16,this[_+1]=m>>>8,this[_]=255&m):qe(this,m,_,!0),_+4},p.prototype.writeUInt32BE=function(m,_,L){return m=+m,_|=0,L||_e(this,m,_,4,4294967295,0),p.TYPED_ARRAY_SUPPORT?(this[_]=m>>>24,this[_+1]=m>>>16,this[_+2]=m>>>8,this[_+3]=255&m):qe(this,m,_,!1),_+4},p.prototype.writeIntLE=function(m,_,L,q){if(m=+m,_|=0,!q){var X=Math.pow(2,8*L-1);_e(this,m,_,L,X-1,-X)}var re=0,he=1,ve=0;for(this[_]=255&m;++re<L&&(he*=256);)m<0&&ve===0&&this[_+re-1]!==0&&(ve=1),this[_+re]=(m/he>>0)-ve&255;return _+L},p.prototype.writeIntBE=function(m,_,L,q){if(m=+m,_|=0,!q){var X=Math.pow(2,8*L-1);_e(this,m,_,L,X-1,-X)}var re=L-1,he=1,ve=0;for(this[_+re]=255&m;--re>=0&&(he*=256);)m<0&&ve===0&&this[_+re+1]!==0&&(ve=1),this[_+re]=(m/he>>0)-ve&255;return _+L},p.prototype.writeInt8=function(m,_,L){return m=+m,_|=0,L||_e(this,m,_,1,127,-128),p.TYPED_ARRAY_SUPPORT||(m=Math.floor(m)),m<0&&(m=255+m+1),this[_]=255&m,_+1},p.prototype.writeInt16LE=function(m,_,L){return m=+m,_|=0,L||_e(this,m,_,2,32767,-32768),p.TYPED_ARRAY_SUPPORT?(this[_]=255&m,this[_+1]=m>>>8):Me(this,m,_,!0),_+2},p.prototype.writeInt16BE=function(m,_,L){return m=+m,_|=0,L||_e(this,m,_,2,32767,-32768),p.TYPED_ARRAY_SUPPORT?(this[_]=m>>>8,this[_+1]=255&m):Me(this,m,_,!1),_+2},p.prototype.writeInt32LE=function(m,_,L){return m=+m,_|=0,L||_e(this,m,_,4,2147483647,-2147483648),p.TYPED_ARRAY_SUPPORT?(this[_]=255&m,this[_+1]=m>>>8,this[_+2]=m>>>16,this[_+3]=m>>>24):qe(this,m,_,!0),_+4},p.prototype.writeInt32BE=function(m,_,L){return m=+m,_|=0,L||_e(this,m,_,4,2147483647,-2147483648),m<0&&(m=4294967295+m+1),p.TYPED_ARRAY_SUPPORT?(this[_]=m>>>24,this[_+1]=m>>>16,this[_+2]=m>>>8,this[_+3]=255&m):qe(this,m,_,!1),_+4},p.prototype.writeFloatLE=function(m,_,L){return wt(this,m,_,!0,L)},p.prototype.writeFloatBE=function(m,_,L){return wt(this,m,_,!1,L)},p.prototype.writeDoubleLE=function(m,_,L){return Rt(this,m,_,!0,L)},p.prototype.writeDoubleBE=function(m,_,L){return Rt(this,m,_,!1,L)},p.prototype.copy=function(m,_,L,q){if(L||(L=0),q||q===0||(q=this.length),_>=m.length&&(_=m.length),_||(_=0),q>0&&q<L&&(q=L),q===L||m.length===0||this.length===0)return 0;if(_<0)throw new RangeError("targetStart out of bounds");if(L<0||L>=this.length)throw new RangeError("sourceStart out of bounds");if(q<0)throw new RangeError("sourceEnd out of bounds");q>this.length&&(q=this.length),m.length-_<q-L&&(q=m.length-_+L);var X,re=q-L;if(this===m&&L<_&&_<q)for(X=re-1;X>=0;--X)m[X+_]=this[X+L];else if(re<1e3||!p.TYPED_ARRAY_SUPPORT)for(X=0;X<re;++X)m[X+_]=this[X+L];else Uint8Array.prototype.set.call(m,this.subarray(L,L+re),_);return re},p.prototype.fill=function(m,_,L,q){if(typeof m=="string"){if(typeof _=="string"?(q=_,_=0,L=this.length):typeof L=="string"&&(q=L,L=this.length),m.length===1){var X=m.charCodeAt(0);X<256&&(m=X)}if(q!==void 0&&typeof q!="string")throw new TypeError("encoding must be a string");if(typeof q=="string"&&!p.isEncoding(q))throw new TypeError("Unknown encoding: "+q)}else typeof m=="number"&&(m&=255);if(_<0||this.length<_||this.length<L)throw new RangeError("Out of range index");if(L<=_)return this;var re;if(_>>>=0,L=L===void 0?this.length:L>>>0,m||(m=0),typeof m=="number")for(re=_;re<L;++re)this[re]=m;else{var he=p.isBuffer(m)?m:St(new p(m,q).toString()),ve=he.length;for(re=0;re<L-_;++re)this[re+_]=he[re%ve]}return this};var Gt=/[^+\/0-9A-Za-z-_]/g;function dt(J){return J<16?"0"+J.toString(16):J.toString(16)}function St(J,m){var _;m=m||1/0;for(var L=J.length,q=null,X=[],re=0;re<L;++re){if((_=J.charCodeAt(re))>55295&&_<57344){if(!q){if(_>56319){(m-=3)>-1&&X.push(239,191,189);continue}if(re+1===L){(m-=3)>-1&&X.push(239,191,189);continue}q=_;continue}if(_<56320){(m-=3)>-1&&X.push(239,191,189),q=_;continue}_=65536+(q-55296<<10|_-56320)}else q&&(m-=3)>-1&&X.push(239,191,189);if(q=null,_<128){if((m-=1)<0)break;X.push(_)}else if(_<2048){if((m-=2)<0)break;X.push(_>>6|192,63&_|128)}else if(_<65536){if((m-=3)<0)break;X.push(_>>12|224,_>>6&63|128,63&_|128)}else{if(!(_<1114112))throw new Error("Invalid code point");if((m-=4)<0)break;X.push(_>>18|240,_>>12&63|128,_>>6&63|128,63&_|128)}}return X}function nt(J){return c.toByteArray(function(_){if((_=function(q){return q.trim?q.trim():q.replace(/^\s+|\s+$/g,"")}(_).replace(Gt,"")).length<2)return"";for(;_.length%4!=0;)_+="=";return _}(J))}function He(J,m,_,L){for(var q=0;q<L&&!(q+_>=m.length||q>=J.length);++q)m[q+_]=J[q];return q}}).call(this,u(29))},function(s,o){var u;u=function(){return this}();try{u=u||new Function("return this")()}catch{typeof window=="object"&&(u=window)}s.exports=u},function(s,o,u){o.byteLength=function(F){var P=p(F),A=P[0],b=P[1];return 3*(A+b)/4-b},o.toByteArray=function(F){var P,A,b=p(F),T=b[0],H=b[1],M=new g(function(ne,ie,W){return 3*(ie+W)/4-W}(0,T,H)),G=0,V=H>0?T-4:T;for(A=0;A<V;A+=4)P=c[F.charCodeAt(A)]<<18|c[F.charCodeAt(A+1)]<<12|c[F.charCodeAt(A+2)]<<6|c[F.charCodeAt(A+3)],M[G++]=P>>16&255,M[G++]=P>>8&255,M[G++]=255&P;return H===2&&(P=c[F.charCodeAt(A)]<<2|c[F.charCodeAt(A+1)]>>4,M[G++]=255&P),H===1&&(P=c[F.charCodeAt(A)]<<10|c[F.charCodeAt(A+1)]<<4|c[F.charCodeAt(A+2)]>>2,M[G++]=P>>8&255,M[G++]=255&P),M},o.fromByteArray=function(F){for(var P,A=F.length,b=A%3,T=[],H=16383,M=0,G=A-b;M<G;M+=H)T.push(w(F,M,M+H>G?G:M+H));return b===1?(P=F[A-1],T.push(l[P>>2]+l[P<<4&63]+"==")):b===2&&(P=(F[A-2]<<8)+F[A-1],T.push(l[P>>10]+l[P>>4&63]+l[P<<2&63]+"=")),T.join("")};for(var l=[],c=[],g=typeof Uint8Array!="undefined"?Uint8Array:Array,y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f=0,h=y.length;f<h;++f)l[f]=y[f],c[y.charCodeAt(f)]=f;function p(x){var F=x.length;if(F%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var P=x.indexOf("=");return P===-1&&(P=F),[P,P===F?0:4-P%4]}function w(x,F,P){for(var A,b,T=[],H=F;H<P;H+=3)A=(x[H]<<16&16711680)+(x[H+1]<<8&65280)+(255&x[H+2]),T.push(l[(b=A)>>18&63]+l[b>>12&63]+l[b>>6&63]+l[63&b]);return T.join("")}c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63},function(s,o){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */o.read=function(u,l,c,g,y){var f,h,p=8*y-g-1,w=(1<<p)-1,x=w>>1,F=-7,P=c?y-1:0,A=c?-1:1,b=u[l+P];for(P+=A,f=b&(1<<-F)-1,b>>=-F,F+=p;F>0;f=256*f+u[l+P],P+=A,F-=8);for(h=f&(1<<-F)-1,f>>=-F,F+=g;F>0;h=256*h+u[l+P],P+=A,F-=8);if(f===0)f=1-x;else{if(f===w)return h?NaN:1/0*(b?-1:1);h+=Math.pow(2,g),f-=x}return(b?-1:1)*h*Math.pow(2,f-g)},o.write=function(u,l,c,g,y,f){var h,p,w,x=8*f-y-1,F=(1<<x)-1,P=F>>1,A=y===23?Math.pow(2,-24)-Math.pow(2,-77):0,b=g?0:f-1,T=g?1:-1,H=l<0||l===0&&1/l<0?1:0;for(l=Math.abs(l),isNaN(l)||l===1/0?(p=isNaN(l)?1:0,h=F):(h=Math.floor(Math.log(l)/Math.LN2),l*(w=Math.pow(2,-h))<1&&(h--,w*=2),(l+=h+P>=1?A/w:A*Math.pow(2,1-P))*w>=2&&(h++,w/=2),h+P>=F?(p=0,h=F):h+P>=1?(p=(l*w-1)*Math.pow(2,y),h+=P):(p=l*Math.pow(2,P-1)*Math.pow(2,y),h=0));y>=8;u[c+b]=255&p,b+=T,p/=256,y-=8);for(h=h<<y|p,x+=y;x>0;u[c+b]=255&h,b+=T,h/=256,x-=8);u[c+b-T]|=128*H}},function(s,o){var u={}.toString;s.exports=Array.isArray||function(l){return u.call(l)=="[object Array]"}},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(g){var y=g.jws,f=g.KeyUtil,h=g.X509,p=g.crypto,w=g.hextob64u,x=g.b64tohex,F=g.AllowedSigningAlgs;return function(){function P(){(function(b,T){if(!(b instanceof T))throw new TypeError("Cannot call a class as a function")})(this,P)}return P.parseJwt=function(b){l.Log.debug("JoseUtil.parseJwt");try{var T=y.JWS.parse(b);return{header:T.headerObj,payload:T.payloadObj}}catch(H){l.Log.error(H)}},P.validateJwt=function(b,T,H,M,G,V,j){l.Log.debug("JoseUtil.validateJwt");try{if(T.kty==="RSA")if(T.e&&T.n)T=f.getKey(T);else{if(!T.x5c||!T.x5c.length)return l.Log.error("JoseUtil.validateJwt: RSA key missing key material",T),Promise.reject(new Error("RSA key missing key material"));var ne=x(T.x5c[0]);T=h.getPublicKeyFromCertHex(ne)}else{if(T.kty!=="EC")return l.Log.error("JoseUtil.validateJwt: Unsupported key type",T&&T.kty),Promise.reject(new Error(T.kty));if(!(T.crv&&T.x&&T.y))return l.Log.error("JoseUtil.validateJwt: EC key missing key material",T),Promise.reject(new Error("EC key missing key material"));T=f.getKey(T)}return P._validateJwt(b,T,H,M,G,V,j)}catch(ie){return l.Log.error(ie&&ie.message||ie),Promise.reject("JWT validation failed")}},P.validateJwtAttributes=function(b,T,H,M,G,V){M||(M=0),G||(G=parseInt(Date.now()/1e3));var j=P.parseJwt(b).payload;if(!j.iss)return l.Log.error("JoseUtil._validateJwt: issuer was not provided"),Promise.reject(new Error("issuer was not provided"));if(j.iss!==T)return l.Log.error("JoseUtil._validateJwt: Invalid issuer in token",j.iss),Promise.reject(new Error("Invalid issuer in token: "+j.iss));if(!j.aud)return l.Log.error("JoseUtil._validateJwt: aud was not provided"),Promise.reject(new Error("aud was not provided"));if(!(j.aud===H||Array.isArray(j.aud)&&j.aud.indexOf(H)>=0))return l.Log.error("JoseUtil._validateJwt: Invalid audience in token",j.aud),Promise.reject(new Error("Invalid audience in token: "+j.aud));if(j.azp&&j.azp!==H)return l.Log.error("JoseUtil._validateJwt: Invalid azp in token",j.azp),Promise.reject(new Error("Invalid azp in token: "+j.azp));if(!V){var ne=G+M,ie=G-M;if(!j.iat)return l.Log.error("JoseUtil._validateJwt: iat was not provided"),Promise.reject(new Error("iat was not provided"));if(ne<j.iat)return l.Log.error("JoseUtil._validateJwt: iat is in the future",j.iat),Promise.reject(new Error("iat is in the future: "+j.iat));if(j.nbf&&ne<j.nbf)return l.Log.error("JoseUtil._validateJwt: nbf is in the future",j.nbf),Promise.reject(new Error("nbf is in the future: "+j.nbf));if(!j.exp)return l.Log.error("JoseUtil._validateJwt: exp was not provided"),Promise.reject(new Error("exp was not provided"));if(j.exp<ie)return l.Log.error("JoseUtil._validateJwt: exp is in the past",j.exp),Promise.reject(new Error("exp is in the past:"+j.exp))}return Promise.resolve(j)},P._validateJwt=function(b,T,H,M,G,V,j){return P.validateJwtAttributes(b,H,M,G,V,j).then(function(ne){try{return y.JWS.verify(b,T,F)?ne:(l.Log.error("JoseUtil._validateJwt: signature validation failed"),Promise.reject(new Error("signature validation failed")))}catch(ie){return l.Log.error(ie&&ie.message||ie),Promise.reject(new Error("signature validation failed"))}})},P.hashString=function(b,T){try{return p.Util.hashString(b,T)}catch(H){l.Log.error(H)}},P.hexToBase64Url=function(b){try{return w(b)}catch(T){l.Log.error(T)}},P}()};var l=u(0);s.exports=o.default},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.SigninResponse=void 0;var l=function(){function y(f,h){for(var p=0;p<h.length;p++){var w=h[p];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),Object.defineProperty(f,w.key,w)}}return function(f,h,p){return h&&y(f.prototype,h),p&&y(f,p),f}}(),c=u(3);function g(y,f){if(!(y instanceof f))throw new TypeError("Cannot call a class as a function")}o.SigninResponse=function(){function y(f){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#";g(this,y);var p=c.UrlUtility.parseUrlFragment(f,h);this.error=p.error,this.error_description=p.error_description,this.error_uri=p.error_uri,this.code=p.code,this.state=p.state,this.id_token=p.id_token,this.session_state=p.session_state,this.access_token=p.access_token,this.token_type=p.token_type,this.scope=p.scope,this.profile=void 0,this.expires_in=p.expires_in}return l(y,[{key:"expires_in",get:function(){if(this.expires_at){var h=parseInt(Date.now()/1e3);return this.expires_at-h}},set:function(h){var p=parseInt(h);if(typeof p=="number"&&p>0){var w=parseInt(Date.now()/1e3);this.expires_at=w+p}}},{key:"expired",get:function(){var h=this.expires_in;if(h!==void 0)return h<=0}},{key:"scopes",get:function(){return(this.scope||"").split(" ")}},{key:"isOpenIdConnect",get:function(){return this.scopes.indexOf("openid")>=0||!!this.id_token}}]),y}()},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.SignoutRequest=void 0;var l=u(0),c=u(3),g=u(9);o.SignoutRequest=function y(f){var h=f.url,p=f.id_token_hint,w=f.post_logout_redirect_uri,x=f.data,F=f.extraQueryParams,P=f.request_type;if(function(T,H){if(!(T instanceof H))throw new TypeError("Cannot call a class as a function")}(this,y),!h)throw l.Log.error("SignoutRequest.ctor: No url passed"),new Error("url");for(var A in p&&(h=c.UrlUtility.addQueryParam(h,"id_token_hint",p)),w&&(h=c.UrlUtility.addQueryParam(h,"post_logout_redirect_uri",w),x&&(this.state=new g.State({data:x,request_type:P}),h=c.UrlUtility.addQueryParam(h,"state",this.state.id))),F)h=c.UrlUtility.addQueryParam(h,A,F[A]);this.url=h}},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.SignoutResponse=void 0;var l=u(3);o.SignoutResponse=function c(g){(function(h,p){if(!(h instanceof p))throw new TypeError("Cannot call a class as a function")})(this,c);var y=l.UrlUtility.parseUrlFragment(g,"?");this.error=y.error,this.error_description=y.error_description,this.error_uri=y.error_uri,this.state=y.state}},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.InMemoryWebStorage=void 0;var l=function(){function g(y,f){for(var h=0;h<f.length;h++){var p=f[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(y,p.key,p)}}return function(y,f,h){return f&&g(y.prototype,f),h&&g(y,h),y}}(),c=u(0);o.InMemoryWebStorage=function(){function g(){(function(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")})(this,g),this._data={}}return g.prototype.getItem=function(f){return c.Log.debug("InMemoryWebStorage.getItem",f),this._data[f]},g.prototype.setItem=function(f,h){c.Log.debug("InMemoryWebStorage.setItem",f),this._data[f]=h},g.prototype.removeItem=function(f){c.Log.debug("InMemoryWebStorage.removeItem",f),delete this._data[f]},g.prototype.key=function(f){return Object.getOwnPropertyNames(this._data)[f]},l(g,[{key:"length",get:function(){return Object.getOwnPropertyNames(this._data).length}}]),g}()},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.UserManager=void 0;var l=function(){function H(M,G){for(var V=0;V<G.length;V++){var j=G[V];j.enumerable=j.enumerable||!1,j.configurable=!0,"value"in j&&(j.writable=!0),Object.defineProperty(M,j.key,j)}}return function(M,G,V){return G&&H(M.prototype,G),V&&H(M,V),M}}(),c=u(0),g=u(10),y=u(39),f=u(15),h=u(45),p=u(47),w=u(18),x=u(8),F=u(20),P=u(11),A=u(4);function b(H,M){if(!(H instanceof M))throw new TypeError("Cannot call a class as a function")}function T(H,M){if(!H)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!M||typeof M!="object"&&typeof M!="function"?H:M}o.UserManager=function(H){function M(){var G=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},V=arguments.length>1&&arguments[1]!==void 0?arguments[1]:p.SilentRenewService,j=arguments.length>2&&arguments[2]!==void 0?arguments[2]:w.SessionMonitor,ne=arguments.length>3&&arguments[3]!==void 0?arguments[3]:F.TokenRevocationClient,ie=arguments.length>4&&arguments[4]!==void 0?arguments[4]:P.TokenClient,W=arguments.length>5&&arguments[5]!==void 0?arguments[5]:A.JoseUtil;b(this,M),G instanceof y.UserManagerSettings||(G=new y.UserManagerSettings(G));var oe=T(this,H.call(this,G));return oe._events=new h.UserManagerEvents(G),oe._silentRenewService=new V(oe),oe.settings.automaticSilentRenew&&(c.Log.debug("UserManager.ctor: automaticSilentRenew is configured, setting up silent renew"),oe.startSilentRenew()),oe.settings.monitorSession&&(c.Log.debug("UserManager.ctor: monitorSession is configured, setting up session monitor"),oe._sessionMonitor=new j(oe)),oe._tokenRevocationClient=new ne(oe._settings),oe._tokenClient=new ie(oe._settings),oe._joseUtil=W,oe}return function(V,j){if(typeof j!="function"&&j!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof j);V.prototype=Object.create(j&&j.prototype,{constructor:{value:V,enumerable:!1,writable:!0,configurable:!0}}),j&&(Object.setPrototypeOf?Object.setPrototypeOf(V,j):V.__proto__=j)}(M,H),M.prototype.getUser=function(){var V=this;return this._loadUser().then(function(j){return j?(c.Log.info("UserManager.getUser: user loaded"),V._events.load(j,!1),j):(c.Log.info("UserManager.getUser: user not found in storage"),null)})},M.prototype.removeUser=function(){var V=this;return this.storeUser(null).then(function(){c.Log.info("UserManager.removeUser: user removed from storage"),V._events.unload()})},M.prototype.signinRedirect=function(){var V=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(V=Object.assign({},V)).request_type="si:r";var j={useReplaceToNavigate:V.useReplaceToNavigate};return this._signinStart(V,this._redirectNavigator,j).then(function(){c.Log.info("UserManager.signinRedirect: successful")})},M.prototype.signinRedirectCallback=function(V){return this._signinEnd(V||this._redirectNavigator.url).then(function(j){return j.profile&&j.profile.sub?c.Log.info("UserManager.signinRedirectCallback: successful, signed in sub: ",j.profile.sub):c.Log.info("UserManager.signinRedirectCallback: no sub"),j})},M.prototype.signinPopup=function(){var V=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(V=Object.assign({},V)).request_type="si:p";var j=V.redirect_uri||this.settings.popup_redirect_uri||this.settings.redirect_uri;return j?(V.redirect_uri=j,V.display="popup",this._signin(V,this._popupNavigator,{startUrl:j,popupWindowFeatures:V.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:V.popupWindowTarget||this.settings.popupWindowTarget}).then(function(ne){return ne&&(ne.profile&&ne.profile.sub?c.Log.info("UserManager.signinPopup: signinPopup successful, signed in sub: ",ne.profile.sub):c.Log.info("UserManager.signinPopup: no sub")),ne})):(c.Log.error("UserManager.signinPopup: No popup_redirect_uri or redirect_uri configured"),Promise.reject(new Error("No popup_redirect_uri or redirect_uri configured")))},M.prototype.signinPopupCallback=function(V){return this._signinCallback(V,this._popupNavigator).then(function(j){return j&&(j.profile&&j.profile.sub?c.Log.info("UserManager.signinPopupCallback: successful, signed in sub: ",j.profile.sub):c.Log.info("UserManager.signinPopupCallback: no sub")),j}).catch(function(j){c.Log.error(j.message)})},M.prototype.signinSilent=function(){var V=this,j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return j=Object.assign({},j),this._loadUser().then(function(ne){return ne&&ne.refresh_token?(j.refresh_token=ne.refresh_token,V._useRefreshToken(j)):(j.request_type="si:s",j.id_token_hint=j.id_token_hint||V.settings.includeIdTokenInSilentRenew&&ne&&ne.id_token,ne&&V._settings.validateSubOnSilentRenew&&(c.Log.debug("UserManager.signinSilent, subject prior to silent renew: ",ne.profile.sub),j.current_sub=ne.profile.sub),V._signinSilentIframe(j))})},M.prototype._useRefreshToken=function(){var V=this,j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._tokenClient.exchangeRefreshToken(j).then(function(ne){return ne?ne.access_token?V._loadUser().then(function(ie){if(ie){var W=Promise.resolve();return ne.id_token&&(W=V._validateIdTokenFromTokenRefreshToken(ie.profile,ne.id_token)),W.then(function(){return c.Log.debug("UserManager._useRefreshToken: refresh token response success"),ie.id_token=ne.id_token||ie.id_token,ie.access_token=ne.access_token,ie.refresh_token=ne.refresh_token||ie.refresh_token,ie.expires_in=ne.expires_in,V.storeUser(ie).then(function(){return V._events.load(ie),ie})})}return null}):(c.Log.error("UserManager._useRefreshToken: No access token returned from token endpoint"),Promise.reject("No access token returned from token endpoint")):(c.Log.error("UserManager._useRefreshToken: No response returned from token endpoint"),Promise.reject("No response returned from token endpoint"))})},M.prototype._validateIdTokenFromTokenRefreshToken=function(V,j){var ne=this;return this._metadataService.getIssuer().then(function(ie){return ne.settings.getEpochTime().then(function(W){return ne._joseUtil.validateJwtAttributes(j,ie,ne._settings.client_id,ne._settings.clockSkew,W).then(function(oe){return oe?oe.sub!==V.sub?(c.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: sub in id_token does not match current sub"),Promise.reject(new Error("sub in id_token does not match current sub"))):oe.auth_time&&oe.auth_time!==V.auth_time?(c.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: auth_time in id_token does not match original auth_time"),Promise.reject(new Error("auth_time in id_token does not match original auth_time"))):oe.azp&&oe.azp!==V.azp?(c.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: azp in id_token does not match original azp"),Promise.reject(new Error("azp in id_token does not match original azp"))):!oe.azp&&V.azp?(c.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: azp not in id_token, but present in original id_token"),Promise.reject(new Error("azp not in id_token, but present in original id_token"))):void 0:(c.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: Failed to validate id_token"),Promise.reject(new Error("Failed to validate id_token")))})})})},M.prototype._signinSilentIframe=function(){var V=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},j=V.redirect_uri||this.settings.silent_redirect_uri||this.settings.redirect_uri;return j?(V.redirect_uri=j,V.prompt=V.prompt||"none",this._signin(V,this._iframeNavigator,{startUrl:j,silentRequestTimeout:V.silentRequestTimeout||this.settings.silentRequestTimeout}).then(function(ne){return ne&&(ne.profile&&ne.profile.sub?c.Log.info("UserManager.signinSilent: successful, signed in sub: ",ne.profile.sub):c.Log.info("UserManager.signinSilent: no sub")),ne})):(c.Log.error("UserManager.signinSilent: No silent_redirect_uri configured"),Promise.reject(new Error("No silent_redirect_uri configured")))},M.prototype.signinSilentCallback=function(V){return this._signinCallback(V,this._iframeNavigator).then(function(j){return j&&(j.profile&&j.profile.sub?c.Log.info("UserManager.signinSilentCallback: successful, signed in sub: ",j.profile.sub):c.Log.info("UserManager.signinSilentCallback: no sub")),j})},M.prototype.signinCallback=function(V){var j=this;return this.readSigninResponseState(V).then(function(ne){var ie=ne.state;return ne.response,ie.request_type==="si:r"?j.signinRedirectCallback(V):ie.request_type==="si:p"?j.signinPopupCallback(V):ie.request_type==="si:s"?j.signinSilentCallback(V):Promise.reject(new Error("invalid response_type in state"))})},M.prototype.signoutCallback=function(V,j){var ne=this;return this.readSignoutResponseState(V).then(function(ie){var W=ie.state,oe=ie.response;return W?W.request_type==="so:r"?ne.signoutRedirectCallback(V):W.request_type==="so:p"?ne.signoutPopupCallback(V,j):Promise.reject(new Error("invalid response_type in state")):oe})},M.prototype.querySessionStatus=function(){var V=this,j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(j=Object.assign({},j)).request_type="si:s";var ne=j.redirect_uri||this.settings.silent_redirect_uri||this.settings.redirect_uri;return ne?(j.redirect_uri=ne,j.prompt="none",j.response_type=j.response_type||this.settings.query_status_response_type,j.scope=j.scope||"openid",j.skipUserInfo=!0,this._signinStart(j,this._iframeNavigator,{startUrl:ne,silentRequestTimeout:j.silentRequestTimeout||this.settings.silentRequestTimeout}).then(function(ie){return V.processSigninResponse(ie.url).then(function(W){if(c.Log.debug("UserManager.querySessionStatus: got signin response"),W.session_state&&W.profile.sub)return c.Log.info("UserManager.querySessionStatus: querySessionStatus success for sub: ",W.profile.sub),{session_state:W.session_state,sub:W.profile.sub,sid:W.profile.sid};c.Log.info("querySessionStatus successful, user not authenticated")}).catch(function(W){if(W.session_state&&V.settings.monitorAnonymousSession&&(W.message=="login_required"||W.message=="consent_required"||W.message=="interaction_required"||W.message=="account_selection_required"))return c.Log.info("UserManager.querySessionStatus: querySessionStatus success for anonymous user"),{session_state:W.session_state};throw W})})):(c.Log.error("UserManager.querySessionStatus: No silent_redirect_uri configured"),Promise.reject(new Error("No silent_redirect_uri configured")))},M.prototype._signin=function(V,j){var ne=this,ie=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._signinStart(V,j,ie).then(function(W){return ne._signinEnd(W.url,V)})},M.prototype._signinStart=function(V,j){var ne=this,ie=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return j.prepare(ie).then(function(W){return c.Log.debug("UserManager._signinStart: got navigator window handle"),ne.createSigninRequest(V).then(function(oe){return c.Log.debug("UserManager._signinStart: got signin request"),ie.url=oe.url,ie.id=oe.state.id,W.navigate(ie)}).catch(function(oe){throw W.close&&(c.Log.debug("UserManager._signinStart: Error after preparing navigator, closing navigator window"),W.close()),oe})})},M.prototype._signinEnd=function(V){var j=this,ne=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.processSigninResponse(V).then(function(ie){c.Log.debug("UserManager._signinEnd: got signin response");var W=new f.User(ie);if(ne.current_sub){if(ne.current_sub!==W.profile.sub)return c.Log.debug("UserManager._signinEnd: current user does not match user returned from signin. sub from signin: ",W.profile.sub),Promise.reject(new Error("login_required"));c.Log.debug("UserManager._signinEnd: current user matches user returned from signin")}return j.storeUser(W).then(function(){return c.Log.debug("UserManager._signinEnd: user stored"),j._events.load(W),W})})},M.prototype._signinCallback=function(V,j){c.Log.debug("UserManager._signinCallback");var ne=this._settings.response_mode==="query"||!this._settings.response_mode&&x.SigninRequest.isCode(this._settings.response_type)?"?":"#";return j.callback(V,void 0,ne)},M.prototype.signoutRedirect=function(){var V=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(V=Object.assign({},V)).request_type="so:r";var j=V.post_logout_redirect_uri||this.settings.post_logout_redirect_uri;j&&(V.post_logout_redirect_uri=j);var ne={useReplaceToNavigate:V.useReplaceToNavigate};return this._signoutStart(V,this._redirectNavigator,ne).then(function(){c.Log.info("UserManager.signoutRedirect: successful")})},M.prototype.signoutRedirectCallback=function(V){return this._signoutEnd(V||this._redirectNavigator.url).then(function(j){return c.Log.info("UserManager.signoutRedirectCallback: successful"),j})},M.prototype.signoutPopup=function(){var V=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(V=Object.assign({},V)).request_type="so:p";var j=V.post_logout_redirect_uri||this.settings.popup_post_logout_redirect_uri||this.settings.post_logout_redirect_uri;return V.post_logout_redirect_uri=j,V.display="popup",V.post_logout_redirect_uri&&(V.state=V.state||{}),this._signout(V,this._popupNavigator,{startUrl:j,popupWindowFeatures:V.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:V.popupWindowTarget||this.settings.popupWindowTarget}).then(function(){c.Log.info("UserManager.signoutPopup: successful")})},M.prototype.signoutPopupCallback=function(V,j){return j===void 0&&typeof V=="boolean"&&(j=V,V=null),this._popupNavigator.callback(V,j,"?").then(function(){c.Log.info("UserManager.signoutPopupCallback: successful")})},M.prototype._signout=function(V,j){var ne=this,ie=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._signoutStart(V,j,ie).then(function(W){return ne._signoutEnd(W.url)})},M.prototype._signoutStart=function(){var V=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},j=this,ne=arguments[1],ie=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return ne.prepare(ie).then(function(W){return c.Log.debug("UserManager._signoutStart: got navigator window handle"),j._loadUser().then(function(oe){return c.Log.debug("UserManager._signoutStart: loaded current user from storage"),(j._settings.revokeAccessTokenOnSignout?j._revokeInternal(oe):Promise.resolve()).then(function(){var Te=V.id_token_hint||oe&&oe.id_token;return Te&&(c.Log.debug("UserManager._signoutStart: Setting id_token into signout request"),V.id_token_hint=Te),j.removeUser().then(function(){return c.Log.debug("UserManager._signoutStart: user removed, creating signout request"),j.createSignoutRequest(V).then(function(be){return c.Log.debug("UserManager._signoutStart: got signout request"),ie.url=be.url,be.state&&(ie.id=be.state.id),W.navigate(ie)})})})}).catch(function(oe){throw W.close&&(c.Log.debug("UserManager._signoutStart: Error after preparing navigator, closing navigator window"),W.close()),oe})})},M.prototype._signoutEnd=function(V){return this.processSignoutResponse(V).then(function(j){return c.Log.debug("UserManager._signoutEnd: got signout response"),j})},M.prototype.revokeAccessToken=function(){var V=this;return this._loadUser().then(function(j){return V._revokeInternal(j,!0).then(function(ne){if(ne)return c.Log.debug("UserManager.revokeAccessToken: removing token properties from user and re-storing"),j.access_token=null,j.refresh_token=null,j.expires_at=null,j.token_type=null,V.storeUser(j).then(function(){c.Log.debug("UserManager.revokeAccessToken: user stored"),V._events.load(j)})})}).then(function(){c.Log.info("UserManager.revokeAccessToken: access token revoked successfully")})},M.prototype._revokeInternal=function(V,j){var ne=this;if(V){var ie=V.access_token,W=V.refresh_token;return this._revokeAccessTokenInternal(ie,j).then(function(oe){return ne._revokeRefreshTokenInternal(W,j).then(function(Te){return oe||Te||c.Log.debug("UserManager.revokeAccessToken: no need to revoke due to no token(s), or JWT format"),oe||Te})})}return Promise.resolve(!1)},M.prototype._revokeAccessTokenInternal=function(V,j){return!V||V.indexOf(".")>=0?Promise.resolve(!1):this._tokenRevocationClient.revoke(V,j).then(function(){return!0})},M.prototype._revokeRefreshTokenInternal=function(V,j){return V?this._tokenRevocationClient.revoke(V,j,"refresh_token").then(function(){return!0}):Promise.resolve(!1)},M.prototype.startSilentRenew=function(){this._silentRenewService.start()},M.prototype.stopSilentRenew=function(){this._silentRenewService.stop()},M.prototype._loadUser=function(){return this._userStore.get(this._userStoreKey).then(function(V){return V?(c.Log.debug("UserManager._loadUser: user storageString loaded"),f.User.fromStorageString(V)):(c.Log.debug("UserManager._loadUser: no user storageString"),null)})},M.prototype.storeUser=function(V){if(V){c.Log.debug("UserManager.storeUser: storing user");var j=V.toStorageString();return this._userStore.set(this._userStoreKey,j)}return c.Log.debug("storeUser.storeUser: removing user"),this._userStore.remove(this._userStoreKey)},l(M,[{key:"_redirectNavigator",get:function(){return this.settings.redirectNavigator}},{key:"_popupNavigator",get:function(){return this.settings.popupNavigator}},{key:"_iframeNavigator",get:function(){return this.settings.iframeNavigator}},{key:"_userStore",get:function(){return this.settings.userStore}},{key:"events",get:function(){return this._events}},{key:"_userStoreKey",get:function(){return"user:"+this.settings.authority+":"+this.settings.client_id}}]),M}(g.OidcClient)},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.UserManagerSettings=void 0;var l=function(){function P(A,b){for(var T=0;T<b.length;T++){var H=b[T];H.enumerable=H.enumerable||!1,H.configurable=!0,"value"in H&&(H.writable=!0),Object.defineProperty(A,H.key,H)}}return function(A,b,T){return b&&P(A.prototype,b),T&&P(A,T),A}}(),c=(u(0),u(5)),g=u(40),y=u(41),f=u(43),h=u(6),p=u(1),w=u(8);function x(P,A){if(!(P instanceof A))throw new TypeError("Cannot call a class as a function")}function F(P,A){if(!P)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!A||typeof A!="object"&&typeof A!="function"?P:A}o.UserManagerSettings=function(P){function A(){var b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},T=b.popup_redirect_uri,H=b.popup_post_logout_redirect_uri,M=b.popupWindowFeatures,G=b.popupWindowTarget,V=b.silent_redirect_uri,j=b.silentRequestTimeout,ne=b.automaticSilentRenew,ie=ne!==void 0&&ne,W=b.validateSubOnSilentRenew,oe=W!==void 0&&W,Te=b.includeIdTokenInSilentRenew,be=Te===void 0||Te,Z=b.monitorSession,ae=Z===void 0||Z,pe=b.monitorAnonymousSession,Ee=pe!==void 0&&pe,Fe=b.checkSessionInterval,le=Fe===void 0?2e3:Fe,_e=b.stopCheckSessionOnError,Me=_e===void 0||_e,qe=b.query_status_response_type,_t=b.revokeAccessTokenOnSignout,wt=_t!==void 0&&_t,Rt=b.accessTokenExpiringNotificationTime,Gt=Rt===void 0?60:Rt,dt=b.redirectNavigator,St=dt===void 0?new g.RedirectNavigator:dt,nt=b.popupNavigator,He=nt===void 0?new y.PopupNavigator:nt,J=b.iframeNavigator,m=J===void 0?new f.IFrameNavigator:J,_=b.userStore,L=_===void 0?new h.WebStorageStateStore({store:p.Global.sessionStorage}):_;x(this,A);var q=F(this,P.call(this,arguments[0]));return q._popup_redirect_uri=T,q._popup_post_logout_redirect_uri=H,q._popupWindowFeatures=M,q._popupWindowTarget=G,q._silent_redirect_uri=V,q._silentRequestTimeout=j,q._automaticSilentRenew=ie,q._validateSubOnSilentRenew=oe,q._includeIdTokenInSilentRenew=be,q._accessTokenExpiringNotificationTime=Gt,q._monitorSession=ae,q._monitorAnonymousSession=Ee,q._checkSessionInterval=le,q._stopCheckSessionOnError=Me,qe?q._query_status_response_type=qe:arguments[0]&&arguments[0].response_type?q._query_status_response_type=w.SigninRequest.isOidc(arguments[0].response_type)?"id_token":"code":q._query_status_response_type="id_token",q._revokeAccessTokenOnSignout=wt,q._redirectNavigator=St,q._popupNavigator=He,q._iframeNavigator=m,q._userStore=L,q}return function(T,H){if(typeof H!="function"&&H!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof H);T.prototype=Object.create(H&&H.prototype,{constructor:{value:T,enumerable:!1,writable:!0,configurable:!0}}),H&&(Object.setPrototypeOf?Object.setPrototypeOf(T,H):T.__proto__=H)}(A,P),l(A,[{key:"popup_redirect_uri",get:function(){return this._popup_redirect_uri}},{key:"popup_post_logout_redirect_uri",get:function(){return this._popup_post_logout_redirect_uri}},{key:"popupWindowFeatures",get:function(){return this._popupWindowFeatures}},{key:"popupWindowTarget",get:function(){return this._popupWindowTarget}},{key:"silent_redirect_uri",get:function(){return this._silent_redirect_uri}},{key:"silentRequestTimeout",get:function(){return this._silentRequestTimeout}},{key:"automaticSilentRenew",get:function(){return this._automaticSilentRenew}},{key:"validateSubOnSilentRenew",get:function(){return this._validateSubOnSilentRenew}},{key:"includeIdTokenInSilentRenew",get:function(){return this._includeIdTokenInSilentRenew}},{key:"accessTokenExpiringNotificationTime",get:function(){return this._accessTokenExpiringNotificationTime}},{key:"monitorSession",get:function(){return this._monitorSession}},{key:"monitorAnonymousSession",get:function(){return this._monitorAnonymousSession}},{key:"checkSessionInterval",get:function(){return this._checkSessionInterval}},{key:"stopCheckSessionOnError",get:function(){return this._stopCheckSessionOnError}},{key:"query_status_response_type",get:function(){return this._query_status_response_type}},{key:"revokeAccessTokenOnSignout",get:function(){return this._revokeAccessTokenOnSignout}},{key:"redirectNavigator",get:function(){return this._redirectNavigator}},{key:"popupNavigator",get:function(){return this._popupNavigator}},{key:"iframeNavigator",get:function(){return this._iframeNavigator}},{key:"userStore",get:function(){return this._userStore}}]),A}(c.OidcClientSettings)},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.RedirectNavigator=void 0;var l=function(){function g(y,f){for(var h=0;h<f.length;h++){var p=f[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(y,p.key,p)}}return function(y,f,h){return f&&g(y.prototype,f),h&&g(y,h),y}}(),c=u(0);o.RedirectNavigator=function(){function g(){(function(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")})(this,g)}return g.prototype.prepare=function(){return Promise.resolve(this)},g.prototype.navigate=function(f){return f&&f.url?(f.useReplaceToNavigate?window.location.replace(f.url):window.location=f.url,Promise.resolve()):(c.Log.error("RedirectNavigator.navigate: No url provided"),Promise.reject(new Error("No url provided")))},l(g,[{key:"url",get:function(){return window.location.href}}]),g}()},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.PopupNavigator=void 0;var l=u(0),c=u(42);o.PopupNavigator=function(){function g(){(function(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")})(this,g)}return g.prototype.prepare=function(f){var h=new c.PopupWindow(f);return Promise.resolve(h)},g.prototype.callback=function(f,h,p){l.Log.debug("PopupNavigator.callback");try{return c.PopupWindow.notifyOpener(f,h,p),Promise.resolve()}catch(w){return Promise.reject(w)}},g}()},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.PopupWindow=void 0;var l=function(){function y(f,h){for(var p=0;p<h.length;p++){var w=h[p];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),Object.defineProperty(f,w.key,w)}}return function(f,h,p){return h&&y(f.prototype,h),p&&y(f,p),f}}(),c=u(0),g=u(3);o.PopupWindow=function(){function y(f){var h=this;(function(F,P){if(!(F instanceof P))throw new TypeError("Cannot call a class as a function")})(this,y),this._promise=new Promise(function(x,F){h._resolve=x,h._reject=F});var p=f.popupWindowTarget||"_blank",w=f.popupWindowFeatures||"location=no,toolbar=no,width=500,height=500,left=100,top=100;";this._popup=window.open("",p,w),this._popup&&(c.Log.debug("PopupWindow.ctor: popup successfully created"),this._checkForPopupClosedTimer=window.setInterval(this._checkForPopupClosed.bind(this),500))}return y.prototype.navigate=function(h){return this._popup?h&&h.url?(c.Log.debug("PopupWindow.navigate: Setting URL in popup"),this._id=h.id,this._id&&(window["popupCallback_"+h.id]=this._callback.bind(this)),this._popup.focus(),this._popup.window.location=h.url):(this._error("PopupWindow.navigate: no url provided"),this._error("No url provided")):this._error("PopupWindow.navigate: Error opening popup window"),this.promise},y.prototype._success=function(h){c.Log.debug("PopupWindow.callback: Successful response from popup window"),this._cleanup(),this._resolve(h)},y.prototype._error=function(h){c.Log.error("PopupWindow.error: ",h),this._cleanup(),this._reject(new Error(h))},y.prototype.close=function(){this._cleanup(!1)},y.prototype._cleanup=function(h){c.Log.debug("PopupWindow.cleanup"),window.clearInterval(this._checkForPopupClosedTimer),this._checkForPopupClosedTimer=null,delete window["popupCallback_"+this._id],this._popup&&!h&&this._popup.close(),this._popup=null},y.prototype._checkForPopupClosed=function(){this._popup&&!this._popup.closed||this._error("Popup window closed")},y.prototype._callback=function(h,p){this._cleanup(p),h?(c.Log.debug("PopupWindow.callback success"),this._success({url:h})):(c.Log.debug("PopupWindow.callback: Invalid response from popup"),this._error("Invalid response from popup"))},y.notifyOpener=function(h,p,w){if(window.opener){if(h=h||window.location.href){var x=g.UrlUtility.parseUrlFragment(h,w);if(x.state){var F="popupCallback_"+x.state,P=window.opener[F];P?(c.Log.debug("PopupWindow.notifyOpener: passing url message to opener"),P(h,p)):c.Log.warn("PopupWindow.notifyOpener: no matching callback found on opener")}else c.Log.warn("PopupWindow.notifyOpener: no state found in response url")}}else c.Log.warn("PopupWindow.notifyOpener: no window.opener. Can't complete notification.")},l(y,[{key:"promise",get:function(){return this._promise}}]),y}()},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.IFrameNavigator=void 0;var l=u(0),c=u(44);o.IFrameNavigator=function(){function g(){(function(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")})(this,g)}return g.prototype.prepare=function(f){var h=new c.IFrameWindow(f);return Promise.resolve(h)},g.prototype.callback=function(f){l.Log.debug("IFrameNavigator.callback");try{return c.IFrameWindow.notifyParent(f),Promise.resolve()}catch(h){return Promise.reject(h)}},g}()},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.IFrameWindow=void 0;var l=function(){function g(y,f){for(var h=0;h<f.length;h++){var p=f[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(y,p.key,p)}}return function(y,f,h){return f&&g(y.prototype,f),h&&g(y,h),y}}(),c=u(0);o.IFrameWindow=function(){function g(y){var f=this;(function(p,w){if(!(p instanceof w))throw new TypeError("Cannot call a class as a function")})(this,g),this._promise=new Promise(function(h,p){f._resolve=h,f._reject=p}),this._boundMessageEvent=this._message.bind(this),window.addEventListener("message",this._boundMessageEvent,!1),this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="absolute",this._frame.width=0,this._frame.height=0,window.document.body.appendChild(this._frame)}return g.prototype.navigate=function(f){if(f&&f.url){var h=f.silentRequestTimeout||1e4;c.Log.debug("IFrameWindow.navigate: Using timeout of:",h),this._timer=window.setTimeout(this._timeout.bind(this),h),this._frame.src=f.url}else this._error("No url provided");return this.promise},g.prototype._success=function(f){this._cleanup(),c.Log.debug("IFrameWindow: Successful response from frame window"),this._resolve(f)},g.prototype._error=function(f){this._cleanup(),c.Log.error(f),this._reject(new Error(f))},g.prototype.close=function(){this._cleanup()},g.prototype._cleanup=function(){this._frame&&(c.Log.debug("IFrameWindow: cleanup"),window.removeEventListener("message",this._boundMessageEvent,!1),window.clearTimeout(this._timer),window.document.body.removeChild(this._frame),this._timer=null,this._frame=null,this._boundMessageEvent=null)},g.prototype._timeout=function(){c.Log.debug("IFrameWindow.timeout"),this._error("Frame window timed out")},g.prototype._message=function(f){if(c.Log.debug("IFrameWindow.message"),this._timer&&f.origin===this._origin&&f.source===this._frame.contentWindow&&typeof f.data=="string"&&(f.data.startsWith("http://")||f.data.startsWith("https://"))){var h=f.data;h?this._success({url:h}):this._error("Invalid response from frame")}},g.notifyParent=function(f){c.Log.debug("IFrameWindow.notifyParent"),(f=f||window.location.href)&&(c.Log.debug("IFrameWindow.notifyParent: posting url message to parent"),window.parent.postMessage(f,location.protocol+"//"+location.host))},l(g,[{key:"promise",get:function(){return this._promise}},{key:"_origin",get:function(){return location.protocol+"//"+location.host}}]),g}()},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.UserManagerEvents=void 0;var l=u(0),c=u(16),g=u(17);o.UserManagerEvents=function(y){function f(h){(function(x,F){if(!(x instanceof F))throw new TypeError("Cannot call a class as a function")})(this,f);var p=function(x,F){if(!x)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!F||typeof F!="object"&&typeof F!="function"?x:F}(this,y.call(this,h));return p._userLoaded=new g.Event("User loaded"),p._userUnloaded=new g.Event("User unloaded"),p._silentRenewError=new g.Event("Silent renew error"),p._userSignedIn=new g.Event("User signed in"),p._userSignedOut=new g.Event("User signed out"),p._userSessionChanged=new g.Event("User session changed"),p}return function(p,w){if(typeof w!="function"&&w!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof w);p.prototype=Object.create(w&&w.prototype,{constructor:{value:p,enumerable:!1,writable:!0,configurable:!0}}),w&&(Object.setPrototypeOf?Object.setPrototypeOf(p,w):p.__proto__=w)}(f,y),f.prototype.load=function(p){var w=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];l.Log.debug("UserManagerEvents.load"),y.prototype.load.call(this,p),w&&this._userLoaded.raise(p)},f.prototype.unload=function(){l.Log.debug("UserManagerEvents.unload"),y.prototype.unload.call(this),this._userUnloaded.raise()},f.prototype.addUserLoaded=function(p){this._userLoaded.addHandler(p)},f.prototype.removeUserLoaded=function(p){this._userLoaded.removeHandler(p)},f.prototype.addUserUnloaded=function(p){this._userUnloaded.addHandler(p)},f.prototype.removeUserUnloaded=function(p){this._userUnloaded.removeHandler(p)},f.prototype.addSilentRenewError=function(p){this._silentRenewError.addHandler(p)},f.prototype.removeSilentRenewError=function(p){this._silentRenewError.removeHandler(p)},f.prototype._raiseSilentRenewError=function(p){l.Log.debug("UserManagerEvents._raiseSilentRenewError",p.message),this._silentRenewError.raise(p)},f.prototype.addUserSignedIn=function(p){this._userSignedIn.addHandler(p)},f.prototype.removeUserSignedIn=function(p){this._userSignedIn.removeHandler(p)},f.prototype._raiseUserSignedIn=function(){l.Log.debug("UserManagerEvents._raiseUserSignedIn"),this._userSignedIn.raise()},f.prototype.addUserSignedOut=function(p){this._userSignedOut.addHandler(p)},f.prototype.removeUserSignedOut=function(p){this._userSignedOut.removeHandler(p)},f.prototype._raiseUserSignedOut=function(){l.Log.debug("UserManagerEvents._raiseUserSignedOut"),this._userSignedOut.raise()},f.prototype.addUserSessionChanged=function(p){this._userSessionChanged.addHandler(p)},f.prototype.removeUserSessionChanged=function(p){this._userSessionChanged.removeHandler(p)},f.prototype._raiseUserSessionChanged=function(){l.Log.debug("UserManagerEvents._raiseUserSessionChanged"),this._userSessionChanged.raise()},f}(c.AccessTokenEvents)},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.Timer=void 0;var l=function(){function p(w,x){for(var F=0;F<x.length;F++){var P=x[F];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(w,P.key,P)}}return function(w,x,F){return x&&p(w.prototype,x),F&&p(w,F),w}}(),c=u(0),g=u(1),y=u(17);function f(p,w){if(!(p instanceof w))throw new TypeError("Cannot call a class as a function")}function h(p,w){if(!p)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!w||typeof w!="object"&&typeof w!="function"?p:w}o.Timer=function(p){function w(x){var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:g.Global.timer,P=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;f(this,w);var A=h(this,p.call(this,x));return A._timer=F,A._nowFunc=P||function(){return Date.now()/1e3},A}return function(F,P){if(typeof P!="function"&&P!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof P);F.prototype=Object.create(P&&P.prototype,{constructor:{value:F,enumerable:!1,writable:!0,configurable:!0}}),P&&(Object.setPrototypeOf?Object.setPrototypeOf(F,P):F.__proto__=P)}(w,p),w.prototype.init=function(F){F<=0&&(F=1),F=parseInt(F);var P=this.now+F;if(this.expiration===P&&this._timerHandle)c.Log.debug("Timer.init timer "+this._name+" skipping initialization since already initialized for expiration:",this.expiration);else{this.cancel(),c.Log.debug("Timer.init timer "+this._name+" for duration:",F),this._expiration=P;var A=5;F<A&&(A=F),this._timerHandle=this._timer.setInterval(this._callback.bind(this),1e3*A)}},w.prototype.cancel=function(){this._timerHandle&&(c.Log.debug("Timer.cancel: ",this._name),this._timer.clearInterval(this._timerHandle),this._timerHandle=null)},w.prototype._callback=function(){var F=this._expiration-this.now;c.Log.debug("Timer.callback; "+this._name+" timer expires in:",F),this._expiration<=this.now&&(this.cancel(),p.prototype.raise.call(this))},l(w,[{key:"now",get:function(){return parseInt(this._nowFunc())}},{key:"expiration",get:function(){return this._expiration}}]),w}(y.Event)},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.SilentRenewService=void 0;var l=u(0);o.SilentRenewService=function(){function c(g){(function(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")})(this,c),this._userManager=g}return c.prototype.start=function(){this._callback||(this._callback=this._tokenExpiring.bind(this),this._userManager.events.addAccessTokenExpiring(this._callback),this._userManager.getUser().then(function(y){}).catch(function(y){l.Log.error("SilentRenewService.start: Error from getUser:",y.message)}))},c.prototype.stop=function(){this._callback&&(this._userManager.events.removeAccessTokenExpiring(this._callback),delete this._callback)},c.prototype._tokenExpiring=function(){var y=this;this._userManager.signinSilent().then(function(f){l.Log.debug("SilentRenewService._tokenExpiring: Silent token renewal successful")},function(f){l.Log.error("SilentRenewService._tokenExpiring: Error from signinSilent:",f.message),y._userManager.events._raiseSilentRenewError(f)})},c}()},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.CordovaPopupNavigator=void 0;var l=u(21);o.CordovaPopupNavigator=function(){function c(){(function(y,f){if(!(y instanceof f))throw new TypeError("Cannot call a class as a function")})(this,c)}return c.prototype.prepare=function(y){var f=new l.CordovaPopupWindow(y);return Promise.resolve(f)},c}()},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.CordovaIFrameNavigator=void 0;var l=u(21);o.CordovaIFrameNavigator=function(){function c(){(function(y,f){if(!(y instanceof f))throw new TypeError("Cannot call a class as a function")})(this,c)}return c.prototype.prepare=function(y){y.popupWindowFeatures="hidden=yes";var f=new l.CordovaPopupWindow(y);return Promise.resolve(f)},c}()},function(s,o,u){Object.defineProperty(o,"__esModule",{value:!0}),o.Version="1.11.6"}])})})(At);function Ac(r,n){var s,o,u,l;throw r.error==="invalid_redirect_uri"?new Error(`Dynamic client registration failed: the provided redirect uri [${(s=n.redirectUrl)===null||s===void 0?void 0:s.toString()}] is invalid - ${(o=r.error_description)!==null&&o!==void 0?o:""}`):r.error==="invalid_client_metadata"?new Error(`Dynamic client registration failed: the provided client metadata ${JSON.stringify(n)} is invalid - ${(u=r.error_description)!==null&&u!==void 0?u:""}`):new Error(`Dynamic client registration failed: ${r.error} - ${(l=r.error_description)!==null&&l!==void 0?l:""}`)}function Pc(r,n){if(r.client_id===void 0)throw new Error(`Dynamic client registration failed: no client_id has been found on ${JSON.stringify(r)}`);if(n.redirectUrl&&(r.redirect_uris===void 0||r.redirect_uris[0]!==n.redirectUrl.toString()))throw new Error(`Dynamic client registration failed: the returned redirect URIs ${JSON.stringify(r.redirect_uris)} don't match the provided ${JSON.stringify([n.redirectUrl.toString()])}`)}async function Tc(r,n){var s;if(!n.registrationEndpoint)throw new Error("Dynamic Registration could not be completed because the issuer has no registration endpoint.");if(!Array.isArray(n.idTokenSigningAlgValuesSupported))throw new Error("The OIDC issuer discovery profile is missing the 'id_token_signing_alg_values_supported' value, which is mandatory.");const o=xe.determineSigningAlg(n.idTokenSigningAlgValuesSupported,xe.PREFERRED_SIGNING_ALG),u={client_name:r.clientName,application_type:"web",redirect_uris:[(s=r.redirectUrl)===null||s===void 0?void 0:s.toString()],subject_type:"public",token_endpoint_auth_method:"client_secret_basic",id_token_signed_response_alg:o,grant_types:["authorization_code","refresh_token"]},l={"Content-Type":"application/json"},c=await fetch(n.registrationEndpoint.toString(),{method:"POST",headers:l,body:JSON.stringify(u)});if(c.ok){const g=await c.json();return Pc(g,r),{clientId:g.client_id,clientSecret:g.client_secret,idTokenSignedResponseAlg:g.id_token_signed_response_alg,clientType:"dynamic"}}throw c.status===400&&Ac(await c.json(),r),new Error(`Dynamic client registration failed: the server returned ${c.status} ${c.statusText} - ${await c.text()}`)}function Cc(r){return r.error!==void 0&&typeof r.error=="string"}function ao(r){return r.error_description!==void 0&&typeof r.error_description=="string"}function xc(r){return r.error_uri!==void 0&&typeof r.error_uri=="string"}function Rc(r){return r.access_token!==void 0&&typeof r.access_token=="string"}function Ic(r){return r.id_token!==void 0&&typeof r.id_token=="string"}function kc(r){return r.refresh_token!==void 0&&typeof r.refresh_token=="string"}function Uc(r){return r.token_type!==void 0&&typeof r.token_type=="string"}function Oc(r){return r.expires_in===void 0||typeof r.expires_in=="number"}function Dc(r,n){if(n.grantType&&(!r.grantTypesSupported||!r.grantTypesSupported.includes(n.grantType)))throw new Error(`The issuer [${r.issuer}] does not support the [${n.grantType}] grant`);if(!r.tokenEndpoint)throw new Error(`This issuer [${r.issuer}] does not have a token endpoint`)}function Fs(r,n){if(Cc(r))throw new xe.OidcProviderError(`Token endpoint returned error [${r.error}]${ao(r)?`: ${r.error_description}`:""}${xc(r)?` (see ${r.error_uri})`:""}`,r.error,ao(r)?r.error_description:void 0);if(!Rc(r))throw new xe.InvalidResponseError(["access_token"]);if(!Ic(r))throw new xe.InvalidResponseError(["id_token"]);if(!Uc(r))throw new xe.InvalidResponseError(["token_type"]);if(!Oc(r))throw new xe.InvalidResponseError(["expires_in"]);if(!n&&r.token_type.toLowerCase()!=="bearer")throw new Error(`Invalid token endpoint response: requested a [Bearer] token, but got a 'token_type' value of [${r.token_type}].`);return r}async function Hc(r,n,s,o){Dc(r,s);const u={"content-type":"application/x-www-form-urlencoded"};let l;o&&(l=await xe.generateDpopKeyPair(),u.DPoP=await xe.createDpopHeader(r.tokenEndpoint,"POST",l)),n.clientSecret&&(u.Authorization=`Basic ${btoa(`${n.clientId}:${n.clientSecret}`)}`);const c={grant_type:s.grantType,redirect_uri:s.redirectUrl,code:s.code,code_verifier:s.codeVerifier,client_id:n.clientId},g={method:"POST",headers:u,body:new URLSearchParams(c).toString()},f=await(await await fetch(r.tokenEndpoint,g)).json(),h=Fs(f,o),p=await xe.getWebidFromTokenPayload(h.id_token,r.jwksUri,r.issuer,n.clientId);return{accessToken:h.access_token,idToken:h.id_token,refreshToken:kc(h)?h.refresh_token:void 0,webId:p,dpopKey:l,expiresIn:h.expires_in}}async function Nc(r){let n;try{const s=new At.exports.OidcClient({response_mode:"query",loadUserInfo:!1});if(n=await s.processSigninResponse(r),s.settings.metadata===void 0)throw new Error("Cannot retrieve issuer metadata from client information in storage.");if(s.settings.metadata.jwks_uri===void 0)throw new Error("Missing some issuer metadata from client information in storage: 'jwks_uri' is undefined");if(s.settings.metadata.issuer===void 0)throw new Error("Missing some issuer metadata from client information in storage: 'issuer' is undefined");if(s.settings.client_id===void 0)throw new Error("Missing some client information in storage: 'client_id' is undefined");const o=await xe.getWebidFromTokenPayload(n.id_token,s.settings.metadata.jwks_uri,s.settings.metadata.issuer,s.settings.client_id);return{accessToken:n.access_token,idToken:n.id_token,webId:o,refreshToken:n.refresh_token}}catch(s){throw new Error(`Problem handling Auth Code Grant (Flow) redirect - URL [${r}]: ${s}`)}}async function Lc(r,n,s){return Hc(r,n,s,!0)}const Mc=r=>{try{return new URL(r),!0}catch{return!1}};async function Kc(r,n,s,o){if(s.clientId===void 0)throw new Error("No client ID available when trying to refresh the access token.");const u={grant_type:"refresh_token",refresh_token:r,scope:xe.DEFAULT_SCOPES};let l={};o!==void 0&&(l={DPoP:await xe.createDpopHeader(n.tokenEndpoint,"POST",o)});let c={};s.clientSecret!==void 0?c={Authorization:`Basic ${btoa(`${s.clientId}:${s.clientSecret}`)}`}:Mc(s.clientId)&&(u.client_id=s.clientId);const g=await fetch(n.tokenEndpoint,{method:"POST",body:new URLSearchParams(u).toString(),headers:{...l,...c,"Content-Type":"application/x-www-form-urlencoded"}});let y;try{y=await g.json()}catch{throw new Error(`The token endpoint of issuer ${n.issuer} returned a malformed response.`)}const f=Fs(y,o!==void 0),h=await xe.getWebidFromTokenPayload(f.id_token,n.jwksUri,n.issuer,s.clientId);return{accessToken:f.access_token,idToken:f.id_token,refreshToken:typeof f.refresh_token=="string"?f.refresh_token:void 0,webId:h,dpopKey:o,expiresIn:f.expires_in}}function Bc(r){const n=new URL(r);return n.searchParams.delete("code"),n.searchParams.delete("state"),n.hash="",n.toString()}async function jc(){await new At.exports.OidcClient({response_mode:"query"}).clearStaleState(new At.exports.WebStorageStateStore({}));const n=window.localStorage,s=[];for(let o=0;o<=n.length;o+=1){const u=n.key(o);u&&(u.match(/^oidc\..+$/)||u.match(/^solidClientAuthenticationUser:.+$/))&&s.push(u)}s.forEach(o=>n.removeItem(o))}var Wc=Object.freeze(Object.defineProperty({__proto__:null,clearOidcPersistentStorage:jc,getBearerToken:Nc,getDpopToken:Lc,refresh:Kc,registerClient:Tc,removeOidcQueryParam:Bc,CordovaIFrameNavigator:At.exports.CordovaIFrameNavigator,CordovaPopupNavigator:At.exports.CordovaPopupNavigator,InMemoryWebStorage:At.exports.InMemoryWebStorage,Log:At.exports.Log,OidcClient:At.exports.OidcClient,SessionMonitor:At.exports.SessionMonitor,User:At.exports.User,UserManager:At.exports.UserManager,Version:At.exports.Version,WebStorageStateStore:At.exports.WebStorageStateStore},Symbol.toStringTag,{value:"Module"})),Tr=ii(Wc);Object.defineProperty(Ai,"__esModule",{value:!0});const Vc=xe,Jc=Tr,uo=(r,n)=>window.fetch(r,n);class qc{constructor(n,s,o,u,l){this.loginHandler=n,this.redirectHandler=s,this.logoutHandler=o,this.sessionInfoManager=u,this.issuerConfigFetcher=l,this.login=async(c,g)=>{var y,f;await this.sessionInfoManager.clear(c.sessionId);const h=(0,Jc.removeOidcQueryParam)((y=c.redirectUrl)!==null&&y!==void 0?y:window.location.href);await this.loginHandler.handle({...c,redirectUrl:h,clientName:(f=c.clientName)!==null&&f!==void 0?f:c.clientId,eventEmitter:g})},this.fetch=uo,this.logout=async c=>{await this.logoutHandler.handle(c),this.fetch=uo},this.getSessionInfo=async c=>this.sessionInfoManager.get(c),this.getAllSessionInfo=async()=>this.sessionInfoManager.getAll(),this.validateCurrentSession=async c=>{const g=await this.sessionInfoManager.get(c);return g===void 0||g.clientAppId===void 0||g.issuer===void 0?null:g},this.handleIncomingRedirect=async(c,g)=>{try{const y=await this.redirectHandler.handle(c,g);return this.fetch=y.fetch.bind(window),this.cleanUrlAfterRedirect(c),{isLoggedIn:y.isLoggedIn,webId:y.webId,sessionId:y.sessionId,expirationDate:y.expirationDate}}catch(y){this.cleanUrlAfterRedirect(c),g.emit(Vc.EVENTS.ERROR,"redirect",y);return}}}cleanUrlAfterRedirect(n){const s=new URL(n);s.searchParams.delete("state"),s.searchParams.delete("code"),s.searchParams.delete("id_token"),s.searchParams.delete("access_token"),s.searchParams.delete("error"),s.searchParams.delete("error_description"),window.history.replaceState(null,"",s.toString())}}Ai.default=qc;var Pi={};Object.defineProperty(Pi,"__esModule",{value:!0});const Kn=xe;function co(r){return typeof r.oidcIssuer=="string"}function lo(r){return typeof r.redirectUrl=="string"}class $c{constructor(n,s,o,u){this.storageUtility=n,this.oidcHandler=s,this.issuerConfigFetcher=o,this.clientRegistrar=u}async canHandle(n){return co(n)&&lo(n)}async handle(n){if(!co(n))throw new Kn.ConfigurationError(`OidcLoginHandler requires an OIDC issuer: missing property 'oidcIssuer' in ${JSON.stringify(n)}`);if(!lo(n))throw new Kn.ConfigurationError(`OidcLoginHandler requires a redirect URL: missing property 'redirectUrl' in ${JSON.stringify(n)}`);const s=await this.issuerConfigFetcher.fetchConfig(n.oidcIssuer),o=await(0,Kn.handleRegistration)(n,s,this.storageUtility,this.clientRegistrar),u={issuer:s.issuer,dpop:n.tokenType.toLowerCase()==="dpop",...n,issuerConfiguration:s,client:o};return this.oidcHandler.handle(u)}}Pi.default=$c;var Ti={};Object.defineProperty(Ti,"__esModule",{value:!0});const Gc=xe,zc=Tr;class Yc{constructor(n,s){this.storageUtility=n,this.redirector=s}async canHandle(n){return!!(n.issuerConfiguration.grantTypesSupported&&n.issuerConfiguration.grantTypesSupported.indexOf("authorization_code")>-1)}async handle(n){var s;const o={authority:n.issuer.toString(),client_id:n.client.clientId,client_secret:n.client.clientSecret,redirect_uri:n.redirectUrl.toString(),post_logout_redirect_uri:n.redirectUrl.toString(),response_type:"code",scope:Gc.DEFAULT_SCOPES,filterProtocolClaims:!0,loadUserInfo:!1,code_verifier:!0,prompt:(s=n.prompt)!==null&&s!==void 0?s:"consent"},u=new zc.OidcClient(o),{redirector:l}=this,c=this.storageUtility;try{const g=await u.createSigninRequest();await Promise.all([c.setForUser(g.state._id,{sessionId:n.sessionId}),c.setForUser(n.sessionId,{codeVerifier:g.state._code_verifier,issuer:n.issuer.toString(),redirectUrl:n.redirectUrl,dpop:n.dpop?"true":"false"})]),l.redirect(g.url.toString(),{handleRedirect:n.handleRedirect})}catch(g){console.error(g)}}}Ti.default=Yc;var As={},Sn={};Object.defineProperty(Sn,"__esModule",{value:!0});Sn.appendToUrlPathname=void 0;function Xc(r,n){const s=new URL(r),o=s.pathname;return s.pathname=`${o}${o.endsWith("/")?"":"/"}${n.startsWith("/")?n.substring(1):n}`,s.toString()}Sn.appendToUrlPathname=Xc;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.WELL_KNOWN_OPENID_CONFIG=void 0;const n=xe,s=Sn;r.WELL_KNOWN_OPENID_CONFIG=".well-known/openid-configuration";const o={issuer:{toKey:"issuer",convertToUrl:!0},authorization_endpoint:{toKey:"authorizationEndpoint",convertToUrl:!0},token_endpoint:{toKey:"tokenEndpoint",convertToUrl:!0},userinfo_endpoint:{toKey:"userinfoEndpoint",convertToUrl:!0},jwks_uri:{toKey:"jwksUri",convertToUrl:!0},registration_endpoint:{toKey:"registrationEndpoint",convertToUrl:!0},scopes_supported:{toKey:"scopesSupported"},response_types_supported:{toKey:"responseTypesSupported"},response_modes_supported:{toKey:"responseModesSupported"},grant_types_supported:{toKey:"grantTypesSupported"},acr_values_supported:{toKey:"acrValuesSupported"},subject_types_supported:{toKey:"subjectTypesSupported"},id_token_signing_alg_values_supported:{toKey:"idTokenSigningAlgValuesSupported"},id_token_encryption_alg_values_supported:{toKey:"idTokenEncryptionAlgValuesSupported"},id_token_encryption_enc_values_supported:{toKey:"idTokenEncryptionEncValuesSupported"},userinfo_signing_alg_values_supported:{toKey:"userinfoSigningAlgValuesSupported"},userinfo_encryption_alg_values_supported:{toKey:"userinfoEncryptionAlgValuesSupported"},userinfo_encryption_enc_values_supported:{toKey:"userinfoEncryptionEncValuesSupported"},request_object_signing_alg_values_supported:{toKey:"requestObjectSigningAlgValuesSupported"},request_object_encryption_alg_values_supported:{toKey:"requestObjectEncryptionAlgValuesSupported"},request_object_encryption_enc_values_supported:{toKey:"requestObjectEncryptionEncValuesSupported"},token_endpoint_auth_methods_supported:{toKey:"tokenEndpointAuthMethodsSupported"},token_endpoint_auth_signing_alg_values_supported:{toKey:"tokenEndpointAuthSigningAlgValuesSupported"},display_values_supported:{toKey:"displayValuesSupported"},claim_types_supported:{toKey:"claimTypesSupported"},claims_supported:{toKey:"claimsSupported"},service_documentation:{toKey:"serviceDocumentation"},claims_locales_supported:{toKey:"claimsLocalesSupported"},ui_locales_supported:{toKey:"uiLocalesSupported"},claims_parameter_supported:{toKey:"claimsParameterSupported"},request_parameter_supported:{toKey:"requestParameterSupported"},request_uri_parameter_supported:{toKey:"requestUriParameterSupported"},require_request_uri_registration:{toKey:"requireRequestUriRegistration"},op_policy_uri:{toKey:"opPolicyUri",convertToUrl:!0},op_tos_uri:{toKey:"opTosUri",convertToUrl:!0}};function u(c){const g={};return Object.keys(c).forEach(y=>{o[y]&&(g[o[y].toKey]=c[y])}),Array.isArray(g.scopesSupported)||(g.scopesSupported=["openid"]),g}class l{constructor(g){this.storageUtility=g}static getLocalStorageKey(g){return`issuerConfig:${g}`}async fetchConfig(g){let y;const f=(0,s.appendToUrlPathname)(g,r.WELL_KNOWN_OPENID_CONFIG),h=await window.fetch(f);try{y=u(await h.json())}catch(p){throw new n.ConfigurationError(`[${g.toString()}] has an invalid configuration: ${p.message}`)}return await this.storageUtility.set(l.getLocalStorageKey(g),JSON.stringify(y)),y}}r.default=l})(As);var En={},qt={};Object.defineProperty(qt,"__esModule",{value:!0});qt.SessionInfoManager=qt.clear=qt.getUnauthenticatedSession=void 0;const Qc=xe,Zc=bi,el=Tr;function tl(){return{isLoggedIn:!1,sessionId:(0,Zc.v4)(),fetch}}qt.getUnauthenticatedSession=tl;async function Ps(r,n){await Promise.all([n.deleteAllUserData(r,{secure:!1}),n.deleteAllUserData(r,{secure:!0}),n.delete("clientKey",{secure:!1})]),await(0,el.clearOidcPersistentStorage)()}qt.clear=Ps;class rl{constructor(n){this.storageUtility=n}update(n,s){throw new Error("Not Implemented")}async get(n){var s;const o=await this.storageUtility.getForUser(n,"isLoggedIn",{secure:!0}),u=await this.storageUtility.getForUser(n,"webId",{secure:!0}),l=await this.storageUtility.getForUser(n,"clientId",{secure:!1}),c=await this.storageUtility.getForUser(n,"clientSecret",{secure:!1}),g=await this.storageUtility.getForUser(n,"redirectUrl",{secure:!1}),y=await this.storageUtility.getForUser(n,"refreshToken",{secure:!0}),f=await this.storageUtility.getForUser(n,"issuer",{secure:!1}),h=(s=await this.storageUtility.getForUser(n,"tokenType",{secure:!1}))!==null&&s!==void 0?s:"DPoP";if(!(0,Qc.isSupportedTokenType)(h))throw new Error(`Tokens of type [${h}] are not supported.`);if(!(l===void 0&&o===void 0&&u===void 0&&y===void 0))return{sessionId:n,webId:u,isLoggedIn:o==="true",redirectUrl:g,refreshToken:y,issuer:f,clientAppId:l,clientAppSecret:c,tokenType:h}}async getAll(){throw new Error("Not implemented")}async clear(n){return Ps(n,this.storageUtility)}async register(n){throw new Error("Not implemented")}async getRegisteredSessionIdAll(){throw new Error("Not implemented")}async clearAll(){throw new Error("Not implemented")}}qt.SessionInfoManager=rl;Object.defineProperty(En,"__esModule",{value:!0});En.FallbackRedirectHandler=void 0;const nl=qt;class il{async canHandle(n){try{return new URL(n),!0}catch(s){throw new Error(`[${n}] is not a valid URL, and cannot be used as a redirect URL: ${s}`)}}async handle(n){return(0,nl.getUnauthenticatedSession)()}}En.FallbackRedirectHandler=il;var Ci={};Object.defineProperty(Ci,"__esModule",{value:!0});class ol{constructor(n){this.sessionInfoManager=n}async canHandle(){return!0}async handle(n){await this.sessionInfoManager.clear(n)}}Ci.default=ol;var bn={};Object.defineProperty(bn,"__esModule",{value:!0});bn.AuthCodeRedirectHandler=void 0;const ho=xe,fo=Tr;class sl{constructor(n,s,o,u,l){this.storageUtility=n,this.sessionInfoManager=s,this.issuerConfigFetcher=o,this.clientRegistrar=u,this.tokerRefresher=l}async canHandle(n){try{const s=new URL(n);return s.searchParams.get("code")!==null&&s.searchParams.get("state")!==null}catch(s){throw new Error(`[${n}] is not a valid URL, and cannot be used as a redirect URL: ${s}`)}}async handle(n,s){if(!await this.canHandle(n))throw new Error(`AuthCodeRedirectHandler cannot handle [${n}]: it is missing one of [code, state].`);const o=new URL(n),u=o.searchParams.get("state"),l=await this.storageUtility.getForUser(u,"sessionId",{errorIfNull:!0}),{issuerConfig:c,codeVerifier:g,redirectUrl:y,dpop:f}=await(0,ho.loadOidcContextFromStorage)(l,this.storageUtility,this.issuerConfigFetcher);if(g===void 0)throw new Error(`The code verifier for session ${l} is missing from storage.`);if(y===void 0)throw new Error(`The redirect URL for session ${l} is missing from storage.`);const h=await this.clientRegistrar.getClient({sessionId:l},c);let p;const w=Date.now();f?(p=await(0,fo.getDpopToken)(c,h,{grantType:"authorization_code",code:o.searchParams.get("code"),codeVerifier:g,redirectUrl:y}),window.localStorage.removeItem(`oidc.${u}`)):p=await(0,fo.getBearerToken)(o.toString());let x;p.refreshToken!==void 0&&(x={sessionId:l,refreshToken:p.refreshToken,tokenRefresher:this.tokerRefresher});const F=await(0,ho.buildAuthenticatedFetch)(fetch,p.accessToken,{dpopKey:p.dpopKey,refreshOptions:x,eventEmitter:s,expiresIn:p.expiresIn});await this.storageUtility.setForUser(l,{webId:p.webId,isLoggedIn:"true"},{secure:!0}),o.searchParams.delete("code"),await this.storageUtility.setForUser(l,{redirectUrl:o.toString()},{secure:!1});const P=await this.sessionInfoManager.get(l);if(!P)throw new Error(`Could not retrieve session: [${l}].`);return Object.assign(P,{fetch:F,expirationDate:typeof p.expiresIn=="number"?w+p.expiresIn*1e3:null})}}bn.AuthCodeRedirectHandler=sl;var xi={};Object.defineProperty(xi,"__esModule",{value:!0});const al=xe;class ul extends al.AggregateHandler{constructor(n){super(n)}}xi.default=ul;var Ri={};Object.defineProperty(Ri,"__esModule",{value:!0});class cl{get storage(){return window.localStorage}async get(n){return this.storage.getItem(n)||void 0}async set(n,s){this.storage.setItem(n,s)}async delete(n){this.storage.removeItem(n)}}Ri.default=cl;var Ii={};Object.defineProperty(Ii,"__esModule",{value:!0});class ll{redirect(n,s){s&&s.handleRedirect?s.handleRedirect(n):s&&s.redirectByReplacingState?window.history.replaceState({},"",n):window.location.href=n}}Ii.default=ll;var ki={};Object.defineProperty(ki,"__esModule",{value:!0});const dl=Tr;class hl{constructor(n){this.storageUtility=n}async getClient(n,s){const[o,u]=await Promise.all([this.storageUtility.getForUser(n.sessionId,"clientId",{secure:!1}),this.storageUtility.getForUser(n.sessionId,"clientSecret",{secure:!1})]);if(o)return{clientId:o,clientSecret:u,clientType:"dynamic"};try{const l=await(0,dl.registerClient)(n,s),c={clientId:l.clientId};return l.clientSecret&&(c.clientSecret=l.clientSecret),l.idTokenSignedResponseAlg&&(c.idTokenSignedResponseAlg=l.idTokenSignedResponseAlg),await this.storageUtility.setForUser(n.sessionId,c,{secure:!1}),l}catch(l){throw new Error(`Client registration failed: [${l}]`)}}}ki.default=hl;var Fn={};Object.defineProperty(Fn,"__esModule",{value:!0});Fn.ErrorOidcHandler=void 0;const fl=xe,pl=qt;class gl{async canHandle(n){try{return new URL(n).searchParams.has("error")}catch(s){throw new Error(`[${n}] is not a valid URL, and cannot be used as a redirect URL: ${s}`)}}async handle(n,s){if(s!==void 0){const o=new URL(n),u=o.searchParams.get("error"),l=o.searchParams.get("error_description");s.emit(fl.EVENTS.ERROR,u,l)}return(0,pl.getUnauthenticatedSession)()}}Fn.ErrorOidcHandler=gl;var Ui={};Object.defineProperty(Ui,"__esModule",{value:!0});const po=xe,yl=Tr;class vl{constructor(n,s,o){this.storageUtility=n,this.issuerConfigFetcher=s,this.clientRegistrar=o}async refresh(n,s,o,u){const l=await(0,po.loadOidcContextFromStorage)(n,this.storageUtility,this.issuerConfigFetcher),c=await this.clientRegistrar.getClient({sessionId:n},l.issuerConfig);if(s===void 0)throw new Error(`Session [${n}] has no refresh token to allow it to refresh its access token.`);if(l.dpop&&o===void 0)throw new Error(`For session [${n}], the key bound to the DPoP access token must be provided to refresh said access token.`);const g=await(0,yl.refresh)(s,l.issuerConfig,c,o);return g.refreshToken!==void 0&&(u==null||u.emit(po.EVENTS.NEW_REFRESH_TOKEN,g.refreshToken),await this.storageUtility.setForUser(n,{refreshToken:g.refreshToken})),g}}Ui.default=vl;var Bt=ze&&ze.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Wr,"__esModule",{value:!0});Wr.getClientAuthenticationWithDependencies=void 0;const ml=xe,_l=Bt(Fi),wl=Bt(Ai),Sl=Bt(Pi),El=Bt(Ti),bl=Bt(As),Fl=En,Al=Bt(Ci),Pl=qt,Tl=bn,Cl=Bt(xi),xl=Bt(Ri),Rl=Bt(Ii),Il=Bt(ki),kl=Fn,Ul=Bt(Ui);function Ol(r){const n=new ml.InMemoryStorage,s=r.secureStorage||n,o=r.insecureStorage||new xl.default,u=new _l.default(s,o),l=new bl.default(u),c=new Il.default(u),g=new Pl.SessionInfoManager(u),y=new Ul.default(u,l,c),f=new Sl.default(u,new El.default(u,new Rl.default),l,c),h=new Cl.default([new kl.ErrorOidcHandler,new Tl.AuthCodeRedirectHandler(u,g,l,c,y),new Fl.FallbackRedirectHandler]);return new wl.default(f,h,new Al.default(g),g,l)}Wr.getClientAuthenticationWithDependencies=Ol;var Ar={};Object.defineProperty(Ar,"__esModule",{value:!0});Ar.KEY_CURRENT_URL=Ar.KEY_CURRENT_SESSION=void 0;const Ts=xe;Ar.KEY_CURRENT_SESSION=`${Ts.SOLID_CLIENT_AUTHN_KEY_PREFIX}currentSession`;Ar.KEY_CURRENT_URL=`${Ts.SOLID_CLIENT_AUTHN_KEY_PREFIX}currentUrl`;Object.defineProperty(hr,"__esModule",{value:!0});hr.Session=hr.silentlyAuthenticate=void 0;const Dl=oi.exports,Ot=xe,Hl=bi,go=Wr,mr=Ar;async function Cs(r,n,s){var o;const u=await n.validateCurrentSession(r);return u!==null?(window.localStorage.setItem(mr.KEY_CURRENT_URL,window.location.href),await n.login({sessionId:r,prompt:"none",oidcIssuer:u.issuer,redirectUrl:u.redirectUrl,clientId:u.clientAppId,clientSecret:u.clientAppSecret,tokenType:(o=u.tokenType)!==null&&o!==void 0?o:"DPoP"},s),!0):!1}hr.silentlyAuthenticate=Cs;function Nl(r){return!!(r!=null&&r.isLoggedIn)}class Ll extends Dl.EventEmitter{constructor(n={},s){super(),this.tokenRequestInProgress=!1,this.login=async o=>{var u;return await this.clientAuthentication.login({sessionId:this.info.sessionId,...o,tokenType:(u=o.tokenType)!==null&&u!==void 0?u:"DPoP"},this),new Promise(()=>{})},this.fetch=async(o,u)=>this.clientAuthentication.fetch(o,u),this.internalLogout=async o=>{window.localStorage.removeItem(mr.KEY_CURRENT_SESSION),await this.clientAuthentication.logout(this.info.sessionId),this.info.isLoggedIn=!1,o&&this.emit(Ot.EVENTS.LOGOUT)},this.logout=async()=>this.internalLogout(!0),this.handleIncomingRedirect=async(o={})=>{var u;if(this.info.isLoggedIn)return this.info;if(this.tokenRequestInProgress)return;const l=typeof o=="string"?{url:o}:o,c=(u=l.url)!==null&&u!==void 0?u:window.location.href;this.tokenRequestInProgress=!0;const g=await this.clientAuthentication.handleIncomingRedirect(c,this);if(Nl(g)){this.setSessionInfo(g);const y=window.localStorage.getItem(mr.KEY_CURRENT_URL);y===null?this.emit(Ot.EVENTS.LOGIN):(window.localStorage.removeItem(mr.KEY_CURRENT_URL),this.emit(Ot.EVENTS.SESSION_RESTORED,y))}else if(l.restorePreviousSession===!0){const y=window.localStorage.getItem(mr.KEY_CURRENT_SESSION);if(y!==null&&await Cs(y,this.clientAuthentication,this))return new Promise(()=>{})}return this.tokenRequestInProgress=!1,g},n.clientAuthentication?this.clientAuthentication=n.clientAuthentication:n.secureStorage&&n.insecureStorage?this.clientAuthentication=(0,go.getClientAuthenticationWithDependencies)({secureStorage:n.secureStorage,insecureStorage:n.insecureStorage}):this.clientAuthentication=(0,go.getClientAuthenticationWithDependencies)({}),n.sessionInfo?this.info={sessionId:n.sessionInfo.sessionId,isLoggedIn:!1,webId:n.sessionInfo.webId}:this.info={sessionId:s!=null?s:(0,Hl.v4)(),isLoggedIn:!1},this.on(Ot.EVENTS.LOGIN,()=>window.localStorage.setItem(mr.KEY_CURRENT_SESSION,this.info.sessionId)),this.on(Ot.EVENTS.SESSION_EXPIRED,()=>this.internalLogout(!1)),this.on(Ot.EVENTS.ERROR,()=>this.internalLogout(!1))}onLogin(n){this.on(Ot.EVENTS.LOGIN,n)}onLogout(n){this.on(Ot.EVENTS.LOGOUT,n)}onError(n){this.on(Ot.EVENTS.ERROR,n)}onSessionRestore(n){this.on(Ot.EVENTS.SESSION_RESTORED,n)}onSessionExpiration(n){this.on(Ot.EVENTS.SESSION_EXPIRED,n)}setSessionInfo(n){this.info.isLoggedIn=n.isLoggedIn,this.info.webId=n.webId,this.info.sessionId=n.sessionId,this.info.expirationDate=n.expirationDate,this.on(Ot.EVENTS.SESSION_EXTENDED,s=>{this.info.expirationDate=Date.now()+s*1e3})}}hr.Session=Ll;var it={};Object.defineProperty(it,"__esModule",{value:!0});it.onSessionRestore=it.onLogout=it.onLogin=it.handleIncomingRedirect=it.logout=it.login=it.fetch=it.getDefaultSession=void 0;const Ml=hr;let Bn;function or(){return typeof Bn=="undefined"&&(Bn=new Ml.Session),Bn}it.getDefaultSession=or;const Kl=(...r)=>or().fetch(...r);it.fetch=Kl;const Bl=(...r)=>or().login(...r);it.login=Bl;const jl=(...r)=>or().logout(...r);it.logout=jl;const Wl=(...r)=>or().handleIncomingRedirect(...r);it.handleIncomingRedirect=Wl;const Vl=(...r)=>or().onLogin(...r);it.onLogin=Vl;const Jl=(...r)=>or().onLogout(...r);it.onLogout=Jl;const ql=(...r)=>or().onSessionRestore(...r);it.onSessionRestore=ql;(function(r){var n=ze&&ze.__createBinding||(Object.create?function(c,g,y,f){f===void 0&&(f=y);var h=Object.getOwnPropertyDescriptor(g,y);(!h||("get"in h?!g.__esModule:h.writable||h.configurable))&&(h={enumerable:!0,get:function(){return g[y]}}),Object.defineProperty(c,f,h)}:function(c,g,y,f){f===void 0&&(f=y),c[f]=g[y]}),s=ze&&ze.__exportStar||function(c,g){for(var y in c)y!=="default"&&!Object.prototype.hasOwnProperty.call(g,y)&&n(g,c,y)};Object.defineProperty(r,"__esModule",{value:!0}),r.InMemoryStorage=r.ConfigurationError=r.NotImplementedError=r.getClientAuthenticationWithDependencies=r.Session=void 0;var o=hr;Object.defineProperty(r,"Session",{enumerable:!0,get:function(){return o.Session}});var u=Wr;Object.defineProperty(r,"getClientAuthenticationWithDependencies",{enumerable:!0,get:function(){return u.getClientAuthenticationWithDependencies}}),s(it,r);var l=xe;Object.defineProperty(r,"NotImplementedError",{enumerable:!0,get:function(){return l.NotImplementedError}}),Object.defineProperty(r,"ConfigurationError",{enumerable:!0,get:function(){return l.ConfigurationError}}),Object.defineProperty(r,"InMemoryStorage",{enumerable:!0,get:function(){return l.InMemoryStorage}})})(Ws);const $l=r=>({}),yo=r=>({});function vo(r){let n;const s=r[5].icon,o=ni(s,r,r[4],yo);return{c(){o&&o.c()},l(u){o&&o.l(u)},m(u,l){o&&o.m(u,l),n=!0},p(u,l){o&&o.p&&(!n||l&16)&&ei(o,s,u,u[4],n?ri(s,u[4],l,$l):ti(u[4]),yo)},i(u){n||(er(o,u),n=!0)},o(u){dr(o,u),n=!1},d(u){o&&o.d(u)}}}function Gl(r){let n,s,o,u,l,c,g=r[3].icon&&vo(r);const y=r[5].default,f=ni(y,r,r[4],null);return{c(){n=rr("div"),g&&g.c(),s=jn(),o=rr("div"),f&&f.c(),this.h()},l(h){n=nr(h,"DIV",{class:!0});var p=Nr(n);g&&g.l(p),s=Wn(p),o=nr(p,"DIV",{class:!0});var w=Nr(o);f&&f.l(w),w.forEach(Kt),p.forEach(Kt),this.h()},h(){Ve(o,"class","div"),Ve(n,"class","rounded-md py-2 px-4 cursor-pointer bg-slate-100 hover:bg-slate-300 transition-colors flex items-center gap-2 svelte-c36zp3"),Ge(n,"filled",r[0]),Ge(n,"focused",r[1]),Ge(n,"destructive",r[2])},m(h,p){Pr(h,n,p),g&&g.m(n,null),cr(n,s),cr(n,o),f&&f.m(o,null),u=!0,l||(c=wr(n,"click",r[6]),l=!0)},p(h,[p]){h[3].icon?g?(g.p(h,p),p&8&&er(g,1)):(g=vo(h),g.c(),er(g,1),g.m(n,s)):g&&(Eo(),dr(g,1,1,()=>{g=null}),bo()),f&&f.p&&(!u||p&16)&&ei(f,y,h,h[4],u?ri(y,h[4],p,null):ti(h[4]),null),p&1&&Ge(n,"filled",h[0]),p&2&&Ge(n,"focused",h[1]),p&4&&Ge(n,"destructive",h[2])},i(h){u||(er(g),er(f,h),u=!0)},o(h){dr(g),dr(f,h),u=!1},d(h){h&&Kt(n),g&&g.d(),f&&f.d(h),l=!1,c()}}}function zl(r,n,s){let{$$slots:o={},$$scope:u}=n;const l=Fo(o);let{filled:c=!1}=n,{focused:g=!1}=n,{destructive:y=!1}=n;function f(h){Vn.call(this,r,h)}return r.$$set=h=>{"filled"in h&&s(0,c=h.filled),"focused"in h&&s(1,g=h.focused),"destructive"in h&&s(2,y=h.destructive),"$$scope"in h&&s(4,u=h.$$scope)},[c,g,y,l,u,o,f]}class ad extends _o{constructor(n){super(),wo(this,n,zl,Gl,So,{filled:0,focused:1,destructive:2})}}function Yl(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const n=Math.random()*16|0;return(r=="x"?n:n&3|8).toString(16)})}const Xl=r=>({}),mo=r=>({});function Ql(r){let n;return{c(){n=Ao(r[1])},l(s){n=Po(s,r[1])},m(s,o){Pr(s,n,o)},p(s,o){o&2&&To(n,s[1])},i:Yi,o:Yi,d(s){s&&Kt(n)}}}function Zl(r){let n;const s=r[8].label,o=ni(s,r,r[7],mo);return{c(){o&&o.c()},l(u){o&&o.l(u)},m(u,l){o&&o.m(u,l),n=!0},p(u,l){o&&o.p&&(!n||l&128)&&ei(o,s,u,u[7],n?ri(s,u[7],l,Xl):ti(u[7]),mo)},i(u){n||(er(o,u),n=!0)},o(u){dr(o,u),n=!1},d(u){o&&o.d(u)}}}function ed(r){let n,s,o,u;return{c(){n=rr("input"),this.h()},l(l){n=nr(l,"INPUT",{id:!0,class:!0,type:!0,placeholder:!0}),this.h()},h(){Ve(n,"id",r[5]),Ve(n,"class","rounded-md p-2 w-full bg-slate-100 hover:ring transition-all"),Ve(n,"type","text"),Ve(n,"placeholder",s=r[2]||r[1]),Ge(n,"ring",r[3]),Ge(n,"ring-red-500",r[3])},m(l,c){Pr(l,n,c),Sr(n,r[0]),o||(u=wr(n,"input",r[13]),o=!0)},p(l,c){c&6&&s!==(s=l[2]||l[1])&&Ve(n,"placeholder",s),c&1&&n.value!==l[0]&&Sr(n,l[0]),c&8&&Ge(n,"ring",l[3]),c&8&&Ge(n,"ring-red-500",l[3])},d(l){l&&Kt(n),o=!1,u()}}}function td(r){let n,s,o,u;return{c(){n=rr("input"),this.h()},l(l){n=nr(l,"INPUT",{id:!0,class:!0,type:!0,placeholder:!0}),this.h()},h(){Ve(n,"id",r[5]),Ve(n,"class","rounded-md p-2 w-full bg-slate-100 hover:ring transition-all"),Ve(n,"type","time"),Ve(n,"placeholder",s=r[2]||r[1]),Ge(n,"ring",r[3]),Ge(n,"ring-red-500",r[3])},m(l,c){Pr(l,n,c),Sr(n,r[0]),o||(u=[wr(n,"input",r[12]),wr(n,"change",r[10])],o=!0)},p(l,c){c&6&&s!==(s=l[2]||l[1])&&Ve(n,"placeholder",s),c&1&&Sr(n,l[0]),c&8&&Ge(n,"ring",l[3]),c&8&&Ge(n,"ring-red-500",l[3])},d(l){l&&Kt(n),o=!1,Co(u)}}}function rd(r){let n,s,o,u;return{c(){n=rr("input"),this.h()},l(l){n=nr(l,"INPUT",{id:!0,class:!0,type:!0,placeholder:!0}),this.h()},h(){Ve(n,"id",r[5]),Ve(n,"class","rounded-md p-2 w-full bg-slate-100 hover:ring transition-all"),Ve(n,"type","date"),Ve(n,"placeholder",s=r[2]||r[1]),Ge(n,"ring",r[3]),Ge(n,"ring-red-500",r[3])},m(l,c){Pr(l,n,c),Sr(n,r[0]),o||(u=[wr(n,"input",r[11]),wr(n,"change",r[9])],o=!0)},p(l,c){c&6&&s!==(s=l[2]||l[1])&&Ve(n,"placeholder",s),c&1&&Sr(n,l[0]),c&8&&Ge(n,"ring",l[3]),c&8&&Ge(n,"ring-red-500",l[3])},d(l){l&&Kt(n),o=!1,Co(u)}}}function nd(r){let n,s,o,u,l,c,g,y,f;const h=[Zl,Ql],p=[];function w(A,b){return A[6].label?0:A[1]?1:-1}~(o=w(r))&&(u=p[o]=h[o](r));function x(A,b){return A[4]=="date"?rd:A[4]=="time"?td:ed}let F=x(r),P=F(r);return{c(){n=rr("label"),s=rr("div"),u&&u.c(),l=jn(),P.c(),c=jn(),g=rr("div"),y=Ao(r[3]),this.h()},l(A){n=nr(A,"LABEL",{class:!0,for:!0});var b=Nr(n);s=nr(b,"DIV",{class:!0});var T=Nr(s);u&&u.l(T),T.forEach(Kt),l=Wn(b),P.l(b),c=Wn(b),g=nr(b,"DIV",{class:!0});var H=Nr(g);y=Po(H,r[3]),H.forEach(Kt),b.forEach(Kt),this.h()},h(){Ve(s,"class","mx-1 mb-px text-sm capitalize"),Ve(g,"class","text-sm h-2 text-red-700 "),Ge(g,"opacity-0",!r[3]),Ve(n,"class","my-4 block"),Ve(n,"for",r[5])},m(A,b){Pr(A,n,b),cr(n,s),~o&&p[o].m(s,null),cr(n,l),P.m(n,null),cr(n,c),cr(n,g),cr(g,y),f=!0},p(A,[b]){let T=o;o=w(A),o===T?~o&&p[o].p(A,b):(u&&(Eo(),dr(p[T],1,1,()=>{p[T]=null}),bo()),~o?(u=p[o],u?u.p(A,b):(u=p[o]=h[o](A),u.c()),er(u,1),u.m(s,null)):u=null),F===(F=x(A))&&P?P.p(A,b):(P.d(1),P=F(A),P&&(P.c(),P.m(n,c))),(!f||b&8)&&To(y,A[3]),b&8&&Ge(g,"opacity-0",!A[3])},i(A){f||(er(u),f=!0)},o(A){dr(u),f=!1},d(A){A&&Kt(n),~o&&p[o].d(),P.d()}}}function id(r,n,s){let{$$slots:o={},$$scope:u}=n;const l=Fo(o);let{label:c=""}=n,{placeholder:g=""}=n,{error:y=""}=n,{value:f=""}=n,{type:h="text"}=n,p=Yl();function w(b){Vn.call(this,r,b)}function x(b){Vn.call(this,r,b)}function F(){f=this.value,s(0,f)}function P(){f=this.value,s(0,f)}function A(){f=this.value,s(0,f)}return r.$$set=b=>{"label"in b&&s(1,c=b.label),"placeholder"in b&&s(2,g=b.placeholder),"error"in b&&s(3,y=b.error),"value"in b&&s(0,f=b.value),"type"in b&&s(4,h=b.type),"$$scope"in b&&s(7,u=b.$$scope)},[f,c,g,y,h,p,l,u,o,w,x,F,P,A]}class ud extends _o{constructor(n){super(),wo(this,n,id,nd,So,{label:1,placeholder:2,error:3,value:0,type:4})}}export{ad as B,ud as I,Yl as U,ze as a,sd as c,Ws as d,oi as e,ii as g};
