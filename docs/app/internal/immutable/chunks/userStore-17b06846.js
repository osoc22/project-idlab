import{w as hs}from"./index-b2bed869.js";function fs(r,n){return n.forEach(function(s){s&&typeof s!="string"&&!Array.isArray(s)&&Object.keys(s).forEach(function(o){if(o!=="default"&&!(o in r)){var c=Object.getOwnPropertyDescriptor(s,o);Object.defineProperty(r,o,c.get?c:{enumerable:!0,get:function(){return s[o]}})}})}),Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}function ps(r){return typeof r=="object"&&r!==null&&"message"in r&&typeof r.message=="string"}function gs(r){if(ps(r))return r;try{return new Error(JSON.stringify(r))}catch{return new Error(String(r))}}var $e=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function ys(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Kn(r){if(r.__esModule)return r;var n=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(r).forEach(function(s){var o=Object.getOwnPropertyDescriptor(r,s);Object.defineProperty(n,s,o.get?o:{enumerable:!0,get:function(){return r[s]}})}),n}var zt={},or={},Bn={exports:{}},hr=typeof Reflect=="object"?Reflect:null,ki=hr&&typeof hr.apply=="function"?hr.apply:function(n,s,o){return Function.prototype.apply.call(n,s,o)},Br;hr&&typeof hr.ownKeys=="function"?Br=hr.ownKeys:Object.getOwnPropertySymbols?Br=function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:Br=function(n){return Object.getOwnPropertyNames(n)};function vs(r){console&&console.warn&&console.warn(r)}var Yi=Number.isNaN||function(n){return n!==n};function Ie(){Ie.init.call(this)}Bn.exports=Ie;Bn.exports.once=ws;Ie.EventEmitter=Ie;Ie.prototype._events=void 0;Ie.prototype._eventsCount=0;Ie.prototype._maxListeners=void 0;var Ui=10;function Xr(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(Ie,"defaultMaxListeners",{enumerable:!0,get:function(){return Ui},set:function(r){if(typeof r!="number"||r<0||Yi(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");Ui=r}});Ie.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Ie.prototype.setMaxListeners=function(n){if(typeof n!="number"||n<0||Yi(n))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+n+".");return this._maxListeners=n,this};function Xi(r){return r._maxListeners===void 0?Ie.defaultMaxListeners:r._maxListeners}Ie.prototype.getMaxListeners=function(){return Xi(this)};Ie.prototype.emit=function(n){for(var s=[],o=1;o<arguments.length;o++)s.push(arguments[o]);var c=n==="error",l=this._events;if(l!==void 0)c=c&&l.error===void 0;else if(!c)return!1;if(c){var u;if(s.length>0&&(u=s[0]),u instanceof Error)throw u;var g=new Error("Unhandled error."+(u?" ("+u.message+")":""));throw g.context=u,g}var y=l[n];if(y===void 0)return!1;if(typeof y=="function")ki(y,this,s);else for(var f=y.length,h=ro(y,f),o=0;o<f;++o)ki(h[o],this,s);return!0};function Qi(r,n,s,o){var c,l,u;if(Xr(s),l=r._events,l===void 0?(l=r._events=Object.create(null),r._eventsCount=0):(l.newListener!==void 0&&(r.emit("newListener",n,s.listener?s.listener:s),l=r._events),u=l[n]),u===void 0)u=l[n]=s,++r._eventsCount;else if(typeof u=="function"?u=l[n]=o?[s,u]:[u,s]:o?u.unshift(s):u.push(s),c=Xi(r),c>0&&u.length>c&&!u.warned){u.warned=!0;var g=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+String(n)+" listeners added. Use emitter.setMaxListeners() to increase limit");g.name="MaxListenersExceededWarning",g.emitter=r,g.type=n,g.count=u.length,vs(g)}return r}Ie.prototype.addListener=function(n,s){return Qi(this,n,s,!1)};Ie.prototype.on=Ie.prototype.addListener;Ie.prototype.prependListener=function(n,s){return Qi(this,n,s,!0)};function ms(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Zi(r,n,s){var o={fired:!1,wrapFn:void 0,target:r,type:n,listener:s},c=ms.bind(o);return c.listener=s,o.wrapFn=c,c}Ie.prototype.once=function(n,s){return Xr(s),this.on(n,Zi(this,n,s)),this};Ie.prototype.prependOnceListener=function(n,s){return Xr(s),this.prependListener(n,Zi(this,n,s)),this};Ie.prototype.removeListener=function(n,s){var o,c,l,u,g;if(Xr(s),c=this._events,c===void 0)return this;if(o=c[n],o===void 0)return this;if(o===s||o.listener===s)--this._eventsCount===0?this._events=Object.create(null):(delete c[n],c.removeListener&&this.emit("removeListener",n,o.listener||s));else if(typeof o!="function"){for(l=-1,u=o.length-1;u>=0;u--)if(o[u]===s||o[u].listener===s){g=o[u].listener,l=u;break}if(l<0)return this;l===0?o.shift():_s(o,l),o.length===1&&(c[n]=o[0]),c.removeListener!==void 0&&this.emit("removeListener",n,g||s)}return this};Ie.prototype.off=Ie.prototype.removeListener;Ie.prototype.removeAllListeners=function(n){var s,o,c;if(o=this._events,o===void 0)return this;if(o.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):o[n]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete o[n]),this;if(arguments.length===0){var l=Object.keys(o),u;for(c=0;c<l.length;++c)u=l[c],u!=="removeListener"&&this.removeAllListeners(u);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(s=o[n],typeof s=="function")this.removeListener(n,s);else if(s!==void 0)for(c=s.length-1;c>=0;c--)this.removeListener(n,s[c]);return this};function eo(r,n,s){var o=r._events;if(o===void 0)return[];var c=o[n];return c===void 0?[]:typeof c=="function"?s?[c.listener||c]:[c]:s?Ss(c):ro(c,c.length)}Ie.prototype.listeners=function(n){return eo(this,n,!0)};Ie.prototype.rawListeners=function(n){return eo(this,n,!1)};Ie.listenerCount=function(r,n){return typeof r.listenerCount=="function"?r.listenerCount(n):to.call(r,n)};Ie.prototype.listenerCount=to;function to(r){var n=this._events;if(n!==void 0){var s=n[r];if(typeof s=="function")return 1;if(s!==void 0)return s.length}return 0}Ie.prototype.eventNames=function(){return this._eventsCount>0?Br(this._events):[]};function ro(r,n){for(var s=new Array(n),o=0;o<n;++o)s[o]=r[o];return s}function _s(r,n){for(;n+1<r.length;n++)r[n]=r[n+1];r.pop()}function Ss(r){for(var n=new Array(r.length),s=0;s<n.length;++s)n[s]=r[s].listener||r[s];return n}function ws(r,n){return new Promise(function(s,o){function c(u){r.removeListener(n,l),o(u)}function l(){typeof r.removeListener=="function"&&r.removeListener("error",c),s([].slice.call(arguments))}no(r,n,l,{once:!0}),n!=="error"&&Es(r,c,{once:!0})})}function Es(r,n,s){typeof r.on=="function"&&no(r,"error",n,s)}function no(r,n,s,o){if(typeof r.on=="function")o.once?r.once(n,s):r.on(n,s);else if(typeof r.addEventListener=="function")r.addEventListener(n,function c(l){o.once&&r.removeEventListener(n,c),s(l)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}var xe={},At={};Object.defineProperty(At,"__esModule",{value:!0});At.DEFAULT_SCOPES=At.REFRESH_BEFORE_EXPIRATION_SECONDS=At.EVENTS=At.PREFERRED_SIGNING_ALG=At.SOLID_CLIENT_AUTHN_KEY_PREFIX=void 0;At.SOLID_CLIENT_AUTHN_KEY_PREFIX="solidClientAuthn:";At.PREFERRED_SIGNING_ALG=["ES256","RS256"];At.EVENTS={ERROR:"error",LOGIN:"login",LOGOUT:"logout",NEW_REFRESH_TOKEN:"newRefreshToken",SESSION_EXPIRED:"sessionExpired",SESSION_EXTENDED:"sessionExtended",SESSION_RESTORED:"sessionRestore",TIMEOUT_SET:"timeoutSet"};At.REFRESH_BEFORE_EXPIRATION_SECONDS=5;const bs="openid",Fs="offline_access",As="webid";At.DEFAULT_SCOPES=[bs,Fs,As].join(" ");var jn={},Qr={};Object.defineProperty(Qr,"__esModule",{value:!0});class Yt extends Error{constructor(n,s,o=!0){super(typeof n=="string"?Yt.substituteParams(n,s):Yt.appendErrorIri(Yt.lookupErrorIri(n,s),n,o))}httpResponse(n,s=!0){return this.message=Yt.appendHttpResponseDetails(this.message,n,s),this.httpErrorResponse=n,this}hasHttpResponse(){return this.httpErrorResponse!==void 0}getHttpResponse(){return this.httpErrorResponse}getHttpStatusCode(){if(this.httpErrorResponse===void 0)throw new Yt("This InruptError was not provided with a HTTP response - so we can't get its HTTP Status Code.");return this.httpErrorResponse.status}getHttpStatusText(){if(this.httpErrorResponse===void 0)throw new Yt("This InruptError was not provided with a HTTP response - so we can't get its HTTP Status Text!");return this.httpErrorResponse.statusText}static determineIfVocabTerm(n){return n.strict!==void 0}static lookupErrorIri(n,s){if(Yt.determineIfVocabTerm(n)){const o=s===void 0?n.message:n.messageParams(...s);return o===void 0?`Looked up error message IRI [${n.value}], but found no message value.`:o}return`Error message looked up at: [${n.value}]${s===void 0?"":`, with params [${s.toString()}]`}`}static appendHttpResponseDetails(n,s,o){return o&&typeof s!="undefined"?`${n} HTTP details: status code [${s.status}], status text [${s.statusText}].`:n}static appendErrorIri(n,s,o){return o?`${n} Error IRI: [${s.value}].`:n}static substituteParams(n,s){let o=n;if(s!==void 0){const c=n.split("{{").length-1;if(c!==s.length)throw new Error(`Setting parameters on message [${n}], but it requires [${c}] params and we received [${s.length}].`);for(let l=0;l<s.length;l+=1){const u=`{{${l}}}`;o=o.replace(u,s[l])}}return o}}Qr.default=Yt;var Ps=$e&&$e.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(jn,"__esModule",{value:!0});const Ts=Ps(Qr);class Cs{constructor(n){this.handleables=n}async getProperHandler(n){const s=await Promise.all(this.handleables.map(o=>o.canHandle(...n)));for(let o=0;o<s.length;o+=1)if(s[o])return this.handleables[o];return null}async canHandle(...n){return await this.getProperHandler(n)!==null}async handle(...n){const s=await this.getProperHandler(n);if(s)return s.handle(...n);throw new Ts.default(`[${this.constructor.name}] cannot find a suitable handler for: ${n.map(o=>{try{return JSON.stringify(o)}catch{return o.toString()}}).join(", ")}`)}}jn.default=Cs;var fr={},pr={exports:{}};(function(r,n){var s=typeof self!="undefined"?self:$e,o=function(){function l(){this.fetch=!1,this.DOMException=s.DOMException}return l.prototype=s,new l}();(function(l){(function(u){var g={searchParams:"URLSearchParams"in l,iterable:"Symbol"in l&&"iterator"in Symbol,blob:"FileReader"in l&&"Blob"in l&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in l,arrayBuffer:"ArrayBuffer"in l};function y(Z){return Z&&DataView.prototype.isPrototypeOf(Z)}if(g.arrayBuffer)var f=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],h=ArrayBuffer.isView||function(Z){return Z&&f.indexOf(Object.prototype.toString.call(Z))>-1};function p(Z){if(typeof Z!="string"&&(Z=String(Z)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(Z))throw new TypeError("Invalid character in header field name");return Z.toLowerCase()}function E(Z){return typeof Z!="string"&&(Z=String(Z)),Z}function C(Z){var ae={next:function(){var pe=Z.shift();return{done:pe===void 0,value:pe}}};return g.iterable&&(ae[Symbol.iterator]=function(){return ae}),ae}function b(Z){this.map={},Z instanceof b?Z.forEach(function(ae,pe){this.append(pe,ae)},this):Array.isArray(Z)?Z.forEach(function(ae){this.append(ae[0],ae[1])},this):Z&&Object.getOwnPropertyNames(Z).forEach(function(ae){this.append(ae,Z[ae])},this)}b.prototype.append=function(Z,ae){Z=p(Z),ae=E(ae);var pe=this.map[Z];this.map[Z]=pe?pe+", "+ae:ae},b.prototype.delete=function(Z){delete this.map[p(Z)]},b.prototype.get=function(Z){return Z=p(Z),this.has(Z)?this.map[Z]:null},b.prototype.has=function(Z){return this.map.hasOwnProperty(p(Z))},b.prototype.set=function(Z,ae){this.map[p(Z)]=E(ae)},b.prototype.forEach=function(Z,ae){for(var pe in this.map)this.map.hasOwnProperty(pe)&&Z.call(ae,this.map[pe],pe,this)},b.prototype.keys=function(){var Z=[];return this.forEach(function(ae,pe){Z.push(pe)}),C(Z)},b.prototype.values=function(){var Z=[];return this.forEach(function(ae){Z.push(ae)}),C(Z)},b.prototype.entries=function(){var Z=[];return this.forEach(function(ae,pe){Z.push([pe,ae])}),C(Z)},g.iterable&&(b.prototype[Symbol.iterator]=b.prototype.entries);function x(Z){if(Z.bodyUsed)return Promise.reject(new TypeError("Already read"));Z.bodyUsed=!0}function R(Z){return new Promise(function(ae,pe){Z.onload=function(){ae(Z.result)},Z.onerror=function(){pe(Z.error)}})}function A(Z){var ae=new FileReader,pe=R(ae);return ae.readAsArrayBuffer(Z),pe}function P(Z){var ae=new FileReader,pe=R(ae);return ae.readAsText(Z),pe}function H(Z){for(var ae=new Uint8Array(Z),pe=new Array(ae.length),Ee=0;Ee<ae.length;Ee++)pe[Ee]=String.fromCharCode(ae[Ee]);return pe.join("")}function M(Z){if(Z.slice)return Z.slice(0);var ae=new Uint8Array(Z.byteLength);return ae.set(new Uint8Array(Z)),ae.buffer}function G(){return this.bodyUsed=!1,this._initBody=function(Z){this._bodyInit=Z,Z?typeof Z=="string"?this._bodyText=Z:g.blob&&Blob.prototype.isPrototypeOf(Z)?this._bodyBlob=Z:g.formData&&FormData.prototype.isPrototypeOf(Z)?this._bodyFormData=Z:g.searchParams&&URLSearchParams.prototype.isPrototypeOf(Z)?this._bodyText=Z.toString():g.arrayBuffer&&g.blob&&y(Z)?(this._bodyArrayBuffer=M(Z.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):g.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(Z)||h(Z))?this._bodyArrayBuffer=M(Z):this._bodyText=Z=Object.prototype.toString.call(Z):this._bodyText="",this.headers.get("content-type")||(typeof Z=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):g.searchParams&&URLSearchParams.prototype.isPrototypeOf(Z)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},g.blob&&(this.blob=function(){var Z=x(this);if(Z)return Z;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?x(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(A)}),this.text=function(){var Z=x(this);if(Z)return Z;if(this._bodyBlob)return P(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(H(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},g.formData&&(this.formData=function(){return this.text().then(ie)}),this.json=function(){return this.text().then(JSON.parse)},this}var J=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function j(Z){var ae=Z.toUpperCase();return J.indexOf(ae)>-1?ae:Z}function ne(Z,ae){ae=ae||{};var pe=ae.body;if(Z instanceof ne){if(Z.bodyUsed)throw new TypeError("Already read");this.url=Z.url,this.credentials=Z.credentials,ae.headers||(this.headers=new b(Z.headers)),this.method=Z.method,this.mode=Z.mode,this.signal=Z.signal,!pe&&Z._bodyInit!=null&&(pe=Z._bodyInit,Z.bodyUsed=!0)}else this.url=String(Z);if(this.credentials=ae.credentials||this.credentials||"same-origin",(ae.headers||!this.headers)&&(this.headers=new b(ae.headers)),this.method=j(ae.method||this.method||"GET"),this.mode=ae.mode||this.mode||null,this.signal=ae.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&pe)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(pe)}ne.prototype.clone=function(){return new ne(this,{body:this._bodyInit})};function ie(Z){var ae=new FormData;return Z.trim().split("&").forEach(function(pe){if(pe){var Ee=pe.split("="),Fe=Ee.shift().replace(/\+/g," "),le=Ee.join("=").replace(/\+/g," ");ae.append(decodeURIComponent(Fe),decodeURIComponent(le))}}),ae}function W(Z){var ae=new b,pe=Z.replace(/\r?\n[\t ]+/g," ");return pe.split(/\r?\n/).forEach(function(Ee){var Fe=Ee.split(":"),le=Fe.shift().trim();if(le){var _e=Fe.join(":").trim();ae.append(le,_e)}}),ae}G.call(ne.prototype);function oe(Z,ae){ae||(ae={}),this.type="default",this.status=ae.status===void 0?200:ae.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in ae?ae.statusText:"OK",this.headers=new b(ae.headers),this.url=ae.url||"",this._initBody(Z)}G.call(oe.prototype),oe.prototype.clone=function(){return new oe(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new b(this.headers),url:this.url})},oe.error=function(){var Z=new oe(null,{status:0,statusText:""});return Z.type="error",Z};var Te=[301,302,303,307,308];oe.redirect=function(Z,ae){if(Te.indexOf(ae)===-1)throw new RangeError("Invalid status code");return new oe(null,{status:ae,headers:{location:Z}})},u.DOMException=l.DOMException;try{new u.DOMException}catch{u.DOMException=function(ae,pe){this.message=ae,this.name=pe;var Ee=Error(ae);this.stack=Ee.stack},u.DOMException.prototype=Object.create(Error.prototype),u.DOMException.prototype.constructor=u.DOMException}function be(Z,ae){return new Promise(function(pe,Ee){var Fe=new ne(Z,ae);if(Fe.signal&&Fe.signal.aborted)return Ee(new u.DOMException("Aborted","AbortError"));var le=new XMLHttpRequest;function _e(){le.abort()}le.onload=function(){var Me={status:le.status,statusText:le.statusText,headers:W(le.getAllResponseHeaders()||"")};Me.url="responseURL"in le?le.responseURL:Me.headers.get("X-Request-URL");var Ve="response"in le?le.response:le.responseText;pe(new oe(Ve,Me))},le.onerror=function(){Ee(new TypeError("Network request failed"))},le.ontimeout=function(){Ee(new TypeError("Network request failed"))},le.onabort=function(){Ee(new u.DOMException("Aborted","AbortError"))},le.open(Fe.method,Fe.url,!0),Fe.credentials==="include"?le.withCredentials=!0:Fe.credentials==="omit"&&(le.withCredentials=!1),"responseType"in le&&g.blob&&(le.responseType="blob"),Fe.headers.forEach(function(Me,Ve){le.setRequestHeader(Ve,Me)}),Fe.signal&&(Fe.signal.addEventListener("abort",_e),le.onreadystatechange=function(){le.readyState===4&&Fe.signal.removeEventListener("abort",_e)}),le.send(typeof Fe._bodyInit=="undefined"?null:Fe._bodyInit)})}return be.polyfill=!0,l.fetch||(l.fetch=be,l.Headers=b,l.Request=ne,l.Response=oe),u.Headers=b,u.Request=ne,u.Response=oe,u.fetch=be,Object.defineProperty(u,"__esModule",{value:!0}),u})({})})(o),o.fetch.ponyfill=!0,delete o.fetch.polyfill;var c=o;n=c.fetch,n.default=c.fetch,n.fetch=c.fetch,n.Headers=c.Headers,n.Request=c.Request,n.Response=c.Response,r.exports=n})(pr,pr.exports);var xs=ys(pr.exports),El=fs({__proto__:null,default:xs},[pr.exports]),me=crypto;const Pt=r=>r instanceof CryptoKey,Rs=async(r,n)=>{const s=`SHA-${r.slice(-3)}`;return new Uint8Array(await me.subtle.digest(s,n))};var io=Rs;const Je=new TextEncoder,Ut=new TextDecoder,Jr=2**32;function Jt(...r){const n=r.reduce((c,{length:l})=>c+l,0),s=new Uint8Array(n);let o=0;return r.forEach(c=>{s.set(c,o),o+=c.length}),s}function Is(r,n){return Jt(Je.encode(r),new Uint8Array([0]),n)}function In(r,n,s){if(n<0||n>=Jr)throw new RangeError(`value must be >= 0 and <= ${Jr-1}. Received ${n}`);r.set([n>>>24,n>>>16,n>>>8,n&255],s)}function oo(r){const n=Math.floor(r/Jr),s=r%Jr,o=new Uint8Array(8);return In(o,n,0),In(o,s,4),o}function Wn(r){const n=new Uint8Array(4);return In(n,r),n}function wn(r){return Jt(Wn(r.length),r)}async function ks(r,n,s){const o=Math.ceil((n>>3)/32),c=new Uint8Array(o*32);for(let l=0;l<o;l++){const u=new Uint8Array(4+r.length+s.length);u.set(Wn(l+1)),u.set(r,4),u.set(s,4+r.length),c.set(await io("sha256",u),l*32)}return c.slice(0,n>>3)}const Jn=r=>{let n=r;typeof n=="string"&&(n=Je.encode(n));const s=32768,o=[];for(let c=0;c<n.length;c+=s)o.push(String.fromCharCode.apply(null,n.subarray(c,c+s)));return btoa(o.join(""))},Ge=r=>Jn(r).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),so=r=>{const n=atob(r),s=new Uint8Array(n.length);for(let o=0;o<n.length;o++)s[o]=n.charCodeAt(o);return s},et=r=>{let n=r;n instanceof Uint8Array&&(n=Ut.decode(n)),n=n.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return so(n)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};class at extends Error{constructor(n){var s;super(n),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(s=Error.captureStackTrace)===null||s===void 0||s.call(Error,this,this.constructor)}static get code(){return"ERR_JOSE_GENERIC"}}class Tt extends at{constructor(n,s="unspecified",o="unspecified"){super(n),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=s,this.reason=o}static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}}class kn extends at{constructor(n,s="unspecified",o="unspecified"){super(n),this.code="ERR_JWT_EXPIRED",this.claim=s,this.reason=o}static get code(){return"ERR_JWT_EXPIRED"}}class Vr extends at{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}}class Pe extends at{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}}class Tr extends at{constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}}class ye extends at{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}}class ke extends at{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}}class Ft extends at{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}}class ao extends at{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}static get code(){return"ERR_JWK_INVALID"}}class qr extends at{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}static get code(){return"ERR_JWKS_INVALID"}}class Vn extends at{constructor(){super(...arguments),this.code="ERR_JWKS_NO_MATCHING_KEY",this.message="no applicable key found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_NO_MATCHING_KEY"}}class uo extends at{constructor(){super(...arguments),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS",this.message="multiple matching keys found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_MULTIPLE_MATCHING_KEYS"}}class co extends at{constructor(){super(...arguments),this.code="ERR_JWKS_TIMEOUT",this.message="request timed out"}static get code(){return"ERR_JWKS_TIMEOUT"}}class qn extends at{constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}var Us=Object.freeze(Object.defineProperty({__proto__:null,JOSEError:at,JWTClaimValidationFailed:Tt,JWTExpired:kn,JOSEAlgNotAllowed:Vr,JOSENotSupported:Pe,JWEDecryptionFailed:Tr,JWEInvalid:ye,JWSInvalid:ke,JWTInvalid:Ft,JWKInvalid:ao,JWKSInvalid:qr,JWKSNoMatchingKey:Vn,JWKSMultipleMatchingKeys:uo,JWKSTimeout:co,JWSSignatureVerificationFailed:qn},Symbol.toStringTag,{value:"Module"})),Zr=me.getRandomValues.bind(me);function lo(r){switch(r){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new Pe(`Unsupported JWE Algorithm: ${r}`)}}var ho=r=>Zr(new Uint8Array(lo(r)>>3));const Os=(r,n)=>{if(n.length<<3!==lo(r))throw new ye("Invalid Initialization Vector length")};var fo=Os;const Ds=(r,n)=>{const s=r.byteLength<<3;if(s!==n)throw new ye(`Invalid Content Encryption Key length. Expected ${n} bits, got ${s} bits`)};var $r=Ds;const Hs=(r,n)=>{if(!(r instanceof Uint8Array))throw new TypeError("First argument must be a buffer");if(!(n instanceof Uint8Array))throw new TypeError("Second argument must be a buffer");if(r.length!==n.length)throw new TypeError("Input buffers must have the same length");const s=r.length;let o=0,c=-1;for(;++c<s;)o|=r[c]^n[c];return o===0};var Ns=Hs;function ar(){return typeof WebSocketPair=="function"}function st(r,n="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${n} must be ${r}`)}function Bt(r,n){return r.name===n}function jr(r){return parseInt(r.name.slice(4),10)}function Ls(r){switch(r){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function po(r,n){if(n.length&&!n.some(s=>r.usages.includes(s))){let s="CryptoKey does not support this operation, its usages must include ";if(n.length>2){const o=n.pop();s+=`one of ${n.join(", ")}, or ${o}.`}else n.length===2?s+=`one of ${n[0]} or ${n[1]}.`:s+=`${n[0]}.`;throw new TypeError(s)}}function Ms(r,n,...s){switch(n){case"HS256":case"HS384":case"HS512":{if(!Bt(r.algorithm,"HMAC"))throw st("HMAC");const o=parseInt(n.slice(2),10);if(jr(r.algorithm.hash)!==o)throw st(`SHA-${o}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!Bt(r.algorithm,"RSASSA-PKCS1-v1_5"))throw st("RSASSA-PKCS1-v1_5");const o=parseInt(n.slice(2),10);if(jr(r.algorithm.hash)!==o)throw st(`SHA-${o}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!Bt(r.algorithm,"RSA-PSS"))throw st("RSA-PSS");const o=parseInt(n.slice(2),10);if(jr(r.algorithm.hash)!==o)throw st(`SHA-${o}`,"algorithm.hash");break}case(ar()&&"EdDSA"):{if(!Bt(r.algorithm,"NODE-ED25519"))throw st("NODE-ED25519");break}case"ES256":case"ES384":case"ES512":{if(!Bt(r.algorithm,"ECDSA"))throw st("ECDSA");const o=Ls(n);if(r.algorithm.namedCurve!==o)throw st(o,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}po(r,s)}function Zt(r,n,...s){switch(n){case"A128GCM":case"A192GCM":case"A256GCM":{if(!Bt(r.algorithm,"AES-GCM"))throw st("AES-GCM");const o=parseInt(n.slice(1,4),10);if(r.algorithm.length!==o)throw st(o,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if(!Bt(r.algorithm,"AES-KW"))throw st("AES-KW");const o=parseInt(n.slice(1,4),10);if(r.algorithm.length!==o)throw st(o,"algorithm.length");break}case"ECDH":if(!Bt(r.algorithm,"ECDH"))throw st("ECDH");break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if(!Bt(r.algorithm,"PBKDF2"))throw st("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(!Bt(r.algorithm,"RSA-OAEP"))throw st("RSA-OAEP");const o=parseInt(n.slice(9),10)||1;if(jr(r.algorithm.hash)!==o)throw st(`SHA-${o}`,"algorithm.hash");break}default:throw new TypeError("CryptoKey does not support this operation")}po(r,s)}function go(r,n,...s){if(s.length>2){const o=s.pop();r+=`one of type ${s.join(", ")}, or ${o}.`}else s.length===2?r+=`one of type ${s[0]} or ${s[1]}.`:r+=`of type ${s[0]}.`;return n==null?r+=` Received ${n}`:typeof n=="function"&&n.name?r+=` Received function ${n.name}`:typeof n=="object"&&n!=null&&n.constructor&&n.constructor.name&&(r+=` Received an instance of ${n.constructor.name}`),r}var pt=(r,...n)=>go("Key must be ",r,...n);function yo(r,n,...s){return go(`Key for the ${r} algorithm must be `,n,...s)}var vo=r=>Pt(r);const je=["CryptoKey"];async function Ks(r,n,s,o,c,l){if(!(n instanceof Uint8Array))throw new TypeError(pt(n,"Uint8Array"));const u=parseInt(r.slice(1,4),10),g=await me.subtle.importKey("raw",n.subarray(u>>3),"AES-CBC",!1,["decrypt"]),y=await me.subtle.importKey("raw",n.subarray(0,u>>3),{hash:`SHA-${u<<1}`,name:"HMAC"},!1,["sign"]),f=Jt(l,o,s,oo(l.length<<3)),h=new Uint8Array((await me.subtle.sign("HMAC",y,f)).slice(0,u>>3));let p;try{p=Ns(c,h)}catch{}if(!p)throw new Tr;let E;try{E=new Uint8Array(await me.subtle.decrypt({iv:o,name:"AES-CBC"},g,s))}catch{}if(!E)throw new Tr;return E}async function Bs(r,n,s,o,c,l){let u;n instanceof Uint8Array?u=await me.subtle.importKey("raw",n,"AES-GCM",!1,["decrypt"]):(Zt(n,r,"decrypt"),u=n);try{return new Uint8Array(await me.subtle.decrypt({additionalData:l,iv:o,name:"AES-GCM",tagLength:128},u,Jt(s,c)))}catch{throw new Tr}}const js=async(r,n,s,o,c,l)=>{if(!Pt(n)&&!(n instanceof Uint8Array))throw new TypeError(pt(n,...je,"Uint8Array"));switch(fo(r,o),r){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return n instanceof Uint8Array&&$r(n,parseInt(r.slice(-3),10)),Ks(r,n,s,o,c,l);case"A128GCM":case"A192GCM":case"A256GCM":return n instanceof Uint8Array&&$r(n,parseInt(r.slice(1,4),10)),Bs(r,n,s,o,c,l);default:throw new Pe("Unsupported JWE Content Encryption Algorithm")}};var mo=js;const Ws=async()=>{throw new Pe('JWE "zip" (Compression Algorithm) Header Parameter is not supported by your javascript runtime. You need to use the `inflateRaw` decrypt option to provide Inflate Raw implementation.')},Js=async()=>{throw new Pe('JWE "zip" (Compression Algorithm) Header Parameter is not supported by your javascript runtime. You need to use the `deflateRaw` encrypt option to provide Deflate Raw implementation.')},Vs=(...r)=>{const n=r.filter(Boolean);if(n.length===0||n.length===1)return!0;let s;for(const o of n){const c=Object.keys(o);if(!s||s.size===0){s=new Set(c);continue}for(const l of c){if(s.has(l))return!1;s.add(l)}}return!0};var Cr=Vs;function qs(r){return typeof r=="object"&&r!==null}function nt(r){if(!qs(r)||Object.prototype.toString.call(r)!=="[object Object]")return!1;if(Object.getPrototypeOf(r)===null)return!0;let n=r;for(;Object.getPrototypeOf(n)!==null;)n=Object.getPrototypeOf(n);return Object.getPrototypeOf(r)===n}const $s=[{hash:"SHA-256",name:"HMAC"},!0,["sign"]];var en=$s;function _o(r,n){if(r.algorithm.length!==parseInt(n.slice(1,4),10))throw new TypeError(`Invalid key size for alg: ${n}`)}function So(r,n,s){if(Pt(r))return Zt(r,n,s),r;if(r instanceof Uint8Array)return me.subtle.importKey("raw",r,"AES-KW",!0,[s]);throw new TypeError(pt(r,...je,"Uint8Array"))}const Un=async(r,n,s)=>{const o=await So(n,r,"wrapKey");_o(o,r);const c=await me.subtle.importKey("raw",s,...en);return new Uint8Array(await me.subtle.wrapKey("raw",c,o,"AES-KW"))},On=async(r,n,s)=>{const o=await So(n,r,"unwrapKey");_o(o,r);const c=await me.subtle.unwrapKey("raw",s,o,"AES-KW",...en);return new Uint8Array(await me.subtle.exportKey("raw",c))};async function wo(r,n,s,o,c=new Uint8Array(0),l=new Uint8Array(0)){if(!Pt(r))throw new TypeError(pt(r,...je));if(Zt(r,"ECDH"),!Pt(n))throw new TypeError(pt(n,...je));Zt(n,"ECDH","deriveBits");const u=Jt(wn(Je.encode(s)),wn(c),wn(l),Wn(o)),g=new Uint8Array(await me.subtle.deriveBits({name:"ECDH",public:r},n,Math.ceil(parseInt(n.algorithm.namedCurve.slice(-3),10)/8)<<3));return ks(g,o,u)}async function Gs(r){if(!Pt(r))throw new TypeError(pt(r,...je));return me.subtle.generateKey(r.algorithm,!0,["deriveBits"])}function Eo(r){if(!Pt(r))throw new TypeError(pt(r,...je));return["P-256","P-384","P-521"].includes(r.algorithm.namedCurve)}function zs(r){if(!(r instanceof Uint8Array)||r.length<8)throw new ye("PBES2 Salt Input must be 8 or more octets")}function Ys(r,n){if(r instanceof Uint8Array)return me.subtle.importKey("raw",r,"PBKDF2",!1,["deriveBits"]);if(Pt(r))return Zt(r,n,"deriveBits","deriveKey"),r;throw new TypeError(pt(r,...je,"Uint8Array"))}async function bo(r,n,s,o){zs(r);const c=Is(n,r),l=parseInt(n.slice(13,16),10),u={hash:`SHA-${n.slice(8,11)}`,iterations:s,name:"PBKDF2",salt:c},g={length:l,name:"AES-KW"},y=await Ys(o,n);if(y.usages.includes("deriveBits"))return new Uint8Array(await me.subtle.deriveBits(u,y,l));if(y.usages.includes("deriveKey"))return me.subtle.deriveKey(u,y,g,!1,["wrapKey","unwrapKey"]);throw new TypeError('PBKDF2 key "usages" must include "deriveBits" or "deriveKey"')}const Xs=async(r,n,s,o=2048,c=Zr(new Uint8Array(16)))=>{const l=await bo(c,r,o,n);return{encryptedKey:await Un(r.slice(-6),l,s),p2c:o,p2s:Ge(c)}},Qs=async(r,n,s,o,c)=>{const l=await bo(c,r,o,n);return On(r.slice(-6),l,s)};function Gr(r){switch(r){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return"RSA-OAEP";default:throw new Pe(`alg ${r} is not supported either by JOSE or your javascript runtime`)}}var tn=(r,n)=>{if(r.startsWith("RS")||r.startsWith("PS")){const{modulusLength:s}=n.algorithm;if(typeof s!="number"||s<2048)throw new TypeError(`${r} requires key modulusLength to be 2048 bits or larger`)}};const Zs=async(r,n,s)=>{if(!Pt(n))throw new TypeError(pt(n,...je));if(Zt(n,r,"encrypt","wrapKey"),tn(r,n),n.usages.includes("encrypt"))return new Uint8Array(await me.subtle.encrypt(Gr(r),n,s));if(n.usages.includes("wrapKey")){const o=await me.subtle.importKey("raw",s,...en);return new Uint8Array(await me.subtle.wrapKey("raw",o,n,Gr(r)))}throw new TypeError('RSA-OAEP key "usages" must include "encrypt" or "wrapKey" for this operation')},ea=async(r,n,s)=>{if(!Pt(n))throw new TypeError(pt(n,...je));if(Zt(n,r,"decrypt","unwrapKey"),tn(r,n),n.usages.includes("decrypt"))return new Uint8Array(await me.subtle.decrypt(Gr(r),n,s));if(n.usages.includes("unwrapKey")){const o=await me.subtle.unwrapKey("raw",s,n,Gr(r),...en);return new Uint8Array(await me.subtle.exportKey("raw",o))}throw new TypeError('RSA-OAEP key "usages" must include "decrypt" or "unwrapKey" for this operation')};function $n(r){switch(r){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new Pe(`Unsupported JWE Algorithm: ${r}`)}}var ir=r=>Zr(new Uint8Array($n(r)>>3)),Fo=(r,n)=>{const s=(r.match(/.{1,64}/g)||[]).join(`
`);return`-----BEGIN ${n}-----
${s}
-----END ${n}-----`};const Ao=async(r,n,s)=>{if(!Pt(s))throw new TypeError(pt(s,...je));if(!s.extractable)throw new TypeError("CryptoKey is not extractable");if(s.type!==r)throw new TypeError(`key is not a ${r} key`);return Fo(Jn(new Uint8Array(await me.subtle.exportKey(n,s))),`${r.toUpperCase()} KEY`)},ta=r=>Ao("public","spki",r),ra=r=>Ao("private","pkcs8",r),Pr=(r,n,s=0)=>{s===0&&(n.unshift(n.length),n.unshift(6));let o=r.indexOf(n[0],s);if(o===-1)return!1;const c=r.subarray(o,o+n.length);return c.length!==n.length?!1:c.every((l,u)=>l===n[u])||Pr(r,n,o+1)},Oi=r=>{switch(!0){case Pr(r,[42,134,72,206,61,3,1,7]):return"P-256";case Pr(r,[43,129,4,0,34]):return"P-384";case Pr(r,[43,129,4,0,35]):return"P-521";case(ar()&&Pr(r,[43,101,112])):return"Ed25519";default:throw new Pe("Invalid or unsupported EC Key Curve or OKP Key Sub Type")}},Po=async(r,n,s,o,c)=>{var l;let u,g;const y=new Uint8Array(atob(s.replace(r,"")).split("").map(h=>h.charCodeAt(0))),f=n==="spki";switch(o){case"PS256":case"PS384":case"PS512":u={name:"RSA-PSS",hash:`SHA-${o.slice(-3)}`},g=f?["verify"]:["sign"];break;case"RS256":case"RS384":case"RS512":u={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${o.slice(-3)}`},g=f?["verify"]:["sign"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":u={name:"RSA-OAEP",hash:`SHA-${parseInt(o.slice(-3),10)||1}`},g=f?["encrypt","wrapKey"]:["decrypt","unwrapKey"];break;case"ES256":u={name:"ECDSA",namedCurve:"P-256"},g=f?["verify"]:["sign"];break;case"ES384":u={name:"ECDSA",namedCurve:"P-384"},g=f?["verify"]:["sign"];break;case"ES512":u={name:"ECDSA",namedCurve:"P-521"},g=f?["verify"]:["sign"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":u={name:"ECDH",namedCurve:Oi(y)},g=f?[]:["deriveBits"];break;case(ar()&&"EdDSA"):const h=Oi(y).toUpperCase();u={name:`NODE-${h}`,namedCurve:`NODE-${h}`},g=f?["verify"]:["sign"];break;default:throw new Pe('Invalid or unsupported "alg" (Algorithm) value')}return me.subtle.importKey(n,y,u,(l=c==null?void 0:c.extractable)!==null&&l!==void 0?l:!1,g)},na=(r,n,s)=>Po(/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g,"pkcs8",r,n,s),To=(r,n,s)=>Po(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g,"spki",r,n,s);function ia(r){let n,s;switch(r.kty){case"oct":{switch(r.alg){case"HS256":case"HS384":case"HS512":n={name:"HMAC",hash:`SHA-${r.alg.slice(-3)}`},s=["sign","verify"];break;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":throw new Pe(`${r.alg} keys cannot be imported as CryptoKey instances`);case"A128GCM":case"A192GCM":case"A256GCM":case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":n={name:"AES-GCM"},s=["encrypt","decrypt"];break;case"A128KW":case"A192KW":case"A256KW":n={name:"AES-KW"},s=["wrapKey","unwrapKey"];break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":n={name:"PBKDF2"},s=["deriveBits"];break;default:throw new Pe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"RSA":{switch(r.alg){case"PS256":case"PS384":case"PS512":n={name:"RSA-PSS",hash:`SHA-${r.alg.slice(-3)}`},s=r.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":n={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${r.alg.slice(-3)}`},s=r.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":n={name:"RSA-OAEP",hash:`SHA-${parseInt(r.alg.slice(-3),10)||1}`},s=r.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new Pe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(r.alg){case"ES256":n={name:"ECDSA",namedCurve:"P-256"},s=r.d?["sign"]:["verify"];break;case"ES384":n={name:"ECDSA",namedCurve:"P-384"},s=r.d?["sign"]:["verify"];break;case"ES512":n={name:"ECDSA",namedCurve:"P-521"},s=r.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":n={name:"ECDH",namedCurve:r.crv},s=r.d?["deriveBits"]:[];break;default:throw new Pe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case(ar()&&"OKP"):if(r.alg!=="EdDSA")throw new Pe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value');switch(r.crv){case"Ed25519":n={name:"NODE-ED25519",namedCurve:"NODE-ED25519"},s=r.d?["sign"]:["verify"];break;default:throw new Pe('Invalid or unsupported JWK "crv" (Subtype of Key Pair) Parameter value')}break;default:throw new Pe('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:n,keyUsages:s}}const oa=async r=>{var n,s;const{algorithm:o,keyUsages:c}=ia(r),l=[o,(n=r.ext)!==null&&n!==void 0?n:!1,(s=r.key_ops)!==null&&s!==void 0?s:c];if(o.name==="PBKDF2")return me.subtle.importKey("raw",et(r.k),...l);const u={...r};return delete u.alg,me.subtle.importKey("jwk",u,...l)};var Di=oa;function Hi(r){let n=[],s=0;for(;s<r.length;){let o=Co(r.subarray(s));n.push(o),s+=o.byteLength}return n}function Co(r){let n=0,s=r[0]&31;if(n++,s===31){for(s=0;r[n]>=128;)s=s*128+r[n]-128,n++;s=s*128+r[n]-128,n++}let o=0;if(r[n]<128)o=r[n],n++;else{let l=r[n]&127;n++,o=0;for(let u=0;u<l;u++)o=o*256+r[n],n++}if(o===128){for(o=0;r[n+o]!==0||r[n+o+1]!==0;)o++;const l=n+o+2;return{byteLength:l,contents:r.subarray(n,n+o),raw:r.subarray(0,l)}}const c=n+o;return{byteLength:c,contents:r.subarray(n,c),raw:r.subarray(0,c)}}function sa(r){const n=Hi(Hi(Co(r).contents)[0].contents);return Jn(n[n[0].raw[0]===160?6:5].raw)}function aa(r){const n=r.replace(/(?:-----(?:BEGIN|END) CERTIFICATE-----|\s)/g,""),s=so(n);return Fo(sa(s),"PUBLIC KEY")}async function ua(r,n,s){if(typeof r!="string"||r.indexOf("-----BEGIN PUBLIC KEY-----")!==0)throw new TypeError('"spki" must be SPKI formatted string');return To(r,n,s)}async function ca(r,n,s){if(typeof r!="string"||r.indexOf("-----BEGIN CERTIFICATE-----")!==0)throw new TypeError('"x509" must be X.509 formatted string');const o=aa(r);return To(o,n,s)}async function la(r,n,s){if(typeof r!="string"||r.indexOf("-----BEGIN PRIVATE KEY-----")!==0)throw new TypeError('"pkcs8" must be PCKS8 formatted string');return na(r,n,s)}async function rn(r,n,s){if(!nt(r))throw new TypeError("JWK must be an object");if(n||(n=r.alg),typeof n!="string"||!n)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');switch(r.kty){case"oct":if(typeof r.k!="string"||!r.k)throw new TypeError('missing "k" (Key Value) Parameter value');return s!=null||(s=r.ext!==!0),s?Di({...r,alg:n,ext:!1}):et(r.k);case"RSA":if(r.oth!==void 0)throw new Pe('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return Di({...r,alg:n});default:throw new Pe('Unsupported "kty" (Key Type) Parameter value')}}const da=(r,n)=>{if(!(n instanceof Uint8Array)){if(!vo(n))throw new TypeError(yo(r,n,...je,"Uint8Array"));if(n.type!=="secret")throw new TypeError(`${je.join(" or ")} instances for symmetric algorithms must be of type "secret"`)}},ha=(r,n,s)=>{if(!vo(n))throw new TypeError(yo(r,n,...je));if(n.type==="secret")throw new TypeError(`${je.join(" or ")} instances for asymmetric algorithms must not be of type "secret"`);if(s==="sign"&&n.type==="public")throw new TypeError(`${je.join(" or ")} instances for asymmetric algorithm signing must be of type "private"`);if(s==="decrypt"&&n.type==="public")throw new TypeError(`${je.join(" or ")} instances for asymmetric algorithm decryption must be of type "private"`);if(n.algorithm&&s==="verify"&&n.type==="private")throw new TypeError(`${je.join(" or ")} instances for asymmetric algorithm verifying must be of type "public"`);if(n.algorithm&&s==="encrypt"&&n.type==="private")throw new TypeError(`${je.join(" or ")} instances for asymmetric algorithm encryption must be of type "public"`)},fa=(r,n,s)=>{r.startsWith("HS")||r==="dir"||r.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(r)?da(r,n):ha(r,n,s)};var nn=fa;async function pa(r,n,s,o,c){if(!(s instanceof Uint8Array))throw new TypeError(pt(s,"Uint8Array"));const l=parseInt(r.slice(1,4),10),u=await me.subtle.importKey("raw",s.subarray(l>>3),"AES-CBC",!1,["encrypt"]),g=await me.subtle.importKey("raw",s.subarray(0,l>>3),{hash:`SHA-${l<<1}`,name:"HMAC"},!1,["sign"]),y=new Uint8Array(await me.subtle.encrypt({iv:o,name:"AES-CBC"},u,n)),f=Jt(c,o,y,oo(c.length<<3)),h=new Uint8Array((await me.subtle.sign("HMAC",g,f)).slice(0,l>>3));return{ciphertext:y,tag:h}}async function ga(r,n,s,o,c){let l;s instanceof Uint8Array?l=await me.subtle.importKey("raw",s,"AES-GCM",!1,["encrypt"]):(Zt(s,r,"encrypt"),l=s);const u=new Uint8Array(await me.subtle.encrypt({additionalData:c,iv:o,name:"AES-GCM",tagLength:128},l,n)),g=u.slice(-16);return{ciphertext:u.slice(0,-16),tag:g}}const ya=async(r,n,s,o,c)=>{if(!Pt(s)&&!(s instanceof Uint8Array))throw new TypeError(pt(s,...je,"Uint8Array"));switch(fo(r,o),r){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return s instanceof Uint8Array&&$r(s,parseInt(r.slice(-3),10)),pa(r,n,s,o,c);case"A128GCM":case"A192GCM":case"A256GCM":return s instanceof Uint8Array&&$r(s,parseInt(r.slice(1,4),10)),ga(r,n,s,o,c);default:throw new Pe("Unsupported JWE Content Encryption Algorithm")}};var Dn=ya;async function va(r,n,s,o){const c=r.slice(0,7);o||(o=ho(c));const{ciphertext:l,tag:u}=await Dn(c,s,n,o,new Uint8Array(0));return{encryptedKey:l,iv:Ge(o),tag:Ge(u)}}async function ma(r,n,s,o,c){const l=r.slice(0,7);return mo(l,n,s,o,c,new Uint8Array(0))}async function _a(r,n,s,o,c){switch(nn(r,n,"decrypt"),r){case"dir":{if(s!==void 0)throw new ye("Encountered unexpected JWE Encrypted Key");return n}case"ECDH-ES":if(s!==void 0)throw new ye("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!nt(o.epk))throw new ye('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(!Eo(n))throw new Pe("ECDH with the provided key is not allowed or not supported by your javascript runtime");const l=await rn(o.epk,r);let u,g;if(o.apu!==void 0){if(typeof o.apu!="string")throw new ye('JOSE Header "apu" (Agreement PartyUInfo) invalid');u=et(o.apu)}if(o.apv!==void 0){if(typeof o.apv!="string")throw new ye('JOSE Header "apv" (Agreement PartyVInfo) invalid');g=et(o.apv)}const y=await wo(l,n,r==="ECDH-ES"?o.enc:r,r==="ECDH-ES"?$n(o.enc):parseInt(r.slice(-5,-2),10),u,g);if(r==="ECDH-ES")return y;if(s===void 0)throw new ye("JWE Encrypted Key missing");return On(r.slice(-6),y,s)}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(s===void 0)throw new ye("JWE Encrypted Key missing");return ea(r,n,s)}case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{if(s===void 0)throw new ye("JWE Encrypted Key missing");if(typeof o.p2c!="number")throw new ye('JOSE Header "p2c" (PBES2 Count) missing or invalid');const l=(c==null?void 0:c.maxPBES2Count)||1e4;if(o.p2c>l)throw new ye('JOSE Header "p2c" (PBES2 Count) out is of acceptable bounds');if(typeof o.p2s!="string")throw new ye('JOSE Header "p2s" (PBES2 Salt) missing or invalid');return Qs(r,n,s,o.p2c,et(o.p2s))}case"A128KW":case"A192KW":case"A256KW":{if(s===void 0)throw new ye("JWE Encrypted Key missing");return On(r,n,s)}case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{if(s===void 0)throw new ye("JWE Encrypted Key missing");if(typeof o.iv!="string")throw new ye('JOSE Header "iv" (Initialization Vector) missing or invalid');if(typeof o.tag!="string")throw new ye('JOSE Header "tag" (Authentication Tag) missing or invalid');const l=et(o.iv),u=et(o.tag);return ma(r,n,s,l,u)}default:throw new Pe('Invalid or unsupported "alg" (JWE Algorithm) header value')}}function xr(r,n,s,o,c){if(c.crit!==void 0&&o.crit===void 0)throw new r('"crit" (Critical) Header Parameter MUST be integrity protected');if(!o||o.crit===void 0)return new Set;if(!Array.isArray(o.crit)||o.crit.length===0||o.crit.some(u=>typeof u!="string"||u.length===0))throw new r('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let l;s!==void 0?l=new Map([...Object.entries(s),...n.entries()]):l=n;for(const u of o.crit){if(!l.has(u))throw new Pe(`Extension Header Parameter "${u}" is not recognized`);if(c[u]===void 0)throw new r(`Extension Header Parameter "${u}" is missing`);if(l.get(u)&&o[u]===void 0)throw new r(`Extension Header Parameter "${u}" MUST be integrity protected`)}return new Set(o.crit)}const Sa=(r,n)=>{if(n!==void 0&&(!Array.isArray(n)||n.some(s=>typeof s!="string")))throw new TypeError(`"${r}" option must be an array of strings`);if(!!n)return new Set(n)};var Hn=Sa;async function Gn(r,n,s){var o;if(!nt(r))throw new ye("Flattened JWE must be an object");if(r.protected===void 0&&r.header===void 0&&r.unprotected===void 0)throw new ye("JOSE Header missing");if(typeof r.iv!="string")throw new ye("JWE Initialization Vector missing or incorrect type");if(typeof r.ciphertext!="string")throw new ye("JWE Ciphertext missing or incorrect type");if(typeof r.tag!="string")throw new ye("JWE Authentication Tag missing or incorrect type");if(r.protected!==void 0&&typeof r.protected!="string")throw new ye("JWE Protected Header incorrect type");if(r.encrypted_key!==void 0&&typeof r.encrypted_key!="string")throw new ye("JWE Encrypted Key incorrect type");if(r.aad!==void 0&&typeof r.aad!="string")throw new ye("JWE AAD incorrect type");if(r.header!==void 0&&!nt(r.header))throw new ye("JWE Shared Unprotected Header incorrect type");if(r.unprotected!==void 0&&!nt(r.unprotected))throw new ye("JWE Per-Recipient Unprotected Header incorrect type");let c;if(r.protected)try{const H=et(r.protected);c=JSON.parse(Ut.decode(H))}catch{throw new ye("JWE Protected Header is invalid")}if(!Cr(c,r.header,r.unprotected))throw new ye("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");const l={...c,...r.header,...r.unprotected};if(xr(ye,new Map,s==null?void 0:s.crit,c,l),l.zip!==void 0){if(!c||!c.zip)throw new ye('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if(l.zip!=="DEF")throw new Pe('Unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}const{alg:u,enc:g}=l;if(typeof u!="string"||!u)throw new ye("missing JWE Algorithm (alg) in JWE Header");if(typeof g!="string"||!g)throw new ye("missing JWE Encryption Algorithm (enc) in JWE Header");const y=s&&Hn("keyManagementAlgorithms",s.keyManagementAlgorithms),f=s&&Hn("contentEncryptionAlgorithms",s.contentEncryptionAlgorithms);if(y&&!y.has(u))throw new Vr('"alg" (Algorithm) Header Parameter not allowed');if(f&&!f.has(g))throw new Vr('"enc" (Encryption Algorithm) Header Parameter not allowed');let h;r.encrypted_key!==void 0&&(h=et(r.encrypted_key));let p=!1;typeof n=="function"&&(n=await n(c,r),p=!0);let E;try{E=await _a(u,n,h,l,s)}catch(H){if(H instanceof TypeError||H instanceof ye||H instanceof Pe)throw H;E=ir(g)}const C=et(r.iv),b=et(r.tag),x=Je.encode((o=r.protected)!==null&&o!==void 0?o:"");let R;r.aad!==void 0?R=Jt(x,Je.encode("."),Je.encode(r.aad)):R=x;let A=await mo(g,E,et(r.ciphertext),C,b,R);l.zip==="DEF"&&(A=await((s==null?void 0:s.inflateRaw)||Ws)(A));const P={plaintext:A};return r.protected!==void 0&&(P.protectedHeader=c),r.aad!==void 0&&(P.additionalAuthenticatedData=et(r.aad)),r.unprotected!==void 0&&(P.sharedUnprotectedHeader=r.unprotected),r.header!==void 0&&(P.unprotectedHeader=r.header),p?{...P,key:n}:P}async function xo(r,n,s){if(r instanceof Uint8Array&&(r=Ut.decode(r)),typeof r!="string")throw new ye("Compact JWE must be a string or Uint8Array");const{0:o,1:c,2:l,3:u,4:g,length:y}=r.split(".");if(y!==5)throw new ye("Invalid Compact JWE");const f=await Gn({ciphertext:u,iv:l||void 0,protected:o||void 0,tag:g||void 0,encrypted_key:c||void 0},n,s),h={plaintext:f.plaintext,protectedHeader:f.protectedHeader};return typeof n=="function"?{...h,key:f.key}:h}async function wa(r,n,s){if(!nt(r))throw new ye("General JWE must be an object");if(!Array.isArray(r.recipients)||!r.recipients.every(nt))throw new ye("JWE Recipients missing or incorrect type");if(!r.recipients.length)throw new ye("JWE Recipients has no members");for(const o of r.recipients)try{return await Gn({aad:r.aad,ciphertext:r.ciphertext,encrypted_key:o.encrypted_key,header:o.header,iv:r.iv,protected:r.protected,tag:r.tag,unprotected:r.unprotected},n,s)}catch{}throw new Tr}const Ea=async r=>{if(r instanceof Uint8Array)return{kty:"oct",k:Ge(r)};if(!Pt(r))throw new TypeError(pt(r,...je,"Uint8Array"));if(!r.extractable)throw new TypeError("non-extractable CryptoKey cannot be exported as a JWK");const{ext:n,key_ops:s,alg:o,use:c,...l}=await me.subtle.exportKey("jwk",r);return l};var ba=Ea;async function Fa(r){return ta(r)}async function Aa(r){return ra(r)}async function Ro(r){return ba(r)}async function Io(r,n,s,o,c={}){let l,u,g;switch(nn(r,s,"encrypt"),r){case"dir":{g=s;break}case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!Eo(s))throw new Pe("ECDH with the provided key is not allowed or not supported by your javascript runtime");const{apu:y,apv:f}=c;let{epk:h}=c;h||(h=(await Gs(s)).privateKey);const{x:p,y:E,crv:C,kty:b}=await Ro(h),x=await wo(s,h,r==="ECDH-ES"?n:r,r==="ECDH-ES"?$n(n):parseInt(r.slice(-5,-2),10),y,f);if(u={epk:{x:p,crv:C,kty:b}},b==="EC"&&(u.epk.y=E),y&&(u.apu=Ge(y)),f&&(u.apv=Ge(f)),r==="ECDH-ES"){g=x;break}g=o||ir(n);const R=r.slice(-6);l=await Un(R,x,g);break}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{g=o||ir(n),l=await Zs(r,s,g);break}case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{g=o||ir(n);const{p2c:y,p2s:f}=c;({encryptedKey:l,...u}=await Xs(r,s,g,y,f));break}case"A128KW":case"A192KW":case"A256KW":{g=o||ir(n),l=await Un(r,s,g);break}case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{g=o||ir(n);const{iv:y}=c;({encryptedKey:l,...u}=await va(r,s,g,y));break}default:throw new Pe('Invalid or unsupported "alg" (JWE Algorithm) header value')}return{cek:g,encryptedKey:l,parameters:u}}const ko=Symbol();class zr{constructor(n){if(!(n instanceof Uint8Array))throw new TypeError("plaintext must be an instance of Uint8Array");this._plaintext=n}setKeyManagementParameters(n){if(this._keyManagementParameters)throw new TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=n,this}setProtectedHeader(n){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=n,this}setSharedUnprotectedHeader(n){if(this._sharedUnprotectedHeader)throw new TypeError("setSharedUnprotectedHeader can only be called once");return this._sharedUnprotectedHeader=n,this}setUnprotectedHeader(n){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=n,this}setAdditionalAuthenticatedData(n){return this._aad=n,this}setContentEncryptionKey(n){if(this._cek)throw new TypeError("setContentEncryptionKey can only be called once");return this._cek=n,this}setInitializationVector(n){if(this._iv)throw new TypeError("setInitializationVector can only be called once");return this._iv=n,this}async encrypt(n,s){if(!this._protectedHeader&&!this._unprotectedHeader&&!this._sharedUnprotectedHeader)throw new ye("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");if(!Cr(this._protectedHeader,this._unprotectedHeader,this._sharedUnprotectedHeader))throw new ye("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");const o={...this._protectedHeader,...this._unprotectedHeader,...this._sharedUnprotectedHeader};if(xr(ye,new Map,s==null?void 0:s.crit,this._protectedHeader,o),o.zip!==void 0){if(!this._protectedHeader||!this._protectedHeader.zip)throw new ye('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if(o.zip!=="DEF")throw new Pe('Unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}const{alg:c,enc:l}=o;if(typeof c!="string"||!c)throw new ye('JWE "alg" (Algorithm) Header Parameter missing or invalid');if(typeof l!="string"||!l)throw new ye('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');let u;if(c==="dir"){if(this._cek)throw new TypeError("setContentEncryptionKey cannot be called when using Direct Encryption")}else if(c==="ECDH-ES"&&this._cek)throw new TypeError("setContentEncryptionKey cannot be called when using Direct Key Agreement");let g;{let b;({cek:g,encryptedKey:u,parameters:b}=await Io(c,l,n,this._cek,this._keyManagementParameters)),b&&(s&&ko in s?this._unprotectedHeader?this._unprotectedHeader={...this._unprotectedHeader,...b}:this.setUnprotectedHeader(b):this._protectedHeader?this._protectedHeader={...this._protectedHeader,...b}:this.setProtectedHeader(b))}this._iv||(this._iv=ho(l));let y,f,h;this._protectedHeader?f=Je.encode(Ge(JSON.stringify(this._protectedHeader))):f=Je.encode(""),this._aad?(h=Ge(this._aad),y=Jt(f,Je.encode("."),Je.encode(h))):y=f;let p,E;if(o.zip==="DEF"){const b=await((s==null?void 0:s.deflateRaw)||Js)(this._plaintext);({ciphertext:p,tag:E}=await Dn(l,b,g,this._iv,y))}else({ciphertext:p,tag:E}=await Dn(l,this._plaintext,g,this._iv,y));const C={ciphertext:Ge(p),iv:Ge(this._iv),tag:Ge(E)};return u&&(C.encrypted_key=Ge(u)),h&&(C.aad=h),this._protectedHeader&&(C.protected=Ut.decode(f)),this._sharedUnprotectedHeader&&(C.unprotected=this._sharedUnprotectedHeader),this._unprotectedHeader&&(C.header=this._unprotectedHeader),C}}class Pa{constructor(n,s,o){this.parent=n,this.key=s,this.options=o}setUnprotectedHeader(n){if(this.unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=n,this}addRecipient(...n){return this.parent.addRecipient(...n)}encrypt(...n){return this.parent.encrypt(...n)}done(){return this.parent}}class Ta{constructor(n){this._recipients=[],this._plaintext=n}addRecipient(n,s){const o=new Pa(this,n,{crit:s==null?void 0:s.crit});return this._recipients.push(o),o}setProtectedHeader(n){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=n,this}setSharedUnprotectedHeader(n){if(this._unprotectedHeader)throw new TypeError("setSharedUnprotectedHeader can only be called once");return this._unprotectedHeader=n,this}setAdditionalAuthenticatedData(n){return this._aad=n,this}async encrypt(n){var s,o,c;if(!this._recipients.length)throw new ye("at least one recipient must be added");if(n={deflateRaw:n==null?void 0:n.deflateRaw},this._recipients.length===1){const[y]=this._recipients,f=await new zr(this._plaintext).setAdditionalAuthenticatedData(this._aad).setProtectedHeader(this._protectedHeader).setSharedUnprotectedHeader(this._unprotectedHeader).setUnprotectedHeader(y.unprotectedHeader).encrypt(y.key,{...y.options,...n});let h={ciphertext:f.ciphertext,iv:f.iv,recipients:[{}],tag:f.tag};return f.aad&&(h.aad=f.aad),f.protected&&(h.protected=f.protected),f.unprotected&&(h.unprotected=f.unprotected),f.encrypted_key&&(h.recipients[0].encrypted_key=f.encrypted_key),f.header&&(h.recipients[0].header=f.header),h}let l;for(let y=0;y<this._recipients.length;y++){const f=this._recipients[y];if(!Cr(this._protectedHeader,this._unprotectedHeader,f.unprotectedHeader))throw new ye("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");const h={...this._protectedHeader,...this._unprotectedHeader,...f.unprotectedHeader},{alg:p}=h;if(typeof p!="string"||!p)throw new ye('JWE "alg" (Algorithm) Header Parameter missing or invalid');if(p==="dir"||p==="ECDH-ES")throw new ye('"dir" and "ECDH-ES" alg may only be used with a single recipient');if(typeof h.enc!="string"||!h.enc)throw new ye('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if(!l)l=h.enc;else if(l!==h.enc)throw new ye('JWE "enc" (Encryption Algorithm) Header Parameter must be the same for all recipients');if(xr(ye,new Map,f.options.crit,this._protectedHeader,h),h.zip!==void 0&&(!this._protectedHeader||!this._protectedHeader.zip))throw new ye('JWE "zip" (Compression Algorithm) Header MUST be integrity protected')}const u=ir(l);let g={ciphertext:"",iv:"",recipients:[],tag:""};for(let y=0;y<this._recipients.length;y++){const f=this._recipients[y],h={};g.recipients.push(h);const E={...this._protectedHeader,...this._unprotectedHeader,...f.unprotectedHeader}.alg.startsWith("PBES2")?2048+y:void 0;if(y===0){const x=await new zr(this._plaintext).setAdditionalAuthenticatedData(this._aad).setContentEncryptionKey(u).setProtectedHeader(this._protectedHeader).setSharedUnprotectedHeader(this._unprotectedHeader).setUnprotectedHeader(f.unprotectedHeader).setKeyManagementParameters({p2c:E}).encrypt(f.key,{...f.options,...n,[ko]:!0});g.ciphertext=x.ciphertext,g.iv=x.iv,g.tag=x.tag,x.aad&&(g.aad=x.aad),x.protected&&(g.protected=x.protected),x.unprotected&&(g.unprotected=x.unprotected),h.encrypted_key=x.encrypted_key,x.header&&(h.header=x.header);continue}const{encryptedKey:C,parameters:b}=await Io(((s=f.unprotectedHeader)===null||s===void 0?void 0:s.alg)||((o=this._protectedHeader)===null||o===void 0?void 0:o.alg)||((c=this._unprotectedHeader)===null||c===void 0?void 0:c.alg),l,f.key,u,{p2c:E});h.encrypted_key=Ge(C),(f.unprotectedHeader||b)&&(h.header={...f.unprotectedHeader,...b})}return g}}function Uo(r,n){const s=`SHA-${r.slice(-3)}`;switch(r){case"HS256":case"HS384":case"HS512":return{hash:s,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:s,name:"RSA-PSS",saltLength:r.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:s,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:s,name:"ECDSA",namedCurve:n.namedCurve};case(ar()&&"EdDSA"):const{namedCurve:o}=n;return{name:o,namedCurve:o};default:throw new Pe(`alg ${r} is not supported either by JOSE or your javascript runtime`)}}function Oo(r,n,s){if(Pt(n))return Ms(n,r,s),n;if(n instanceof Uint8Array){if(!r.startsWith("HS"))throw new TypeError(pt(n,...je));return me.subtle.importKey("raw",n,{hash:`SHA-${r.slice(-3)}`,name:"HMAC"},!1,[s])}throw new TypeError(pt(n,...je,"Uint8Array"))}const Ca=async(r,n,s,o)=>{const c=await Oo(r,n,"verify");tn(r,c);const l=Uo(r,c.algorithm);try{return await me.subtle.verify(l,c,s,o)}catch{return!1}};var xa=Ca;async function zn(r,n,s){var o;if(!nt(r))throw new ke("Flattened JWS must be an object");if(r.protected===void 0&&r.header===void 0)throw new ke('Flattened JWS must have either of the "protected" or "header" members');if(r.protected!==void 0&&typeof r.protected!="string")throw new ke("JWS Protected Header incorrect type");if(r.payload===void 0)throw new ke("JWS Payload missing");if(typeof r.signature!="string")throw new ke("JWS Signature missing or incorrect type");if(r.header!==void 0&&!nt(r.header))throw new ke("JWS Unprotected Header incorrect type");let c={};if(r.protected)try{const R=et(r.protected);c=JSON.parse(Ut.decode(R))}catch{throw new ke("JWS Protected Header is invalid")}if(!Cr(c,r.header))throw new ke("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const l={...c,...r.header},u=xr(ke,new Map([["b64",!0]]),s==null?void 0:s.crit,c,l);let g=!0;if(u.has("b64")&&(g=c.b64,typeof g!="boolean"))throw new ke('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:y}=l;if(typeof y!="string"||!y)throw new ke('JWS "alg" (Algorithm) Header Parameter missing or invalid');const f=s&&Hn("algorithms",s.algorithms);if(f&&!f.has(y))throw new Vr('"alg" (Algorithm) Header Parameter not allowed');if(g){if(typeof r.payload!="string")throw new ke("JWS Payload must be a string")}else if(typeof r.payload!="string"&&!(r.payload instanceof Uint8Array))throw new ke("JWS Payload must be a string or an Uint8Array instance");let h=!1;typeof n=="function"&&(n=await n(c,r),h=!0),nn(y,n,"verify");const p=Jt(Je.encode((o=r.protected)!==null&&o!==void 0?o:""),Je.encode("."),typeof r.payload=="string"?Je.encode(r.payload):r.payload),E=et(r.signature);if(!await xa(y,n,E,p))throw new qn;let b;g?b=et(r.payload):typeof r.payload=="string"?b=Je.encode(r.payload):b=r.payload;const x={payload:b};return r.protected!==void 0&&(x.protectedHeader=c),r.header!==void 0&&(x.unprotectedHeader=r.header),h?{...x,key:n}:x}async function Do(r,n,s){if(r instanceof Uint8Array&&(r=Ut.decode(r)),typeof r!="string")throw new ke("Compact JWS must be a string or Uint8Array");const{0:o,1:c,2:l,length:u}=r.split(".");if(u!==3)throw new ke("Invalid Compact JWS");const g=await zn({payload:c,protected:o,signature:l},n,s),y={payload:g.payload,protectedHeader:g.protectedHeader};return typeof n=="function"?{...y,key:g.key}:y}async function Ra(r,n,s){if(!nt(r))throw new ke("General JWS must be an object");if(!Array.isArray(r.signatures)||!r.signatures.every(nt))throw new ke("JWS Signatures missing or incorrect type");for(const o of r.signatures)try{return await zn({header:o.header,payload:r.payload,protected:o.protected,signature:o.signature},n,s)}catch{}throw new qn}var Wr=r=>Math.floor(r.getTime()/1e3);const Ho=60,No=Ho*60,Yn=No*24,Ia=Yn*7,ka=Yn*365.25,Ua=/^(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)$/i;var Yr=r=>{const n=Ua.exec(r);if(!n)throw new TypeError("Invalid time period format");const s=parseFloat(n[1]);switch(n[2].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":return Math.round(s);case"minute":case"minutes":case"min":case"mins":case"m":return Math.round(s*Ho);case"hour":case"hours":case"hr":case"hrs":case"h":return Math.round(s*No);case"day":case"days":case"d":return Math.round(s*Yn);case"week":case"weeks":case"w":return Math.round(s*Ia);default:return Math.round(s*ka)}};const Ni=r=>r.toLowerCase().replace(/^application\//,""),Oa=(r,n)=>typeof r=="string"?n.includes(r):Array.isArray(r)?n.some(Set.prototype.has.bind(new Set(r))):!1;var Xn=(r,n,s={})=>{const{typ:o}=s;if(o&&(typeof r.typ!="string"||Ni(r.typ)!==Ni(o)))throw new Tt('unexpected "typ" JWT header value',"typ","check_failed");let c;try{c=JSON.parse(Ut.decode(n))}catch{}if(!nt(c))throw new Ft("JWT Claims Set must be a top-level JSON object");const{issuer:l}=s;if(l&&!(Array.isArray(l)?l:[l]).includes(c.iss))throw new Tt('unexpected "iss" claim value',"iss","check_failed");const{subject:u}=s;if(u&&c.sub!==u)throw new Tt('unexpected "sub" claim value',"sub","check_failed");const{audience:g}=s;if(g&&!Oa(c.aud,typeof g=="string"?[g]:g))throw new Tt('unexpected "aud" claim value',"aud","check_failed");let y;switch(typeof s.clockTolerance){case"string":y=Yr(s.clockTolerance);break;case"number":y=s.clockTolerance;break;case"undefined":y=0;break;default:throw new TypeError("Invalid clockTolerance option type")}const{currentDate:f}=s,h=Wr(f||new Date);if((c.iat!==void 0||s.maxTokenAge)&&typeof c.iat!="number")throw new Tt('"iat" claim must be a number',"iat","invalid");if(c.nbf!==void 0){if(typeof c.nbf!="number")throw new Tt('"nbf" claim must be a number',"nbf","invalid");if(c.nbf>h+y)throw new Tt('"nbf" claim timestamp check failed',"nbf","check_failed")}if(c.exp!==void 0){if(typeof c.exp!="number")throw new Tt('"exp" claim must be a number',"exp","invalid");if(c.exp<=h-y)throw new kn('"exp" claim timestamp check failed',"exp","check_failed")}if(s.maxTokenAge){const p=h-c.iat,E=typeof s.maxTokenAge=="number"?s.maxTokenAge:Yr(s.maxTokenAge);if(p-y>E)throw new kn('"iat" claim timestamp check failed (too far in the past)',"iat","check_failed");if(p<0-y)throw new Tt('"iat" claim timestamp check failed (it should be in the past)',"iat","check_failed")}return c};async function Da(r,n,s){var o;const c=await Do(r,n,s);if(((o=c.protectedHeader.crit)===null||o===void 0?void 0:o.includes("b64"))&&c.protectedHeader.b64===!1)throw new Ft("JWTs MUST NOT use unencoded payload");const u={payload:Xn(c.protectedHeader,c.payload,s),protectedHeader:c.protectedHeader};return typeof n=="function"?{...u,key:c.key}:u}async function Ha(r,n,s){const o=await xo(r,n,s),c=Xn(o.protectedHeader,o.plaintext,s),{protectedHeader:l}=o;if(l.iss!==void 0&&l.iss!==c.iss)throw new Tt('replicated "iss" claim header parameter mismatch',"iss","mismatch");if(l.sub!==void 0&&l.sub!==c.sub)throw new Tt('replicated "sub" claim header parameter mismatch',"sub","mismatch");if(l.aud!==void 0&&JSON.stringify(l.aud)!==JSON.stringify(c.aud))throw new Tt('replicated "aud" claim header parameter mismatch',"aud","mismatch");const u={payload:c,protectedHeader:l};return typeof n=="function"?{...u,key:o.key}:u}class Lo{constructor(n){this._flattened=new zr(n)}setContentEncryptionKey(n){return this._flattened.setContentEncryptionKey(n),this}setInitializationVector(n){return this._flattened.setInitializationVector(n),this}setProtectedHeader(n){return this._flattened.setProtectedHeader(n),this}setKeyManagementParameters(n){return this._flattened.setKeyManagementParameters(n),this}async encrypt(n,s){const o=await this._flattened.encrypt(n,s);return[o.protected,o.encrypted_key,o.iv,o.ciphertext,o.tag].join(".")}}const Na=async(r,n,s)=>{const o=await Oo(r,n,"sign");tn(r,o);const c=await me.subtle.sign(Uo(r,o.algorithm),o,s);return new Uint8Array(c)};var La=Na;class Qn{constructor(n){if(!(n instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=n}setProtectedHeader(n){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=n,this}setUnprotectedHeader(n){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=n,this}async sign(n,s){if(!this._protectedHeader&&!this._unprotectedHeader)throw new ke("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!Cr(this._protectedHeader,this._unprotectedHeader))throw new ke("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const o={...this._protectedHeader,...this._unprotectedHeader},c=xr(ke,new Map([["b64",!0]]),s==null?void 0:s.crit,this._protectedHeader,o);let l=!0;if(c.has("b64")&&(l=this._protectedHeader.b64,typeof l!="boolean"))throw new ke('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:u}=o;if(typeof u!="string"||!u)throw new ke('JWS "alg" (Algorithm) Header Parameter missing or invalid');nn(u,n,"sign");let g=this._payload;l&&(g=Je.encode(Ge(g)));let y;this._protectedHeader?y=Je.encode(Ge(JSON.stringify(this._protectedHeader))):y=Je.encode("");const f=Jt(y,Je.encode("."),g),h=await La(u,n,f),p={signature:Ge(h),payload:""};return l&&(p.payload=Ut.decode(g)),this._unprotectedHeader&&(p.header=this._unprotectedHeader),this._protectedHeader&&(p.protected=Ut.decode(y)),p}}class Mo{constructor(n){this._flattened=new Qn(n)}setProtectedHeader(n){return this._flattened.setProtectedHeader(n),this}async sign(n,s){const o=await this._flattened.sign(n,s);if(o.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${o.protected}.${o.payload}.${o.signature}`}}class Ma{constructor(n,s,o){this.parent=n,this.key=s,this.options=o}setProtectedHeader(n){if(this.protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this.protectedHeader=n,this}setUnprotectedHeader(n){if(this.unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=n,this}addSignature(...n){return this.parent.addSignature(...n)}sign(...n){return this.parent.sign(...n)}done(){return this.parent}}class Ka{constructor(n){this._signatures=[],this._payload=n}addSignature(n,s){const o=new Ma(this,n,s);return this._signatures.push(o),o}async sign(){if(!this._signatures.length)throw new ke("at least one signature must be added");const n={signatures:[],payload:""};for(let s=0;s<this._signatures.length;s++){const o=this._signatures[s],c=new Qn(this._payload);c.setProtectedHeader(o.protectedHeader),c.setUnprotectedHeader(o.unprotectedHeader);const{payload:l,...u}=await c.sign(o.key,o.options);if(s===0)n.payload=l;else if(n.payload!==l)throw new ke("inconsistent use of JWS Unencoded Payload Option (RFC7797)");n.signatures.push(u)}return n}}class Zn{constructor(n){if(!nt(n))throw new TypeError("JWT Claims Set MUST be an object");this._payload=n}setIssuer(n){return this._payload={...this._payload,iss:n},this}setSubject(n){return this._payload={...this._payload,sub:n},this}setAudience(n){return this._payload={...this._payload,aud:n},this}setJti(n){return this._payload={...this._payload,jti:n},this}setNotBefore(n){return typeof n=="number"?this._payload={...this._payload,nbf:n}:this._payload={...this._payload,nbf:Wr(new Date)+Yr(n)},this}setExpirationTime(n){return typeof n=="number"?this._payload={...this._payload,exp:n}:this._payload={...this._payload,exp:Wr(new Date)+Yr(n)},this}setIssuedAt(n){return typeof n=="undefined"?this._payload={...this._payload,iat:Wr(new Date)}:this._payload={...this._payload,iat:n},this}}class Ba extends Zn{setProtectedHeader(n){return this._protectedHeader=n,this}async sign(n,s){var o;const c=new Mo(Je.encode(JSON.stringify(this._payload)));if(c.setProtectedHeader(this._protectedHeader),Array.isArray((o=this._protectedHeader)===null||o===void 0?void 0:o.crit)&&this._protectedHeader.crit.includes("b64")&&this._protectedHeader.b64===!1)throw new Ft("JWTs MUST NOT use unencoded payload");return c.sign(n,s)}}class ja extends Zn{setProtectedHeader(n){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=n,this}setKeyManagementParameters(n){if(this._keyManagementParameters)throw new TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=n,this}setContentEncryptionKey(n){if(this._cek)throw new TypeError("setContentEncryptionKey can only be called once");return this._cek=n,this}setInitializationVector(n){if(this._iv)throw new TypeError("setInitializationVector can only be called once");return this._iv=n,this}replicateIssuerAsHeader(){return this._replicateIssuerAsHeader=!0,this}replicateSubjectAsHeader(){return this._replicateSubjectAsHeader=!0,this}replicateAudienceAsHeader(){return this._replicateAudienceAsHeader=!0,this}async encrypt(n,s){const o=new Lo(Je.encode(JSON.stringify(this._payload)));return this._replicateIssuerAsHeader&&(this._protectedHeader={...this._protectedHeader,iss:this._payload.iss}),this._replicateSubjectAsHeader&&(this._protectedHeader={...this._protectedHeader,sub:this._payload.sub}),this._replicateAudienceAsHeader&&(this._protectedHeader={...this._protectedHeader,aud:this._payload.aud}),o.setProtectedHeader(this._protectedHeader),this._iv&&o.setInitializationVector(this._iv),this._cek&&o.setContentEncryptionKey(this._cek),this._keyManagementParameters&&o.setKeyManagementParameters(this._keyManagementParameters),o.encrypt(n,s)}}const Xt=(r,n)=>{if(typeof r!="string"||!r)throw new ao(`${n} missing or invalid`)};async function Ko(r,n){if(!nt(r))throw new TypeError("JWK must be an object");if(n!=null||(n="sha256"),n!=="sha256"&&n!=="sha384"&&n!=="sha512")throw new TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');let s;switch(r.kty){case"EC":Xt(r.crv,'"crv" (Curve) Parameter'),Xt(r.x,'"x" (X Coordinate) Parameter'),Xt(r.y,'"y" (Y Coordinate) Parameter'),s={crv:r.crv,kty:r.kty,x:r.x,y:r.y};break;case"OKP":Xt(r.crv,'"crv" (Subtype of Key Pair) Parameter'),Xt(r.x,'"x" (Public Key) Parameter'),s={crv:r.crv,kty:r.kty,x:r.x};break;case"RSA":Xt(r.e,'"e" (Exponent) Parameter'),Xt(r.n,'"n" (Modulus) Parameter'),s={e:r.e,kty:r.kty,n:r.n};break;case"oct":Xt(r.k,'"k" (Key Value) Parameter'),s={k:r.k,kty:r.kty};break;default:throw new Pe('"kty" (Key Type) Parameter missing or unsupported')}const o=Je.encode(JSON.stringify(s));return Ge(await io(n,o))}async function Wa(r,n){n!=null||(n="sha256");const s=await Ko(r,n);return`urn:ietf:params:oauth:jwk-thumbprint:sha-${n.slice(-3)}:${s}`}async function Ja(r,n){const s={...r,...n.header};if(!nt(s.jwk))throw new ke('"jwk" (JSON Web Key) Header Parameter must be a JSON object');const o=await rn({...s.jwk,ext:!0},s.alg,!0);if(o instanceof Uint8Array||o.type!=="public")throw new ke('"jwk" (JSON Web Key) Header Parameter must be a public key');return o}function Va(r){switch(typeof r=="string"&&r.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new Pe('Unsupported "alg" value for a JSON Web Key Set')}}function Bo(r){return r&&typeof r=="object"&&Array.isArray(r.keys)&&r.keys.every(qa)}function qa(r){return nt(r)}function $a(r){return typeof structuredClone=="function"?structuredClone(r):JSON.parse(JSON.stringify(r))}class Nn{constructor(n){if(this._cached=new WeakMap,!Bo(n))throw new qr("JSON Web Key Set malformed");this._jwks=$a(n)}async getKey(n,s){const{alg:o,kid:c}={...n,...s.header},l=Va(o),u=this._jwks.keys.filter(h=>{let p=l===h.kty;if(p&&typeof c=="string"&&(p=c===h.kid),p&&typeof h.alg=="string"&&(p=o===h.alg),p&&typeof h.use=="string"&&(p=h.use==="sig"),p&&Array.isArray(h.key_ops)&&(p=h.key_ops.includes("verify")),p&&o==="EdDSA"&&(p=h.crv==="Ed25519"||h.crv==="Ed448"),p)switch(o){case"ES256":p=h.crv==="P-256";break;case"ES256K":p=h.crv==="secp256k1";break;case"ES384":p=h.crv==="P-384";break;case"ES512":p=h.crv==="P-521";break}return p}),{0:g,length:y}=u;if(y===0)throw new Vn;if(y!==1)throw new uo;const f=this._cached.get(g)||this._cached.set(g,{}).get(g);if(f[o]===void 0){const h=await rn({...g,ext:!0},o);if(h instanceof Uint8Array||h.type!=="public")throw new qr("JSON Web Key Set members must be public keys");f[o]=h}return f[o]}}function Ga(r){return Nn.prototype.getKey.bind(new Nn(r))}const za=async(r,n,s)=>{let o,c,l=!1;typeof AbortController=="function"&&(o=new AbortController,c=setTimeout(()=>{l=!0,o.abort()},n));const u=await fetch(r.href,{signal:o?o.signal:void 0,redirect:"manual",headers:s.headers}).catch(g=>{throw l?new co:g});if(c!==void 0&&clearTimeout(c),u.status!==200)throw new at("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await u.json()}catch{throw new at("Failed to parse the JSON Web Key Set HTTP response as JSON")}};var Ya=za;class Li extends Nn{constructor(n,s){if(super({keys:[]}),this._jwks=void 0,!(n instanceof URL))throw new TypeError("url must be an instance of URL");this._url=new URL(n.href),this._options={agent:s==null?void 0:s.agent,headers:s==null?void 0:s.headers},this._timeoutDuration=typeof(s==null?void 0:s.timeoutDuration)=="number"?s==null?void 0:s.timeoutDuration:5e3,this._cooldownDuration=typeof(s==null?void 0:s.cooldownDuration)=="number"?s==null?void 0:s.cooldownDuration:3e4,this._cacheMaxAge=typeof(s==null?void 0:s.cacheMaxAge)=="number"?s==null?void 0:s.cacheMaxAge:6e5}coolingDown(){return typeof this._jwksTimestamp=="number"?Date.now()<this._jwksTimestamp+this._cooldownDuration:!1}fresh(){return typeof this._jwksTimestamp=="number"?Date.now()<this._jwksTimestamp+this._cacheMaxAge:!1}async getKey(n,s){(!this._jwks||!this.fresh())&&await this.reload();try{return await super.getKey(n,s)}catch(o){if(o instanceof Vn&&this.coolingDown()===!1)return await this.reload(),super.getKey(n,s);throw o}}async reload(){if(this._pendingFetch&&ar())return new Promise(n=>{const s=()=>{this._pendingFetch===void 0?n():setTimeout(s,5)};s()});this._pendingFetch||(this._pendingFetch=Ya(this._url,this._timeoutDuration,this._options).then(n=>{if(!Bo(n))throw new qr("JSON Web Key Set malformed");this._jwks={keys:n.keys},this._jwksTimestamp=Date.now(),this._pendingFetch=void 0}).catch(n=>{throw this._pendingFetch=void 0,n})),await this._pendingFetch}}function Xa(r,n){return Li.prototype.getKey.bind(new Li(r,n))}class Qa extends Zn{encode(){const n=Ge(JSON.stringify({alg:"none"})),s=Ge(JSON.stringify(this._payload));return`${n}.${s}.`}static decode(n,s){if(typeof n!="string")throw new Ft("Unsecured JWT must be a string");const{0:o,1:c,2:l,length:u}=n.split(".");if(u!==3||l!=="")throw new Ft("Invalid Unsecured JWT");let g;try{if(g=JSON.parse(Ut.decode(et(o))),g.alg!=="none")throw new Error}catch{throw new Ft("Invalid Unsecured JWT")}return{payload:Xn(g,et(c),s),header:g}}}const Za=Ge,ei=et;var eu=Object.freeze(Object.defineProperty({__proto__:null,encode:Za,decode:ei},Symbol.toStringTag,{value:"Module"}));function tu(r){let n;if(typeof r=="string"){const s=r.split(".");(s.length===3||s.length===5)&&([n]=s)}else if(typeof r=="object"&&r)if("protected"in r)n=r.protected;else throw new TypeError("Token does not contain a Protected Header");try{if(typeof n!="string"||!n)throw new Error;const s=JSON.parse(Ut.decode(ei(n)));if(!nt(s))throw new Error;return s}catch{throw new TypeError("Invalid Token or Protected Header formatting")}}function ru(r){if(typeof r!="string")throw new Ft("JWTs must use Compact JWS serialization, JWT must be a string");const{1:n,length:s}=r.split(".");if(s===5)throw new Ft("Only JWTs using Compact JWS serialization can be decoded");if(s!==3)throw new Ft("Invalid JWT");if(!n)throw new Ft("JWTs must contain a payload");let o;try{o=ei(n)}catch{throw new Ft("Failed to parse the base64url encoded payload")}let c;try{c=JSON.parse(Ut.decode(o))}catch{throw new Ft("Failed to parse the decoded payload as JSON")}if(!nt(c))throw new Ft("Invalid JWT Claims Set");return c}async function nu(r,n){var s;let o,c,l;switch(r){case"HS256":case"HS384":case"HS512":o=parseInt(r.slice(-3),10),c={name:"HMAC",hash:`SHA-${o}`,length:o},l=["sign","verify"];break;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return o=parseInt(r.slice(-3),10),Zr(new Uint8Array(o>>3));case"A128KW":case"A192KW":case"A256KW":o=parseInt(r.slice(1,4),10),c={name:"AES-KW",length:o},l=["wrapKey","unwrapKey"];break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":case"A128GCM":case"A192GCM":case"A256GCM":o=parseInt(r.slice(1,4),10),c={name:"AES-GCM",length:o},l=["encrypt","decrypt"];break;default:throw new Pe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return me.subtle.generateKey(c,(s=n==null?void 0:n.extractable)!==null&&s!==void 0?s:!1,l)}function En(r){var n;const s=(n=r==null?void 0:r.modulusLength)!==null&&n!==void 0?n:2048;if(typeof s!="number"||s<2048)throw new Pe("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");return s}async function iu(r,n){var s,o;let c,l;switch(r){case"PS256":case"PS384":case"PS512":c={name:"RSA-PSS",hash:`SHA-${r.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:En(n)},l=["sign","verify"];break;case"RS256":case"RS384":case"RS512":c={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${r.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:En(n)},l=["sign","verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":c={name:"RSA-OAEP",hash:`SHA-${parseInt(r.slice(-3),10)||1}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:En(n)},l=["decrypt","unwrapKey","encrypt","wrapKey"];break;case"ES256":c={name:"ECDSA",namedCurve:"P-256"},l=["sign","verify"];break;case"ES384":c={name:"ECDSA",namedCurve:"P-384"},l=["sign","verify"];break;case"ES512":c={name:"ECDSA",namedCurve:"P-521"},l=["sign","verify"];break;case(ar()&&"EdDSA"):switch(n==null?void 0:n.crv){case void 0:case"Ed25519":c={name:"NODE-ED25519",namedCurve:"NODE-ED25519"},l=["sign","verify"];break;default:throw new Pe("Invalid or unsupported crv option provided")}break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":c={name:"ECDH",namedCurve:(s=n==null?void 0:n.crv)!==null&&s!==void 0?s:"P-256"},l=["deriveKey","deriveBits"];break;default:throw new Pe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return me.subtle.generateKey(c,(o=n==null?void 0:n.extractable)!==null&&o!==void 0?o:!1,l)}async function ou(r,n){return iu(r,n)}async function su(r,n){return nu(r,n)}var au=Object.freeze(Object.defineProperty({__proto__:null,errors:Us,base64url:eu,compactDecrypt:xo,flattenedDecrypt:Gn,generalDecrypt:wa,GeneralEncrypt:Ta,compactVerify:Do,flattenedVerify:zn,generalVerify:Ra,jwtVerify:Da,jwtDecrypt:Ha,CompactEncrypt:Lo,FlattenedEncrypt:zr,CompactSign:Mo,FlattenedSign:Qn,GeneralSign:Ka,SignJWT:Ba,EncryptJWT:ja,calculateJwkThumbprint:Ko,calculateJwkThumbprintUri:Wa,EmbeddedJWK:Ja,createLocalJWKSet:Ga,createRemoteJWKSet:Xa,UnsecuredJWT:Qa,exportPKCS8:Aa,exportSPKI:Fa,exportJWK:Ro,importSPKI:ua,importPKCS8:la,importX509:ca,importJWK:rn,decodeProtectedHeader:tu,decodeJwt:ru,generateKeyPair:ou,generateSecret:su},Symbol.toStringTag,{value:"Module"})),ti=Kn(au);Object.defineProperty(fr,"__esModule",{value:!0});fr.getWebidFromTokenPayload=fr.fetchJwks=void 0;const uu=pr.exports,Mi=ti;async function jo(r,n){const s=await(0,uu.fetch)(r);if(s.status!==200)throw new Error(`Could not fetch JWKS for [${n}] at [${r}]: ${s.status} ${s.statusText}`);let o;try{o=(await s.json()).keys[0]}catch(c){throw new Error(`Malformed JWKS for [${n}] at [${r}]: ${c.message}`)}return o}fr.fetchJwks=jo;async function cu(r,n,s,o){const c=await jo(n,s);let l;try{const{payload:u}=await(0,Mi.jwtVerify)(r,await(0,Mi.importJWK)(c),{issuer:s,audience:o});l=u}catch(u){throw new Error(`Token verification failed: ${u.stack}`)}if(typeof l.webid=="string")return l.webid;if(typeof l.sub!="string")throw new Error(`The token ${JSON.stringify(l)} is invalid: it has no 'webid' claim and no 'sub' claim.`);try{return new URL(l.sub),l.sub}catch(u){throw new Error(`The token has no 'webid' claim, and its 'sub' claim of [${l.sub}] is invalid as a URL - error [${u}].`)}}fr.getWebidFromTokenPayload=cu;var on={};Object.defineProperty(on,"__esModule",{value:!0});on.isSupportedTokenType=void 0;function lu(r){return typeof r=="string"&&["DPoP","Bearer"].includes(r)}on.isSupportedTokenType=lu;var sn={};Object.defineProperty(sn,"__esModule",{value:!0});sn.USER_SESSION_PREFIX=void 0;sn.USER_SESSION_PREFIX="solidClientAuthenticationUser";var gr={};Object.defineProperty(gr,"__esModule",{value:!0});gr.handleRegistration=gr.determineSigningAlg=void 0;function Ki(r){try{return new URL(r),!0}catch{return!1}}function du(r,n){var s;return(s=n.find(o=>r.includes(o)))!==null&&s!==void 0?s:null}gr.determineSigningAlg=du;function hu(r,n){return r.clientId!==void 0&&!Ki(r.clientId)?"static":n.scopesSupported.includes("webid")&&r.clientId!==void 0&&Ki(r.clientId)?"solid-oidc":"dynamic"}async function fu(r,n,s,o){const c=hu(r,n);return c==="dynamic"?o.getClient({sessionId:r.sessionId,clientName:r.clientName,redirectUrl:r.redirectUrl},n):(await s.setForUser(r.sessionId,{clientId:r.clientId}),r.clientSecret&&await s.setForUser(r.sessionId,{clientSecret:r.clientSecret}),r.clientName&&await s.setForUser(r.sessionId,{clientName:r.clientName}),{clientId:r.clientId,clientSecret:r.clientSecret,clientName:r.clientName,clientType:c})}gr.handleRegistration=fu;var jt={},pu=$e&&$e.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(jt,"__esModule",{value:!0});jt.saveSessionInfoToStorage=jt.loadOidcContextFromStorage=jt.getSessionIdFromOauthState=void 0;const gu=ti,bn=pu(Qr);async function yu(r,n){return r.getForUser(n,"sessionId")}jt.getSessionIdFromOauthState=yu;async function vu(r,n,s){try{const[o,c,l,u]=await Promise.all([n.getForUser(r,"issuer",{errorIfNull:!0}),n.getForUser(r,"codeVerifier"),n.getForUser(r,"redirectUrl"),n.getForUser(r,"dpop",{errorIfNull:!0})]);await n.deleteForUser(r,"codeVerifier");const g=await s.fetchConfig(o);return{codeVerifier:c,redirectUrl:l,issuerConfig:g,dpop:u==="true"}}catch(o){throw new Error(`Failed to retrieve OIDC context from storage associated with session [${r}]: ${o}`)}}jt.loadOidcContextFromStorage=vu;async function mu(r,n,s,o,c,l,u){c!==void 0&&await r.setForUser(n,{refreshToken:c},{secure:l}),s!==void 0&&await r.setForUser(n,{webId:s},{secure:l}),o!==void 0&&await r.setForUser(n,{isLoggedIn:o},{secure:l}),u!==void 0&&await r.setForUser(n,{publicKey:JSON.stringify(u.publicKey),privateKey:JSON.stringify(await(0,gu.exportJWK)(u.privateKey))},{secure:l})}jt.saveSessionInfoToStorage=mu;class _u{constructor(n,s){this.secureStorage=n,this.insecureStorage=s}getKey(n){return`solidClientAuthenticationUser:${n}`}async getUserData(n,s){const o=await(s?this.secureStorage:this.insecureStorage).get(this.getKey(n));if(o===void 0)return{};try{return JSON.parse(o)}catch{throw new bn.default(`Data for user [${n}] in [${s?"secure":"unsecure"}] storage is corrupted - expected valid JSON, but got: ${o}`)}}async setUserData(n,s,o){await(o?this.secureStorage:this.insecureStorage).set(this.getKey(n),JSON.stringify(s))}async get(n,s){const o=await(s!=null&&s.secure?this.secureStorage:this.insecureStorage).get(n);if(o===void 0&&(s==null?void 0:s.errorIfNull))throw new bn.default(`[${n}] is not stored`);return o}async set(n,s,o){return(o!=null&&o.secure?this.secureStorage:this.insecureStorage).set(n,s)}async delete(n,s){return(s!=null&&s.secure?this.secureStorage:this.insecureStorage).delete(n)}async getForUser(n,s,o){const c=await this.getUserData(n,o==null?void 0:o.secure);let l;if((!c||!c[s])&&(l=void 0),l=c[s],l===void 0&&(o==null?void 0:o.errorIfNull))throw new bn.default(`Field [${s}] for user [${n}] is not stored`);return l||void 0}async setForUser(n,s,o){let c;try{c=await this.getUserData(n,o==null?void 0:o.secure)}catch{c={}}await this.setUserData(n,{...c,...s},o==null?void 0:o.secure)}async deleteForUser(n,s,o){const c=await this.getUserData(n,o==null?void 0:o.secure);delete c[s],await this.setUserData(n,c,o==null?void 0:o.secure)}async deleteAllUserData(n,s){await(s!=null&&s.secure?this.secureStorage:this.insecureStorage).delete(this.getKey(n))}}jt.default=_u;var ri={};Object.defineProperty(ri,"__esModule",{value:!0});class Su{constructor(){this.map={}}async get(n){return this.map[n]||void 0}async set(n,s){this.map[n]=s}async delete(n){delete this.map[n]}}ri.default=Su;var ni={};Object.defineProperty(ni,"__esModule",{value:!0});class wu extends Error{constructor(n){super(n)}}ni.default=wu;var ii={};Object.defineProperty(ii,"__esModule",{value:!0});class Eu extends Error{constructor(n){super(`[${n}] is not implemented`)}}ii.default=Eu;var Rr={};Object.defineProperty(Rr,"__esModule",{value:!0});Rr.InvalidResponseError=void 0;class bu extends Error{constructor(n){super(`Invalid response from OIDC provider: missing fields ${n}`),this.missingFields=n}}Rr.InvalidResponseError=bu;var Ir={};Object.defineProperty(Ir,"__esModule",{value:!0});Ir.OidcProviderError=void 0;class Fu extends Error{constructor(n,s,o){super(n),this.error=s,this.errorDescription=o}}Ir.OidcProviderError=Fu;var sr={},Kr,Au=new Uint8Array(16);function Wo(){if(!Kr&&(Kr=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Kr))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Kr(Au)}var Pu=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function an(r){return typeof r=="string"&&Pu.test(r)}var ot=[];for(var Fn=0;Fn<256;++Fn)ot.push((Fn+256).toString(16).substr(1));function un(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=(ot[r[n+0]]+ot[r[n+1]]+ot[r[n+2]]+ot[r[n+3]]+"-"+ot[r[n+4]]+ot[r[n+5]]+"-"+ot[r[n+6]]+ot[r[n+7]]+"-"+ot[r[n+8]]+ot[r[n+9]]+"-"+ot[r[n+10]]+ot[r[n+11]]+ot[r[n+12]]+ot[r[n+13]]+ot[r[n+14]]+ot[r[n+15]]).toLowerCase();if(!an(s))throw TypeError("Stringified UUID is invalid");return s}var Bi,An,Pn=0,Tn=0;function Tu(r,n,s){var o=n&&s||0,c=n||new Array(16);r=r||{};var l=r.node||Bi,u=r.clockseq!==void 0?r.clockseq:An;if(l==null||u==null){var g=r.random||(r.rng||Wo)();l==null&&(l=Bi=[g[0]|1,g[1],g[2],g[3],g[4],g[5]]),u==null&&(u=An=(g[6]<<8|g[7])&16383)}var y=r.msecs!==void 0?r.msecs:Date.now(),f=r.nsecs!==void 0?r.nsecs:Tn+1,h=y-Pn+(f-Tn)/1e4;if(h<0&&r.clockseq===void 0&&(u=u+1&16383),(h<0||y>Pn)&&r.nsecs===void 0&&(f=0),f>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Pn=y,Tn=f,An=u,y+=122192928e5;var p=((y&268435455)*1e4+f)%4294967296;c[o++]=p>>>24&255,c[o++]=p>>>16&255,c[o++]=p>>>8&255,c[o++]=p&255;var E=y/4294967296*1e4&268435455;c[o++]=E>>>8&255,c[o++]=E&255,c[o++]=E>>>24&15|16,c[o++]=E>>>16&255,c[o++]=u>>>8|128,c[o++]=u&255;for(var C=0;C<6;++C)c[o+C]=l[C];return n||un(c)}function Jo(r){if(!an(r))throw TypeError("Invalid UUID");var n,s=new Uint8Array(16);return s[0]=(n=parseInt(r.slice(0,8),16))>>>24,s[1]=n>>>16&255,s[2]=n>>>8&255,s[3]=n&255,s[4]=(n=parseInt(r.slice(9,13),16))>>>8,s[5]=n&255,s[6]=(n=parseInt(r.slice(14,18),16))>>>8,s[7]=n&255,s[8]=(n=parseInt(r.slice(19,23),16))>>>8,s[9]=n&255,s[10]=(n=parseInt(r.slice(24,36),16))/1099511627776&255,s[11]=n/4294967296&255,s[12]=n>>>24&255,s[13]=n>>>16&255,s[14]=n>>>8&255,s[15]=n&255,s}function Cu(r){r=unescape(encodeURIComponent(r));for(var n=[],s=0;s<r.length;++s)n.push(r.charCodeAt(s));return n}var xu="6ba7b810-9dad-11d1-80b4-00c04fd430c8",Ru="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function Vo(r,n,s){function o(c,l,u,g){if(typeof c=="string"&&(c=Cu(c)),typeof l=="string"&&(l=Jo(l)),l.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var y=new Uint8Array(16+c.length);if(y.set(l),y.set(c,l.length),y=s(y),y[6]=y[6]&15|n,y[8]=y[8]&63|128,u){g=g||0;for(var f=0;f<16;++f)u[g+f]=y[f];return u}return un(y)}try{o.name=r}catch{}return o.DNS=xu,o.URL=Ru,o}function Iu(r){if(typeof r=="string"){var n=unescape(encodeURIComponent(r));r=new Uint8Array(n.length);for(var s=0;s<n.length;++s)r[s]=n.charCodeAt(s)}return ku(Uu(Ou(r),r.length*8))}function ku(r){for(var n=[],s=r.length*32,o="0123456789abcdef",c=0;c<s;c+=8){var l=r[c>>5]>>>c%32&255,u=parseInt(o.charAt(l>>>4&15)+o.charAt(l&15),16);n.push(u)}return n}function qo(r){return(r+64>>>9<<4)+14+1}function Uu(r,n){r[n>>5]|=128<<n%32,r[qo(n)-1]=n;for(var s=1732584193,o=-271733879,c=-1732584194,l=271733878,u=0;u<r.length;u+=16){var g=s,y=o,f=c,h=l;s=lt(s,o,c,l,r[u],7,-680876936),l=lt(l,s,o,c,r[u+1],12,-389564586),c=lt(c,l,s,o,r[u+2],17,606105819),o=lt(o,c,l,s,r[u+3],22,-1044525330),s=lt(s,o,c,l,r[u+4],7,-176418897),l=lt(l,s,o,c,r[u+5],12,1200080426),c=lt(c,l,s,o,r[u+6],17,-1473231341),o=lt(o,c,l,s,r[u+7],22,-45705983),s=lt(s,o,c,l,r[u+8],7,1770035416),l=lt(l,s,o,c,r[u+9],12,-1958414417),c=lt(c,l,s,o,r[u+10],17,-42063),o=lt(o,c,l,s,r[u+11],22,-1990404162),s=lt(s,o,c,l,r[u+12],7,1804603682),l=lt(l,s,o,c,r[u+13],12,-40341101),c=lt(c,l,s,o,r[u+14],17,-1502002290),o=lt(o,c,l,s,r[u+15],22,1236535329),s=dt(s,o,c,l,r[u+1],5,-165796510),l=dt(l,s,o,c,r[u+6],9,-1069501632),c=dt(c,l,s,o,r[u+11],14,643717713),o=dt(o,c,l,s,r[u],20,-373897302),s=dt(s,o,c,l,r[u+5],5,-701558691),l=dt(l,s,o,c,r[u+10],9,38016083),c=dt(c,l,s,o,r[u+15],14,-660478335),o=dt(o,c,l,s,r[u+4],20,-405537848),s=dt(s,o,c,l,r[u+9],5,568446438),l=dt(l,s,o,c,r[u+14],9,-1019803690),c=dt(c,l,s,o,r[u+3],14,-187363961),o=dt(o,c,l,s,r[u+8],20,1163531501),s=dt(s,o,c,l,r[u+13],5,-1444681467),l=dt(l,s,o,c,r[u+2],9,-51403784),c=dt(c,l,s,o,r[u+7],14,1735328473),o=dt(o,c,l,s,r[u+12],20,-1926607734),s=ht(s,o,c,l,r[u+5],4,-378558),l=ht(l,s,o,c,r[u+8],11,-2022574463),c=ht(c,l,s,o,r[u+11],16,1839030562),o=ht(o,c,l,s,r[u+14],23,-35309556),s=ht(s,o,c,l,r[u+1],4,-1530992060),l=ht(l,s,o,c,r[u+4],11,1272893353),c=ht(c,l,s,o,r[u+7],16,-155497632),o=ht(o,c,l,s,r[u+10],23,-1094730640),s=ht(s,o,c,l,r[u+13],4,681279174),l=ht(l,s,o,c,r[u],11,-358537222),c=ht(c,l,s,o,r[u+3],16,-722521979),o=ht(o,c,l,s,r[u+6],23,76029189),s=ht(s,o,c,l,r[u+9],4,-640364487),l=ht(l,s,o,c,r[u+12],11,-421815835),c=ht(c,l,s,o,r[u+15],16,530742520),o=ht(o,c,l,s,r[u+2],23,-995338651),s=ft(s,o,c,l,r[u],6,-198630844),l=ft(l,s,o,c,r[u+7],10,1126891415),c=ft(c,l,s,o,r[u+14],15,-1416354905),o=ft(o,c,l,s,r[u+5],21,-57434055),s=ft(s,o,c,l,r[u+12],6,1700485571),l=ft(l,s,o,c,r[u+3],10,-1894986606),c=ft(c,l,s,o,r[u+10],15,-1051523),o=ft(o,c,l,s,r[u+1],21,-2054922799),s=ft(s,o,c,l,r[u+8],6,1873313359),l=ft(l,s,o,c,r[u+15],10,-30611744),c=ft(c,l,s,o,r[u+6],15,-1560198380),o=ft(o,c,l,s,r[u+13],21,1309151649),s=ft(s,o,c,l,r[u+4],6,-145523070),l=ft(l,s,o,c,r[u+11],10,-1120210379),c=ft(c,l,s,o,r[u+2],15,718787259),o=ft(o,c,l,s,r[u+9],21,-343485551),s=Qt(s,g),o=Qt(o,y),c=Qt(c,f),l=Qt(l,h)}return[s,o,c,l]}function Ou(r){if(r.length===0)return[];for(var n=r.length*8,s=new Uint32Array(qo(n)),o=0;o<n;o+=8)s[o>>5]|=(r[o/8]&255)<<o%32;return s}function Qt(r,n){var s=(r&65535)+(n&65535),o=(r>>16)+(n>>16)+(s>>16);return o<<16|s&65535}function Du(r,n){return r<<n|r>>>32-n}function cn(r,n,s,o,c,l){return Qt(Du(Qt(Qt(n,r),Qt(o,l)),c),s)}function lt(r,n,s,o,c,l,u){return cn(n&s|~n&o,r,n,c,l,u)}function dt(r,n,s,o,c,l,u){return cn(n&o|s&~o,r,n,c,l,u)}function ht(r,n,s,o,c,l,u){return cn(n^s^o,r,n,c,l,u)}function ft(r,n,s,o,c,l,u){return cn(s^(n|~o),r,n,c,l,u)}var Hu=Vo("v3",48,Iu),Nu=Hu;function Lu(r,n,s){r=r||{};var o=r.random||(r.rng||Wo)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,n){s=s||0;for(var c=0;c<16;++c)n[s+c]=o[c];return n}return un(o)}function Mu(r,n,s,o){switch(r){case 0:return n&s^~n&o;case 1:return n^s^o;case 2:return n&s^n&o^s&o;case 3:return n^s^o}}function Cn(r,n){return r<<n|r>>>32-n}function Ku(r){var n=[1518500249,1859775393,2400959708,3395469782],s=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof r=="string"){var o=unescape(encodeURIComponent(r));r=[];for(var c=0;c<o.length;++c)r.push(o.charCodeAt(c))}else Array.isArray(r)||(r=Array.prototype.slice.call(r));r.push(128);for(var l=r.length/4+2,u=Math.ceil(l/16),g=new Array(u),y=0;y<u;++y){for(var f=new Uint32Array(16),h=0;h<16;++h)f[h]=r[y*64+h*4]<<24|r[y*64+h*4+1]<<16|r[y*64+h*4+2]<<8|r[y*64+h*4+3];g[y]=f}g[u-1][14]=(r.length-1)*8/Math.pow(2,32),g[u-1][14]=Math.floor(g[u-1][14]),g[u-1][15]=(r.length-1)*8&4294967295;for(var p=0;p<u;++p){for(var E=new Uint32Array(80),C=0;C<16;++C)E[C]=g[p][C];for(var b=16;b<80;++b)E[b]=Cn(E[b-3]^E[b-8]^E[b-14]^E[b-16],1);for(var x=s[0],R=s[1],A=s[2],P=s[3],H=s[4],M=0;M<80;++M){var G=Math.floor(M/20),J=Cn(x,5)+Mu(G,R,A,P)+H+n[G]+E[M]>>>0;H=P,P=A,A=Cn(R,30)>>>0,R=x,x=J}s[0]=s[0]+x>>>0,s[1]=s[1]+R>>>0,s[2]=s[2]+A>>>0,s[3]=s[3]+P>>>0,s[4]=s[4]+H>>>0}return[s[0]>>24&255,s[0]>>16&255,s[0]>>8&255,s[0]&255,s[1]>>24&255,s[1]>>16&255,s[1]>>8&255,s[1]&255,s[2]>>24&255,s[2]>>16&255,s[2]>>8&255,s[2]&255,s[3]>>24&255,s[3]>>16&255,s[3]>>8&255,s[3]&255,s[4]>>24&255,s[4]>>16&255,s[4]>>8&255,s[4]&255]}var Bu=Vo("v5",80,Ku),ju=Bu,Wu="00000000-0000-0000-0000-000000000000";function Ju(r){if(!an(r))throw TypeError("Invalid UUID");return parseInt(r.substr(14,1),16)}var Vu=Object.freeze(Object.defineProperty({__proto__:null,v1:Tu,v3:Nu,v4:Lu,v5:ju,NIL:Wu,version:Ju,validate:an,stringify:un,parse:Jo},Symbol.toStringTag,{value:"Module"})),oi=Kn(Vu);Object.defineProperty(sr,"__esModule",{value:!0});sr.generateDpopKeyPair=sr.createDpopHeader=void 0;const Ln=ti,qu=oi,Mn=At;function $u(r){const n=new URL(r);return new URL(n.pathname,n.origin).toString()}async function Gu(r,n,s){return new Ln.SignJWT({htu:$u(r),htm:n.toUpperCase(),jti:(0,qu.v4)()}).setProtectedHeader({alg:Mn.PREFERRED_SIGNING_ALG[0],jwk:s.publicKey,typ:"dpop+jwt"}).setIssuedAt().sign(s.privateKey,{})}sr.createDpopHeader=Gu;async function zu(){const{privateKey:r,publicKey:n}=await(0,Ln.generateKeyPair)(Mn.PREFERRED_SIGNING_ALG[0]),s={privateKey:r,publicKey:await(0,Ln.exportJWK)(n)};return[s.publicKey.alg]=Mn.PREFERRED_SIGNING_ALG,s}sr.generateDpopKeyPair=zu;var $o={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.buildAuthenticatedFetch=r.DEFAULT_EXPIRATION_TIME_SECONDS=void 0;const n=pr.exports,s=At,o=sr,c=Ir,l=Rr;r.DEFAULT_EXPIRATION_TIME_SECONDS=600;function u(C){return[401,403].includes(C)}async function g(C,b,x,R){var A;const P=new n.Headers(R==null?void 0:R.headers);return P.set("Authorization",`DPoP ${b}`),P.set("DPoP",await(0,o.createDpopHeader)(C,(A=R==null?void 0:R.method)!==null&&A!==void 0?A:"get",x)),{...R,headers:P}}async function y(C,b,x,R){if(x!==void 0)return g(C,b,x,R);const A=new n.Headers(R==null?void 0:R.headers);return A.set("Authorization",`Bearer ${b}`),{...R,headers:A}}async function f(C,b,x,R,A){return C(x,await y(x.toString(),b,A,R))}async function h(C,b,x){var R;const A=await C.tokenRefresher.refresh(C.sessionId,C.refreshToken,b);return x==null||x.emit(s.EVENTS.SESSION_EXTENDED,(R=A.expiresIn)!==null&&R!==void 0?R:r.DEFAULT_EXPIRATION_TIME_SECONDS),typeof A.refreshToken=="string"&&(x==null||x.emit(s.EVENTS.NEW_REFRESH_TOKEN,A.refreshToken)),{accessToken:A.accessToken,refreshToken:A.refreshToken,expiresIn:A.expiresIn}}const p=C=>C!==void 0?C-s.REFRESH_BEFORE_EXPIRATION_SECONDS>0?C-s.REFRESH_BEFORE_EXPIRATION_SECONDS:C:r.DEFAULT_EXPIRATION_TIME_SECONDS;async function E(C,b,x){var R;let A=b,P;const H=x==null?void 0:x.refreshOptions;if(H!==void 0){const M=async()=>{var G,J,j,ne;try{const{accessToken:ie,refreshToken:W,expiresIn:oe}=await h(H,x.dpopKey,x.eventEmitter);A=ie,W!==void 0&&(H.refreshToken=W),clearTimeout(P),P=setTimeout(M,p(oe)*1e3),(G=x.eventEmitter)===null||G===void 0||G.emit(s.EVENTS.TIMEOUT_SET,P)}catch(ie){ie instanceof c.OidcProviderError&&((J=x==null?void 0:x.eventEmitter)===null||J===void 0||J.emit(s.EVENTS.ERROR,ie.error,ie.errorDescription),(j=x==null?void 0:x.eventEmitter)===null||j===void 0||j.emit(s.EVENTS.SESSION_EXPIRED)),ie instanceof l.InvalidResponseError&&ie.missingFields.includes("access_token")&&((ne=x==null?void 0:x.eventEmitter)===null||ne===void 0||ne.emit(s.EVENTS.SESSION_EXPIRED))}};P=setTimeout(M,p(x.expiresIn)*1e3),(R=x.eventEmitter)===null||R===void 0||R.emit(s.EVENTS.TIMEOUT_SET,P)}else if(x!==void 0&&x.eventEmitter!==void 0){const M=setTimeout(()=>{x.eventEmitter.emit(s.EVENTS.SESSION_EXPIRED)},p(x.expiresIn)*1e3);x.eventEmitter.emit(s.EVENTS.TIMEOUT_SET,M)}return async(M,G)=>{let J=await f(C,A,M,G,x==null?void 0:x.dpopKey);const j=!J.ok&&!u(J.status);return J.ok||j||J.url!==M&&(x==null?void 0:x.dpopKey)!==void 0&&(J=await f(C,A,J.url,G,x.dpopKey)),J}}r.buildAuthenticatedFetch=E})($o);var Go={};(function(r){var n=$e&&$e.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(r,"__esModule",{value:!0}),r.mockStorageUtility=r.mockStorage=r.StorageUtilityMock=r.StorageUtilityGetResponse=void 0;const s=n(jt);r.StorageUtilityGetResponse="getResponse",r.StorageUtilityMock={get:async(l,u)=>r.StorageUtilityGetResponse,set:async(l,u)=>{},delete:async l=>{},getForUser:async(l,u,g)=>r.StorageUtilityGetResponse,setForUser:async(l,u,g)=>{},deleteForUser:async(l,u,g)=>{},deleteAllUserData:async(l,u)=>{}};const o=l=>{const u=l;return{get:async g=>{if(u[g]!==void 0)return typeof u[g]=="string"?u[g]:JSON.stringify(u[g])},set:async(g,y)=>{u[g]=y},delete:async g=>{delete u[g]}}};r.mockStorage=o;const c=(l,u=!1)=>u?new s.default((0,r.mockStorage)(l),(0,r.mockStorage)({})):new s.default((0,r.mockStorage)({}),(0,r.mockStorage)(l));r.mockStorageUtility=c})(Go);(function(r){var n=$e&&$e.__createBinding||(Object.create?function(P,H,M,G){G===void 0&&(G=M);var J=Object.getOwnPropertyDescriptor(H,M);(!J||("get"in J?!H.__esModule:J.writable||J.configurable))&&(J={enumerable:!0,get:function(){return H[M]}}),Object.defineProperty(P,G,J)}:function(P,H,M,G){G===void 0&&(G=M),P[G]=H[M]}),s=$e&&$e.__exportStar||function(P,H){for(var M in P)M!=="default"&&!Object.prototype.hasOwnProperty.call(H,M)&&n(H,P,M)},o=$e&&$e.__importDefault||function(P){return P&&P.__esModule?P:{default:P}};Object.defineProperty(r,"__esModule",{value:!0}),r.StorageUtilityGetResponse=r.StorageUtilityMock=r.mockStorageUtility=r.mockStorage=r.buildAuthenticatedFetch=r.generateDpopKeyPair=r.createDpopHeader=r.OidcProviderError=r.InvalidResponseError=r.NotImplementedError=r.ConfigurationError=r.InMemoryStorage=r.getSessionIdFromOauthState=r.saveSessionInfoToStorage=r.loadOidcContextFromStorage=r.StorageUtility=r.determineSigningAlg=r.handleRegistration=r.USER_SESSION_PREFIX=r.isSupportedTokenType=r.fetchJwks=r.getWebidFromTokenPayload=r.AggregateHandler=void 0,s(At,r);var c=jn;Object.defineProperty(r,"AggregateHandler",{enumerable:!0,get:function(){return o(c).default}});var l=fr;Object.defineProperty(r,"getWebidFromTokenPayload",{enumerable:!0,get:function(){return l.getWebidFromTokenPayload}}),Object.defineProperty(r,"fetchJwks",{enumerable:!0,get:function(){return l.fetchJwks}});var u=on;Object.defineProperty(r,"isSupportedTokenType",{enumerable:!0,get:function(){return u.isSupportedTokenType}});var g=sn;Object.defineProperty(r,"USER_SESSION_PREFIX",{enumerable:!0,get:function(){return g.USER_SESSION_PREFIX}});var y=gr;Object.defineProperty(r,"handleRegistration",{enumerable:!0,get:function(){return y.handleRegistration}}),Object.defineProperty(r,"determineSigningAlg",{enumerable:!0,get:function(){return y.determineSigningAlg}});var f=jt;Object.defineProperty(r,"StorageUtility",{enumerable:!0,get:function(){return o(f).default}}),Object.defineProperty(r,"loadOidcContextFromStorage",{enumerable:!0,get:function(){return f.loadOidcContextFromStorage}}),Object.defineProperty(r,"saveSessionInfoToStorage",{enumerable:!0,get:function(){return f.saveSessionInfoToStorage}}),Object.defineProperty(r,"getSessionIdFromOauthState",{enumerable:!0,get:function(){return f.getSessionIdFromOauthState}});var h=ri;Object.defineProperty(r,"InMemoryStorage",{enumerable:!0,get:function(){return o(h).default}});var p=ni;Object.defineProperty(r,"ConfigurationError",{enumerable:!0,get:function(){return o(p).default}});var E=ii;Object.defineProperty(r,"NotImplementedError",{enumerable:!0,get:function(){return o(E).default}});var C=Rr;Object.defineProperty(r,"InvalidResponseError",{enumerable:!0,get:function(){return C.InvalidResponseError}});var b=Ir;Object.defineProperty(r,"OidcProviderError",{enumerable:!0,get:function(){return b.OidcProviderError}});var x=sr;Object.defineProperty(r,"createDpopHeader",{enumerable:!0,get:function(){return x.createDpopHeader}}),Object.defineProperty(r,"generateDpopKeyPair",{enumerable:!0,get:function(){return x.generateDpopKeyPair}});var R=$o;Object.defineProperty(r,"buildAuthenticatedFetch",{enumerable:!0,get:function(){return R.buildAuthenticatedFetch}});var A=Go;Object.defineProperty(r,"mockStorage",{enumerable:!0,get:function(){return A.mockStorage}}),Object.defineProperty(r,"mockStorageUtility",{enumerable:!0,get:function(){return A.mockStorageUtility}}),Object.defineProperty(r,"StorageUtilityMock",{enumerable:!0,get:function(){return A.StorageUtilityMock}}),Object.defineProperty(r,"StorageUtilityGetResponse",{enumerable:!0,get:function(){return A.StorageUtilityGetResponse}})})(xe);var kr={},si={};Object.defineProperty(si,"__esModule",{value:!0});const Yu=xe;class Xu extends Yu.StorageUtility{constructor(n,s){super(n,s)}}si.default=Xu;var ai={},bt={exports:{}};(function(r,n){(function(o,c){r.exports=c()})($e,function(){return function(s){var o={};function c(l){if(o[l])return o[l].exports;var u=o[l]={i:l,l:!1,exports:{}};return s[l].call(u.exports,u,u.exports,c),u.l=!0,u.exports}return c.m=s,c.c=o,c.d=function(l,u,g){c.o(l,u)||Object.defineProperty(l,u,{enumerable:!0,get:g})},c.r=function(l){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})},c.t=function(l,u){if(1&u&&(l=c(l)),8&u||4&u&&typeof l=="object"&&l&&l.__esModule)return l;var g=Object.create(null);if(c.r(g),Object.defineProperty(g,"default",{enumerable:!0,value:l}),2&u&&typeof l!="string")for(var y in l)c.d(g,y,function(f){return l[f]}.bind(null,y));return g},c.n=function(l){var u=l&&l.__esModule?function(){return l.default}:function(){return l};return c.d(u,"a",u),u},c.o=function(l,u){return Object.prototype.hasOwnProperty.call(l,u)},c.p="",c(c.s=22)}([function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0});var l=function(){function f(h,p){for(var E=0;E<p.length;E++){var C=p[E];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(h,C.key,C)}}return function(h,p,E){return p&&f(h.prototype,p),E&&f(h,E),h}}(),u={debug:function(){},info:function(){},warn:function(){},error:function(){}},g=void 0,y=void 0;(o.Log=function(){function f(){(function(p,E){if(!(p instanceof E))throw new TypeError("Cannot call a class as a function")})(this,f)}return f.reset=function(){y=3,g=u},f.debug=function(){if(y>=4){for(var p=arguments.length,E=Array(p),C=0;C<p;C++)E[C]=arguments[C];g.debug.apply(g,Array.from(E))}},f.info=function(){if(y>=3){for(var p=arguments.length,E=Array(p),C=0;C<p;C++)E[C]=arguments[C];g.info.apply(g,Array.from(E))}},f.warn=function(){if(y>=2){for(var p=arguments.length,E=Array(p),C=0;C<p;C++)E[C]=arguments[C];g.warn.apply(g,Array.from(E))}},f.error=function(){if(y>=1){for(var p=arguments.length,E=Array(p),C=0;C<p;C++)E[C]=arguments[C];g.error.apply(g,Array.from(E))}},l(f,null,[{key:"NONE",get:function(){return 0}},{key:"ERROR",get:function(){return 1}},{key:"WARN",get:function(){return 2}},{key:"INFO",get:function(){return 3}},{key:"DEBUG",get:function(){return 4}},{key:"level",get:function(){return y},set:function(p){if(!(0<=p&&p<=4))throw new Error("Invalid log level");y=p}},{key:"logger",get:function(){return g},set:function(p){if(!p.debug&&p.info&&(p.debug=p.info),!(p.debug&&p.info&&p.warn&&p.error))throw new Error("Invalid logger");g=p}}]),f}()).reset()},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0});var l=function(){function f(h,p){for(var E=0;E<p.length;E++){var C=p[E];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(h,C.key,C)}}return function(h,p,E){return p&&f(h.prototype,p),E&&f(h,E),h}}(),u={setInterval:function(f){function h(p,E){return f.apply(this,arguments)}return h.toString=function(){return f.toString()},h}(function(f,h){return setInterval(f,h)}),clearInterval:function(f){function h(p){return f.apply(this,arguments)}return h.toString=function(){return f.toString()},h}(function(f){return clearInterval(f)})},g=!1,y=null;o.Global=function(){function f(){(function(p,E){if(!(p instanceof E))throw new TypeError("Cannot call a class as a function")})(this,f)}return f._testing=function(){g=!0},f.setXMLHttpRequest=function(p){y=p},l(f,null,[{key:"location",get:function(){if(!g)return location}},{key:"localStorage",get:function(){if(!g&&typeof window!="undefined")return localStorage}},{key:"sessionStorage",get:function(){if(!g&&typeof window!="undefined")return sessionStorage}},{key:"XMLHttpRequest",get:function(){if(!g&&typeof window!="undefined")return y||XMLHttpRequest}},{key:"timer",get:function(){if(!g)return u}}]),f}()},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.MetadataService=void 0;var l=function(){function h(p,E){for(var C=0;C<E.length;C++){var b=E[C];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(p,b.key,b)}}return function(p,E,C){return E&&h(p.prototype,E),C&&h(p,C),p}}(),u=c(0),g=c(7);function y(h,p){if(!(h instanceof p))throw new TypeError("Cannot call a class as a function")}var f=".well-known/openid-configuration";o.MetadataService=function(){function h(p){var E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:g.JsonService;if(y(this,h),!p)throw u.Log.error("MetadataService: No settings passed to MetadataService"),new Error("settings");this._settings=p,this._jsonService=new E(["application/jwk-set+json"])}return h.prototype.resetSigningKeys=function(){this._settings=this._settings||{},this._settings.signingKeys=void 0},h.prototype.getMetadata=function(){var E=this;return this._settings.metadata?(u.Log.debug("MetadataService.getMetadata: Returning metadata from settings"),Promise.resolve(this._settings.metadata)):this.metadataUrl?(u.Log.debug("MetadataService.getMetadata: getting metadata from",this.metadataUrl),this._jsonService.getJson(this.metadataUrl).then(function(C){u.Log.debug("MetadataService.getMetadata: json received");var b=E._settings.metadataSeed||{};return E._settings.metadata=Object.assign({},b,C),E._settings.metadata})):(u.Log.error("MetadataService.getMetadata: No authority or metadataUrl configured on settings"),Promise.reject(new Error("No authority or metadataUrl configured on settings")))},h.prototype.getIssuer=function(){return this._getMetadataProperty("issuer")},h.prototype.getAuthorizationEndpoint=function(){return this._getMetadataProperty("authorization_endpoint")},h.prototype.getUserInfoEndpoint=function(){return this._getMetadataProperty("userinfo_endpoint")},h.prototype.getTokenEndpoint=function(){var E=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];return this._getMetadataProperty("token_endpoint",E)},h.prototype.getCheckSessionIframe=function(){return this._getMetadataProperty("check_session_iframe",!0)},h.prototype.getEndSessionEndpoint=function(){return this._getMetadataProperty("end_session_endpoint",!0)},h.prototype.getRevocationEndpoint=function(){return this._getMetadataProperty("revocation_endpoint",!0)},h.prototype.getKeysEndpoint=function(){return this._getMetadataProperty("jwks_uri",!0)},h.prototype._getMetadataProperty=function(E){var C=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return u.Log.debug("MetadataService.getMetadataProperty for: "+E),this.getMetadata().then(function(b){if(u.Log.debug("MetadataService.getMetadataProperty: metadata recieved"),b[E]===void 0){if(C===!0)return void u.Log.warn("MetadataService.getMetadataProperty: Metadata does not contain optional property "+E);throw u.Log.error("MetadataService.getMetadataProperty: Metadata does not contain property "+E),new Error("Metadata does not contain property "+E)}return b[E]})},h.prototype.getSigningKeys=function(){var E=this;return this._settings.signingKeys?(u.Log.debug("MetadataService.getSigningKeys: Returning signingKeys from settings"),Promise.resolve(this._settings.signingKeys)):this._getMetadataProperty("jwks_uri").then(function(C){return u.Log.debug("MetadataService.getSigningKeys: jwks_uri received",C),E._jsonService.getJson(C).then(function(b){if(u.Log.debug("MetadataService.getSigningKeys: key set received",b),!b.keys)throw u.Log.error("MetadataService.getSigningKeys: Missing keys on keyset"),new Error("Missing keys on keyset");return E._settings.signingKeys=b.keys,E._settings.signingKeys})})},l(h,[{key:"metadataUrl",get:function(){return this._metadataUrl||(this._settings.metadataUrl?this._metadataUrl=this._settings.metadataUrl:(this._metadataUrl=this._settings.authority,this._metadataUrl&&this._metadataUrl.indexOf(f)<0&&(this._metadataUrl[this._metadataUrl.length-1]!=="/"&&(this._metadataUrl+="/"),this._metadataUrl+=f))),this._metadataUrl}}]),h}()},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.UrlUtility=void 0;var l=c(0),u=c(1);o.UrlUtility=function(){function g(){(function(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")})(this,g)}return g.addQueryParam=function(f,h,p){return f.indexOf("?")<0&&(f+="?"),f[f.length-1]!=="?"&&(f+="&"),f+=encodeURIComponent(h),f+="=",f+=encodeURIComponent(p)},g.parseUrlFragment=function(f){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#",p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:u.Global;typeof f!="string"&&(f=p.location.href);var E=f.lastIndexOf(h);E>=0&&(f=f.substr(E+1)),h==="?"&&(E=f.indexOf("#"))>=0&&(f=f.substr(0,E));for(var C,b={},x=/([^&=]+)=([^&]*)/g,R=0;C=x.exec(f);)if(b[decodeURIComponent(C[1])]=decodeURIComponent(C[2].replace(/\+/g," ")),R++>50)return l.Log.error("UrlUtility.parseUrlFragment: response exceeded expected number of parameters",f),{error:"Response exceeded expected number of parameters"};for(var A in b)return b;return{}},g}()},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.JoseUtil=void 0;var l=c(26),u=function(y){return y&&y.__esModule?y:{default:y}}(c(33));o.JoseUtil=(0,u.default)({jws:l.jws,KeyUtil:l.KeyUtil,X509:l.X509,crypto:l.crypto,hextob64u:l.hextob64u,b64tohex:l.b64tohex,AllowedSigningAlgs:l.AllowedSigningAlgs})},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.OidcClientSettings=void 0;var l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},u=function(){function A(P,H){for(var M=0;M<H.length;M++){var G=H[M];G.enumerable=G.enumerable||!1,G.configurable=!0,"value"in G&&(G.writable=!0),Object.defineProperty(P,G.key,G)}}return function(P,H,M){return H&&A(P.prototype,H),M&&A(P,M),P}}(),g=c(0),y=c(23),f=c(6),h=c(24),p=c(2);function E(A,P){if(!(A instanceof P))throw new TypeError("Cannot call a class as a function")}var C=".well-known/openid-configuration",b="id_token",x="openid",R="client_secret_post";o.OidcClientSettings=function(){function A(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},H=P.authority,M=P.metadataUrl,G=P.metadata,J=P.signingKeys,j=P.metadataSeed,ne=P.client_id,ie=P.client_secret,W=P.response_type,oe=W===void 0?b:W,Te=P.scope,be=Te===void 0?x:Te,Z=P.redirect_uri,ae=P.post_logout_redirect_uri,pe=P.client_authentication,Ee=pe===void 0?R:pe,Fe=P.prompt,le=P.display,_e=P.max_age,Me=P.ui_locales,Ve=P.acr_values,vt=P.resource,mt=P.response_mode,Ct=P.filterProtocolClaims,Vt=Ct===void 0||Ct,ut=P.loadUserInfo,_t=ut===void 0||ut,tt=P.staleStateAge,He=tt===void 0?900:tt,V=P.clockSkew,m=V===void 0?300:V,_=P.clockService,L=_===void 0?new y.ClockService:_,q=P.userInfoJwtIssuer,X=q===void 0?"OP":q,re=P.mergeClaims,he=re!==void 0&&re,ve=P.stateStore,Ce=ve===void 0?new f.WebStorageStateStore:ve,Ae=P.ResponseValidatorCtor,Re=Ae===void 0?h.ResponseValidator:Ae,St=P.MetadataServiceCtor,Ot=St===void 0?p.MetadataService:St,fe=P.extraQueryParams,Ke=fe===void 0?{}:fe,we=P.extraTokenParams,xt=we===void 0?{}:we;E(this,A),this._authority=H,this._metadataUrl=M,this._metadata=G,this._metadataSeed=j,this._signingKeys=J,this._client_id=ne,this._client_secret=ie,this._response_type=oe,this._scope=be,this._redirect_uri=Z,this._post_logout_redirect_uri=ae,this._client_authentication=Ee,this._prompt=Fe,this._display=le,this._max_age=_e,this._ui_locales=Me,this._acr_values=Ve,this._resource=vt,this._response_mode=mt,this._filterProtocolClaims=!!Vt,this._loadUserInfo=!!_t,this._staleStateAge=He,this._clockSkew=m,this._clockService=L,this._userInfoJwtIssuer=X,this._mergeClaims=!!he,this._stateStore=Ce,this._validator=new Re(this),this._metadataService=new Ot(this),this._extraQueryParams=(Ke===void 0?"undefined":l(Ke))==="object"?Ke:{},this._extraTokenParams=(xt===void 0?"undefined":l(xt))==="object"?xt:{}}return A.prototype.getEpochTime=function(){return this._clockService.getEpochTime()},u(A,[{key:"client_id",get:function(){return this._client_id},set:function(H){if(this._client_id)throw g.Log.error("OidcClientSettings.set_client_id: client_id has already been assigned."),new Error("client_id has already been assigned.");this._client_id=H}},{key:"client_secret",get:function(){return this._client_secret}},{key:"response_type",get:function(){return this._response_type}},{key:"scope",get:function(){return this._scope}},{key:"redirect_uri",get:function(){return this._redirect_uri}},{key:"post_logout_redirect_uri",get:function(){return this._post_logout_redirect_uri}},{key:"client_authentication",get:function(){return this._client_authentication}},{key:"prompt",get:function(){return this._prompt}},{key:"display",get:function(){return this._display}},{key:"max_age",get:function(){return this._max_age}},{key:"ui_locales",get:function(){return this._ui_locales}},{key:"acr_values",get:function(){return this._acr_values}},{key:"resource",get:function(){return this._resource}},{key:"response_mode",get:function(){return this._response_mode}},{key:"authority",get:function(){return this._authority},set:function(H){if(this._authority)throw g.Log.error("OidcClientSettings.set_authority: authority has already been assigned."),new Error("authority has already been assigned.");this._authority=H}},{key:"metadataUrl",get:function(){return this._metadataUrl||(this._metadataUrl=this.authority,this._metadataUrl&&this._metadataUrl.indexOf(C)<0&&(this._metadataUrl[this._metadataUrl.length-1]!=="/"&&(this._metadataUrl+="/"),this._metadataUrl+=C)),this._metadataUrl}},{key:"metadata",get:function(){return this._metadata},set:function(H){this._metadata=H}},{key:"metadataSeed",get:function(){return this._metadataSeed},set:function(H){this._metadataSeed=H}},{key:"signingKeys",get:function(){return this._signingKeys},set:function(H){this._signingKeys=H}},{key:"filterProtocolClaims",get:function(){return this._filterProtocolClaims}},{key:"loadUserInfo",get:function(){return this._loadUserInfo}},{key:"staleStateAge",get:function(){return this._staleStateAge}},{key:"clockSkew",get:function(){return this._clockSkew}},{key:"userInfoJwtIssuer",get:function(){return this._userInfoJwtIssuer}},{key:"mergeClaims",get:function(){return this._mergeClaims}},{key:"stateStore",get:function(){return this._stateStore}},{key:"validator",get:function(){return this._validator}},{key:"metadataService",get:function(){return this._metadataService}},{key:"extraQueryParams",get:function(){return this._extraQueryParams},set:function(H){(H===void 0?"undefined":l(H))==="object"?this._extraQueryParams=H:this._extraQueryParams={}}},{key:"extraTokenParams",get:function(){return this._extraTokenParams},set:function(H){(H===void 0?"undefined":l(H))==="object"?this._extraTokenParams=H:this._extraTokenParams={}}}]),A}()},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.WebStorageStateStore=void 0;var l=c(0),u=c(1);function g(y,f){if(!(y instanceof f))throw new TypeError("Cannot call a class as a function")}o.WebStorageStateStore=function(){function y(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=f.prefix,p=h===void 0?"oidc.":h,E=f.store,C=E===void 0?u.Global.localStorage:E;g(this,y),this._store=C,this._prefix=p}return y.prototype.set=function(h,p){return l.Log.debug("WebStorageStateStore.set",h),h=this._prefix+h,this._store.setItem(h,p),Promise.resolve()},y.prototype.get=function(h){l.Log.debug("WebStorageStateStore.get",h),h=this._prefix+h;var p=this._store.getItem(h);return Promise.resolve(p)},y.prototype.remove=function(h){l.Log.debug("WebStorageStateStore.remove",h),h=this._prefix+h;var p=this._store.getItem(h);return this._store.removeItem(h),Promise.resolve(p)},y.prototype.getAllKeys=function(){l.Log.debug("WebStorageStateStore.getAllKeys");for(var h=[],p=0;p<this._store.length;p++){var E=this._store.key(p);E.indexOf(this._prefix)===0&&h.push(E.substr(this._prefix.length))}return Promise.resolve(h)},y}()},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.JsonService=void 0;var l=c(0),u=c(1);function g(y,f){if(!(y instanceof f))throw new TypeError("Cannot call a class as a function")}o.JsonService=function(){function y(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:u.Global.XMLHttpRequest,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;g(this,y),f&&Array.isArray(f)?this._contentTypes=f.slice():this._contentTypes=[],this._contentTypes.push("application/json"),p&&this._contentTypes.push("application/jwt"),this._XMLHttpRequest=h,this._jwtHandler=p}return y.prototype.getJson=function(h,p){var E=this;if(!h)throw l.Log.error("JsonService.getJson: No url passed"),new Error("url");return l.Log.debug("JsonService.getJson, url: ",h),new Promise(function(C,b){var x=new E._XMLHttpRequest;x.open("GET",h);var R=E._contentTypes,A=E._jwtHandler;x.onload=function(){if(l.Log.debug("JsonService.getJson: HTTP response received, status",x.status),x.status===200){var P=x.getResponseHeader("Content-Type");if(P){var H=R.find(function(M){if(P.startsWith(M))return!0});if(H=="application/jwt")return void A(x).then(C,b);if(H)try{return void C(JSON.parse(x.responseText))}catch(M){return l.Log.error("JsonService.getJson: Error parsing JSON response",M.message),void b(M)}}b(Error("Invalid response Content-Type: "+P+", from URL: "+h))}else b(Error(x.statusText+" ("+x.status+")"))},x.onerror=function(){l.Log.error("JsonService.getJson: network error"),b(Error("Network Error"))},p&&(l.Log.debug("JsonService.getJson: token passed, setting Authorization header"),x.setRequestHeader("Authorization","Bearer "+p)),x.send()})},y.prototype.postForm=function(h,p,E){var C=this;if(!h)throw l.Log.error("JsonService.postForm: No url passed"),new Error("url");return l.Log.debug("JsonService.postForm, url: ",h),new Promise(function(b,x){var R=new C._XMLHttpRequest;R.open("POST",h);var A=C._contentTypes;R.onload=function(){if(l.Log.debug("JsonService.postForm: HTTP response received, status",R.status),R.status!==200){if(R.status===400&&(J=R.getResponseHeader("Content-Type"))&&A.find(function(j){if(J.startsWith(j))return!0}))try{var G=JSON.parse(R.responseText);if(G&&G.error)return l.Log.error("JsonService.postForm: Error from server: ",G.error),void x(new Error(G.error))}catch(j){return l.Log.error("JsonService.postForm: Error parsing JSON response",j.message),void x(j)}x(Error(R.statusText+" ("+R.status+")"))}else{var J;if((J=R.getResponseHeader("Content-Type"))&&A.find(function(j){if(J.startsWith(j))return!0}))try{return void b(JSON.parse(R.responseText))}catch(j){return l.Log.error("JsonService.postForm: Error parsing JSON response",j.message),void x(j)}x(Error("Invalid response Content-Type: "+J+", from URL: "+h))}},R.onerror=function(){l.Log.error("JsonService.postForm: network error"),x(Error("Network Error"))};var P="";for(var H in p){var M=p[H];M&&(P.length>0&&(P+="&"),P+=encodeURIComponent(H),P+="=",P+=encodeURIComponent(M))}R.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),E!==void 0&&R.setRequestHeader("Authorization","Basic "+btoa(E)),R.send(P)})},y}()},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.SigninRequest=void 0;var l=c(0),u=c(3),g=c(13);o.SigninRequest=function(){function y(f){var h=f.url,p=f.client_id,E=f.redirect_uri,C=f.response_type,b=f.scope,x=f.authority,R=f.data,A=f.prompt,P=f.display,H=f.max_age,M=f.ui_locales,G=f.id_token_hint,J=f.login_hint,j=f.acr_values,ne=f.resource,ie=f.response_mode,W=f.request,oe=f.request_uri,Te=f.extraQueryParams,be=f.request_type,Z=f.client_secret,ae=f.extraTokenParams,pe=f.skipUserInfo;if(function(vt,mt){if(!(vt instanceof mt))throw new TypeError("Cannot call a class as a function")}(this,y),!h)throw l.Log.error("SigninRequest.ctor: No url passed"),new Error("url");if(!p)throw l.Log.error("SigninRequest.ctor: No client_id passed"),new Error("client_id");if(!E)throw l.Log.error("SigninRequest.ctor: No redirect_uri passed"),new Error("redirect_uri");if(!C)throw l.Log.error("SigninRequest.ctor: No response_type passed"),new Error("response_type");if(!b)throw l.Log.error("SigninRequest.ctor: No scope passed"),new Error("scope");if(!x)throw l.Log.error("SigninRequest.ctor: No authority passed"),new Error("authority");var Ee=y.isOidc(C),Fe=y.isCode(C);ie||(ie=y.isCode(C)?"query":null),this.state=new g.SigninState({nonce:Ee,data:R,client_id:p,authority:x,redirect_uri:E,code_verifier:Fe,request_type:be,response_mode:ie,client_secret:Z,scope:b,extraTokenParams:ae,skipUserInfo:pe}),h=u.UrlUtility.addQueryParam(h,"client_id",p),h=u.UrlUtility.addQueryParam(h,"redirect_uri",E),h=u.UrlUtility.addQueryParam(h,"response_type",C),h=u.UrlUtility.addQueryParam(h,"scope",b),h=u.UrlUtility.addQueryParam(h,"state",this.state.id),Ee&&(h=u.UrlUtility.addQueryParam(h,"nonce",this.state.nonce)),Fe&&(h=u.UrlUtility.addQueryParam(h,"code_challenge",this.state.code_challenge),h=u.UrlUtility.addQueryParam(h,"code_challenge_method","S256"));var le={prompt:A,display:P,max_age:H,ui_locales:M,id_token_hint:G,login_hint:J,acr_values:j,resource:ne,request:W,request_uri:oe,response_mode:ie};for(var _e in le)le[_e]&&(h=u.UrlUtility.addQueryParam(h,_e,le[_e]));for(var Me in Te)h=u.UrlUtility.addQueryParam(h,Me,Te[Me]);this.url=h}return y.isOidc=function(h){return!!h.split(/\s+/g).filter(function(p){return p==="id_token"})[0]},y.isOAuth=function(h){return!!h.split(/\s+/g).filter(function(p){return p==="token"})[0]},y.isCode=function(h){return!!h.split(/\s+/g).filter(function(p){return p==="code"})[0]},y}()},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.State=void 0;var l=function(){function f(h,p){for(var E=0;E<p.length;E++){var C=p[E];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(h,C.key,C)}}return function(h,p,E){return p&&f(h.prototype,p),E&&f(h,E),h}}(),u=c(0),g=function(h){return h&&h.__esModule?h:{default:h}}(c(14));function y(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")}o.State=function(){function f(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},p=h.id,E=h.data,C=h.created,b=h.request_type;y(this,f),this._id=p||(0,g.default)(),this._data=E,this._created=typeof C=="number"&&C>0?C:parseInt(Date.now()/1e3),this._request_type=b}return f.prototype.toStorageString=function(){return u.Log.debug("State.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type})},f.fromStorageString=function(p){return u.Log.debug("State.fromStorageString"),new f(JSON.parse(p))},f.clearStaleState=function(p,E){var C=Date.now()/1e3-E;return p.getAllKeys().then(function(b){u.Log.debug("State.clearStaleState: got keys",b);for(var x=[],R=function(M){var G=b[M];P=p.get(G).then(function(J){var j=!1;if(J)try{var ne=f.fromStorageString(J);u.Log.debug("State.clearStaleState: got item from key: ",G,ne.created),ne.created<=C&&(j=!0)}catch(ie){u.Log.error("State.clearStaleState: Error parsing state for key",G,ie.message),j=!0}else u.Log.debug("State.clearStaleState: no item in storage for key: ",G),j=!0;if(j)return u.Log.debug("State.clearStaleState: removed item for key: ",G),p.remove(G)}),x.push(P)},A=0;A<b.length;A++){var P;R(A)}return u.Log.debug("State.clearStaleState: waiting on promise count:",x.length),Promise.all(x)})},l(f,[{key:"id",get:function(){return this._id}},{key:"data",get:function(){return this._data}},{key:"created",get:function(){return this._created}},{key:"request_type",get:function(){return this._request_type}}]),f}()},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.OidcClient=void 0;var l=function(){function R(A,P){for(var H=0;H<P.length;H++){var M=P[H];M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(A,M.key,M)}}return function(A,P,H){return P&&R(A.prototype,P),H&&R(A,H),A}}(),u=c(0),g=c(5),y=c(12),f=c(8),h=c(34),p=c(35),E=c(36),C=c(13),b=c(9);function x(R,A){if(!(R instanceof A))throw new TypeError("Cannot call a class as a function")}o.OidcClient=function(){function R(){var A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};x(this,R),A instanceof g.OidcClientSettings?this._settings=A:this._settings=new g.OidcClientSettings(A)}return R.prototype.createSigninRequest=function(){var P=this,H=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},M=H.response_type,G=H.scope,J=H.redirect_uri,j=H.data,ne=H.state,ie=H.prompt,W=H.display,oe=H.max_age,Te=H.ui_locales,be=H.id_token_hint,Z=H.login_hint,ae=H.acr_values,pe=H.resource,Ee=H.request,Fe=H.request_uri,le=H.response_mode,_e=H.extraQueryParams,Me=H.extraTokenParams,Ve=H.request_type,vt=H.skipUserInfo,mt=arguments[1];u.Log.debug("OidcClient.createSigninRequest");var Ct=this._settings.client_id;M=M||this._settings.response_type,G=G||this._settings.scope,J=J||this._settings.redirect_uri,ie=ie||this._settings.prompt,W=W||this._settings.display,oe=oe||this._settings.max_age,Te=Te||this._settings.ui_locales,ae=ae||this._settings.acr_values,pe=pe||this._settings.resource,le=le||this._settings.response_mode,_e=_e||this._settings.extraQueryParams,Me=Me||this._settings.extraTokenParams;var Vt=this._settings.authority;return f.SigninRequest.isCode(M)&&M!=="code"?Promise.reject(new Error("OpenID Connect hybrid flow is not supported")):this._metadataService.getAuthorizationEndpoint().then(function(ut){u.Log.debug("OidcClient.createSigninRequest: Received authorization endpoint",ut);var _t=new f.SigninRequest({url:ut,client_id:Ct,redirect_uri:J,response_type:M,scope:G,data:j||ne,authority:Vt,prompt:ie,display:W,max_age:oe,ui_locales:Te,id_token_hint:be,login_hint:Z,acr_values:ae,resource:pe,request:Ee,request_uri:Fe,extraQueryParams:_e,extraTokenParams:Me,request_type:Ve,response_mode:le,client_secret:P._settings.client_secret,skipUserInfo:vt}),tt=_t.state;return(mt=mt||P._stateStore).set(tt.id,tt.toStorageString()).then(function(){return _t})})},R.prototype.readSigninResponseState=function(P,H){var M=arguments.length>2&&arguments[2]!==void 0&&arguments[2];u.Log.debug("OidcClient.readSigninResponseState");var G=this._settings.response_mode==="query"||!this._settings.response_mode&&f.SigninRequest.isCode(this._settings.response_type),J=G?"?":"#",j=new h.SigninResponse(P,J);if(!j.state)return u.Log.error("OidcClient.readSigninResponseState: No state in response"),Promise.reject(new Error("No state in response"));H=H||this._stateStore;var ne=M?H.remove.bind(H):H.get.bind(H);return ne(j.state).then(function(ie){if(!ie)throw u.Log.error("OidcClient.readSigninResponseState: No matching state found in storage"),new Error("No matching state found in storage");return{state:C.SigninState.fromStorageString(ie),response:j}})},R.prototype.processSigninResponse=function(P,H){var M=this;return u.Log.debug("OidcClient.processSigninResponse"),this.readSigninResponseState(P,H,!0).then(function(G){var J=G.state,j=G.response;return u.Log.debug("OidcClient.processSigninResponse: Received state from storage; validating response"),M._validator.validateSigninResponse(J,j)})},R.prototype.createSignoutRequest=function(){var P=this,H=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},M=H.id_token_hint,G=H.data,J=H.state,j=H.post_logout_redirect_uri,ne=H.extraQueryParams,ie=H.request_type,W=arguments[1];return u.Log.debug("OidcClient.createSignoutRequest"),j=j||this._settings.post_logout_redirect_uri,ne=ne||this._settings.extraQueryParams,this._metadataService.getEndSessionEndpoint().then(function(oe){if(!oe)throw u.Log.error("OidcClient.createSignoutRequest: No end session endpoint url returned"),new Error("no end session endpoint");u.Log.debug("OidcClient.createSignoutRequest: Received end session endpoint",oe);var Te=new p.SignoutRequest({url:oe,id_token_hint:M,post_logout_redirect_uri:j,data:G||J,extraQueryParams:ne,request_type:ie}),be=Te.state;return be&&(u.Log.debug("OidcClient.createSignoutRequest: Signout request has state to persist"),(W=W||P._stateStore).set(be.id,be.toStorageString())),Te})},R.prototype.readSignoutResponseState=function(P,H){var M=arguments.length>2&&arguments[2]!==void 0&&arguments[2];u.Log.debug("OidcClient.readSignoutResponseState");var G=new E.SignoutResponse(P);if(!G.state)return u.Log.debug("OidcClient.readSignoutResponseState: No state in response"),G.error?(u.Log.warn("OidcClient.readSignoutResponseState: Response was error: ",G.error),Promise.reject(new y.ErrorResponse(G))):Promise.resolve({state:void 0,response:G});var J=G.state;H=H||this._stateStore;var j=M?H.remove.bind(H):H.get.bind(H);return j(J).then(function(ne){if(!ne)throw u.Log.error("OidcClient.readSignoutResponseState: No matching state found in storage"),new Error("No matching state found in storage");return{state:b.State.fromStorageString(ne),response:G}})},R.prototype.processSignoutResponse=function(P,H){var M=this;return u.Log.debug("OidcClient.processSignoutResponse"),this.readSignoutResponseState(P,H,!0).then(function(G){var J=G.state,j=G.response;return J?(u.Log.debug("OidcClient.processSignoutResponse: Received state from storage; validating response"),M._validator.validateSignoutResponse(J,j)):(u.Log.debug("OidcClient.processSignoutResponse: No state from storage; skipping validating response"),j)})},R.prototype.clearStaleState=function(P){return u.Log.debug("OidcClient.clearStaleState"),P=P||this._stateStore,b.State.clearStaleState(P,this.settings.staleStateAge)},l(R,[{key:"_stateStore",get:function(){return this.settings.stateStore}},{key:"_validator",get:function(){return this.settings.validator}},{key:"_metadataService",get:function(){return this.settings.metadataService}},{key:"settings",get:function(){return this._settings}},{key:"metadataService",get:function(){return this._metadataService}}]),R}()},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.TokenClient=void 0;var l=c(7),u=c(2),g=c(0);function y(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")}o.TokenClient=function(){function f(h){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:l.JsonService,E=arguments.length>2&&arguments[2]!==void 0?arguments[2]:u.MetadataService;if(y(this,f),!h)throw g.Log.error("TokenClient.ctor: No settings passed"),new Error("settings");this._settings=h,this._jsonService=new p,this._metadataService=new E(this._settings)}return f.prototype.exchangeCode=function(){var p=this,E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(E=Object.assign({},E)).grant_type=E.grant_type||"authorization_code",E.client_id=E.client_id||this._settings.client_id,E.client_secret=E.client_secret||this._settings.client_secret,E.redirect_uri=E.redirect_uri||this._settings.redirect_uri;var C=void 0,b=E._client_authentication||this._settings._client_authentication;return delete E._client_authentication,E.code?E.redirect_uri?E.code_verifier?E.client_id?E.client_secret||b!="client_secret_basic"?(b=="client_secret_basic"&&(C=E.client_id+":"+E.client_secret,delete E.client_id,delete E.client_secret),this._metadataService.getTokenEndpoint(!1).then(function(x){return g.Log.debug("TokenClient.exchangeCode: Received token endpoint"),p._jsonService.postForm(x,E,C).then(function(R){return g.Log.debug("TokenClient.exchangeCode: response received"),R})})):(g.Log.error("TokenClient.exchangeCode: No client_secret passed"),Promise.reject(new Error("A client_secret is required"))):(g.Log.error("TokenClient.exchangeCode: No client_id passed"),Promise.reject(new Error("A client_id is required"))):(g.Log.error("TokenClient.exchangeCode: No code_verifier passed"),Promise.reject(new Error("A code_verifier is required"))):(g.Log.error("TokenClient.exchangeCode: No redirect_uri passed"),Promise.reject(new Error("A redirect_uri is required"))):(g.Log.error("TokenClient.exchangeCode: No code passed"),Promise.reject(new Error("A code is required")))},f.prototype.exchangeRefreshToken=function(){var p=this,E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(E=Object.assign({},E)).grant_type=E.grant_type||"refresh_token",E.client_id=E.client_id||this._settings.client_id,E.client_secret=E.client_secret||this._settings.client_secret;var C=void 0,b=E._client_authentication||this._settings._client_authentication;return delete E._client_authentication,E.refresh_token?E.client_id?(b=="client_secret_basic"&&(C=E.client_id+":"+E.client_secret,delete E.client_id,delete E.client_secret),this._metadataService.getTokenEndpoint(!1).then(function(x){return g.Log.debug("TokenClient.exchangeRefreshToken: Received token endpoint"),p._jsonService.postForm(x,E,C).then(function(R){return g.Log.debug("TokenClient.exchangeRefreshToken: response received"),R})})):(g.Log.error("TokenClient.exchangeRefreshToken: No client_id passed"),Promise.reject(new Error("A client_id is required"))):(g.Log.error("TokenClient.exchangeRefreshToken: No refresh_token passed"),Promise.reject(new Error("A refresh_token is required")))},f}()},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.ErrorResponse=void 0;var l=c(0);function u(y,f){if(!(y instanceof f))throw new TypeError("Cannot call a class as a function")}function g(y,f){if(!y)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!f||typeof f!="object"&&typeof f!="function"?y:f}o.ErrorResponse=function(y){function f(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},p=h.error,E=h.error_description,C=h.error_uri,b=h.state,x=h.session_state;if(u(this,f),!p)throw l.Log.error("No error passed to ErrorResponse"),new Error("error");var R=g(this,y.call(this,E||p));return R.name="ErrorResponse",R.error=p,R.error_description=E,R.error_uri=C,R.state=b,R.session_state=x,R}return function(p,E){if(typeof E!="function"&&E!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof E);p.prototype=Object.create(E&&E.prototype,{constructor:{value:p,enumerable:!1,writable:!0,configurable:!0}}),E&&(Object.setPrototypeOf?Object.setPrototypeOf(p,E):p.__proto__=E)}(f,y),f}(Error)},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.SigninState=void 0;var l=function(){function E(C,b){for(var x=0;x<b.length;x++){var R=b[x];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(C,R.key,R)}}return function(C,b,x){return b&&E(C.prototype,b),x&&E(C,x),C}}(),u=c(0),g=c(9),y=c(4),f=function(C){return C&&C.__esModule?C:{default:C}}(c(14));function h(E,C){if(!(E instanceof C))throw new TypeError("Cannot call a class as a function")}function p(E,C){if(!E)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!C||typeof C!="object"&&typeof C!="function"?E:C}o.SigninState=function(E){function C(){var b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},x=b.nonce,R=b.authority,A=b.client_id,P=b.redirect_uri,H=b.code_verifier,M=b.response_mode,G=b.client_secret,J=b.scope,j=b.extraTokenParams,ne=b.skipUserInfo;h(this,C);var ie=p(this,E.call(this,arguments[0]));if(x===!0?ie._nonce=(0,f.default)():x&&(ie._nonce=x),H===!0?ie._code_verifier=(0,f.default)()+(0,f.default)()+(0,f.default)():H&&(ie._code_verifier=H),ie.code_verifier){var W=y.JoseUtil.hashString(ie.code_verifier,"SHA256");ie._code_challenge=y.JoseUtil.hexToBase64Url(W)}return ie._redirect_uri=P,ie._authority=R,ie._client_id=A,ie._response_mode=M,ie._client_secret=G,ie._scope=J,ie._extraTokenParams=j,ie._skipUserInfo=ne,ie}return function(x,R){if(typeof R!="function"&&R!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof R);x.prototype=Object.create(R&&R.prototype,{constructor:{value:x,enumerable:!1,writable:!0,configurable:!0}}),R&&(Object.setPrototypeOf?Object.setPrototypeOf(x,R):x.__proto__=R)}(C,E),C.prototype.toStorageString=function(){return u.Log.debug("SigninState.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,nonce:this.nonce,code_verifier:this.code_verifier,redirect_uri:this.redirect_uri,authority:this.authority,client_id:this.client_id,response_mode:this.response_mode,client_secret:this.client_secret,scope:this.scope,extraTokenParams:this.extraTokenParams,skipUserInfo:this.skipUserInfo})},C.fromStorageString=function(x){return u.Log.debug("SigninState.fromStorageString"),new C(JSON.parse(x))},l(C,[{key:"nonce",get:function(){return this._nonce}},{key:"authority",get:function(){return this._authority}},{key:"client_id",get:function(){return this._client_id}},{key:"redirect_uri",get:function(){return this._redirect_uri}},{key:"code_verifier",get:function(){return this._code_verifier}},{key:"code_challenge",get:function(){return this._code_challenge}},{key:"response_mode",get:function(){return this._response_mode}},{key:"client_secret",get:function(){return this._client_secret}},{key:"scope",get:function(){return this._scope}},{key:"extraTokenParams",get:function(){return this._extraTokenParams}},{key:"skipUserInfo",get:function(){return this._skipUserInfo}}]),C}(g.State)},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(){return(l!="undefined"&&l!==null&&l.getRandomValues!==void 0?u:g)().replace(/-/g,"")};var l=typeof window!="undefined"?window.crypto||window.msCrypto:null;function u(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(y){return(y^l.getRandomValues(new Uint8Array(1))[0]&15>>y/4).toString(16)})}function g(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(y){return(y^16*Math.random()>>y/4).toString(16)})}s.exports=o.default},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.User=void 0;var l=function(){function g(y,f){for(var h=0;h<f.length;h++){var p=f[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(y,p.key,p)}}return function(y,f,h){return f&&g(y.prototype,f),h&&g(y,h),y}}(),u=c(0);o.User=function(){function g(y){var f=y.id_token,h=y.session_state,p=y.access_token,E=y.refresh_token,C=y.token_type,b=y.scope,x=y.profile,R=y.expires_at,A=y.state;(function(H,M){if(!(H instanceof M))throw new TypeError("Cannot call a class as a function")})(this,g),this.id_token=f,this.session_state=h,this.access_token=p,this.refresh_token=E,this.token_type=C,this.scope=b,this.profile=x,this.expires_at=R,this.state=A}return g.prototype.toStorageString=function(){return u.Log.debug("User.toStorageString"),JSON.stringify({id_token:this.id_token,session_state:this.session_state,access_token:this.access_token,refresh_token:this.refresh_token,token_type:this.token_type,scope:this.scope,profile:this.profile,expires_at:this.expires_at})},g.fromStorageString=function(f){return u.Log.debug("User.fromStorageString"),new g(JSON.parse(f))},l(g,[{key:"expires_in",get:function(){if(this.expires_at){var f=parseInt(Date.now()/1e3);return this.expires_at-f}},set:function(f){var h=parseInt(f);if(typeof h=="number"&&h>0){var p=parseInt(Date.now()/1e3);this.expires_at=p+h}}},{key:"expired",get:function(){var f=this.expires_in;if(f!==void 0)return f<=0}},{key:"scopes",get:function(){return(this.scope||"").split(" ")}}]),g}()},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.AccessTokenEvents=void 0;var l=c(0),u=c(46);function g(y,f){if(!(y instanceof f))throw new TypeError("Cannot call a class as a function")}o.AccessTokenEvents=function(){function y(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=f.accessTokenExpiringNotificationTime,p=h===void 0?60:h,E=f.accessTokenExpiringTimer,C=E===void 0?new u.Timer("Access token expiring"):E,b=f.accessTokenExpiredTimer,x=b===void 0?new u.Timer("Access token expired"):b;g(this,y),this._accessTokenExpiringNotificationTime=p,this._accessTokenExpiring=C,this._accessTokenExpired=x}return y.prototype.load=function(h){if(h.access_token&&h.expires_in!==void 0){var p=h.expires_in;if(l.Log.debug("AccessTokenEvents.load: access token present, remaining duration:",p),p>0){var E=p-this._accessTokenExpiringNotificationTime;E<=0&&(E=1),l.Log.debug("AccessTokenEvents.load: registering expiring timer in:",E),this._accessTokenExpiring.init(E)}else l.Log.debug("AccessTokenEvents.load: canceling existing expiring timer becase we're past expiration."),this._accessTokenExpiring.cancel();var C=p+1;l.Log.debug("AccessTokenEvents.load: registering expired timer in:",C),this._accessTokenExpired.init(C)}else this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()},y.prototype.unload=function(){l.Log.debug("AccessTokenEvents.unload: canceling existing access token timers"),this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()},y.prototype.addAccessTokenExpiring=function(h){this._accessTokenExpiring.addHandler(h)},y.prototype.removeAccessTokenExpiring=function(h){this._accessTokenExpiring.removeHandler(h)},y.prototype.addAccessTokenExpired=function(h){this._accessTokenExpired.addHandler(h)},y.prototype.removeAccessTokenExpired=function(h){this._accessTokenExpired.removeHandler(h)},y}()},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.Event=void 0;var l=c(0);o.Event=function(){function u(g){(function(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")})(this,u),this._name=g,this._callbacks=[]}return u.prototype.addHandler=function(y){this._callbacks.push(y)},u.prototype.removeHandler=function(y){var f=this._callbacks.findIndex(function(h){return h===y});f>=0&&this._callbacks.splice(f,1)},u.prototype.raise=function(){l.Log.debug("Event: Raising event: "+this._name);for(var y=0;y<this._callbacks.length;y++){var f;(f=this._callbacks)[y].apply(f,arguments)}},u}()},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.SessionMonitor=void 0;var l=function(){function h(p,E){for(var C=0;C<E.length;C++){var b=E[C];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(p,b.key,b)}}return function(p,E,C){return E&&h(p.prototype,E),C&&h(p,C),p}}(),u=c(0),g=c(19),y=c(1);function f(h,p){if(!(h instanceof p))throw new TypeError("Cannot call a class as a function")}o.SessionMonitor=function(){function h(p){var E=this,C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:g.CheckSessionIFrame,b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:y.Global.timer;if(f(this,h),!p)throw u.Log.error("SessionMonitor.ctor: No user manager passed to SessionMonitor"),new Error("userManager");this._userManager=p,this._CheckSessionIFrameCtor=C,this._timer=b,this._userManager.events.addUserLoaded(this._start.bind(this)),this._userManager.events.addUserUnloaded(this._stop.bind(this)),Promise.resolve(this._userManager.getUser().then(function(x){x?E._start(x):E._settings.monitorAnonymousSession&&E._userManager.querySessionStatus().then(function(R){var A={session_state:R.session_state};R.sub&&R.sid&&(A.profile={sub:R.sub,sid:R.sid}),E._start(A)}).catch(function(R){u.Log.error("SessionMonitor ctor: error from querySessionStatus:",R.message)})}).catch(function(x){u.Log.error("SessionMonitor ctor: error from getUser:",x.message)}))}return h.prototype._start=function(E){var C=this,b=E.session_state;b&&(E.profile?(this._sub=E.profile.sub,this._sid=E.profile.sid,u.Log.debug("SessionMonitor._start: session_state:",b,", sub:",this._sub)):(this._sub=void 0,this._sid=void 0,u.Log.debug("SessionMonitor._start: session_state:",b,", anonymous user")),this._checkSessionIFrame?this._checkSessionIFrame.start(b):this._metadataService.getCheckSessionIframe().then(function(x){if(x){u.Log.debug("SessionMonitor._start: Initializing check session iframe");var R=C._client_id,A=C._checkSessionInterval,P=C._stopCheckSessionOnError;C._checkSessionIFrame=new C._CheckSessionIFrameCtor(C._callback.bind(C),R,x,A,P),C._checkSessionIFrame.load().then(function(){C._checkSessionIFrame.start(b)})}else u.Log.warn("SessionMonitor._start: No check session iframe found in the metadata")}).catch(function(x){u.Log.error("SessionMonitor._start: Error from getCheckSessionIframe:",x.message)}))},h.prototype._stop=function(){var E=this;if(this._sub=void 0,this._sid=void 0,this._checkSessionIFrame&&(u.Log.debug("SessionMonitor._stop"),this._checkSessionIFrame.stop()),this._settings.monitorAnonymousSession)var C=this._timer.setInterval(function(){E._timer.clearInterval(C),E._userManager.querySessionStatus().then(function(b){var x={session_state:b.session_state};b.sub&&b.sid&&(x.profile={sub:b.sub,sid:b.sid}),E._start(x)}).catch(function(b){u.Log.error("SessionMonitor: error from querySessionStatus:",b.message)})},1e3)},h.prototype._callback=function(){var E=this;this._userManager.querySessionStatus().then(function(C){var b=!0;C?C.sub===E._sub?(b=!1,E._checkSessionIFrame.start(C.session_state),C.sid===E._sid?u.Log.debug("SessionMonitor._callback: Same sub still logged in at OP, restarting check session iframe; session_state:",C.session_state):(u.Log.debug("SessionMonitor._callback: Same sub still logged in at OP, session state has changed, restarting check session iframe; session_state:",C.session_state),E._userManager.events._raiseUserSessionChanged())):u.Log.debug("SessionMonitor._callback: Different subject signed into OP:",C.sub):u.Log.debug("SessionMonitor._callback: Subject no longer signed into OP"),b&&(E._sub?(u.Log.debug("SessionMonitor._callback: SessionMonitor._callback; raising signed out event"),E._userManager.events._raiseUserSignedOut()):(u.Log.debug("SessionMonitor._callback: SessionMonitor._callback; raising signed in event"),E._userManager.events._raiseUserSignedIn()))}).catch(function(C){E._sub&&(u.Log.debug("SessionMonitor._callback: Error calling queryCurrentSigninSession; raising signed out event",C.message),E._userManager.events._raiseUserSignedOut())})},l(h,[{key:"_settings",get:function(){return this._userManager.settings}},{key:"_metadataService",get:function(){return this._userManager.metadataService}},{key:"_client_id",get:function(){return this._settings.client_id}},{key:"_checkSessionInterval",get:function(){return this._settings.checkSessionInterval}},{key:"_stopCheckSessionOnError",get:function(){return this._settings.stopCheckSessionOnError}}]),h}()},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.CheckSessionIFrame=void 0;var l=c(0);function u(g,y){if(!(g instanceof y))throw new TypeError("Cannot call a class as a function")}o.CheckSessionIFrame=function(){function g(y,f,h,p){var E=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];u(this,g),this._callback=y,this._client_id=f,this._url=h,this._interval=p||2e3,this._stopOnError=E;var C=h.indexOf("/",h.indexOf("//")+2);this._frame_origin=h.substr(0,C),this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="absolute",this._frame.style.display="none",this._frame.width=0,this._frame.height=0,this._frame.src=h}return g.prototype.load=function(){var f=this;return new Promise(function(h){f._frame.onload=function(){h()},window.document.body.appendChild(f._frame),f._boundMessageEvent=f._message.bind(f),window.addEventListener("message",f._boundMessageEvent,!1)})},g.prototype._message=function(f){f.origin===this._frame_origin&&f.source===this._frame.contentWindow&&(f.data==="error"?(l.Log.error("CheckSessionIFrame: error message from check session op iframe"),this._stopOnError&&this.stop()):f.data==="changed"?(l.Log.debug("CheckSessionIFrame: changed message from check session op iframe"),this.stop(),this._callback()):l.Log.debug("CheckSessionIFrame: "+f.data+" message from check session op iframe"))},g.prototype.start=function(f){var h=this;if(this._session_state!==f){l.Log.debug("CheckSessionIFrame.start"),this.stop(),this._session_state=f;var p=function(){h._frame.contentWindow.postMessage(h._client_id+" "+h._session_state,h._frame_origin)};p(),this._timer=window.setInterval(p,this._interval)}},g.prototype.stop=function(){this._session_state=null,this._timer&&(l.Log.debug("CheckSessionIFrame.stop"),window.clearInterval(this._timer),this._timer=null)},g}()},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.TokenRevocationClient=void 0;var l=c(0),u=c(2),g=c(1);function y(p,E){if(!(p instanceof E))throw new TypeError("Cannot call a class as a function")}var f="access_token",h="refresh_token";o.TokenRevocationClient=function(){function p(E){var C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:g.Global.XMLHttpRequest,b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:u.MetadataService;if(y(this,p),!E)throw l.Log.error("TokenRevocationClient.ctor: No settings provided"),new Error("No settings provided.");this._settings=E,this._XMLHttpRequestCtor=C,this._metadataService=new b(this._settings)}return p.prototype.revoke=function(C,b){var x=this,R=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"access_token";if(!C)throw l.Log.error("TokenRevocationClient.revoke: No token provided"),new Error("No token provided.");if(R!==f&&R!=h)throw l.Log.error("TokenRevocationClient.revoke: Invalid token type"),new Error("Invalid token type.");return this._metadataService.getRevocationEndpoint().then(function(A){if(A){l.Log.debug("TokenRevocationClient.revoke: Revoking "+R);var P=x._settings.client_id,H=x._settings.client_secret;return x._revoke(A,P,H,C,R)}if(b)throw l.Log.error("TokenRevocationClient.revoke: Revocation not supported"),new Error("Revocation not supported")})},p.prototype._revoke=function(C,b,x,R,A){var P=this;return new Promise(function(H,M){var G=new P._XMLHttpRequestCtor;G.open("POST",C),G.onload=function(){l.Log.debug("TokenRevocationClient.revoke: HTTP response received, status",G.status),G.status===200?H():M(Error(G.statusText+" ("+G.status+")"))},G.onerror=function(){l.Log.debug("TokenRevocationClient.revoke: Network Error."),M("Network Error")};var J="client_id="+encodeURIComponent(b);x&&(J+="&client_secret="+encodeURIComponent(x)),J+="&token_type_hint="+encodeURIComponent(A),J+="&token="+encodeURIComponent(R),G.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),G.send(J)})},p}()},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.CordovaPopupWindow=void 0;var l=function(){function g(y,f){for(var h=0;h<f.length;h++){var p=f[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(y,p.key,p)}}return function(y,f,h){return f&&g(y.prototype,f),h&&g(y,h),y}}(),u=c(0);o.CordovaPopupWindow=function(){function g(y){var f=this;(function(p,E){if(!(p instanceof E))throw new TypeError("Cannot call a class as a function")})(this,g),this._promise=new Promise(function(h,p){f._resolve=h,f._reject=p}),this.features=y.popupWindowFeatures||"location=no,toolbar=no,zoom=no",this.target=y.popupWindowTarget||"_blank",this.redirect_uri=y.startUrl,u.Log.debug("CordovaPopupWindow.ctor: redirect_uri: "+this.redirect_uri)}return g.prototype._isInAppBrowserInstalled=function(f){return["cordova-plugin-inappbrowser","cordova-plugin-inappbrowser.inappbrowser","org.apache.cordova.inappbrowser"].some(function(h){return f.hasOwnProperty(h)})},g.prototype.navigate=function(f){if(f&&f.url){if(!window.cordova)return this._error("cordova is undefined");var h=window.cordova.require("cordova/plugin_list").metadata;if(this._isInAppBrowserInstalled(h)===!1)return this._error("InAppBrowser plugin not found");this._popup=cordova.InAppBrowser.open(f.url,this.target,this.features),this._popup?(u.Log.debug("CordovaPopupWindow.navigate: popup successfully created"),this._exitCallbackEvent=this._exitCallback.bind(this),this._loadStartCallbackEvent=this._loadStartCallback.bind(this),this._popup.addEventListener("exit",this._exitCallbackEvent,!1),this._popup.addEventListener("loadstart",this._loadStartCallbackEvent,!1)):this._error("Error opening popup window")}else this._error("No url provided");return this.promise},g.prototype._loadStartCallback=function(f){f.url.indexOf(this.redirect_uri)===0&&this._success({url:f.url})},g.prototype._exitCallback=function(f){this._error(f)},g.prototype._success=function(f){this._cleanup(),u.Log.debug("CordovaPopupWindow: Successful response from cordova popup window"),this._resolve(f)},g.prototype._error=function(f){this._cleanup(),u.Log.error(f),this._reject(new Error(f))},g.prototype.close=function(){this._cleanup()},g.prototype._cleanup=function(){this._popup&&(u.Log.debug("CordovaPopupWindow: cleaning up popup"),this._popup.removeEventListener("exit",this._exitCallbackEvent,!1),this._popup.removeEventListener("loadstart",this._loadStartCallbackEvent,!1),this._popup.close()),this._popup=null},l(g,[{key:"promise",get:function(){return this._promise}}]),g}()},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0});var l=c(0),u=c(10),g=c(5),y=c(6),f=c(37),h=c(38),p=c(16),E=c(2),C=c(48),b=c(49),x=c(19),R=c(20),A=c(18),P=c(1),H=c(15),M=c(50);o.default={Version:M.Version,Log:l.Log,OidcClient:u.OidcClient,OidcClientSettings:g.OidcClientSettings,WebStorageStateStore:y.WebStorageStateStore,InMemoryWebStorage:f.InMemoryWebStorage,UserManager:h.UserManager,AccessTokenEvents:p.AccessTokenEvents,MetadataService:E.MetadataService,CordovaPopupNavigator:C.CordovaPopupNavigator,CordovaIFrameNavigator:b.CordovaIFrameNavigator,CheckSessionIFrame:x.CheckSessionIFrame,TokenRevocationClient:R.TokenRevocationClient,SessionMonitor:A.SessionMonitor,Global:P.Global,User:H.User},s.exports=o.default},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.ClockService=function(){function l(){(function(g,y){if(!(g instanceof y))throw new TypeError("Cannot call a class as a function")})(this,l)}return l.prototype.getEpochTime=function(){return Promise.resolve(Date.now()/1e3|0)},l}()},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.ResponseValidator=void 0;var l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(b){return typeof b}:function(b){return b&&typeof Symbol=="function"&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b},u=c(0),g=c(2),y=c(25),f=c(11),h=c(12),p=c(4);function E(b,x){if(!(b instanceof x))throw new TypeError("Cannot call a class as a function")}var C=["nonce","at_hash","iat","nbf","exp","aud","iss","c_hash"];o.ResponseValidator=function(){function b(x){var R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:g.MetadataService,A=arguments.length>2&&arguments[2]!==void 0?arguments[2]:y.UserInfoService,P=arguments.length>3&&arguments[3]!==void 0?arguments[3]:p.JoseUtil,H=arguments.length>4&&arguments[4]!==void 0?arguments[4]:f.TokenClient;if(E(this,b),!x)throw u.Log.error("ResponseValidator.ctor: No settings passed to ResponseValidator"),new Error("settings");this._settings=x,this._metadataService=new R(this._settings),this._userInfoService=new A(this._settings),this._joseUtil=P,this._tokenClient=new H(this._settings)}return b.prototype.validateSigninResponse=function(R,A){var P=this;return u.Log.debug("ResponseValidator.validateSigninResponse"),this._processSigninParams(R,A).then(function(H){return u.Log.debug("ResponseValidator.validateSigninResponse: state processed"),P._validateTokens(R,H).then(function(M){return u.Log.debug("ResponseValidator.validateSigninResponse: tokens validated"),P._processClaims(R,M).then(function(G){return u.Log.debug("ResponseValidator.validateSigninResponse: claims processed"),G})})})},b.prototype.validateSignoutResponse=function(R,A){return R.id!==A.state?(u.Log.error("ResponseValidator.validateSignoutResponse: State does not match"),Promise.reject(new Error("State does not match"))):(u.Log.debug("ResponseValidator.validateSignoutResponse: state validated"),A.state=R.data,A.error?(u.Log.warn("ResponseValidator.validateSignoutResponse: Response was error",A.error),Promise.reject(new h.ErrorResponse(A))):Promise.resolve(A))},b.prototype._processSigninParams=function(R,A){if(R.id!==A.state)return u.Log.error("ResponseValidator._processSigninParams: State does not match"),Promise.reject(new Error("State does not match"));if(!R.client_id)return u.Log.error("ResponseValidator._processSigninParams: No client_id on state"),Promise.reject(new Error("No client_id on state"));if(!R.authority)return u.Log.error("ResponseValidator._processSigninParams: No authority on state"),Promise.reject(new Error("No authority on state"));if(this._settings.authority){if(this._settings.authority&&this._settings.authority!==R.authority)return u.Log.error("ResponseValidator._processSigninParams: authority mismatch on settings vs. signin state"),Promise.reject(new Error("authority mismatch on settings vs. signin state"))}else this._settings.authority=R.authority;if(this._settings.client_id){if(this._settings.client_id&&this._settings.client_id!==R.client_id)return u.Log.error("ResponseValidator._processSigninParams: client_id mismatch on settings vs. signin state"),Promise.reject(new Error("client_id mismatch on settings vs. signin state"))}else this._settings.client_id=R.client_id;return u.Log.debug("ResponseValidator._processSigninParams: state validated"),A.state=R.data,A.error?(u.Log.warn("ResponseValidator._processSigninParams: Response was error",A.error),Promise.reject(new h.ErrorResponse(A))):R.nonce&&!A.id_token?(u.Log.error("ResponseValidator._processSigninParams: Expecting id_token in response"),Promise.reject(new Error("No id_token in response"))):!R.nonce&&A.id_token?(u.Log.error("ResponseValidator._processSigninParams: Not expecting id_token in response"),Promise.reject(new Error("Unexpected id_token in response"))):R.code_verifier&&!A.code?(u.Log.error("ResponseValidator._processSigninParams: Expecting code in response"),Promise.reject(new Error("No code in response"))):!R.code_verifier&&A.code?(u.Log.error("ResponseValidator._processSigninParams: Not expecting code in response"),Promise.reject(new Error("Unexpected code in response"))):(A.scope||(A.scope=R.scope),Promise.resolve(A))},b.prototype._processClaims=function(R,A){var P=this;if(A.isOpenIdConnect){if(u.Log.debug("ResponseValidator._processClaims: response is OIDC, processing claims"),A.profile=this._filterProtocolClaims(A.profile),R.skipUserInfo!==!0&&this._settings.loadUserInfo&&A.access_token)return u.Log.debug("ResponseValidator._processClaims: loading user info"),this._userInfoService.getClaims(A.access_token).then(function(H){return u.Log.debug("ResponseValidator._processClaims: user info claims received from user info endpoint"),H.sub!==A.profile.sub?(u.Log.error("ResponseValidator._processClaims: sub from user info endpoint does not match sub in id_token"),Promise.reject(new Error("sub from user info endpoint does not match sub in id_token"))):(A.profile=P._mergeClaims(A.profile,H),u.Log.debug("ResponseValidator._processClaims: user info claims received, updated profile:",A.profile),A)});u.Log.debug("ResponseValidator._processClaims: not loading user info")}else u.Log.debug("ResponseValidator._processClaims: response is not OIDC, not processing claims");return Promise.resolve(A)},b.prototype._mergeClaims=function(R,A){var P=Object.assign({},R);for(var H in A){var M=A[H];Array.isArray(M)||(M=[M]);for(var G=0;G<M.length;G++){var J=M[G];P[H]?Array.isArray(P[H])?P[H].indexOf(J)<0&&P[H].push(J):P[H]!==J&&((J===void 0?"undefined":l(J))==="object"&&this._settings.mergeClaims?P[H]=this._mergeClaims(P[H],J):P[H]=[P[H],J]):P[H]=J}}return P},b.prototype._filterProtocolClaims=function(R){u.Log.debug("ResponseValidator._filterProtocolClaims, incoming claims:",R);var A=Object.assign({},R);return this._settings._filterProtocolClaims?(C.forEach(function(P){delete A[P]}),u.Log.debug("ResponseValidator._filterProtocolClaims: protocol claims filtered",A)):u.Log.debug("ResponseValidator._filterProtocolClaims: protocol claims not filtered"),A},b.prototype._validateTokens=function(R,A){return A.code?(u.Log.debug("ResponseValidator._validateTokens: Validating code"),this._processCode(R,A)):A.id_token?A.access_token?(u.Log.debug("ResponseValidator._validateTokens: Validating id_token and access_token"),this._validateIdTokenAndAccessToken(R,A)):(u.Log.debug("ResponseValidator._validateTokens: Validating id_token"),this._validateIdToken(R,A)):(u.Log.debug("ResponseValidator._validateTokens: No code to process or id_token to validate"),Promise.resolve(A))},b.prototype._processCode=function(R,A){var P=this,H={client_id:R.client_id,client_secret:R.client_secret,code:A.code,redirect_uri:R.redirect_uri,code_verifier:R.code_verifier};return R.extraTokenParams&&l(R.extraTokenParams)==="object"&&Object.assign(H,R.extraTokenParams),this._tokenClient.exchangeCode(H).then(function(M){for(var G in M)A[G]=M[G];return A.id_token?(u.Log.debug("ResponseValidator._processCode: token response successful, processing id_token"),P._validateIdTokenAttributes(R,A)):(u.Log.debug("ResponseValidator._processCode: token response successful, returning response"),A)})},b.prototype._validateIdTokenAttributes=function(R,A){var P=this;return this._metadataService.getIssuer().then(function(H){var M=R.client_id,G=P._settings.clockSkew;return u.Log.debug("ResponseValidator._validateIdTokenAttributes: Validaing JWT attributes; using clock skew (in seconds) of: ",G),P._settings.getEpochTime().then(function(J){return P._joseUtil.validateJwtAttributes(A.id_token,H,M,G,J).then(function(j){return R.nonce&&R.nonce!==j.nonce?(u.Log.error("ResponseValidator._validateIdTokenAttributes: Invalid nonce in id_token"),Promise.reject(new Error("Invalid nonce in id_token"))):j.sub?(A.profile=j,A):(u.Log.error("ResponseValidator._validateIdTokenAttributes: No sub present in id_token"),Promise.reject(new Error("No sub present in id_token")))})})})},b.prototype._validateIdTokenAndAccessToken=function(R,A){var P=this;return this._validateIdToken(R,A).then(function(H){return P._validateAccessToken(H)})},b.prototype._getSigningKeyForJwt=function(R){var A=this;return this._metadataService.getSigningKeys().then(function(P){var H=R.header.kid;if(!P)return u.Log.error("ResponseValidator._validateIdToken: No signing keys from metadata"),Promise.reject(new Error("No signing keys from metadata"));u.Log.debug("ResponseValidator._validateIdToken: Received signing keys");var M=void 0;if(H)M=P.filter(function(G){return G.kid===H})[0];else{if((P=A._filterByAlg(P,R.header.alg)).length>1)return u.Log.error("ResponseValidator._validateIdToken: No kid found in id_token and more than one key found in metadata"),Promise.reject(new Error("No kid found in id_token and more than one key found in metadata"));M=P[0]}return Promise.resolve(M)})},b.prototype._getSigningKeyForJwtWithSingleRetry=function(R){var A=this;return this._getSigningKeyForJwt(R).then(function(P){return P?Promise.resolve(P):(A._metadataService.resetSigningKeys(),A._getSigningKeyForJwt(R))})},b.prototype._validateIdToken=function(R,A){var P=this;if(!R.nonce)return u.Log.error("ResponseValidator._validateIdToken: No nonce on state"),Promise.reject(new Error("No nonce on state"));var H=this._joseUtil.parseJwt(A.id_token);return H&&H.header&&H.payload?R.nonce!==H.payload.nonce?(u.Log.error("ResponseValidator._validateIdToken: Invalid nonce in id_token"),Promise.reject(new Error("Invalid nonce in id_token"))):this._metadataService.getIssuer().then(function(M){return u.Log.debug("ResponseValidator._validateIdToken: Received issuer"),P._getSigningKeyForJwtWithSingleRetry(H).then(function(G){if(!G)return u.Log.error("ResponseValidator._validateIdToken: No key matching kid or alg found in signing keys"),Promise.reject(new Error("No key matching kid or alg found in signing keys"));var J=R.client_id,j=P._settings.clockSkew;return u.Log.debug("ResponseValidator._validateIdToken: Validaing JWT; using clock skew (in seconds) of: ",j),P._joseUtil.validateJwt(A.id_token,G,M,J,j).then(function(){return u.Log.debug("ResponseValidator._validateIdToken: JWT validation successful"),H.payload.sub?(A.profile=H.payload,A):(u.Log.error("ResponseValidator._validateIdToken: No sub present in id_token"),Promise.reject(new Error("No sub present in id_token")))})})}):(u.Log.error("ResponseValidator._validateIdToken: Failed to parse id_token",H),Promise.reject(new Error("Failed to parse id_token")))},b.prototype._filterByAlg=function(R,A){var P=null;if(A.startsWith("RS"))P="RSA";else if(A.startsWith("PS"))P="PS";else{if(!A.startsWith("ES"))return u.Log.debug("ResponseValidator._filterByAlg: alg not supported: ",A),[];P="EC"}return u.Log.debug("ResponseValidator._filterByAlg: Looking for keys that match kty: ",P),R=R.filter(function(H){return H.kty===P}),u.Log.debug("ResponseValidator._filterByAlg: Number of keys that match kty: ",P,R.length),R},b.prototype._validateAccessToken=function(R){if(!R.profile)return u.Log.error("ResponseValidator._validateAccessToken: No profile loaded from id_token"),Promise.reject(new Error("No profile loaded from id_token"));if(!R.profile.at_hash)return u.Log.error("ResponseValidator._validateAccessToken: No at_hash in id_token"),Promise.reject(new Error("No at_hash in id_token"));if(!R.id_token)return u.Log.error("ResponseValidator._validateAccessToken: No id_token"),Promise.reject(new Error("No id_token"));var A=this._joseUtil.parseJwt(R.id_token);if(!A||!A.header)return u.Log.error("ResponseValidator._validateAccessToken: Failed to parse id_token",A),Promise.reject(new Error("Failed to parse id_token"));var P=A.header.alg;if(!P||P.length!==5)return u.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",P),Promise.reject(new Error("Unsupported alg: "+P));var H=P.substr(2,3);if(!H)return u.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",P,H),Promise.reject(new Error("Unsupported alg: "+P));if((H=parseInt(H))!==256&&H!==384&&H!==512)return u.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",P,H),Promise.reject(new Error("Unsupported alg: "+P));var M="sha"+H,G=this._joseUtil.hashString(R.access_token,M);if(!G)return u.Log.error("ResponseValidator._validateAccessToken: access_token hash failed:",M),Promise.reject(new Error("Failed to validate at_hash"));var J=G.substr(0,G.length/2),j=this._joseUtil.hexToBase64Url(J);return j!==R.profile.at_hash?(u.Log.error("ResponseValidator._validateAccessToken: Failed to validate at_hash",j,R.profile.at_hash),Promise.reject(new Error("Failed to validate at_hash"))):(u.Log.debug("ResponseValidator._validateAccessToken: success"),Promise.resolve(R))},b}()},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.UserInfoService=void 0;var l=c(7),u=c(2),g=c(0),y=c(4);function f(h,p){if(!(h instanceof p))throw new TypeError("Cannot call a class as a function")}o.UserInfoService=function(){function h(p){var E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:l.JsonService,C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:u.MetadataService,b=arguments.length>3&&arguments[3]!==void 0?arguments[3]:y.JoseUtil;if(f(this,h),!p)throw g.Log.error("UserInfoService.ctor: No settings passed"),new Error("settings");this._settings=p,this._jsonService=new E(void 0,void 0,this._getClaimsFromJwt.bind(this)),this._metadataService=new C(this._settings),this._joseUtil=b}return h.prototype.getClaims=function(E){var C=this;return E?this._metadataService.getUserInfoEndpoint().then(function(b){return g.Log.debug("UserInfoService.getClaims: received userinfo url",b),C._jsonService.getJson(b,E).then(function(x){return g.Log.debug("UserInfoService.getClaims: claims received",x),x})}):(g.Log.error("UserInfoService.getClaims: No token passed"),Promise.reject(new Error("A token is required")))},h.prototype._getClaimsFromJwt=function(E){var C=this;try{var b=this._joseUtil.parseJwt(E.responseText);if(!b||!b.header||!b.payload)return g.Log.error("UserInfoService._getClaimsFromJwt: Failed to parse JWT",b),Promise.reject(new Error("Failed to parse id_token"));var x=b.header.kid,R=void 0;switch(this._settings.userInfoJwtIssuer){case"OP":R=this._metadataService.getIssuer();break;case"ANY":R=Promise.resolve(b.payload.iss);break;default:R=Promise.resolve(this._settings.userInfoJwtIssuer)}return R.then(function(A){return g.Log.debug("UserInfoService._getClaimsFromJwt: Received issuer:"+A),C._metadataService.getSigningKeys().then(function(P){if(!P)return g.Log.error("UserInfoService._getClaimsFromJwt: No signing keys from metadata"),Promise.reject(new Error("No signing keys from metadata"));g.Log.debug("UserInfoService._getClaimsFromJwt: Received signing keys");var H=void 0;if(x)H=P.filter(function(J){return J.kid===x})[0];else{if((P=C._filterByAlg(P,b.header.alg)).length>1)return g.Log.error("UserInfoService._getClaimsFromJwt: No kid found in id_token and more than one key found in metadata"),Promise.reject(new Error("No kid found in id_token and more than one key found in metadata"));H=P[0]}if(!H)return g.Log.error("UserInfoService._getClaimsFromJwt: No key matching kid or alg found in signing keys"),Promise.reject(new Error("No key matching kid or alg found in signing keys"));var M=C._settings.client_id,G=C._settings.clockSkew;return g.Log.debug("UserInfoService._getClaimsFromJwt: Validaing JWT; using clock skew (in seconds) of: ",G),C._joseUtil.validateJwt(E.responseText,H,A,M,G,void 0,!0).then(function(){return g.Log.debug("UserInfoService._getClaimsFromJwt: JWT validation successful"),b.payload})})})}catch(A){return g.Log.error("UserInfoService._getClaimsFromJwt: Error parsing JWT response",A.message),void reject(A)}},h.prototype._filterByAlg=function(E,C){var b=null;if(C.startsWith("RS"))b="RSA";else if(C.startsWith("PS"))b="PS";else{if(!C.startsWith("ES"))return g.Log.debug("UserInfoService._filterByAlg: alg not supported: ",C),[];b="EC"}return g.Log.debug("UserInfoService._filterByAlg: Looking for keys that match kty: ",b),E=E.filter(function(x){return x.kty===b}),g.Log.debug("UserInfoService._filterByAlg: Number of keys that match kty: ",b,E.length),E},h}()},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.AllowedSigningAlgs=o.b64tohex=o.hextob64u=o.crypto=o.X509=o.KeyUtil=o.jws=void 0;var l=c(27);o.jws=l.jws,o.KeyUtil=l.KEYUTIL,o.X509=l.X509,o.crypto=l.crypto,o.hextob64u=l.hextob64u,o.b64tohex=l.b64tohex,o.AllowedSigningAlgs=["RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"]},function(s,o,c){(function(l){Object.defineProperty(o,"__esModule",{value:!0});var u,g,y,f,h,p,E,C,b,x,R,A=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},P={userAgent:!1},H={},M=M||(u=Math,y=(g={}).lib={},f=y.Base=function(){function t(){}return{extend:function(i){t.prototype=this;var a=new t;return i&&a.mixIn(i),a.hasOwnProperty("init")||(a.init=function(){a.$super.init.apply(this,arguments)}),a.init.prototype=a,a.$super=this,a},create:function(){var i=this.extend();return i.init.apply(i,arguments),i},init:function(){},mixIn:function(i){for(var a in i)i.hasOwnProperty(a)&&(this[a]=i[a]);i.hasOwnProperty("toString")&&(this.toString=i.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),h=y.WordArray=f.extend({init:function(e,i){e=this.words=e||[],this.sigBytes=i!=null?i:4*e.length},toString:function(e){return(e||E).stringify(this)},concat:function(e){var i=this.words,a=e.words,d=this.sigBytes,v=e.sigBytes;if(this.clamp(),d%4)for(var w=0;w<v;w++){var k=a[w>>>2]>>>24-w%4*8&255;i[d+w>>>2]|=k<<24-(d+w)%4*8}else for(w=0;w<v;w+=4)i[d+w>>>2]=a[w>>>2];return this.sigBytes+=v,this},clamp:function(){var e=this.words,i=this.sigBytes;e[i>>>2]&=4294967295<<32-i%4*8,e.length=u.ceil(i/4)},clone:function(){var e=f.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var i=[],a=0;a<e;a+=4)i.push(4294967296*u.random()|0);return new h.init(i,e)}}),p=g.enc={},E=p.Hex={stringify:function(e){for(var i=e.words,a=e.sigBytes,d=[],v=0;v<a;v++){var w=i[v>>>2]>>>24-v%4*8&255;d.push((w>>>4).toString(16)),d.push((15&w).toString(16))}return d.join("")},parse:function(e){for(var i=e.length,a=[],d=0;d<i;d+=2)a[d>>>3]|=parseInt(e.substr(d,2),16)<<24-d%8*4;return new h.init(a,i/2)}},C=p.Latin1={stringify:function(e){for(var i=e.words,a=e.sigBytes,d=[],v=0;v<a;v++){var w=i[v>>>2]>>>24-v%4*8&255;d.push(String.fromCharCode(w))}return d.join("")},parse:function(e){for(var i=e.length,a=[],d=0;d<i;d++)a[d>>>2]|=(255&e.charCodeAt(d))<<24-d%4*8;return new h.init(a,i)}},b=p.Utf8={stringify:function(e){try{return decodeURIComponent(escape(C.stringify(e)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(e){return C.parse(unescape(encodeURIComponent(e)))}},x=y.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new h.init,this._nDataBytes=0},_append:function(e){typeof e=="string"&&(e=b.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var i=this._data,a=i.words,d=i.sigBytes,v=this.blockSize,w=d/(4*v),k=(w=e?u.ceil(w):u.max((0|w)-this._minBufferSize,0))*v,T=u.min(4*k,d);if(k){for(var I=0;I<k;I+=v)this._doProcessBlock(a,I);var U=a.splice(0,k);i.sigBytes-=T}return new h.init(U,T)},clone:function(){var e=f.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),y.Hasher=x.extend({cfg:f.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){x.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(i,a){return new e.init(a).finalize(i)}},_createHmacHelper:function(e){return function(i,a){return new R.HMAC.init(e,a).finalize(i)}}}),R=g.algo={},g);(function(t){var e,i=(e=M).lib,a=i.Base,d=i.WordArray;(e=e.x64={}).Word=a.extend({init:function(w,k){this.high=w,this.low=k}}),e.WordArray=a.extend({init:function(w,k){w=this.words=w||[],this.sigBytes=k!=null?k:8*w.length},toX32:function(){for(var w=this.words,k=w.length,T=[],I=0;I<k;I++){var U=w[I];T.push(U.high),T.push(U.low)}return d.create(T,this.sigBytes)},clone:function(){for(var w=a.clone.call(this),k=w.words=this.words.slice(0),T=k.length,I=0;I<T;I++)k[I]=k[I].clone();return w}})})(),function(){var t=M,e=t.lib.WordArray;t.enc.Base64={stringify:function(a){var d=a.words,v=a.sigBytes,w=this._map;a.clamp(),a=[];for(var k=0;k<v;k+=3)for(var T=(d[k>>>2]>>>24-k%4*8&255)<<16|(d[k+1>>>2]>>>24-(k+1)%4*8&255)<<8|d[k+2>>>2]>>>24-(k+2)%4*8&255,I=0;4>I&&k+.75*I<v;I++)a.push(w.charAt(T>>>6*(3-I)&63));if(d=w.charAt(64))for(;a.length%4;)a.push(d);return a.join("")},parse:function(a){var d=a.length,v=this._map;(w=v.charAt(64))&&(w=a.indexOf(w))!=-1&&(d=w);for(var w=[],k=0,T=0;T<d;T++)if(T%4){var I=v.indexOf(a.charAt(T-1))<<T%4*2,U=v.indexOf(a.charAt(T))>>>6-T%4*2;w[k>>>2]|=(I|U)<<24-k%4*8,k++}return e.create(w,k)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(t){for(var e=M,i=(d=e.lib).WordArray,a=d.Hasher,d=e.algo,v=[],w=[],k=function(Q){return 4294967296*(Q-(0|Q))|0},T=2,I=0;64>I;){var U;e:{U=T;for(var D=t.sqrt(U),B=2;B<=D;B++)if(!(U%B)){U=!1;break e}U=!0}U&&(8>I&&(v[I]=k(t.pow(T,.5))),w[I]=k(t.pow(T,1/3)),I++),T++}var $=[];d=d.SHA256=a.extend({_doReset:function(){this._hash=new i.init(v.slice(0))},_doProcessBlock:function(Q,ee){for(var S=this._hash.words,O=S[0],N=S[1],K=S[2],Y=S[3],te=S[4],de=S[5],se=S[6],Se=S[7],ce=0;64>ce;ce++){if(16>ce)$[ce]=0|Q[ee+ce];else{var ge=$[ce-15],Ue=$[ce-2];$[ce]=((ge<<25|ge>>>7)^(ge<<14|ge>>>18)^ge>>>3)+$[ce-7]+((Ue<<15|Ue>>>17)^(Ue<<13|Ue>>>19)^Ue>>>10)+$[ce-16]}ge=Se+((te<<26|te>>>6)^(te<<21|te>>>11)^(te<<7|te>>>25))+(te&de^~te&se)+w[ce]+$[ce],Ue=((O<<30|O>>>2)^(O<<19|O>>>13)^(O<<10|O>>>22))+(O&N^O&K^N&K),Se=se,se=de,de=te,te=Y+ge|0,Y=K,K=N,N=O,O=ge+Ue|0}S[0]=S[0]+O|0,S[1]=S[1]+N|0,S[2]=S[2]+K|0,S[3]=S[3]+Y|0,S[4]=S[4]+te|0,S[5]=S[5]+de|0,S[6]=S[6]+se|0,S[7]=S[7]+Se|0},_doFinalize:function(){var Q=this._data,ee=Q.words,S=8*this._nDataBytes,O=8*Q.sigBytes;return ee[O>>>5]|=128<<24-O%32,ee[14+(O+64>>>9<<4)]=t.floor(S/4294967296),ee[15+(O+64>>>9<<4)]=S,Q.sigBytes=4*ee.length,this._process(),this._hash},clone:function(){var Q=a.clone.call(this);return Q._hash=this._hash.clone(),Q}}),e.SHA256=a._createHelper(d),e.HmacSHA256=a._createHmacHelper(d)}(Math),function(){function t(){return a.create.apply(a,arguments)}for(var e=M,i=e.lib.Hasher,a=(v=e.x64).Word,d=v.WordArray,v=e.algo,w=[t(1116352408,3609767458),t(1899447441,602891725),t(3049323471,3964484399),t(3921009573,2173295548),t(961987163,4081628472),t(1508970993,3053834265),t(2453635748,2937671579),t(2870763221,3664609560),t(3624381080,2734883394),t(310598401,1164996542),t(607225278,1323610764),t(1426881987,3590304994),t(1925078388,4068182383),t(2162078206,991336113),t(2614888103,633803317),t(3248222580,3479774868),t(3835390401,2666613458),t(4022224774,944711139),t(264347078,2341262773),t(604807628,2007800933),t(770255983,1495990901),t(1249150122,1856431235),t(1555081692,3175218132),t(1996064986,2198950837),t(2554220882,3999719339),t(2821834349,766784016),t(2952996808,2566594879),t(3210313671,3203337956),t(3336571891,1034457026),t(3584528711,2466948901),t(113926993,3758326383),t(338241895,168717936),t(666307205,1188179964),t(773529912,1546045734),t(1294757372,1522805485),t(1396182291,2643833823),t(1695183700,2343527390),t(1986661051,1014477480),t(2177026350,1206759142),t(2456956037,344077627),t(2730485921,1290863460),t(2820302411,3158454273),t(3259730800,3505952657),t(3345764771,106217008),t(3516065817,3606008344),t(3600352804,1432725776),t(4094571909,1467031594),t(275423344,851169720),t(430227734,3100823752),t(506948616,1363258195),t(659060556,3750685593),t(883997877,3785050280),t(958139571,3318307427),t(1322822218,3812723403),t(1537002063,2003034995),t(1747873779,3602036899),t(1955562222,1575990012),t(2024104815,1125592928),t(2227730452,2716904306),t(2361852424,442776044),t(2428436474,593698344),t(2756734187,3733110249),t(3204031479,2999351573),t(3329325298,3815920427),t(3391569614,3928383900),t(3515267271,566280711),t(3940187606,3454069534),t(4118630271,4000239992),t(116418474,1914138554),t(174292421,2731055270),t(289380356,3203993006),t(460393269,320620315),t(685471733,587496836),t(852142971,1086792851),t(1017036298,365543100),t(1126000580,2618297676),t(1288033470,3409855158),t(1501505948,4234509866),t(1607167915,987167468),t(1816402316,1246189591)],k=[],T=0;80>T;T++)k[T]=t();v=v.SHA512=i.extend({_doReset:function(){this._hash=new d.init([new a.init(1779033703,4089235720),new a.init(3144134277,2227873595),new a.init(1013904242,4271175723),new a.init(2773480762,1595750129),new a.init(1359893119,2917565137),new a.init(2600822924,725511199),new a.init(528734635,4215389547),new a.init(1541459225,327033209)])},_doProcessBlock:function(U,D){for(var B=(N=this._hash.words)[0],$=N[1],z=N[2],Q=N[3],ee=N[4],S=N[5],O=N[6],N=N[7],K=B.high,Y=B.low,te=$.high,de=$.low,se=z.high,Se=z.low,ce=Q.high,ge=Q.low,Ue=ee.high,Ne=ee.low,De=S.high,Et=S.low,ct=O.high,gt=O.low,We=N.high,Qe=N.low,it=K,yt=Y,Sr=te,ur=de,wr=se,cr=Se,mn=ce,Er=ge,Ht=Ue,It=Ne,Lr=De,br=Et,Mr=ct,Fr=gt,_n=We,Ar=Qe,Nt=0;80>Nt;Nt++){var tr=k[Nt];if(16>Nt)var $t=tr.high=0|U[D+2*Nt],Le=tr.low=0|U[D+2*Nt+1];else{$t=((Le=($t=k[Nt-15]).high)>>>1|(Gt=$t.low)<<31)^(Le>>>8|Gt<<24)^Le>>>7;var Gt=(Gt>>>1|Le<<31)^(Gt>>>8|Le<<24)^(Gt>>>7|Le<<25),lr=((Le=(lr=k[Nt-2]).high)>>>19|(Ze=lr.low)<<13)^(Le<<3|Ze>>>29)^Le>>>6,Ze=(Ze>>>19|Le<<13)^(Ze<<3|Le>>>29)^(Ze>>>6|Le<<26),Sn=(Le=k[Nt-7]).high,rr=(nr=k[Nt-16]).high,nr=nr.low;$t=($t=($t=$t+Sn+((Le=Gt+Le.low)>>>0<Gt>>>0?1:0))+lr+((Le=Le+Ze)>>>0<Ze>>>0?1:0))+rr+((Le=Le+nr)>>>0<nr>>>0?1:0),tr.high=$t,tr.low=Le}Sn=Ht&Lr^~Ht&Mr,nr=It&br^~It&Fr,tr=it&Sr^it&wr^Sr&wr;var ls=yt&ur^yt&cr^ur&cr,ds=(Gt=(it>>>28|yt<<4)^(it<<30|yt>>>2)^(it<<25|yt>>>7),lr=(yt>>>28|it<<4)^(yt<<30|it>>>2)^(yt<<25|it>>>7),(Ze=w[Nt]).high),Ii=Ze.low;rr=_n+((Ht>>>14|It<<18)^(Ht>>>18|It<<14)^(Ht<<23|It>>>9))+((Ze=Ar+((It>>>14|Ht<<18)^(It>>>18|Ht<<14)^(It<<23|Ht>>>9)))>>>0<Ar>>>0?1:0),_n=Mr,Ar=Fr,Mr=Lr,Fr=br,Lr=Ht,br=It,Ht=mn+(rr=(rr=(rr=rr+Sn+((Ze=Ze+nr)>>>0<nr>>>0?1:0))+ds+((Ze=Ze+Ii)>>>0<Ii>>>0?1:0))+$t+((Ze=Ze+Le)>>>0<Le>>>0?1:0))+((It=Er+Ze|0)>>>0<Er>>>0?1:0)|0,mn=wr,Er=cr,wr=Sr,cr=ur,Sr=it,ur=yt,it=rr+(tr=Gt+tr+((Le=lr+ls)>>>0<lr>>>0?1:0))+((yt=Ze+Le|0)>>>0<Ze>>>0?1:0)|0}Y=B.low=Y+yt,B.high=K+it+(Y>>>0<yt>>>0?1:0),de=$.low=de+ur,$.high=te+Sr+(de>>>0<ur>>>0?1:0),Se=z.low=Se+cr,z.high=se+wr+(Se>>>0<cr>>>0?1:0),ge=Q.low=ge+Er,Q.high=ce+mn+(ge>>>0<Er>>>0?1:0),Ne=ee.low=Ne+It,ee.high=Ue+Ht+(Ne>>>0<It>>>0?1:0),Et=S.low=Et+br,S.high=De+Lr+(Et>>>0<br>>>0?1:0),gt=O.low=gt+Fr,O.high=ct+Mr+(gt>>>0<Fr>>>0?1:0),Qe=N.low=Qe+Ar,N.high=We+_n+(Qe>>>0<Ar>>>0?1:0)},_doFinalize:function(){var U=this._data,D=U.words,B=8*this._nDataBytes,$=8*U.sigBytes;return D[$>>>5]|=128<<24-$%32,D[30+($+128>>>10<<5)]=Math.floor(B/4294967296),D[31+($+128>>>10<<5)]=B,U.sigBytes=4*D.length,this._process(),this._hash.toX32()},clone:function(){var U=i.clone.call(this);return U._hash=this._hash.clone(),U},blockSize:32}),e.SHA512=i._createHelper(v),e.HmacSHA512=i._createHmacHelper(v)}(),function(){var t=M,e=(d=t.x64).Word,i=d.WordArray,a=(d=t.algo).SHA512,d=d.SHA384=a.extend({_doReset:function(){this._hash=new i.init([new e.init(3418070365,3238371032),new e.init(1654270250,914150663),new e.init(2438529370,812702999),new e.init(355462360,4144912697),new e.init(1731405415,4290775857),new e.init(2394180231,1750603025),new e.init(3675008525,1694076839),new e.init(1203062813,3204075428)])},_doFinalize:function(){var w=a._doFinalize.call(this);return w.sigBytes-=16,w}});t.SHA384=a._createHelper(d),t.HmacSHA384=a._createHmacHelper(d)}();/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */var G,J="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function j(t){var e,i,a="";for(e=0;e+3<=t.length;e+=3)i=parseInt(t.substring(e,e+3),16),a+=J.charAt(i>>6)+J.charAt(63&i);for(e+1==t.length?(i=parseInt(t.substring(e,e+1),16),a+=J.charAt(i<<2)):e+2==t.length&&(i=parseInt(t.substring(e,e+2),16),a+=J.charAt(i>>2)+J.charAt((3&i)<<4)),"=";(3&a.length)>0;)a+="=";return a}function ne(t){var e,i,a,d="",v=0;for(e=0;e<t.length&&t.charAt(e)!="=";++e)(a=J.indexOf(t.charAt(e)))<0||(v==0?(d+=ae(a>>2),i=3&a,v=1):v==1?(d+=ae(i<<2|a>>4),i=15&a,v=2):v==2?(d+=ae(i),d+=ae(a>>2),i=3&a,v=3):(d+=ae(i<<2|a>>4),d+=ae(15&a),v=0));return v==1&&(d+=ae(i<<2)),d}function ie(t){var e,i=ne(t),a=new Array;for(e=0;2*e<i.length;++e)a[e]=parseInt(i.substring(2*e,2*e+2),16);return a}function W(t,e,i){t!=null&&(typeof t=="number"?this.fromNumber(t,e,i):e==null&&typeof t!="string"?this.fromString(t,256):this.fromString(t,e))}function oe(){return new W(null)}P.appName=="Microsoft Internet Explorer"?(W.prototype.am=function(e,i,a,d,v,w){for(var k=32767&i,T=i>>15;--w>=0;){var I=32767&this[e],U=this[e++]>>15,D=T*I+U*k;v=((I=k*I+((32767&D)<<15)+a[d]+(1073741823&v))>>>30)+(D>>>15)+T*U+(v>>>30),a[d++]=1073741823&I}return v},G=30):P.appName!="Netscape"?(W.prototype.am=function(e,i,a,d,v,w){for(;--w>=0;){var k=i*this[e++]+a[d]+v;v=Math.floor(k/67108864),a[d++]=67108863&k}return v},G=26):(W.prototype.am=function(e,i,a,d,v,w){for(var k=16383&i,T=i>>14;--w>=0;){var I=16383&this[e],U=this[e++]>>14,D=T*I+U*k;v=((I=k*I+((16383&D)<<14)+a[d]+v)>>28)+(D>>14)+T*U,a[d++]=268435455&I}return v},G=28),W.prototype.DB=G,W.prototype.DM=(1<<G)-1,W.prototype.DV=1<<G,W.prototype.FV=Math.pow(2,52),W.prototype.F1=52-G,W.prototype.F2=2*G-52;var Te,be,Z=new Array;for(Te="0".charCodeAt(0),be=0;be<=9;++be)Z[Te++]=be;for(Te="a".charCodeAt(0),be=10;be<36;++be)Z[Te++]=be;for(Te="A".charCodeAt(0),be=10;be<36;++be)Z[Te++]=be;function ae(t){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(t)}function pe(t,e){var i=Z[t.charCodeAt(e)];return i==null?-1:i}function Ee(t){var e=oe();return e.fromInt(t),e}function Fe(t){var e,i=1;return(e=t>>>16)!=0&&(t=e,i+=16),(e=t>>8)!=0&&(t=e,i+=8),(e=t>>4)!=0&&(t=e,i+=4),(e=t>>2)!=0&&(t=e,i+=2),(e=t>>1)!=0&&(t=e,i+=1),i}function le(t){this.m=t}function _e(t){this.m=t,this.mp=t.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function Me(t,e){return t&e}function Ve(t,e){return t|e}function vt(t,e){return t^e}function mt(t,e){return t&~e}function Ct(t){if(t==0)return-1;var e=0;return(65535&t)==0&&(t>>=16,e+=16),(255&t)==0&&(t>>=8,e+=8),(15&t)==0&&(t>>=4,e+=4),(3&t)==0&&(t>>=2,e+=2),(1&t)==0&&++e,e}function Vt(t){for(var e=0;t!=0;)t&=t-1,++e;return e}function ut(){}function _t(t){return t}function tt(t){this.r2=oe(),this.q3=oe(),W.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}le.prototype.convert=function(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e},le.prototype.revert=function(e){return e},le.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},le.prototype.mulTo=function(e,i,a){e.multiplyTo(i,a),this.reduce(a)},le.prototype.sqrTo=function(e,i){e.squareTo(i),this.reduce(i)},_e.prototype.convert=function(e){var i=oe();return e.abs().dlShiftTo(this.m.t,i),i.divRemTo(this.m,null,i),e.s<0&&i.compareTo(W.ZERO)>0&&this.m.subTo(i,i),i},_e.prototype.revert=function(e){var i=oe();return e.copyTo(i),this.reduce(i),i},_e.prototype.reduce=function(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var i=0;i<this.m.t;++i){var a=32767&e[i],d=a*this.mpl+((a*this.mph+(e[i]>>15)*this.mpl&this.um)<<15)&e.DM;for(e[a=i+this.m.t]+=this.m.am(0,d,e,i,0,this.m.t);e[a]>=e.DV;)e[a]-=e.DV,e[++a]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)},_e.prototype.mulTo=function(e,i,a){e.multiplyTo(i,a),this.reduce(a)},_e.prototype.sqrTo=function(e,i){e.squareTo(i),this.reduce(i)},W.prototype.copyTo=function(e){for(var i=this.t-1;i>=0;--i)e[i]=this[i];e.t=this.t,e.s=this.s},W.prototype.fromInt=function(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0},W.prototype.fromString=function(e,i){var a;if(i==16)a=4;else if(i==8)a=3;else if(i==256)a=8;else if(i==2)a=1;else if(i==32)a=5;else{if(i!=4)return void this.fromRadix(e,i);a=2}this.t=0,this.s=0;for(var d=e.length,v=!1,w=0;--d>=0;){var k=a==8?255&e[d]:pe(e,d);k<0?e.charAt(d)=="-"&&(v=!0):(v=!1,w==0?this[this.t++]=k:w+a>this.DB?(this[this.t-1]|=(k&(1<<this.DB-w)-1)<<w,this[this.t++]=k>>this.DB-w):this[this.t-1]|=k<<w,(w+=a)>=this.DB&&(w-=this.DB))}a==8&&(128&e[0])!=0&&(this.s=-1,w>0&&(this[this.t-1]|=(1<<this.DB-w)-1<<w)),this.clamp(),v&&W.ZERO.subTo(this,this)},W.prototype.clamp=function(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t},W.prototype.dlShiftTo=function(e,i){var a;for(a=this.t-1;a>=0;--a)i[a+e]=this[a];for(a=e-1;a>=0;--a)i[a]=0;i.t=this.t+e,i.s=this.s},W.prototype.drShiftTo=function(e,i){for(var a=e;a<this.t;++a)i[a-e]=this[a];i.t=Math.max(this.t-e,0),i.s=this.s},W.prototype.lShiftTo=function(e,i){var a,d=e%this.DB,v=this.DB-d,w=(1<<v)-1,k=Math.floor(e/this.DB),T=this.s<<d&this.DM;for(a=this.t-1;a>=0;--a)i[a+k+1]=this[a]>>v|T,T=(this[a]&w)<<d;for(a=k-1;a>=0;--a)i[a]=0;i[k]=T,i.t=this.t+k+1,i.s=this.s,i.clamp()},W.prototype.rShiftTo=function(e,i){i.s=this.s;var a=Math.floor(e/this.DB);if(a>=this.t)i.t=0;else{var d=e%this.DB,v=this.DB-d,w=(1<<d)-1;i[0]=this[a]>>d;for(var k=a+1;k<this.t;++k)i[k-a-1]|=(this[k]&w)<<v,i[k-a]=this[k]>>d;d>0&&(i[this.t-a-1]|=(this.s&w)<<v),i.t=this.t-a,i.clamp()}},W.prototype.subTo=function(e,i){for(var a=0,d=0,v=Math.min(e.t,this.t);a<v;)d+=this[a]-e[a],i[a++]=d&this.DM,d>>=this.DB;if(e.t<this.t){for(d-=e.s;a<this.t;)d+=this[a],i[a++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=this.s;a<e.t;)d-=e[a],i[a++]=d&this.DM,d>>=this.DB;d-=e.s}i.s=d<0?-1:0,d<-1?i[a++]=this.DV+d:d>0&&(i[a++]=d),i.t=a,i.clamp()},W.prototype.multiplyTo=function(e,i){var a=this.abs(),d=e.abs(),v=a.t;for(i.t=v+d.t;--v>=0;)i[v]=0;for(v=0;v<d.t;++v)i[v+a.t]=a.am(0,d[v],i,v,0,a.t);i.s=0,i.clamp(),this.s!=e.s&&W.ZERO.subTo(i,i)},W.prototype.squareTo=function(e){for(var i=this.abs(),a=e.t=2*i.t;--a>=0;)e[a]=0;for(a=0;a<i.t-1;++a){var d=i.am(a,i[a],e,2*a,0,1);(e[a+i.t]+=i.am(a+1,2*i[a],e,2*a+1,d,i.t-a-1))>=i.DV&&(e[a+i.t]-=i.DV,e[a+i.t+1]=1)}e.t>0&&(e[e.t-1]+=i.am(a,i[a],e,2*a,0,1)),e.s=0,e.clamp()},W.prototype.divRemTo=function(e,i,a){var d=e.abs();if(!(d.t<=0)){var v=this.abs();if(v.t<d.t)return i!=null&&i.fromInt(0),void(a!=null&&this.copyTo(a));a==null&&(a=oe());var w=oe(),k=this.s,T=e.s,I=this.DB-Fe(d[d.t-1]);I>0?(d.lShiftTo(I,w),v.lShiftTo(I,a)):(d.copyTo(w),v.copyTo(a));var U=w.t,D=w[U-1];if(D!=0){var B=D*(1<<this.F1)+(U>1?w[U-2]>>this.F2:0),$=this.FV/B,z=(1<<this.F1)/B,Q=1<<this.F2,ee=a.t,S=ee-U,O=i==null?oe():i;for(w.dlShiftTo(S,O),a.compareTo(O)>=0&&(a[a.t++]=1,a.subTo(O,a)),W.ONE.dlShiftTo(U,O),O.subTo(w,w);w.t<U;)w[w.t++]=0;for(;--S>=0;){var N=a[--ee]==D?this.DM:Math.floor(a[ee]*$+(a[ee-1]+Q)*z);if((a[ee]+=w.am(0,N,a,S,0,U))<N)for(w.dlShiftTo(S,O),a.subTo(O,a);a[ee]<--N;)a.subTo(O,a)}i!=null&&(a.drShiftTo(U,i),k!=T&&W.ZERO.subTo(i,i)),a.t=U,a.clamp(),I>0&&a.rShiftTo(I,a),k<0&&W.ZERO.subTo(a,a)}}},W.prototype.invDigit=function(){if(this.t<1)return 0;var e=this[0];if((1&e)==0)return 0;var i=3&e;return(i=(i=(i=(i=i*(2-(15&e)*i)&15)*(2-(255&e)*i)&255)*(2-((65535&e)*i&65535))&65535)*(2-e*i%this.DV)%this.DV)>0?this.DV-i:-i},W.prototype.isEven=function(){return(this.t>0?1&this[0]:this.s)==0},W.prototype.exp=function(e,i){if(e>4294967295||e<1)return W.ONE;var a=oe(),d=oe(),v=i.convert(this),w=Fe(e)-1;for(v.copyTo(a);--w>=0;)if(i.sqrTo(a,d),(e&1<<w)>0)i.mulTo(d,v,a);else{var k=a;a=d,d=k}return i.revert(a)},W.prototype.toString=function(e){if(this.s<0)return"-"+this.negate().toString(e);var i;if(e==16)i=4;else if(e==8)i=3;else if(e==2)i=1;else if(e==32)i=5;else{if(e!=4)return this.toRadix(e);i=2}var a,d=(1<<i)-1,v=!1,w="",k=this.t,T=this.DB-k*this.DB%i;if(k-- >0)for(T<this.DB&&(a=this[k]>>T)>0&&(v=!0,w=ae(a));k>=0;)T<i?(a=(this[k]&(1<<T)-1)<<i-T,a|=this[--k]>>(T+=this.DB-i)):(a=this[k]>>(T-=i)&d,T<=0&&(T+=this.DB,--k)),a>0&&(v=!0),v&&(w+=ae(a));return v?w:"0"},W.prototype.negate=function(){var e=oe();return W.ZERO.subTo(this,e),e},W.prototype.abs=function(){return this.s<0?this.negate():this},W.prototype.compareTo=function(e){var i=this.s-e.s;if(i!=0)return i;var a=this.t;if((i=a-e.t)!=0)return this.s<0?-i:i;for(;--a>=0;)if((i=this[a]-e[a])!=0)return i;return 0},W.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+Fe(this[this.t-1]^this.s&this.DM)},W.prototype.mod=function(e){var i=oe();return this.abs().divRemTo(e,null,i),this.s<0&&i.compareTo(W.ZERO)>0&&e.subTo(i,i),i},W.prototype.modPowInt=function(e,i){var a;return a=e<256||i.isEven()?new le(i):new _e(i),this.exp(e,a)},W.ZERO=Ee(0),W.ONE=Ee(1),ut.prototype.convert=_t,ut.prototype.revert=_t,ut.prototype.mulTo=function(e,i,a){e.multiplyTo(i,a)},ut.prototype.sqrTo=function(e,i){e.squareTo(i)},tt.prototype.convert=function(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var i=oe();return e.copyTo(i),this.reduce(i),i},tt.prototype.revert=function(e){return e},tt.prototype.reduce=function(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)},tt.prototype.mulTo=function(e,i,a){e.multiplyTo(i,a),this.reduce(a)},tt.prototype.sqrTo=function(e,i){e.squareTo(i),this.reduce(i)};var He=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],V=(1<<26)/He[He.length-1];/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function m(){this.i=0,this.j=0,this.S=new Array}W.prototype.chunkSize=function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},W.prototype.toRadix=function(e){if(e==null&&(e=10),this.signum()==0||e<2||e>36)return"0";var i=this.chunkSize(e),a=Math.pow(e,i),d=Ee(a),v=oe(),w=oe(),k="";for(this.divRemTo(d,v,w);v.signum()>0;)k=(a+w.intValue()).toString(e).substr(1)+k,v.divRemTo(d,v,w);return w.intValue().toString(e)+k},W.prototype.fromRadix=function(e,i){this.fromInt(0),i==null&&(i=10);for(var a=this.chunkSize(i),d=Math.pow(i,a),v=!1,w=0,k=0,T=0;T<e.length;++T){var I=pe(e,T);I<0?e.charAt(T)=="-"&&this.signum()==0&&(v=!0):(k=i*k+I,++w>=a&&(this.dMultiply(d),this.dAddOffset(k,0),w=0,k=0))}w>0&&(this.dMultiply(Math.pow(i,w)),this.dAddOffset(k,0)),v&&W.ZERO.subTo(this,this)},W.prototype.fromNumber=function(e,i,a){if(typeof i=="number")if(e<2)this.fromInt(1);else for(this.fromNumber(e,a),this.testBit(e-1)||this.bitwiseTo(W.ONE.shiftLeft(e-1),Ve,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(i);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(W.ONE.shiftLeft(e-1),this);else{var d=new Array,v=7&e;d.length=1+(e>>3),i.nextBytes(d),v>0?d[0]&=(1<<v)-1:d[0]=0,this.fromString(d,256)}},W.prototype.bitwiseTo=function(e,i,a){var d,v,w=Math.min(e.t,this.t);for(d=0;d<w;++d)a[d]=i(this[d],e[d]);if(e.t<this.t){for(v=e.s&this.DM,d=w;d<this.t;++d)a[d]=i(this[d],v);a.t=this.t}else{for(v=this.s&this.DM,d=w;d<e.t;++d)a[d]=i(v,e[d]);a.t=e.t}a.s=i(this.s,e.s),a.clamp()},W.prototype.changeBit=function(e,i){var a=W.ONE.shiftLeft(e);return this.bitwiseTo(a,i,a),a},W.prototype.addTo=function(e,i){for(var a=0,d=0,v=Math.min(e.t,this.t);a<v;)d+=this[a]+e[a],i[a++]=d&this.DM,d>>=this.DB;if(e.t<this.t){for(d+=e.s;a<this.t;)d+=this[a],i[a++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=this.s;a<e.t;)d+=e[a],i[a++]=d&this.DM,d>>=this.DB;d+=e.s}i.s=d<0?-1:0,d>0?i[a++]=d:d<-1&&(i[a++]=this.DV+d),i.t=a,i.clamp()},W.prototype.dMultiply=function(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},W.prototype.dAddOffset=function(e,i){if(e!=0){for(;this.t<=i;)this[this.t++]=0;for(this[i]+=e;this[i]>=this.DV;)this[i]-=this.DV,++i>=this.t&&(this[this.t++]=0),++this[i]}},W.prototype.multiplyLowerTo=function(e,i,a){var d,v=Math.min(this.t+e.t,i);for(a.s=0,a.t=v;v>0;)a[--v]=0;for(d=a.t-this.t;v<d;++v)a[v+this.t]=this.am(0,e[v],a,v,0,this.t);for(d=Math.min(e.t,i);v<d;++v)this.am(0,e[v],a,v,0,i-v);a.clamp()},W.prototype.multiplyUpperTo=function(e,i,a){--i;var d=a.t=this.t+e.t-i;for(a.s=0;--d>=0;)a[d]=0;for(d=Math.max(i-this.t,0);d<e.t;++d)a[this.t+d-i]=this.am(i-d,e[d],a,0,0,this.t+d-i);a.clamp(),a.drShiftTo(1,a)},W.prototype.modInt=function(e){if(e<=0)return 0;var i=this.DV%e,a=this.s<0?e-1:0;if(this.t>0)if(i==0)a=this[0]%e;else for(var d=this.t-1;d>=0;--d)a=(i*a+this[d])%e;return a},W.prototype.millerRabin=function(e){var i=this.subtract(W.ONE),a=i.getLowestSetBit();if(a<=0)return!1;var d=i.shiftRight(a);(e=e+1>>1)>He.length&&(e=He.length);for(var v=oe(),w=0;w<e;++w){v.fromInt(He[Math.floor(Math.random()*He.length)]);var k=v.modPow(d,this);if(k.compareTo(W.ONE)!=0&&k.compareTo(i)!=0){for(var T=1;T++<a&&k.compareTo(i)!=0;)if((k=k.modPowInt(2,this)).compareTo(W.ONE)==0)return!1;if(k.compareTo(i)!=0)return!1}}return!0},W.prototype.clone=function(){var e=oe();return this.copyTo(e),e},W.prototype.intValue=function(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},W.prototype.byteValue=function(){return this.t==0?this.s:this[0]<<24>>24},W.prototype.shortValue=function(){return this.t==0?this.s:this[0]<<16>>16},W.prototype.signum=function(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1},W.prototype.toByteArray=function(){var e=this.t,i=new Array;i[0]=this.s;var a,d=this.DB-e*this.DB%8,v=0;if(e-- >0)for(d<this.DB&&(a=this[e]>>d)!=(this.s&this.DM)>>d&&(i[v++]=a|this.s<<this.DB-d);e>=0;)d<8?(a=(this[e]&(1<<d)-1)<<8-d,a|=this[--e]>>(d+=this.DB-8)):(a=this[e]>>(d-=8)&255,d<=0&&(d+=this.DB,--e)),(128&a)!=0&&(a|=-256),v==0&&(128&this.s)!=(128&a)&&++v,(v>0||a!=this.s)&&(i[v++]=a);return i},W.prototype.equals=function(e){return this.compareTo(e)==0},W.prototype.min=function(e){return this.compareTo(e)<0?this:e},W.prototype.max=function(e){return this.compareTo(e)>0?this:e},W.prototype.and=function(e){var i=oe();return this.bitwiseTo(e,Me,i),i},W.prototype.or=function(e){var i=oe();return this.bitwiseTo(e,Ve,i),i},W.prototype.xor=function(e){var i=oe();return this.bitwiseTo(e,vt,i),i},W.prototype.andNot=function(e){var i=oe();return this.bitwiseTo(e,mt,i),i},W.prototype.not=function(){for(var e=oe(),i=0;i<this.t;++i)e[i]=this.DM&~this[i];return e.t=this.t,e.s=~this.s,e},W.prototype.shiftLeft=function(e){var i=oe();return e<0?this.rShiftTo(-e,i):this.lShiftTo(e,i),i},W.prototype.shiftRight=function(e){var i=oe();return e<0?this.lShiftTo(-e,i):this.rShiftTo(e,i),i},W.prototype.getLowestSetBit=function(){for(var e=0;e<this.t;++e)if(this[e]!=0)return e*this.DB+Ct(this[e]);return this.s<0?this.t*this.DB:-1},W.prototype.bitCount=function(){for(var e=0,i=this.s&this.DM,a=0;a<this.t;++a)e+=Vt(this[a]^i);return e},W.prototype.testBit=function(e){var i=Math.floor(e/this.DB);return i>=this.t?this.s!=0:(this[i]&1<<e%this.DB)!=0},W.prototype.setBit=function(e){return this.changeBit(e,Ve)},W.prototype.clearBit=function(e){return this.changeBit(e,mt)},W.prototype.flipBit=function(e){return this.changeBit(e,vt)},W.prototype.add=function(e){var i=oe();return this.addTo(e,i),i},W.prototype.subtract=function(e){var i=oe();return this.subTo(e,i),i},W.prototype.multiply=function(e){var i=oe();return this.multiplyTo(e,i),i},W.prototype.divide=function(e){var i=oe();return this.divRemTo(e,i,null),i},W.prototype.remainder=function(e){var i=oe();return this.divRemTo(e,null,i),i},W.prototype.divideAndRemainder=function(e){var i=oe(),a=oe();return this.divRemTo(e,i,a),new Array(i,a)},W.prototype.modPow=function(e,i){var a,d,v=e.bitLength(),w=Ee(1);if(v<=0)return w;a=v<18?1:v<48?3:v<144?4:v<768?5:6,d=v<8?new le(i):i.isEven()?new tt(i):new _e(i);var k=new Array,T=3,I=a-1,U=(1<<a)-1;if(k[1]=d.convert(this),a>1){var D=oe();for(d.sqrTo(k[1],D);T<=U;)k[T]=oe(),d.mulTo(D,k[T-2],k[T]),T+=2}var B,$,z=e.t-1,Q=!0,ee=oe();for(v=Fe(e[z])-1;z>=0;){for(v>=I?B=e[z]>>v-I&U:(B=(e[z]&(1<<v+1)-1)<<I-v,z>0&&(B|=e[z-1]>>this.DB+v-I)),T=a;(1&B)==0;)B>>=1,--T;if((v-=T)<0&&(v+=this.DB,--z),Q)k[B].copyTo(w),Q=!1;else{for(;T>1;)d.sqrTo(w,ee),d.sqrTo(ee,w),T-=2;T>0?d.sqrTo(w,ee):($=w,w=ee,ee=$),d.mulTo(ee,k[B],w)}for(;z>=0&&(e[z]&1<<v)==0;)d.sqrTo(w,ee),$=w,w=ee,ee=$,--v<0&&(v=this.DB-1,--z)}return d.revert(w)},W.prototype.modInverse=function(e){var i=e.isEven();if(this.isEven()&&i||e.signum()==0)return W.ZERO;for(var a=e.clone(),d=this.clone(),v=Ee(1),w=Ee(0),k=Ee(0),T=Ee(1);a.signum()!=0;){for(;a.isEven();)a.rShiftTo(1,a),i?(v.isEven()&&w.isEven()||(v.addTo(this,v),w.subTo(e,w)),v.rShiftTo(1,v)):w.isEven()||w.subTo(e,w),w.rShiftTo(1,w);for(;d.isEven();)d.rShiftTo(1,d),i?(k.isEven()&&T.isEven()||(k.addTo(this,k),T.subTo(e,T)),k.rShiftTo(1,k)):T.isEven()||T.subTo(e,T),T.rShiftTo(1,T);a.compareTo(d)>=0?(a.subTo(d,a),i&&v.subTo(k,v),w.subTo(T,w)):(d.subTo(a,d),i&&k.subTo(v,k),T.subTo(w,T))}return d.compareTo(W.ONE)!=0?W.ZERO:T.compareTo(e)>=0?T.subtract(e):T.signum()<0?(T.addTo(e,T),T.signum()<0?T.add(e):T):T},W.prototype.pow=function(e){return this.exp(e,new ut)},W.prototype.gcd=function(e){var i=this.s<0?this.negate():this.clone(),a=e.s<0?e.negate():e.clone();if(i.compareTo(a)<0){var d=i;i=a,a=d}var v=i.getLowestSetBit(),w=a.getLowestSetBit();if(w<0)return i;for(v<w&&(w=v),w>0&&(i.rShiftTo(w,i),a.rShiftTo(w,a));i.signum()>0;)(v=i.getLowestSetBit())>0&&i.rShiftTo(v,i),(v=a.getLowestSetBit())>0&&a.rShiftTo(v,a),i.compareTo(a)>=0?(i.subTo(a,i),i.rShiftTo(1,i)):(a.subTo(i,a),a.rShiftTo(1,a));return w>0&&a.lShiftTo(w,a),a},W.prototype.isProbablePrime=function(e){var i,a=this.abs();if(a.t==1&&a[0]<=He[He.length-1]){for(i=0;i<He.length;++i)if(a[0]==He[i])return!0;return!1}if(a.isEven())return!1;for(i=1;i<He.length;){for(var d=He[i],v=i+1;v<He.length&&d<V;)d*=He[v++];for(d=a.modInt(d);i<v;)if(d%He[i++]==0)return!1}return a.millerRabin(e)},W.prototype.square=function(){var e=oe();return this.squareTo(e),e},m.prototype.init=function(e){var i,a,d;for(i=0;i<256;++i)this.S[i]=i;for(a=0,i=0;i<256;++i)a=a+this.S[i]+e[i%e.length]&255,d=this.S[i],this.S[i]=this.S[a],this.S[a]=d;this.i=0,this.j=0},m.prototype.next=function(){var e;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,e=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=e,this.S[e+this.S[this.i]&255]};var _,L,q;/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function X(){(function(e){L[q++]^=255&e,L[q++]^=e>>8&255,L[q++]^=e>>16&255,L[q++]^=e>>24&255,q>=256&&(q-=256)})(new Date().getTime())}if(L==null){var re;if(L=new Array,q=0,H!==void 0&&(H.crypto!==void 0||H.msCrypto!==void 0)){var he=H.crypto||H.msCrypto;if(he.getRandomValues){var ve=new Uint8Array(32);for(he.getRandomValues(ve),re=0;re<32;++re)L[q++]=ve[re]}else if(P.appName=="Netscape"&&P.appVersion<"5"){var Ce=H.crypto.random(32);for(re=0;re<Ce.length;++re)L[q++]=255&Ce.charCodeAt(re)}}for(;q<256;)re=Math.floor(65536*Math.random()),L[q++]=re>>>8,L[q++]=255&re;q=0,X()}function Ae(){if(_==null){for(X(),(_=function(){return new m}()).init(L),q=0;q<L.length;++q)L[q]=0;q=0}return _.next()}function Re(){}/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function St(t,e){return new W(t,e)}function Ot(t,e,i){for(var a="",d=0;a.length<e;)a+=i(String.fromCharCode.apply(String,t.concat([(4278190080&d)>>24,(16711680&d)>>16,(65280&d)>>8,255&d]))),d+=1;return a}function fe(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function Ke(t,e){this.x=e,this.q=t}function we(t,e,i,a){this.curve=t,this.x=e,this.y=i,this.z=a==null?W.ONE:a,this.zinv=null}function xt(t,e,i){this.q=t,this.a=this.fromBigInteger(e),this.b=this.fromBigInteger(i),this.infinity=new we(this,null,null)}Re.prototype.nextBytes=function(e){var i;for(i=0;i<e.length;++i)e[i]=Ae()},fe.prototype.doPublic=function(e){return e.modPowInt(this.e,this.n)},fe.prototype.setPublic=function(e,i){if(this.isPublic=!0,this.isPrivate=!1,typeof e!="string")this.n=e,this.e=i;else{if(!(e!=null&&i!=null&&e.length>0&&i.length>0))throw"Invalid RSA public key";this.n=St(e,16),this.e=parseInt(i,16)}},fe.prototype.encrypt=function(e){var i=function(w,k){if(k<w.length+11)throw"Message too long for RSA";for(var T=new Array,I=w.length-1;I>=0&&k>0;){var U=w.charCodeAt(I--);U<128?T[--k]=U:U>127&&U<2048?(T[--k]=63&U|128,T[--k]=U>>6|192):(T[--k]=63&U|128,T[--k]=U>>6&63|128,T[--k]=U>>12|224)}T[--k]=0;for(var D=new Re,B=new Array;k>2;){for(B[0]=0;B[0]==0;)D.nextBytes(B);T[--k]=B[0]}return T[--k]=2,T[--k]=0,new W(T)}(e,this.n.bitLength()+7>>3);if(i==null)return null;var a=this.doPublic(i);if(a==null)return null;var d=a.toString(16);return(1&d.length)==0?d:"0"+d},fe.prototype.encryptOAEP=function(e,i,a){var d=function(T,I,U,D){var B=F.crypto.MessageDigest,$=F.crypto.Util,z=null;if(U||(U="sha1"),typeof U=="string"&&(z=B.getCanonicalAlgName(U),D=B.getHashLength(z),U=function(se){return Rt($.hashHex(Mt(se),z))}),T.length+2*D+2>I)throw"Message too long for RSA";var Q,ee="";for(Q=0;Q<I-T.length-2*D-2;Q+=1)ee+="\0";var S=U("")+ee+""+T,O=new Array(D);new Re().nextBytes(O);var N=Ot(O,S.length,U),K=[];for(Q=0;Q<S.length;Q+=1)K[Q]=S.charCodeAt(Q)^N.charCodeAt(Q);var Y=Ot(K,O.length,U),te=[0];for(Q=0;Q<O.length;Q+=1)te[Q+1]=O[Q]^Y.charCodeAt(Q);return new W(te.concat(K))}(e,this.n.bitLength()+7>>3,i,a);if(d==null)return null;var v=this.doPublic(d);if(v==null)return null;var w=v.toString(16);return(1&w.length)==0?w:"0"+w},fe.prototype.type="RSA",Ke.prototype.equals=function(e){return e==this||this.q.equals(e.q)&&this.x.equals(e.x)},Ke.prototype.toBigInteger=function(){return this.x},Ke.prototype.negate=function(){return new Ke(this.q,this.x.negate().mod(this.q))},Ke.prototype.add=function(e){return new Ke(this.q,this.x.add(e.toBigInteger()).mod(this.q))},Ke.prototype.subtract=function(e){return new Ke(this.q,this.x.subtract(e.toBigInteger()).mod(this.q))},Ke.prototype.multiply=function(e){return new Ke(this.q,this.x.multiply(e.toBigInteger()).mod(this.q))},Ke.prototype.square=function(){return new Ke(this.q,this.x.square().mod(this.q))},Ke.prototype.divide=function(e){return new Ke(this.q,this.x.multiply(e.toBigInteger().modInverse(this.q)).mod(this.q))},we.prototype.getX=function(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))},we.prototype.getY=function(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))},we.prototype.equals=function(e){return e==this||(this.isInfinity()?e.isInfinity():e.isInfinity()?this.isInfinity():!!e.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(e.z)).mod(this.curve.q).equals(W.ZERO)&&e.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(e.z)).mod(this.curve.q).equals(W.ZERO))},we.prototype.isInfinity=function(){return this.x==null&&this.y==null||this.z.equals(W.ZERO)&&!this.y.toBigInteger().equals(W.ZERO)},we.prototype.negate=function(){return new we(this.curve,this.x,this.y.negate(),this.z)},we.prototype.add=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;var i=e.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(e.z)).mod(this.curve.q),a=e.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(e.z)).mod(this.curve.q);if(W.ZERO.equals(a))return W.ZERO.equals(i)?this.twice():this.curve.getInfinity();var d=new W("3"),v=this.x.toBigInteger(),w=this.y.toBigInteger(),k=(e.x.toBigInteger(),e.y.toBigInteger(),a.square()),T=k.multiply(a),I=v.multiply(k),U=i.square().multiply(this.z),D=U.subtract(I.shiftLeft(1)).multiply(e.z).subtract(T).multiply(a).mod(this.curve.q),B=I.multiply(d).multiply(i).subtract(w.multiply(T)).subtract(U.multiply(i)).multiply(e.z).add(i.multiply(T)).mod(this.curve.q),$=T.multiply(this.z).multiply(e.z).mod(this.curve.q);return new we(this.curve,this.curve.fromBigInteger(D),this.curve.fromBigInteger(B),$)},we.prototype.twice=function(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var e=new W("3"),i=this.x.toBigInteger(),a=this.y.toBigInteger(),d=a.multiply(this.z),v=d.multiply(a).mod(this.curve.q),w=this.curve.a.toBigInteger(),k=i.square().multiply(e);W.ZERO.equals(w)||(k=k.add(this.z.square().multiply(w)));var T=(k=k.mod(this.curve.q)).square().subtract(i.shiftLeft(3).multiply(v)).shiftLeft(1).multiply(d).mod(this.curve.q),I=k.multiply(e).multiply(i).subtract(v.shiftLeft(1)).shiftLeft(2).multiply(v).subtract(k.square().multiply(k)).mod(this.curve.q),U=d.square().multiply(d).shiftLeft(3).mod(this.curve.q);return new we(this.curve,this.curve.fromBigInteger(T),this.curve.fromBigInteger(I),U)},we.prototype.multiply=function(e){if(this.isInfinity())return this;if(e.signum()==0)return this.curve.getInfinity();var i,a=e,d=a.multiply(new W("3")),v=this.negate(),w=this,k=this.curve.q.subtract(e),T=k.multiply(new W("3")),I=new we(this.curve,this.x,this.y),U=I.negate();for(i=d.bitLength()-2;i>0;--i){w=w.twice();var D=d.testBit(i);D!=a.testBit(i)&&(w=w.add(D?this:v))}for(i=T.bitLength()-2;i>0;--i){I=I.twice();var B=T.testBit(i);B!=k.testBit(i)&&(I=I.add(B?I:U))}return w},we.prototype.multiplyTwo=function(e,i,a){var d;d=e.bitLength()>a.bitLength()?e.bitLength()-1:a.bitLength()-1;for(var v=this.curve.getInfinity(),w=this.add(i);d>=0;)v=v.twice(),e.testBit(d)?v=a.testBit(d)?v.add(w):v.add(this):a.testBit(d)&&(v=v.add(i)),--d;return v},xt.prototype.getQ=function(){return this.q},xt.prototype.getA=function(){return this.a},xt.prototype.getB=function(){return this.b},xt.prototype.equals=function(e){return e==this||this.q.equals(e.q)&&this.a.equals(e.a)&&this.b.equals(e.b)},xt.prototype.getInfinity=function(){return this.infinity},xt.prototype.fromBigInteger=function(e){return new Ke(this.q,e)},xt.prototype.decodePointHex=function(e){switch(parseInt(e.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:return null;case 4:case 6:case 7:var i=(e.length-2)/2,a=e.substr(2,i),d=e.substr(i+2,i);return new we(this,this.fromBigInteger(new W(a,16)),this.fromBigInteger(new W(d,16)));default:return null}},Ke.prototype.getByteLength=function(){return Math.floor((this.toBigInteger().bitLength()+7)/8)},we.prototype.getEncoded=function(t){var e=function(w,k){var T=w.toByteArrayUnsigned();if(k<T.length)T=T.slice(T.length-k);else for(;k>T.length;)T.unshift(0);return T},i=this.getX().toBigInteger(),a=this.getY().toBigInteger(),d=e(i,32);return t?a.isEven()?d.unshift(2):d.unshift(3):(d.unshift(4),d=d.concat(e(a,32))),d},we.decodeFrom=function(t,e){e[0];var i=e.length-1,a=e.slice(1,1+i/2),d=e.slice(1+i/2,1+i);a.unshift(0),d.unshift(0);var v=new W(a),w=new W(d);return new we(t,t.fromBigInteger(v),t.fromBigInteger(w))},we.decodeFromHex=function(t,e){e.substr(0,2);var i=e.length-2,a=e.substr(2,i/2),d=e.substr(2+i/2,i/2),v=new W(a,16),w=new W(d,16);return new we(t,t.fromBigInteger(v),t.fromBigInteger(w))},we.prototype.add2D=function(t){if(this.isInfinity())return t;if(t.isInfinity())return this;if(this.x.equals(t.x))return this.y.equals(t.y)?this.twice():this.curve.getInfinity();var e=t.x.subtract(this.x),i=t.y.subtract(this.y).divide(e),a=i.square().subtract(this.x).subtract(t.x),d=i.multiply(this.x.subtract(a)).subtract(this.y);return new we(this.curve,a,d)},we.prototype.twice2D=function(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var t=this.curve.fromBigInteger(W.valueOf(2)),e=this.curve.fromBigInteger(W.valueOf(3)),i=this.x.square().multiply(e).add(this.curve.a).divide(this.y.multiply(t)),a=i.square().subtract(this.x.multiply(t)),d=i.multiply(this.x.subtract(a)).subtract(this.y);return new we(this.curve,a,d)},we.prototype.multiply2D=function(t){if(this.isInfinity())return this;if(t.signum()==0)return this.curve.getInfinity();var e,i=t,a=i.multiply(new W("3")),d=this.negate(),v=this;for(e=a.bitLength()-2;e>0;--e){v=v.twice();var w=a.testBit(e);w!=i.testBit(e)&&(v=v.add2D(w?this:d))}return v},we.prototype.isOnCurve=function(){var t=this.getX().toBigInteger(),e=this.getY().toBigInteger(),i=this.curve.getA().toBigInteger(),a=this.curve.getB().toBigInteger(),d=this.curve.getQ(),v=e.multiply(e).mod(d),w=t.multiply(t).multiply(t).add(i.multiply(t)).add(a).mod(d);return v.equals(w)},we.prototype.toString=function(){return"("+this.getX().toBigInteger().toString()+","+this.getY().toBigInteger().toString()+")"},we.prototype.validate=function(){var t=this.curve.getQ();if(this.isInfinity())throw new Error("Point is at infinity.");var e=this.getX().toBigInteger(),i=this.getY().toBigInteger();if(e.compareTo(W.ONE)<0||e.compareTo(t.subtract(W.ONE))>0)throw new Error("x coordinate out of bounds");if(i.compareTo(W.ONE)<0||i.compareTo(t.subtract(W.ONE))>0)throw new Error("y coordinate out of bounds");if(!this.isOnCurve())throw new Error("Point is not on the curve.");if(this.multiply(t).isInfinity())throw new Error("Point is not a scalar multiple of G.");return!0};/*! Mike Samuel (c) 2009 | code.google.com/p/json-sans-eval
 */var yi=function(){var t=new RegExp('(?:false|true|null|[\\{\\}\\[\\]]|(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)|(?:"(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))*"))',"g"),e=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),i={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"};function a(w,k,T){return k?i[k]:String.fromCharCode(parseInt(T,16))}var d=new String(""),v=Object.hasOwnProperty;return function(w,k){var T,I,U=w.match(t),D=U[0],B=!1;D==="{"?T={}:D==="["?T=[]:(T=[],B=!0);for(var $=[T],z=1-B,Q=U.length;z<Q;++z){var ee;switch((D=U[z]).charCodeAt(0)){default:(ee=$[0])[I||ee.length]=+D,I=void 0;break;case 34:if((D=D.substring(1,D.length-1)).indexOf("\\")!==-1&&(D=D.replace(e,a)),ee=$[0],!I){if(!(ee instanceof Array)){I=D||d;break}I=ee.length}ee[I]=D,I=void 0;break;case 91:ee=$[0],$.unshift(ee[I||ee.length]=[]),I=void 0;break;case 93:$.shift();break;case 102:(ee=$[0])[I||ee.length]=!1,I=void 0;break;case 110:(ee=$[0])[I||ee.length]=null,I=void 0;break;case 116:(ee=$[0])[I||ee.length]=!0,I=void 0;break;case 123:ee=$[0],$.unshift(ee[I||ee.length]={}),I=void 0;break;case 125:$.shift()}}if(B){if($.length!==1)throw new Error;T=T[0]}else if($.length)throw new Error;return k&&(T=function S(O,N){var K=O[N];if(K&&(K===void 0?"undefined":A(K))==="object"){var Y=null;for(var te in K)if(v.call(K,te)&&K!==O){var de=S(K,te);de!==void 0?K[te]=de:(Y||(Y=[]),Y.push(te))}if(Y)for(var se=Y.length;--se>=0;)delete K[Y[se]]}return k.call(O,N,K)}({"":T},"")),T}}();F!==void 0&&F||(o.KJUR=F={}),F.asn1!==void 0&&F.asn1||(F.asn1={}),F.asn1.ASN1Util=new function(){this.integerToByteHex=function(t){var e=t.toString(16);return e.length%2==1&&(e="0"+e),e},this.bigIntToMinTwosComplementsHex=function(t){var e=t.toString(16);if(e.substr(0,1)!="-")e.length%2==1?e="0"+e:e.match(/^[0-7]/)||(e="00"+e);else{var i=e.substr(1).length;i%2==1?i+=1:e.match(/^[0-7]/)||(i+=2);for(var a="",d=0;d<i;d++)a+="f";e=new W(a,16).xor(t).add(W.ONE).toString(16).replace(/^-/,"")}return e},this.getPEMStringFromHex=function(t,e){return wt(t,e)},this.newObject=function(t){var e=F.asn1,i=e.ASN1Object,a=e.DERBoolean,d=e.DERInteger,v=e.DERBitString,w=e.DEROctetString,k=e.DERNull,T=e.DERObjectIdentifier,I=e.DEREnumerated,U=e.DERUTF8String,D=e.DERNumericString,B=e.DERPrintableString,$=e.DERTeletexString,z=e.DERIA5String,Q=e.DERUTCTime,ee=e.DERGeneralizedTime,S=e.DERVisibleString,O=e.DERBMPString,N=e.DERSequence,K=e.DERSet,Y=e.DERTaggedObject,te=e.ASN1Util.newObject;if(t instanceof e.ASN1Object)return t;var de=Object.keys(t);if(de.length!=1)throw new Error("key of param shall be only one.");var se=de[0];if(":asn1:bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:visstr:bmpstr:seq:set:tag:".indexOf(":"+se+":")==-1)throw new Error("undefined key: "+se);if(se=="bool")return new a(t[se]);if(se=="int")return new d(t[se]);if(se=="bitstr")return new v(t[se]);if(se=="octstr")return new w(t[se]);if(se=="null")return new k(t[se]);if(se=="oid")return new T(t[se]);if(se=="enum")return new I(t[se]);if(se=="utf8str")return new U(t[se]);if(se=="numstr")return new D(t[se]);if(se=="prnstr")return new B(t[se]);if(se=="telstr")return new $(t[se]);if(se=="ia5str")return new z(t[se]);if(se=="utctime")return new Q(t[se]);if(se=="gentime")return new ee(t[se]);if(se=="visstr")return new S(t[se]);if(se=="bmpstr")return new O(t[se]);if(se=="asn1")return new i(t[se]);if(se=="seq"){for(var Se=t[se],ce=[],ge=0;ge<Se.length;ge++){var Ue=te(Se[ge]);ce.push(Ue)}return new N({array:ce})}if(se=="set"){for(Se=t[se],ce=[],ge=0;ge<Se.length;ge++)Ue=te(Se[ge]),ce.push(Ue);return new K({array:ce})}if(se=="tag"){var Ne=t[se];if(Object.prototype.toString.call(Ne)==="[object Array]"&&Ne.length==3){var De=te(Ne[2]);return new Y({tag:Ne[0],explicit:Ne[1],obj:De})}return new Y(Ne)}},this.jsonToASN1HEX=function(t){return this.newObject(t).getEncodedHex()}},F.asn1.ASN1Util.oidHexToInt=function(t){for(var e="",i=parseInt(t.substr(0,2),16),a=(e=Math.floor(i/40)+"."+i%40,""),d=2;d<t.length;d+=2){var v=("00000000"+parseInt(t.substr(d,2),16).toString(2)).slice(-8);a+=v.substr(1,7),v.substr(0,1)=="0"&&(e=e+"."+new W(a,2).toString(10),a="")}return e},F.asn1.ASN1Util.oidIntToHex=function(t){var e=function(T){var I=T.toString(16);return I.length==1&&(I="0"+I),I},i=function(T){var I="",U=new W(T,10).toString(2),D=7-U.length%7;D==7&&(D=0);for(var B="",$=0;$<D;$++)B+="0";for(U=B+U,$=0;$<U.length-1;$+=7){var z=U.substr($,7);$!=U.length-7&&(z="1"+z),I+=e(parseInt(z,2))}return I};if(!t.match(/^[0-9.]+$/))throw"malformed oid string: "+t;var a="",d=t.split("."),v=40*parseInt(d[0])+parseInt(d[1]);a+=e(v),d.splice(0,2);for(var w=0;w<d.length;w++)a+=i(d[w]);return a},F.asn1.ASN1Object=function(t){this.params=null,this.getLengthHexFromValue=function(){if(this.hV===void 0||this.hV==null)throw new Error("this.hV is null or undefined");if(this.hV.length%2==1)throw new Error("value hex must be even length: n="+0+",v="+this.hV);var e=this.hV.length/2,i=e.toString(16);if(i.length%2==1&&(i="0"+i),e<128)return i;var a=i.length/2;if(a>15)throw"ASN.1 length too long to represent by 8x: n = "+e.toString(16);return(128+a).toString(16)+i},this.getEncodedHex=function(){return(this.hTLV==null||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getValueHex=function(){return this.getEncodedHex(),this.hV},this.getFreshValueHex=function(){return""},this.setByParam=function(e){this.params=e},t!=null&&t.tlv!=null&&(this.hTLV=t.tlv,this.isModified=!1)},F.asn1.DERAbstractString=function(t){F.asn1.DERAbstractString.superclass.constructor.call(this),this.getString=function(){return this.s},this.setString=function(e){this.hTLV=null,this.isModified=!0,this.s=e,this.hV=pn(this.s).toLowerCase()},this.setStringHex=function(e){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=e},this.getFreshValueHex=function(){return this.hV},t!==void 0&&(typeof t=="string"?this.setString(t):t.str!==void 0?this.setString(t.str):t.hex!==void 0&&this.setStringHex(t.hex))},Be(F.asn1.DERAbstractString,F.asn1.ASN1Object),F.asn1.DERAbstractTime=function(t){F.asn1.DERAbstractTime.superclass.constructor.call(this),this.localDateToUTC=function(e){var i=e.getTime()+6e4*e.getTimezoneOffset();return new Date(i)},this.formatDate=function(e,i,a){var d=this.zeroPadding,v=this.localDateToUTC(e),w=String(v.getFullYear());i=="utc"&&(w=w.substr(2,2));var k=w+d(String(v.getMonth()+1),2)+d(String(v.getDate()),2)+d(String(v.getHours()),2)+d(String(v.getMinutes()),2)+d(String(v.getSeconds()),2);if(a===!0){var T=v.getMilliseconds();if(T!=0){var I=d(String(T),3);k=k+"."+(I=I.replace(/[0]+$/,""))}}return k+"Z"},this.zeroPadding=function(e,i){return e.length>=i?e:new Array(i-e.length+1).join("0")+e},this.getString=function(){return this.s},this.setString=function(e){this.hTLV=null,this.isModified=!0,this.s=e,this.hV=qt(e)},this.setByDateValue=function(e,i,a,d,v,w){var k=new Date(Date.UTC(e,i-1,a,d,v,w,0));this.setByDate(k)},this.getFreshValueHex=function(){return this.hV}},Be(F.asn1.DERAbstractTime,F.asn1.ASN1Object),F.asn1.DERAbstractStructured=function(t){F.asn1.DERAbstractString.superclass.constructor.call(this),this.setByASN1ObjectArray=function(e){this.hTLV=null,this.isModified=!0,this.asn1Array=e},this.appendASN1Object=function(e){this.hTLV=null,this.isModified=!0,this.asn1Array.push(e)},this.asn1Array=new Array,t!==void 0&&t.array!==void 0&&(this.asn1Array=t.array)},Be(F.asn1.DERAbstractStructured,F.asn1.ASN1Object),F.asn1.DERBoolean=function(t){F.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",this.hTLV=t==0?"010100":"0101ff"},Be(F.asn1.DERBoolean,F.asn1.ASN1Object),F.asn1.DERInteger=function(t){F.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.setByBigInteger=function(e){this.hTLV=null,this.isModified=!0,this.hV=F.asn1.ASN1Util.bigIntToMinTwosComplementsHex(e)},this.setByInteger=function(e){var i=new W(String(e),10);this.setByBigInteger(i)},this.setValueHex=function(e){this.hV=e},this.getFreshValueHex=function(){return this.hV},t!==void 0&&(t.bigint!==void 0?this.setByBigInteger(t.bigint):t.int!==void 0?this.setByInteger(t.int):typeof t=="number"?this.setByInteger(t):t.hex!==void 0&&this.setValueHex(t.hex))},Be(F.asn1.DERInteger,F.asn1.ASN1Object),F.asn1.DERBitString=function(t){if(t!==void 0&&t.obj!==void 0){var e=F.asn1.ASN1Util.newObject(t.obj);t.hex="00"+e.getEncodedHex()}F.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(i){this.hTLV=null,this.isModified=!0,this.hV=i},this.setUnusedBitsAndHexValue=function(i,a){if(i<0||7<i)throw"unused bits shall be from 0 to 7: u = "+i;var d="0"+i;this.hTLV=null,this.isModified=!0,this.hV=d+a},this.setByBinaryString=function(i){var a=8-(i=i.replace(/0+$/,"")).length%8;a==8&&(a=0);for(var d=0;d<=a;d++)i+="0";var v="";for(d=0;d<i.length-1;d+=8){var w=i.substr(d,8),k=parseInt(w,2).toString(16);k.length==1&&(k="0"+k),v+=k}this.hTLV=null,this.isModified=!0,this.hV="0"+a+v},this.setByBooleanArray=function(i){for(var a="",d=0;d<i.length;d++)i[d]==1?a+="1":a+="0";this.setByBinaryString(a)},this.newFalseArray=function(i){for(var a=new Array(i),d=0;d<i;d++)a[d]=!1;return a},this.getFreshValueHex=function(){return this.hV},t!==void 0&&(typeof t=="string"&&t.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(t):t.hex!==void 0?this.setHexValueIncludingUnusedBits(t.hex):t.bin!==void 0?this.setByBinaryString(t.bin):t.array!==void 0&&this.setByBooleanArray(t.array))},Be(F.asn1.DERBitString,F.asn1.ASN1Object),F.asn1.DEROctetString=function(t){if(t!==void 0&&t.obj!==void 0){var e=F.asn1.ASN1Util.newObject(t.obj);t.hex=e.getEncodedHex()}F.asn1.DEROctetString.superclass.constructor.call(this,t),this.hT="04"},Be(F.asn1.DEROctetString,F.asn1.DERAbstractString),F.asn1.DERNull=function(){F.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},Be(F.asn1.DERNull,F.asn1.ASN1Object),F.asn1.DERObjectIdentifier=function(t){F.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(e){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=e},this.setValueOidString=function(e){var i=function(d){var v=function(B){var $=B.toString(16);return $.length==1&&($="0"+$),$},w=function(B){var $="",z=parseInt(B,10).toString(2),Q=7-z.length%7;Q==7&&(Q=0);for(var ee="",S=0;S<Q;S++)ee+="0";for(z=ee+z,S=0;S<z.length-1;S+=7){var O=z.substr(S,7);S!=z.length-7&&(O="1"+O),$+=v(parseInt(O,2))}return $};try{if(!d.match(/^[0-9.]+$/))return null;var k="",T=d.split("."),I=40*parseInt(T[0],10)+parseInt(T[1],10);k+=v(I),T.splice(0,2);for(var U=0;U<T.length;U++)k+=w(T[U]);return k}catch{return null}}(e);if(i==null)throw new Error("malformed oid string: "+e);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=i},this.setValueName=function(e){var i=F.asn1.x509.OID.name2oid(e);if(i==="")throw new Error("DERObjectIdentifier oidName undefined: "+e);this.setValueOidString(i)},this.setValueNameOrOid=function(e){e.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(e):this.setValueName(e)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(e){typeof e=="string"?this.setValueNameOrOid(e):e.oid!==void 0?this.setValueNameOrOid(e.oid):e.name!==void 0?this.setValueNameOrOid(e.name):e.hex!==void 0&&this.setValueHex(e.hex)},t!==void 0&&this.setByParam(t)},Be(F.asn1.DERObjectIdentifier,F.asn1.ASN1Object),F.asn1.DEREnumerated=function(t){F.asn1.DEREnumerated.superclass.constructor.call(this),this.hT="0a",this.setByBigInteger=function(e){this.hTLV=null,this.isModified=!0,this.hV=F.asn1.ASN1Util.bigIntToMinTwosComplementsHex(e)},this.setByInteger=function(e){var i=new W(String(e),10);this.setByBigInteger(i)},this.setValueHex=function(e){this.hV=e},this.getFreshValueHex=function(){return this.hV},t!==void 0&&(t.int!==void 0?this.setByInteger(t.int):typeof t=="number"?this.setByInteger(t):t.hex!==void 0&&this.setValueHex(t.hex))},Be(F.asn1.DEREnumerated,F.asn1.ASN1Object),F.asn1.DERUTF8String=function(t){F.asn1.DERUTF8String.superclass.constructor.call(this,t),this.hT="0c"},Be(F.asn1.DERUTF8String,F.asn1.DERAbstractString),F.asn1.DERNumericString=function(t){F.asn1.DERNumericString.superclass.constructor.call(this,t),this.hT="12"},Be(F.asn1.DERNumericString,F.asn1.DERAbstractString),F.asn1.DERPrintableString=function(t){F.asn1.DERPrintableString.superclass.constructor.call(this,t),this.hT="13"},Be(F.asn1.DERPrintableString,F.asn1.DERAbstractString),F.asn1.DERTeletexString=function(t){F.asn1.DERTeletexString.superclass.constructor.call(this,t),this.hT="14"},Be(F.asn1.DERTeletexString,F.asn1.DERAbstractString),F.asn1.DERIA5String=function(t){F.asn1.DERIA5String.superclass.constructor.call(this,t),this.hT="16"},Be(F.asn1.DERIA5String,F.asn1.DERAbstractString),F.asn1.DERVisibleString=function(t){F.asn1.DERIA5String.superclass.constructor.call(this,t),this.hT="1a"},Be(F.asn1.DERVisibleString,F.asn1.DERAbstractString),F.asn1.DERBMPString=function(t){F.asn1.DERBMPString.superclass.constructor.call(this,t),this.hT="1e"},Be(F.asn1.DERBMPString,F.asn1.DERAbstractString),F.asn1.DERUTCTime=function(t){F.asn1.DERUTCTime.superclass.constructor.call(this,t),this.hT="17",this.setByDate=function(e){this.hTLV=null,this.isModified=!0,this.date=e,this.s=this.formatDate(this.date,"utc"),this.hV=qt(this.s)},this.getFreshValueHex=function(){return this.date===void 0&&this.s===void 0&&(this.date=new Date,this.s=this.formatDate(this.date,"utc"),this.hV=qt(this.s)),this.hV},t!==void 0&&(t.str!==void 0?this.setString(t.str):typeof t=="string"&&t.match(/^[0-9]{12}Z$/)?this.setString(t):t.hex!==void 0?this.setStringHex(t.hex):t.date!==void 0&&this.setByDate(t.date))},Be(F.asn1.DERUTCTime,F.asn1.DERAbstractTime),F.asn1.DERGeneralizedTime=function(t){F.asn1.DERGeneralizedTime.superclass.constructor.call(this,t),this.hT="18",this.withMillis=!1,this.setByDate=function(e){this.hTLV=null,this.isModified=!0,this.date=e,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=qt(this.s)},this.getFreshValueHex=function(){return this.date===void 0&&this.s===void 0&&(this.date=new Date,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=qt(this.s)),this.hV},t!==void 0&&(t.str!==void 0?this.setString(t.str):typeof t=="string"&&t.match(/^[0-9]{14}Z$/)?this.setString(t):t.hex!==void 0?this.setStringHex(t.hex):t.date!==void 0&&this.setByDate(t.date),t.millis===!0&&(this.withMillis=!0))},Be(F.asn1.DERGeneralizedTime,F.asn1.DERAbstractTime),F.asn1.DERSequence=function(t){F.asn1.DERSequence.superclass.constructor.call(this,t),this.hT="30",this.getFreshValueHex=function(){for(var e="",i=0;i<this.asn1Array.length;i++)e+=this.asn1Array[i].getEncodedHex();return this.hV=e,this.hV}},Be(F.asn1.DERSequence,F.asn1.DERAbstractStructured),F.asn1.DERSet=function(t){F.asn1.DERSet.superclass.constructor.call(this,t),this.hT="31",this.sortFlag=!0,this.getFreshValueHex=function(){for(var e=new Array,i=0;i<this.asn1Array.length;i++){var a=this.asn1Array[i];e.push(a.getEncodedHex())}return this.sortFlag==1&&e.sort(),this.hV=e.join(""),this.hV},t!==void 0&&t.sortflag!==void 0&&t.sortflag==0&&(this.sortFlag=!1)},Be(F.asn1.DERSet,F.asn1.DERAbstractStructured),F.asn1.DERTaggedObject=function(t){F.asn1.DERTaggedObject.superclass.constructor.call(this);var e=F.asn1;this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.setASN1Object=function(i,a,d){this.hT=a,this.isExplicit=i,this.asn1Object=d,this.isExplicit?(this.hV=this.asn1Object.getEncodedHex(),this.hTLV=null,this.isModified=!0):(this.hV=null,this.hTLV=d.getEncodedHex(),this.hTLV=this.hTLV.replace(/^../,a),this.isModified=!1)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(i){i.tag!=null&&(this.hT=i.tag),i.explicit!=null&&(this.isExplicit=i.explicit),i.tage!=null&&(this.hT=i.tage,this.isExplicit=!0),i.tagi!=null&&(this.hT=i.tagi,this.isExplicit=!1),i.obj!=null&&(i.obj instanceof e.ASN1Object?(this.asn1Object=i.obj,this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)):A(i.obj)=="object"&&(this.asn1Object=e.ASN1Util.newObject(i.obj),this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)))},t!=null&&this.setByParam(t)},Be(F.asn1.DERTaggedObject,F.asn1.ASN1Object);var F,mr,Dt,ue=new function(){};function vi(t){for(var e=new Array,i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e}function mi(t){for(var e="",i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return e}function Ur(t){for(var e="",i=0;i<t.length;i++){var a=t[i].toString(16);a.length==1&&(a="0"+a),e+=a}return e}function qt(t){return Ur(vi(t))}function Or(t){return t=(t=(t=t.replace(/\=/g,"")).replace(/\+/g,"-")).replace(/\//g,"_")}function _r(t){return t.length%4==2?t+="==":t.length%4==3&&(t+="="),t=(t=t.replace(/-/g,"+")).replace(/_/g,"/")}function ze(t){return t.length%2==1&&(t="0"+t),Or(j(t))}function Oe(t){return ne(_r(t))}function pn(t){return Dr(Nr(t))}function Ye(t){return decodeURIComponent(Hr(t))}function Rt(t){for(var e="",i=0;i<t.length-1;i+=2)e+=String.fromCharCode(parseInt(t.substr(i,2),16));return e}function Mt(t){for(var e="",i=0;i<t.length;i++)e+=("0"+t.charCodeAt(i).toString(16)).slice(-2);return e}function _i(t){return j(t)}function Si(t){var e=_i(t).replace(/(.{64})/g,`$1\r
`);return e=e.replace(/\r\n$/,"")}function wi(t){return ne(t.replace(/[^0-9A-Za-z\/+=]*/g,""))}function wt(t,e){return"-----BEGIN "+e+`-----\r
`+Si(t)+`\r
-----END `+e+`-----\r
`}function Kt(t,e){if(t.indexOf("-----BEGIN ")==-1)throw"can't find PEM header: "+e;return wi(t=e!==void 0?(t=t.replace(new RegExp("^[^]*-----BEGIN "+e+"-----"),"")).replace(new RegExp("-----END "+e+"-----[^]*$"),""):(t=t.replace(/^[^]*-----BEGIN [^-]+-----/,"")).replace(/-----END [^-]+-----[^]*$/,""))}function gn(t){var e,i,a,d,v,w,k,T,I,U,D;if(D=t.match(/^(\d{2}|\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(|\.\d+)Z$/))return T=D[1],e=parseInt(T),T.length===2&&(50<=e&&e<100?e=1900+e:0<=e&&e<50&&(e=2e3+e)),i=parseInt(D[2])-1,a=parseInt(D[3]),d=parseInt(D[4]),v=parseInt(D[5]),w=parseInt(D[6]),k=0,(I=D[7])!==""&&(U=(I.substr(1)+"00").substr(0,3),k=parseInt(U)),Date.UTC(e,i,a,d,v,w,k);throw"unsupported zulu format: "+t}function Ei(t){return~~(gn(t)/1e3)}function Dr(t){return t.replace(/%/g,"")}function Hr(t){return t.replace(/(..)/g,"%$1")}function bi(t){var e="malformed IPv6 address";if(!t.match(/^[0-9A-Fa-f:]+$/))throw e;var i=(t=t.toLowerCase()).split(":").length-1;if(i<2)throw e;var a=":".repeat(7-i+2),d=(t=t.replace("::",a)).split(":");if(d.length!=8)throw e;for(var v=0;v<8;v++)d[v]=("0000"+d[v]).slice(-4);return d.join("")}function Fi(t){if(!t.match(/^[0-9A-Fa-f]{32}$/))throw"malformed IPv6 address octet";for(var e=(t=t.toLowerCase()).match(/.{1,4}/g),i=0;i<8;i++)e[i]=e[i].replace(/^0+/,""),e[i]==""&&(e[i]="0");var a=(t=":"+e.join(":")+":").match(/:(0:){2,}/g);if(a===null)return t.slice(1,-1);var d="";for(i=0;i<a.length;i++)a[i].length>d.length&&(d=a[i]);return(t=t.replace(d,"::")).slice(1,-1)}function yn(t){var e="malformed hex value";if(!t.match(/^([0-9A-Fa-f][0-9A-Fa-f]){1,}$/))throw e;if(t.length!=8)return t.length==32?Fi(t):t;try{return parseInt(t.substr(0,2),16)+"."+parseInt(t.substr(2,2),16)+"."+parseInt(t.substr(4,2),16)+"."+parseInt(t.substr(6,2),16)}catch{throw e}}function Ai(t){return t.match(/.{4}/g).map(function(i){var a=parseInt(i.substr(0,2),16),d=parseInt(i.substr(2),16);if(a==0&d<128)return String.fromCharCode(d);if(a<8){var v=128|63&d;return Ye((192|(7&a)<<3|(192&d)>>6).toString(16)+v.toString(16))}v=128|(15&a)<<2|(192&d)>>6;var w=128|63&d;return Ye((224|(240&a)>>4).toString(16)+v.toString(16)+w.toString(16))}).join("")}function Nr(t){for(var e=encodeURIComponent(t),i="",a=0;a<e.length;a++)e[a]=="%"?(i+=e.substr(a,3),a+=2):i=i+"%"+qt(e[a]);return i}function Pi(t){return!(t.length%2!=0||!t.match(/^[0-9a-f]+$/)&&!t.match(/^[0-9A-F]+$/))}function vn(t){return t.length%2==1?"0"+t:t.substr(0,1)>"7"?"00"+t:t}ue.getLblen=function(t,e){if(t.substr(e+2,1)!="8")return 1;var i=parseInt(t.substr(e+3,1));return i==0?-1:0<i&&i<10?i+1:-2},ue.getL=function(t,e){var i=ue.getLblen(t,e);return i<1?"":t.substr(e+2,2*i)},ue.getVblen=function(t,e){var i;return(i=ue.getL(t,e))==""?-1:(i.substr(0,1)==="8"?new W(i.substr(2),16):new W(i,16)).intValue()},ue.getVidx=function(t,e){var i=ue.getLblen(t,e);return i<0?i:e+2*(i+1)},ue.getV=function(t,e){var i=ue.getVidx(t,e),a=ue.getVblen(t,e);return t.substr(i,2*a)},ue.getTLV=function(t,e){return t.substr(e,2)+ue.getL(t,e)+ue.getV(t,e)},ue.getTLVblen=function(t,e){return 2+2*ue.getLblen(t,e)+2*ue.getVblen(t,e)},ue.getNextSiblingIdx=function(t,e){return ue.getVidx(t,e)+2*ue.getVblen(t,e)},ue.getChildIdx=function(t,e){var i,a,d,v=ue,w=[];i=v.getVidx(t,e),a=2*v.getVblen(t,e),t.substr(e,2)=="03"&&(i+=2,a-=2),d=0;for(var k=i;d<=a;){var T=v.getTLVblen(t,k);if((d+=T)<=a&&w.push(k),k+=T,d>=a)break}return w},ue.getNthChildIdx=function(t,e,i){return ue.getChildIdx(t,e)[i]},ue.getIdxbyList=function(t,e,i,a){var d,v,w=ue;return i.length==0?a!==void 0&&t.substr(e,2)!==a?-1:e:(d=i.shift())>=(v=w.getChildIdx(t,e)).length?-1:w.getIdxbyList(t,v[d],i,a)},ue.getIdxbyListEx=function(t,e,i,a){var d,v,w=ue;if(i.length==0)return a!==void 0&&t.substr(e,2)!==a?-1:e;d=i.shift(),v=w.getChildIdx(t,e);for(var k=0,T=0;T<v.length;T++){var I=t.substr(v[T],2);if(typeof d=="number"&&!w.isContextTag(I)&&k==d||typeof d=="string"&&w.isContextTag(I,d))return w.getIdxbyListEx(t,v[T],i,a);w.isContextTag(I)||k++}return-1},ue.getTLVbyList=function(t,e,i,a){var d=ue,v=d.getIdxbyList(t,e,i,a);return v==-1||v>=t.length?null:d.getTLV(t,v)},ue.getTLVbyListEx=function(t,e,i,a){var d=ue,v=d.getIdxbyListEx(t,e,i,a);return v==-1?null:d.getTLV(t,v)},ue.getVbyList=function(t,e,i,a,d){var v,w,k=ue;return(v=k.getIdxbyList(t,e,i,a))==-1||v>=t.length?null:(w=k.getV(t,v),d===!0&&(w=w.substr(2)),w)},ue.getVbyListEx=function(t,e,i,a,d){var v,w,k=ue;return(v=k.getIdxbyListEx(t,e,i,a))==-1?null:(w=k.getV(t,v),t.substr(v,2)=="03"&&d!==!1&&(w=w.substr(2)),w)},ue.getInt=function(t,e,i){i==null&&(i=-1);try{var a=t.substr(e,2);if(a!="02"&&a!="03")return i;var d=ue.getV(t,e);return a=="02"?parseInt(d,16):function(w){try{var k=w.substr(0,2);if(k=="00")return parseInt(w.substr(2),16);var T=parseInt(k,16),I=w.substr(2),U=parseInt(I,16).toString(2);return U=="0"&&(U="00000000"),U=U.slice(0,0-T),parseInt(U,2)}catch{return-1}}(d)}catch{return i}},ue.getOID=function(t,e,i){i==null&&(i=null);try{return t.substr(e,2)!="06"?i:function(d){if(!Pi(d))return null;try{var v=[],w=d.substr(0,2),k=parseInt(w,16);v[0]=new String(Math.floor(k/40)),v[1]=new String(k%40);for(var T=d.substr(2),I=[],U=0;U<T.length/2;U++)I.push(parseInt(T.substr(2*U,2),16));var D=[],B="";for(U=0;U<I.length;U++)128&I[U]?B+=Ti((127&I[U]).toString(2),7):(B+=Ti((127&I[U]).toString(2),7),D.push(new String(parseInt(B,2))),B="");var $=v.join(".");return D.length>0&&($=$+"."+D.join(".")),$}catch{return null}}(ue.getV(t,e))}catch{return i}},ue.getOIDName=function(t,e,i){i==null&&(i=null);try{var a=ue.getOID(t,e,i);if(a==i)return i;var d=F.asn1.x509.OID.oid2name(a);return d==""?a:d}catch{return i}},ue.getString=function(t,e,i){i==null&&(i=null);try{return Rt(ue.getV(t,e))}catch{return i}},ue.hextooidstr=function(t){var e=function(B,$){return B.length>=$?B:new Array($-B.length+1).join("0")+B},i=[],a=t.substr(0,2),d=parseInt(a,16);i[0]=new String(Math.floor(d/40)),i[1]=new String(d%40);for(var v=t.substr(2),w=[],k=0;k<v.length/2;k++)w.push(parseInt(v.substr(2*k,2),16));var T=[],I="";for(k=0;k<w.length;k++)128&w[k]?I+=e((127&w[k]).toString(2),7):(I+=e((127&w[k]).toString(2),7),T.push(new String(parseInt(I,2))),I="");var U=i.join(".");return T.length>0&&(U=U+"."+T.join(".")),U},ue.dump=function(t,e,i,a){var d=ue,v=d.getV,w=d.dump,k=d.getChildIdx,T=t;t instanceof F.asn1.ASN1Object&&(T=t.getEncodedHex());var I=function(se,Se){return se.length<=2*Se?se:se.substr(0,Se)+"..(total "+se.length/2+"bytes).."+se.substr(se.length-Se,Se)};e===void 0&&(e={ommit_long_octet:32}),i===void 0&&(i=0),a===void 0&&(a="");var U,D=e.ommit_long_octet;if((U=T.substr(i,2))=="01")return(B=v(T,i))=="00"?a+`BOOLEAN FALSE
`:a+`BOOLEAN TRUE
`;if(U=="02")return a+"INTEGER "+I(B=v(T,i),D)+`
`;if(U=="03"){var B=v(T,i);if(d.isASN1HEX(B.substr(2))){var $=a+`BITSTRING, encapsulates
`;return $+=w(B.substr(2),e,0,a+"  ")}return a+"BITSTRING "+I(B,D)+`
`}if(U=="04")return B=v(T,i),d.isASN1HEX(B)?($=a+`OCTETSTRING, encapsulates
`,$+=w(B,e,0,a+"  ")):a+"OCTETSTRING "+I(B,D)+`
`;if(U=="05")return a+`NULL
`;if(U=="06"){var z=v(T,i),Q=F.asn1.ASN1Util.oidHexToInt(z),ee=F.asn1.x509.OID.oid2name(Q),S=Q.replace(/\./g," ");return ee!=""?a+"ObjectIdentifier "+ee+" ("+S+`)
`:a+"ObjectIdentifier ("+S+`)
`}if(U=="0a")return a+"ENUMERATED "+parseInt(v(T,i))+`
`;if(U=="0c")return a+"UTF8String '"+Ye(v(T,i))+`'
`;if(U=="13")return a+"PrintableString '"+Ye(v(T,i))+`'
`;if(U=="14")return a+"TeletexString '"+Ye(v(T,i))+`'
`;if(U=="16")return a+"IA5String '"+Ye(v(T,i))+`'
`;if(U=="17")return a+"UTCTime "+Ye(v(T,i))+`
`;if(U=="18")return a+"GeneralizedTime "+Ye(v(T,i))+`
`;if(U=="1a")return a+"VisualString '"+Ye(v(T,i))+`'
`;if(U=="1e")return a+"BMPString '"+Ai(v(T,i))+`'
`;if(U=="30"){if(T.substr(i,4)=="3000")return a+`SEQUENCE {}
`;$=a+`SEQUENCE
`;var O=e;if(((Y=k(T,i)).length==2||Y.length==3)&&T.substr(Y[0],2)=="06"&&T.substr(Y[Y.length-1],2)=="04"){ee=d.oidname(v(T,Y[0]));var N=JSON.parse(JSON.stringify(e));N.x509ExtName=ee,O=N}for(var K=0;K<Y.length;K++)$+=w(T,O,Y[K],a+"  ");return $}if(U=="31"){$=a+`SET
`;var Y=k(T,i);for(K=0;K<Y.length;K++)$+=w(T,e,Y[K],a+"  ");return $}if((128&(U=parseInt(U,16)))!=0){var te=31&U;if((32&U)!=0){for($=a+"["+te+`]
`,Y=k(T,i),K=0;K<Y.length;K++)$+=w(T,e,Y[K],a+"  ");return $}if(B=v(T,i),ue.isASN1HEX(B)){var $=a+"["+te+`]
`;return $+=w(B,e,0,a+"  ")}return(B.substr(0,8)=="68747470"||e.x509ExtName==="subjectAltName"&&te==2)&&(B=Ye(B)),$=a+"["+te+"] "+B+`
`}return a+"UNKNOWN("+U+") "+v(T,i)+`
`},ue.isContextTag=function(t,e){var i,a;t=t.toLowerCase();try{i=parseInt(t,16)}catch{return-1}if(e===void 0)return(192&i)==128;try{return e.match(/^\[[0-9]+\]$/)!=null&&!((a=parseInt(e.substr(1,e.length-1),10))>31)&&(192&i)==128&&(31&i)==a}catch{return!1}},ue.isASN1HEX=function(t){var e=ue;if(t.length%2==1)return!1;var i=e.getVblen(t,0),a=t.substr(0,2),d=e.getL(t,0);return t.length-a.length-d.length==2*i},ue.checkStrictDER=function(t,e,i,a,d){var v=ue;if(i===void 0){if(typeof t!="string")throw new Error("not hex string");if(t=t.toLowerCase(),!F.lang.String.isHex(t))throw new Error("not hex string");i=t.length,d=(a=t.length/2)<128?1:Math.ceil(a.toString(16))+1}if(v.getL(t,e).length>2*d)throw new Error("L of TLV too long: idx="+e);var w=v.getVblen(t,e);if(w>a)throw new Error("value of L too long than hex: idx="+e);var k=v.getTLV(t,e),T=k.length-2-v.getL(t,e).length;if(T!==2*w)throw new Error("V string length and L's value not the same:"+T+"/"+2*w);if(e===0&&t.length!=k.length)throw new Error("total length and TLV length unmatch:"+t.length+"!="+k.length);var I=t.substr(e,2);if(I==="02"){var U=v.getVidx(t,e);if(t.substr(U,2)=="00"&&t.charCodeAt(U+2)<56)throw new Error("not least zeros for DER INTEGER")}if(32&parseInt(I,16)){for(var D=v.getVblen(t,e),B=0,$=v.getChildIdx(t,e),z=0;z<$.length;z++)B+=v.getTLV(t,$[z]).length,v.checkStrictDER(t,$[z],i,a,d);if(2*D!=B)throw new Error("sum of children's TLV length and L unmatch: "+2*D+"!="+B)}},ue.oidname=function(t){var e=F.asn1;F.lang.String.isHex(t)&&(t=e.ASN1Util.oidHexToInt(t));var i=e.x509.OID.oid2name(t);return i===""&&(i=t),i},F!==void 0&&F||(o.KJUR=F={}),F.lang!==void 0&&F.lang||(F.lang={}),F.lang.String=function(){},typeof l=="function"?(o.utf8tob64u=mr=function(e){return Or(l.from(e,"utf8").toString("base64"))},o.b64utoutf8=Dt=function(e){return l.from(_r(e),"base64").toString("utf8")}):(o.utf8tob64u=mr=function(e){return ze(Dr(Nr(e)))},o.b64utoutf8=Dt=function(e){return decodeURIComponent(Hr(Oe(e)))}),F.lang.String.isInteger=function(t){return!!t.match(/^[0-9]+$/)||!!t.match(/^-[0-9]+$/)},F.lang.String.isHex=function(t){return Pi(t)},F.lang.String.isBase64=function(t){return!(!(t=t.replace(/\s+/g,"")).match(/^[0-9A-Za-z+\/]+={0,3}$/)||t.length%4!=0)},F.lang.String.isBase64URL=function(t){return!t.match(/[+/=]/)&&(t=_r(t),F.lang.String.isBase64(t))},F.lang.String.isIntegerArray=function(t){return!!(t=t.replace(/\s+/g,"")).match(/^\[[0-9,]+\]$/)},F.lang.String.isPrintable=function(t){return t.match(/^[0-9A-Za-z '()+,-./:=?]*$/)!==null},F.lang.String.isIA5=function(t){return t.match(/^[\x20-\x21\x23-\x7f]*$/)!==null},F.lang.String.isMail=function(t){return t.match(/^[A-Za-z0-9]{1}[A-Za-z0-9_.-]*@{1}[A-Za-z0-9_.-]{1,}\.[A-Za-z0-9]{1,}$/)!==null};var Ti=function(e,i,a){return a==null&&(a="0"),e.length>=i?e:new Array(i-e.length+1).join(a)+e};function Be(t,e){var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t,t.superclass=e.prototype,e.prototype.constructor==Object.prototype.constructor&&(e.prototype.constructor=e)}F!==void 0&&F||(o.KJUR=F={}),F.crypto!==void 0&&F.crypto||(F.crypto={}),F.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHAwithRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:M.algo.MD5,sha1:M.algo.SHA1,sha224:M.algo.SHA224,sha256:M.algo.SHA256,sha384:M.algo.SHA384,sha512:M.algo.SHA512,ripemd160:M.algo.RIPEMD160},this.getDigestInfoHex=function(t,e){if(this.DIGESTINFOHEAD[e]===void 0)throw"alg not supported in Util.DIGESTINFOHEAD: "+e;return this.DIGESTINFOHEAD[e]+t},this.getPaddedDigestInfoHex=function(t,e,i){var a=this.getDigestInfoHex(t,e),d=i/4;if(a.length+22>d)throw"key is too short for SigAlg: keylen="+i+","+e;for(var v="0001",w="00"+a,k="",T=d-v.length-w.length,I=0;I<T;I+=2)k+="ff";return v+k+w},this.hashString=function(t,e){return new F.crypto.MessageDigest({alg:e}).digestString(t)},this.hashHex=function(t,e){return new F.crypto.MessageDigest({alg:e}).digestHex(t)},this.sha1=function(t){return this.hashString(t,"sha1")},this.sha256=function(t){return this.hashString(t,"sha256")},this.sha256Hex=function(t){return this.hashHex(t,"sha256")},this.sha512=function(t){return this.hashString(t,"sha512")},this.sha512Hex=function(t){return this.hashHex(t,"sha512")},this.isKey=function(t){return t instanceof fe||t instanceof F.crypto.DSA||t instanceof F.crypto.ECDSA}},F.crypto.Util.md5=function(t){return new F.crypto.MessageDigest({alg:"md5",prov:"cryptojs"}).digestString(t)},F.crypto.Util.ripemd160=function(t){return new F.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"}).digestString(t)},F.crypto.Util.SECURERANDOMGEN=new Re,F.crypto.Util.getRandomHexOfNbytes=function(t){var e=new Array(t);return F.crypto.Util.SECURERANDOMGEN.nextBytes(e),Ur(e)},F.crypto.Util.getRandomBigIntegerOfNbytes=function(t){return new W(F.crypto.Util.getRandomHexOfNbytes(t),16)},F.crypto.Util.getRandomHexOfNbits=function(t){var e=t%8,i=new Array((t-e)/8+1);return F.crypto.Util.SECURERANDOMGEN.nextBytes(i),i[0]=(255<<e&255^255)&i[0],Ur(i)},F.crypto.Util.getRandomBigIntegerOfNbits=function(t){return new W(F.crypto.Util.getRandomHexOfNbits(t),16)},F.crypto.Util.getRandomBigIntegerZeroToMax=function(t){for(var e=t.bitLength();;){var i=F.crypto.Util.getRandomBigIntegerOfNbits(e);if(t.compareTo(i)!=-1)return i}},F.crypto.Util.getRandomBigIntegerMinToMax=function(t,e){var i=t.compareTo(e);if(i==1)throw"biMin is greater than biMax";if(i==0)return t;var a=e.subtract(t);return F.crypto.Util.getRandomBigIntegerZeroToMax(a).add(t)},F.crypto.MessageDigest=function(t){this.setAlgAndProvider=function(e,i){if((e=F.crypto.MessageDigest.getCanonicalAlgName(e))!==null&&i===void 0&&(i=F.crypto.Util.DEFAULTPROVIDER[e]),":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(e)!=-1&&i=="cryptojs"){try{this.md=F.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[e].create()}catch(a){throw"setAlgAndProvider hash alg set fail alg="+e+"/"+a}this.updateString=function(a){this.md.update(a)},this.updateHex=function(a){var d=M.enc.Hex.parse(a);this.md.update(d)},this.digest=function(){return this.md.finalize().toString(M.enc.Hex)},this.digestString=function(a){return this.updateString(a),this.digest()},this.digestHex=function(a){return this.updateHex(a),this.digest()}}if(":sha256:".indexOf(e)!=-1&&i=="sjcl"){try{this.md=new sjcl.hash.sha256}catch(a){throw"setAlgAndProvider hash alg set fail alg="+e+"/"+a}this.updateString=function(a){this.md.update(a)},this.updateHex=function(a){var d=sjcl.codec.hex.toBits(a);this.md.update(d)},this.digest=function(){var a=this.md.finalize();return sjcl.codec.hex.fromBits(a)},this.digestString=function(a){return this.updateString(a),this.digest()},this.digestHex=function(a){return this.updateHex(a),this.digest()}}},this.updateString=function(e){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(e){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(e){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(e){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},t!==void 0&&t.alg!==void 0&&(this.algName=t.alg,t.prov===void 0&&(this.provName=F.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))},F.crypto.MessageDigest.getCanonicalAlgName=function(t){return typeof t=="string"&&(t=(t=t.toLowerCase()).replace(/-/,"")),t},F.crypto.MessageDigest.getHashLength=function(t){var e=F.crypto.MessageDigest,i=e.getCanonicalAlgName(t);if(e.HASHLENGTH[i]===void 0)throw"not supported algorithm: "+t;return e.HASHLENGTH[i]},F.crypto.MessageDigest.HASHLENGTH={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,ripemd160:20},F.crypto.Mac=function(t){this.setAlgAndProvider=function(e,i){if((e=e.toLowerCase())==null&&(e="hmacsha1"),(e=e.toLowerCase()).substr(0,4)!="hmac")throw"setAlgAndProvider unsupported HMAC alg: "+e;i===void 0&&(i=F.crypto.Util.DEFAULTPROVIDER[e]),this.algProv=e+"/"+i;var a=e.substr(4);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(a)!=-1&&i=="cryptojs"){try{var d=F.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[a];this.mac=M.algo.HMAC.create(d,this.pass)}catch(v){throw"setAlgAndProvider hash alg set fail hashAlg="+a+"/"+v}this.updateString=function(v){this.mac.update(v)},this.updateHex=function(v){var w=M.enc.Hex.parse(v);this.mac.update(w)},this.doFinal=function(){return this.mac.finalize().toString(M.enc.Hex)},this.doFinalString=function(v){return this.updateString(v),this.doFinal()},this.doFinalHex=function(v){return this.updateHex(v),this.doFinal()}}},this.updateString=function(e){throw"updateString(str) not supported for this alg/prov: "+this.algProv},this.updateHex=function(e){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv},this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv},this.doFinalString=function(e){throw"digestString(str) not supported for this alg/prov: "+this.algProv},this.doFinalHex=function(e){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv},this.setPassword=function(e){if(typeof e=="string"){var i=e;return e.length%2!=1&&e.match(/^[0-9A-Fa-f]+$/)||(i=Mt(e)),void(this.pass=M.enc.Hex.parse(i))}if((e===void 0?"undefined":A(e))!="object")throw"KJUR.crypto.Mac unsupported password type: "+e;if(i=null,e.hex!==void 0){if(e.hex.length%2!=0||!e.hex.match(/^[0-9A-Fa-f]+$/))throw"Mac: wrong hex password: "+e.hex;i=e.hex}if(e.utf8!==void 0&&(i=pn(e.utf8)),e.rstr!==void 0&&(i=Mt(e.rstr)),e.b64!==void 0&&(i=ne(e.b64)),e.b64u!==void 0&&(i=Oe(e.b64u)),i==null)throw"KJUR.crypto.Mac unsupported password type: "+e;this.pass=M.enc.Hex.parse(i)},t!==void 0&&(t.pass!==void 0&&this.setPassword(t.pass),t.alg!==void 0&&(this.algName=t.alg,t.prov===void 0&&(this.provName=F.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))},F.crypto.Signature=function(t){var e=null;if(this._setAlgNames=function(){var i=this.algName.match(/^(.+)with(.+)$/);i&&(this.mdAlgName=i[1].toLowerCase(),this.pubkeyAlgName=i[2].toLowerCase(),this.pubkeyAlgName=="rsaandmgf1"&&this.mdAlgName=="sha"&&(this.mdAlgName="sha1"))},this._zeroPaddingOfSignature=function(i,a){for(var d="",v=a/4-i.length,w=0;w<v;w++)d+="0";return d+i},this.setAlgAndProvider=function(i,a){if(this._setAlgNames(),a!="cryptojs/jsrsa")throw new Error("provider not supported: "+a);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)!=-1){try{this.md=new F.crypto.MessageDigest({alg:this.mdAlgName})}catch(d){throw new Error("setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+d)}this.init=function(d,v){var w=null;try{w=v===void 0?qe.getKey(d):qe.getKey(d,v)}catch(k){throw"init failed:"+k}if(w.isPrivate===!0)this.prvKey=w,this.state="SIGN";else{if(w.isPublic!==!0)throw"init failed.:"+w;this.pubKey=w,this.state="VERIFY"}},this.updateString=function(d){this.md.updateString(d)},this.updateHex=function(d){this.md.updateHex(d)},this.sign=function(){if(this.sHashHex=this.md.digest(),this.prvKey===void 0&&this.ecprvhex!==void 0&&this.eccurvename!==void 0&&F.crypto.ECDSA!==void 0&&(this.prvKey=new F.crypto.ECDSA({curve:this.eccurvename,prv:this.ecprvhex})),this.prvKey instanceof fe&&this.pubkeyAlgName==="rsaandmgf1")this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if(this.prvKey instanceof fe&&this.pubkeyAlgName==="rsa")this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof F.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else{if(!(this.prvKey instanceof F.crypto.DSA))throw"Signature: unsupported private key alg: "+this.pubkeyAlgName;this.hSign=this.prvKey.signWithMessageHash(this.sHashHex)}return this.hSign},this.signString=function(d){return this.updateString(d),this.sign()},this.signHex=function(d){return this.updateHex(d),this.sign()},this.verify=function(d){if(this.sHashHex=this.md.digest(),this.pubKey===void 0&&this.ecpubhex!==void 0&&this.eccurvename!==void 0&&F.crypto.ECDSA!==void 0&&(this.pubKey=new F.crypto.ECDSA({curve:this.eccurvename,pub:this.ecpubhex})),this.pubKey instanceof fe&&this.pubkeyAlgName==="rsaandmgf1")return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,d,this.mdAlgName,this.pssSaltLen);if(this.pubKey instanceof fe&&this.pubkeyAlgName==="rsa")return this.pubKey.verifyWithMessageHash(this.sHashHex,d);if(F.crypto.ECDSA!==void 0&&this.pubKey instanceof F.crypto.ECDSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,d);if(F.crypto.DSA!==void 0&&this.pubKey instanceof F.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,d);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(i,a){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.updateString=function(i){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(i){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName},this.signString=function(i){throw"digestString(str) not supported for this alg:prov="+this.algProvName},this.signHex=function(i){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(i){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},this.initParams=t,t!==void 0&&(t.alg!==void 0&&(this.algName=t.alg,t.prov===void 0?this.provName=F.crypto.Util.DEFAULTPROVIDER[this.algName]:this.provName=t.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),t.psssaltlen!==void 0&&(this.pssSaltLen=t.psssaltlen),t.prvkeypem!==void 0)){if(t.prvkeypas!==void 0)throw"both prvkeypem and prvkeypas parameters not supported";try{e=qe.getKey(t.prvkeypem),this.init(e)}catch(i){throw"fatal error to load pem private key: "+i}}},F.crypto.Cipher=function(t){},F.crypto.Cipher.encrypt=function(t,e,i){if(e instanceof fe&&e.isPublic){var a=F.crypto.Cipher.getAlgByKeyAndName(e,i);if(a==="RSA")return e.encrypt(t);if(a==="RSAOAEP")return e.encryptOAEP(t,"sha1");var d=a.match(/^RSAOAEP(\d+)$/);if(d!==null)return e.encryptOAEP(t,"sha"+d[1]);throw"Cipher.encrypt: unsupported algorithm for RSAKey: "+i}throw"Cipher.encrypt: unsupported key or algorithm"},F.crypto.Cipher.decrypt=function(t,e,i){if(e instanceof fe&&e.isPrivate){var a=F.crypto.Cipher.getAlgByKeyAndName(e,i);if(a==="RSA")return e.decrypt(t);if(a==="RSAOAEP")return e.decryptOAEP(t,"sha1");var d=a.match(/^RSAOAEP(\d+)$/);if(d!==null)return e.decryptOAEP(t,"sha"+d[1]);throw"Cipher.decrypt: unsupported algorithm for RSAKey: "+i}throw"Cipher.decrypt: unsupported key or algorithm"},F.crypto.Cipher.getAlgByKeyAndName=function(t,e){if(t instanceof fe){if(":RSA:RSAOAEP:RSAOAEP224:RSAOAEP256:RSAOAEP384:RSAOAEP512:".indexOf(e)!=-1)return e;if(e==null)return"RSA";throw"getAlgByKeyAndName: not supported algorithm name for RSAKey: "+e}throw"getAlgByKeyAndName: not supported algorithm name: "+e},F.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040023":"secp521r1","2b81040022":"secp384r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}},F!==void 0&&F||(o.KJUR=F={}),F.crypto!==void 0&&F.crypto||(F.crypto={}),F.crypto.ECDSA=function(t){var e=Error,i=W,a=we,d=F.crypto.ECDSA,v=F.crypto.ECParameterDB,w=d.getName,k=ue,T=k.getVbyListEx,I=k.isASN1HEX,U=new Re;this.type="EC",this.isPrivate=!1,this.isPublic=!1,this.getBigRandom=function(D){return new i(D.bitLength(),U).mod(D.subtract(i.ONE)).add(i.ONE)},this.setNamedCurve=function(D){this.ecparams=v.getByName(D),this.prvKeyHex=null,this.pubKeyHex=null,this.curveName=D},this.setPrivateKeyHex=function(D){this.isPrivate=!0,this.prvKeyHex=D},this.setPublicKeyHex=function(D){this.isPublic=!0,this.pubKeyHex=D},this.getPublicKeyXYHex=function(){var D=this.pubKeyHex;if(D.substr(0,2)!=="04")throw"this method supports uncompressed format(04) only";var B=this.ecparams.keylen/4;if(D.length!==2+2*B)throw"malformed public key hex length";var $={};return $.x=D.substr(2,B),$.y=D.substr(2+B),$},this.getShortNISTPCurveName=function(){var D=this.curveName;return D==="secp256r1"||D==="NIST P-256"||D==="P-256"||D==="prime256v1"?"P-256":D==="secp384r1"||D==="NIST P-384"||D==="P-384"?"P-384":null},this.generateKeyPairHex=function(){var D=this.ecparams.n,B=this.getBigRandom(D),$=this.ecparams.G.multiply(B),z=$.getX().toBigInteger(),Q=$.getY().toBigInteger(),ee=this.ecparams.keylen/4,S=("0000000000"+B.toString(16)).slice(-ee),O="04"+("0000000000"+z.toString(16)).slice(-ee)+("0000000000"+Q.toString(16)).slice(-ee);return this.setPrivateKeyHex(S),this.setPublicKeyHex(O),{ecprvhex:S,ecpubhex:O}},this.signWithMessageHash=function(D){return this.signHex(D,this.prvKeyHex)},this.signHex=function(D,B){var $=new i(B,16),z=this.ecparams.n,Q=new i(D.substring(0,this.ecparams.keylen/4),16);do var ee=this.getBigRandom(z),S=this.ecparams.G.multiply(ee).getX().toBigInteger().mod(z);while(S.compareTo(i.ZERO)<=0);var O=ee.modInverse(z).multiply(Q.add($.multiply(S))).mod(z);return d.biRSSigToASN1Sig(S,O)},this.sign=function(D,B){var $=B,z=this.ecparams.n,Q=i.fromByteArrayUnsigned(D);do var ee=this.getBigRandom(z),S=this.ecparams.G.multiply(ee).getX().toBigInteger().mod(z);while(S.compareTo(W.ZERO)<=0);var O=ee.modInverse(z).multiply(Q.add($.multiply(S))).mod(z);return this.serializeSig(S,O)},this.verifyWithMessageHash=function(D,B){return this.verifyHex(D,B,this.pubKeyHex)},this.verifyHex=function(D,B,$){try{var z,Q,ee=d.parseSigHex(B);z=ee.r,Q=ee.s;var S=a.decodeFromHex(this.ecparams.curve,$),O=new i(D.substring(0,this.ecparams.keylen/4),16);return this.verifyRaw(O,z,Q,S)}catch{return!1}},this.verify=function(D,B,$){var z,Q,ee;if(Bitcoin.Util.isArray(B)){var S=this.parseSig(B);z=S.r,Q=S.s}else{if((B===void 0?"undefined":A(B))!=="object"||!B.r||!B.s)throw"Invalid value for signature";z=B.r,Q=B.s}if($ instanceof we)ee=$;else{if(!Bitcoin.Util.isArray($))throw"Invalid format for pubkey value, must be byte array or ECPointFp";ee=a.decodeFrom(this.ecparams.curve,$)}var O=i.fromByteArrayUnsigned(D);return this.verifyRaw(O,z,Q,ee)},this.verifyRaw=function(D,B,$,z){var Q=this.ecparams.n,ee=this.ecparams.G;if(B.compareTo(i.ONE)<0||B.compareTo(Q)>=0||$.compareTo(i.ONE)<0||$.compareTo(Q)>=0)return!1;var S=$.modInverse(Q),O=D.multiply(S).mod(Q),N=B.multiply(S).mod(Q);return ee.multiply(O).add(z.multiply(N)).getX().toBigInteger().mod(Q).equals(B)},this.serializeSig=function(D,B){var $=D.toByteArraySigned(),z=B.toByteArraySigned(),Q=[];return Q.push(2),Q.push($.length),(Q=Q.concat($)).push(2),Q.push(z.length),(Q=Q.concat(z)).unshift(Q.length),Q.unshift(48),Q},this.parseSig=function(D){var B;if(D[0]!=48)throw new Error("Signature not a valid DERSequence");if(D[B=2]!=2)throw new Error("First element in signature must be a DERInteger");var $=D.slice(B+2,B+2+D[B+1]);if(D[B+=2+D[B+1]]!=2)throw new Error("Second element in signature must be a DERInteger");var z=D.slice(B+2,B+2+D[B+1]);return B+=2+D[B+1],{r:i.fromByteArrayUnsigned($),s:i.fromByteArrayUnsigned(z)}},this.parseSigCompact=function(D){if(D.length!==65)throw"Signature has the wrong length";var B=D[0]-27;if(B<0||B>7)throw"Invalid signature type";var $=this.ecparams.n;return{r:i.fromByteArrayUnsigned(D.slice(1,33)).mod($),s:i.fromByteArrayUnsigned(D.slice(33,65)).mod($),i:B}},this.readPKCS5PrvKeyHex=function(D){if(I(D)===!1)throw new Error("not ASN.1 hex string");var B,$,z;try{B=T(D,0,["[0]",0],"06"),$=T(D,0,[1],"04");try{z=T(D,0,["[1]",0],"03")}catch{}}catch{throw new Error("malformed PKCS#1/5 plain ECC private key")}if(this.curveName=w(B),this.curveName===void 0)throw"unsupported curve name";this.setNamedCurve(this.curveName),this.setPublicKeyHex(z),this.setPrivateKeyHex($),this.isPublic=!1},this.readPKCS8PrvKeyHex=function(D){if(I(D)===!1)throw new e("not ASN.1 hex string");var B,$,z;try{T(D,0,[1,0],"06"),B=T(D,0,[1,1],"06"),$=T(D,0,[2,0,1],"04");try{z=T(D,0,[2,0,"[1]",0],"03")}catch{}}catch{throw new e("malformed PKCS#8 plain ECC private key")}if(this.curveName=w(B),this.curveName===void 0)throw new e("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(z),this.setPrivateKeyHex($),this.isPublic=!1},this.readPKCS8PubKeyHex=function(D){if(I(D)===!1)throw new e("not ASN.1 hex string");var B,$;try{T(D,0,[0,0],"06"),B=T(D,0,[0,1],"06"),$=T(D,0,[1],"03")}catch{throw new e("malformed PKCS#8 ECC public key")}if(this.curveName=w(B),this.curveName===null)throw new e("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex($)},this.readCertPubKeyHex=function(D,B){if(I(D)===!1)throw new e("not ASN.1 hex string");var $,z;try{$=T(D,0,[0,5,0,1],"06"),z=T(D,0,[0,5,1],"03")}catch{throw new e("malformed X.509 certificate ECC public key")}if(this.curveName=w($),this.curveName===null)throw new e("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(z)},t!==void 0&&t.curve!==void 0&&(this.curveName=t.curve),this.curveName===void 0&&(this.curveName="secp256r1"),this.setNamedCurve(this.curveName),t!==void 0&&(t.prv!==void 0&&this.setPrivateKeyHex(t.prv),t.pub!==void 0&&this.setPublicKeyHex(t.pub))},F.crypto.ECDSA.parseSigHex=function(t){var e=F.crypto.ECDSA.parseSigHexInHexRS(t);return{r:new W(e.r,16),s:new W(e.s,16)}},F.crypto.ECDSA.parseSigHexInHexRS=function(t){var e=ue,i=e.getChildIdx,a=e.getV;if(e.checkStrictDER(t,0),t.substr(0,2)!="30")throw new Error("signature is not a ASN.1 sequence");var d=i(t,0);if(d.length!=2)throw new Error("signature shall have two elements");var v=d[0],w=d[1];if(t.substr(v,2)!="02")throw new Error("1st item not ASN.1 integer");if(t.substr(w,2)!="02")throw new Error("2nd item not ASN.1 integer");return{r:a(t,v),s:a(t,w)}},F.crypto.ECDSA.asn1SigToConcatSig=function(t){var e=F.crypto.ECDSA.parseSigHexInHexRS(t),i=e.r,a=e.s;if(i.substr(0,2)=="00"&&i.length%32==2&&(i=i.substr(2)),a.substr(0,2)=="00"&&a.length%32==2&&(a=a.substr(2)),i.length%32==30&&(i="00"+i),a.length%32==30&&(a="00"+a),i.length%32!=0)throw"unknown ECDSA sig r length error";if(a.length%32!=0)throw"unknown ECDSA sig s length error";return i+a},F.crypto.ECDSA.concatSigToASN1Sig=function(t){if(t.length/2*8%128!=0)throw"unknown ECDSA concatinated r-s sig  length error";var e=t.substr(0,t.length/2),i=t.substr(t.length/2);return F.crypto.ECDSA.hexRSSigToASN1Sig(e,i)},F.crypto.ECDSA.hexRSSigToASN1Sig=function(t,e){var i=new W(t,16),a=new W(e,16);return F.crypto.ECDSA.biRSSigToASN1Sig(i,a)},F.crypto.ECDSA.biRSSigToASN1Sig=function(t,e){var i=F.asn1,a=new i.DERInteger({bigint:t}),d=new i.DERInteger({bigint:e});return new i.DERSequence({array:[a,d]}).getEncodedHex()},F.crypto.ECDSA.getName=function(t){return t==="2b8104001f"?"secp192k1":t==="2a8648ce3d030107"?"secp256r1":t==="2b8104000a"?"secp256k1":t==="2b81040021"?"secp224r1":t==="2b81040022"?"secp384r1":"|secp256r1|NIST P-256|P-256|prime256v1|".indexOf(t)!==-1?"secp256r1":"|secp256k1|".indexOf(t)!==-1?"secp256k1":"|secp224r1|NIST P-224|P-224|".indexOf(t)!==-1?"secp224r1":"|secp384r1|NIST P-384|P-384|".indexOf(t)!==-1?"secp384r1":null},F!==void 0&&F||(o.KJUR=F={}),F.crypto!==void 0&&F.crypto||(F.crypto={}),F.crypto.ECParameterDB=new function(){var t={},e={};function i(a){return new W(a,16)}this.getByName=function(a){var d=a;if(e[d]!==void 0&&(d=e[a]),t[d]!==void 0)return t[d];throw"unregistered EC curve name: "+d},this.regist=function(a,d,v,w,k,T,I,U,D,B,$,z){t[a]={};var Q=i(v),ee=i(w),S=i(k),O=i(T),N=i(I),K=new xt(Q,ee,S),Y=K.decodePointHex("04"+U+D);t[a].name=a,t[a].keylen=d,t[a].curve=K,t[a].G=Y,t[a].n=O,t[a].h=N,t[a].oid=$,t[a].info=z;for(var te=0;te<B.length;te++)e[B[te]]=a}},F.crypto.ECParameterDB.regist("secp128r1",128,"FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFC","E87579C11079F43DD824993C2CEE5ED3","FFFFFFFE0000000075A30D1B9038A115","1","161FF7528B899B2D0C28607CA52C5B86","CF5AC8395BAFEB13C02DA292DDED7A83",[],"","secp128r1 : SECG curve over a 128 bit prime field"),F.crypto.ECParameterDB.regist("secp160k1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFAC73","0","7","0100000000000000000001B8FA16DFAB9ACA16B6B3","1","3B4C382CE37AA192A4019E763036F4F5DD4D7EBB","938CF935318FDCED6BC28286531733C3F03C4FEE",[],"","secp160k1 : SECG curve over a 160 bit prime field"),F.crypto.ECParameterDB.regist("secp160r1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFC","1C97BEFC54BD7A8B65ACF89F81D4D4ADC565FA45","0100000000000000000001F4C8F927AED3CA752257","1","4A96B5688EF573284664698968C38BB913CBFC82","23A628553168947D59DCC912042351377AC5FB32",[],"","secp160r1 : SECG curve over a 160 bit prime field"),F.crypto.ECParameterDB.regist("secp192k1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFEE37","0","3","FFFFFFFFFFFFFFFFFFFFFFFE26F2FC170F69466A74DEFD8D","1","DB4FF10EC057E9AE26B07D0280B7F4341DA5D1B1EAE06C7D","9B2F2F6D9C5628A7844163D015BE86344082AA88D95E2F9D",[]),F.crypto.ECParameterDB.regist("secp192r1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC","64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1","FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831","1","188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF1012","07192B95FFC8DA78631011ED6B24CDD573F977A11E794811",[]),F.crypto.ECParameterDB.regist("secp224r1",224,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE","B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4","FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D","1","B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21","BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34",[]),F.crypto.ECParameterDB.regist("secp256k1",256,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F","0","7","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141","1","79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798","483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8",[]),F.crypto.ECParameterDB.regist("secp256r1",256,"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC","5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B","FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551","1","6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296","4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5",["NIST P-256","P-256","prime256v1"]),F.crypto.ECParameterDB.regist("secp384r1",384,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFC","B3312FA7E23EE7E4988E056BE3F82D19181D9C6EFE8141120314088F5013875AC656398D8A2ED19D2A85C8EDD3EC2AEF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC7634D81F4372DDF581A0DB248B0A77AECEC196ACCC52973","1","AA87CA22BE8B05378EB1C71EF320AD746E1D3B628BA79B9859F741E082542A385502F25DBF55296C3A545E3872760AB7","3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f",["NIST P-384","P-384"]),F.crypto.ECParameterDB.regist("secp521r1",521,"1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC","051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409","1","C6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66","011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650",["NIST P-521","P-521"]);var qe=function(){var t=function(I,U,D){return e(M.AES,I,U,D)},e=function(I,U,D,B){var $=M.enc.Hex.parse(U),z=M.enc.Hex.parse(D),Q=M.enc.Hex.parse(B),ee={};ee.key=z,ee.iv=Q,ee.ciphertext=$;var S=I.decrypt(ee,z,{iv:Q});return M.enc.Hex.stringify(S)},i=function(I,U,D){return a(M.AES,I,U,D)},a=function(I,U,D,B){var $=M.enc.Hex.parse(U),z=M.enc.Hex.parse(D),Q=M.enc.Hex.parse(B),ee=I.encrypt($,z,{iv:Q}),S=M.enc.Hex.parse(ee.toString());return M.enc.Base64.stringify(S)},d={"AES-256-CBC":{proc:t,eproc:i,keylen:32,ivlen:16},"AES-192-CBC":{proc:t,eproc:i,keylen:24,ivlen:16},"AES-128-CBC":{proc:t,eproc:i,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:function(I,U,D){return e(M.TripleDES,I,U,D)},eproc:function(I,U,D){return a(M.TripleDES,I,U,D)},keylen:24,ivlen:8},"DES-CBC":{proc:function(I,U,D){return e(M.DES,I,U,D)},eproc:function(I,U,D){return a(M.DES,I,U,D)},keylen:8,ivlen:8}},v=function(I){var U={},D=I.match(new RegExp("DEK-Info: ([^,]+),([0-9A-Fa-f]+)","m"));D&&(U.cipher=D[1],U.ivsalt=D[2]);var B=I.match(new RegExp("-----BEGIN ([A-Z]+) PRIVATE KEY-----"));B&&(U.type=B[1]);var $=-1,z=0;I.indexOf(`\r
\r
`)!=-1&&($=I.indexOf(`\r
\r
`),z=2),I.indexOf(`

`)!=-1&&($=I.indexOf(`

`),z=1);var Q=I.indexOf("-----END");if($!=-1&&Q!=-1){var ee=I.substring($+2*z,Q-z);ee=ee.replace(/\s+/g,""),U.data=ee}return U},w=function(I,U,D){for(var B=D.substring(0,16),$=M.enc.Hex.parse(B),z=M.enc.Utf8.parse(U),Q=d[I].keylen+d[I].ivlen,ee="",S=null;;){var O=M.algo.MD5.create();if(S!=null&&O.update(S),O.update(z),O.update($),S=O.finalize(),(ee+=M.enc.Hex.stringify(S)).length>=2*Q)break}var N={};return N.keyhex=ee.substr(0,2*d[I].keylen),N.ivhex=ee.substr(2*d[I].keylen,2*d[I].ivlen),N},k=function(I,U,D,B){var $=M.enc.Base64.parse(I),z=M.enc.Hex.stringify($);return(0,d[U].proc)(z,D,B)};return{version:"1.0.0",parsePKCS5PEM:function(I){return v(I)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(I,U,D){return w(I,U,D)},decryptKeyB64:function(I,U,D,B){return k(I,U,D,B)},getDecryptedKeyHex:function(I,U){var D=v(I),B=D.cipher,$=D.ivsalt,z=D.data,Q=w(B,U,$).keyhex;return k(z,B,Q,$)},getEncryptedPKCS5PEMFromPrvKeyHex:function(I,U,D,B,$){var z="";if(B!==void 0&&B!=null||(B="AES-256-CBC"),d[B]===void 0)throw new Error("KEYUTIL unsupported algorithm: "+B);$!==void 0&&$!=null||($=function(S){var O=M.lib.WordArray.random(S);return M.enc.Hex.stringify(O)}(d[B].ivlen).toUpperCase());var Q=function(S,O,N,K){return(0,d[O].eproc)(S,N,K)}(U,B,w(B,D,$).keyhex,$);return z="-----BEGIN "+I+` PRIVATE KEY-----\r
`,z+=`Proc-Type: 4,ENCRYPTED\r
`,z+="DEK-Info: "+B+","+$+`\r
`,z+=`\r
`,z+=Q.replace(/(.{64})/g,`$1\r
`),z+=`\r
-----END `+I+` PRIVATE KEY-----\r
`},parseHexOfEncryptedPKCS8:function(I){var U=ue,D=U.getChildIdx,B=U.getV,$={},z=D(I,0);if(z.length!=2)throw new Error("malformed format: SEQUENCE(0).items != 2: "+z.length);$.ciphertext=B(I,z[1]);var Q=D(I,z[0]);if(Q.length!=2)throw new Error("malformed format: SEQUENCE(0.0).items != 2: "+Q.length);if(B(I,Q[0])!="2a864886f70d01050d")throw new Error("this only supports pkcs5PBES2");var ee=D(I,Q[1]);if(Q.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1).items != 2: "+ee.length);var S=D(I,ee[1]);if(S.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1.1).items != 2: "+S.length);if(B(I,S[0])!="2a864886f70d0307")throw"this only supports TripleDES";$.encryptionSchemeAlg="TripleDES",$.encryptionSchemeIV=B(I,S[1]);var O=D(I,ee[0]);if(O.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1.0).items != 2: "+O.length);if(B(I,O[0])!="2a864886f70d01050c")throw new Error("this only supports pkcs5PBKDF2");var N=D(I,O[1]);if(N.length<2)throw new Error("malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+N.length);$.pbkdf2Salt=B(I,N[0]);var K=B(I,N[1]);try{$.pbkdf2Iter=parseInt(K,16)}catch{throw new Error("malformed format pbkdf2Iter: "+K)}return $},getPBKDF2KeyHexFromParam:function(I,U){var D=M.enc.Hex.parse(I.pbkdf2Salt),B=I.pbkdf2Iter,$=M.PBKDF2(U,D,{keySize:6,iterations:B});return M.enc.Hex.stringify($)},_getPlainPKCS8HexFromEncryptedPKCS8PEM:function(I,U){var D=Kt(I,"ENCRYPTED PRIVATE KEY"),B=this.parseHexOfEncryptedPKCS8(D),$=qe.getPBKDF2KeyHexFromParam(B,U),z={};z.ciphertext=M.enc.Hex.parse(B.ciphertext);var Q=M.enc.Hex.parse($),ee=M.enc.Hex.parse(B.encryptionSchemeIV),S=M.TripleDES.decrypt(z,Q,{iv:ee});return M.enc.Hex.stringify(S)},getKeyFromEncryptedPKCS8PEM:function(I,U){var D=this._getPlainPKCS8HexFromEncryptedPKCS8PEM(I,U);return this.getKeyFromPlainPrivatePKCS8Hex(D)},parsePlainPrivatePKCS8Hex:function(I){var U=ue,D=U.getChildIdx,B=U.getV,$={algparam:null};if(I.substr(0,2)!="30")throw new Error("malformed plain PKCS8 private key(code:001)");var z=D(I,0);if(z.length<3)throw new Error("malformed plain PKCS8 private key(code:002)");if(I.substr(z[1],2)!="30")throw new Error("malformed PKCS8 private key(code:003)");var Q=D(I,z[1]);if(Q.length!=2)throw new Error("malformed PKCS8 private key(code:004)");if(I.substr(Q[0],2)!="06")throw new Error("malformed PKCS8 private key(code:005)");if($.algoid=B(I,Q[0]),I.substr(Q[1],2)=="06"&&($.algparam=B(I,Q[1])),I.substr(z[2],2)!="04")throw new Error("malformed PKCS8 private key(code:006)");return $.keyidx=U.getVidx(I,z[2]),$},getKeyFromPlainPrivatePKCS8PEM:function(I){var U=Kt(I,"PRIVATE KEY");return this.getKeyFromPlainPrivatePKCS8Hex(U)},getKeyFromPlainPrivatePKCS8Hex:function(I){var U,D=this.parsePlainPrivatePKCS8Hex(I);if(D.algoid=="2a864886f70d010101")U=new fe;else if(D.algoid=="2a8648ce380401")U=new F.crypto.DSA;else{if(D.algoid!="2a8648ce3d0201")throw new Error("unsupported private key algorithm");U=new F.crypto.ECDSA}return U.readPKCS8PrvKeyHex(I),U},_getKeyFromPublicPKCS8Hex:function(I){var U,D=ue.getVbyList(I,0,[0,0],"06");if(D==="2a864886f70d010101")U=new fe;else if(D==="2a8648ce380401")U=new F.crypto.DSA;else{if(D!=="2a8648ce3d0201")throw new Error("unsupported PKCS#8 public key hex");U=new F.crypto.ECDSA}return U.readPKCS8PubKeyHex(I),U},parsePublicRawRSAKeyHex:function(I){var U=ue,D=U.getChildIdx,B=U.getV,$={};if(I.substr(0,2)!="30")throw new Error("malformed RSA key(code:001)");var z=D(I,0);if(z.length!=2)throw new Error("malformed RSA key(code:002)");if(I.substr(z[0],2)!="02")throw new Error("malformed RSA key(code:003)");if($.n=B(I,z[0]),I.substr(z[1],2)!="02")throw new Error("malformed RSA key(code:004)");return $.e=B(I,z[1]),$},parsePublicPKCS8Hex:function(I){var U=ue,D=U.getChildIdx,B=U.getV,$={algparam:null},z=D(I,0);if(z.length!=2)throw new Error("outer DERSequence shall have 2 elements: "+z.length);var Q=z[0];if(I.substr(Q,2)!="30")throw new Error("malformed PKCS8 public key(code:001)");var ee=D(I,Q);if(ee.length!=2)throw new Error("malformed PKCS8 public key(code:002)");if(I.substr(ee[0],2)!="06")throw new Error("malformed PKCS8 public key(code:003)");if($.algoid=B(I,ee[0]),I.substr(ee[1],2)=="06"?$.algparam=B(I,ee[1]):I.substr(ee[1],2)=="30"&&($.algparam={},$.algparam.p=U.getVbyList(I,ee[1],[0],"02"),$.algparam.q=U.getVbyList(I,ee[1],[1],"02"),$.algparam.g=U.getVbyList(I,ee[1],[2],"02")),I.substr(z[1],2)!="03")throw new Error("malformed PKCS8 public key(code:004)");return $.key=B(I,z[1]).substr(2),$}}}();qe.getKey=function(t,e,i){var a=(ee=ue).getChildIdx,d=(ee.getV,ee.getVbyList),v=F.crypto,w=v.ECDSA,k=v.DSA,T=fe,I=Kt,U=qe;if(T!==void 0&&t instanceof T||w!==void 0&&t instanceof w||k!==void 0&&t instanceof k)return t;if(t.curve!==void 0&&t.xy!==void 0&&t.d===void 0)return new w({pub:t.xy,curve:t.curve});if(t.curve!==void 0&&t.d!==void 0)return new w({prv:t.d,curve:t.curve});if(t.kty===void 0&&t.n!==void 0&&t.e!==void 0&&t.d===void 0)return(ge=new T).setPublic(t.n,t.e),ge;if(t.kty===void 0&&t.n!==void 0&&t.e!==void 0&&t.d!==void 0&&t.p!==void 0&&t.q!==void 0&&t.dp!==void 0&&t.dq!==void 0&&t.co!==void 0&&t.qi===void 0)return(ge=new T).setPrivateEx(t.n,t.e,t.d,t.p,t.q,t.dp,t.dq,t.co),ge;if(t.kty===void 0&&t.n!==void 0&&t.e!==void 0&&t.d!==void 0&&t.p===void 0)return(ge=new T).setPrivate(t.n,t.e,t.d),ge;if(t.p!==void 0&&t.q!==void 0&&t.g!==void 0&&t.y!==void 0&&t.x===void 0)return(ge=new k).setPublic(t.p,t.q,t.g,t.y),ge;if(t.p!==void 0&&t.q!==void 0&&t.g!==void 0&&t.y!==void 0&&t.x!==void 0)return(ge=new k).setPrivate(t.p,t.q,t.g,t.y,t.x),ge;if(t.kty==="RSA"&&t.n!==void 0&&t.e!==void 0&&t.d===void 0)return(ge=new T).setPublic(Oe(t.n),Oe(t.e)),ge;if(t.kty==="RSA"&&t.n!==void 0&&t.e!==void 0&&t.d!==void 0&&t.p!==void 0&&t.q!==void 0&&t.dp!==void 0&&t.dq!==void 0&&t.qi!==void 0)return(ge=new T).setPrivateEx(Oe(t.n),Oe(t.e),Oe(t.d),Oe(t.p),Oe(t.q),Oe(t.dp),Oe(t.dq),Oe(t.qi)),ge;if(t.kty==="RSA"&&t.n!==void 0&&t.e!==void 0&&t.d!==void 0)return(ge=new T).setPrivate(Oe(t.n),Oe(t.e),Oe(t.d)),ge;if(t.kty==="EC"&&t.crv!==void 0&&t.x!==void 0&&t.y!==void 0&&t.d===void 0){var D=(ce=new w({curve:t.crv})).ecparams.keylen/4,B="04"+("0000000000"+Oe(t.x)).slice(-D)+("0000000000"+Oe(t.y)).slice(-D);return ce.setPublicKeyHex(B),ce}if(t.kty==="EC"&&t.crv!==void 0&&t.x!==void 0&&t.y!==void 0&&t.d!==void 0){D=(ce=new w({curve:t.crv})).ecparams.keylen/4,B="04"+("0000000000"+Oe(t.x)).slice(-D)+("0000000000"+Oe(t.y)).slice(-D);var $=("0000000000"+Oe(t.d)).slice(-D);return ce.setPublicKeyHex(B),ce.setPrivateKeyHex($),ce}if(i==="pkcs5prv"){var z,Q=t,ee=ue;if((z=a(Q,0)).length===9)(ge=new T).readPKCS5PrvKeyHex(Q);else if(z.length===6)(ge=new k).readPKCS5PrvKeyHex(Q);else{if(!(z.length>2&&Q.substr(z[1],2)==="04"))throw new Error("unsupported PKCS#1/5 hexadecimal key");(ge=new w).readPKCS5PrvKeyHex(Q)}return ge}if(i==="pkcs8prv")return ge=U.getKeyFromPlainPrivatePKCS8Hex(t);if(i==="pkcs8pub")return U._getKeyFromPublicPKCS8Hex(t);if(i==="x509pub")return Xe.getPublicKeyFromCertHex(t);if(t.indexOf("-END CERTIFICATE-",0)!=-1||t.indexOf("-END X509 CERTIFICATE-",0)!=-1||t.indexOf("-END TRUSTED CERTIFICATE-",0)!=-1)return Xe.getPublicKeyFromCertPEM(t);if(t.indexOf("-END PUBLIC KEY-")!=-1){var S=Kt(t,"PUBLIC KEY");return U._getKeyFromPublicPKCS8Hex(S)}if(t.indexOf("-END RSA PRIVATE KEY-")!=-1&&t.indexOf("4,ENCRYPTED")==-1){var O=I(t,"RSA PRIVATE KEY");return U.getKey(O,null,"pkcs5prv")}if(t.indexOf("-END DSA PRIVATE KEY-")!=-1&&t.indexOf("4,ENCRYPTED")==-1){var N=d(De=I(t,"DSA PRIVATE KEY"),0,[1],"02"),K=d(De,0,[2],"02"),Y=d(De,0,[3],"02"),te=d(De,0,[4],"02"),de=d(De,0,[5],"02");return(ge=new k).setPrivate(new W(N,16),new W(K,16),new W(Y,16),new W(te,16),new W(de,16)),ge}if(t.indexOf("-END EC PRIVATE KEY-")!=-1&&t.indexOf("4,ENCRYPTED")==-1)return O=I(t,"EC PRIVATE KEY"),U.getKey(O,null,"pkcs5prv");if(t.indexOf("-END PRIVATE KEY-")!=-1)return U.getKeyFromPlainPrivatePKCS8PEM(t);if(t.indexOf("-END RSA PRIVATE KEY-")!=-1&&t.indexOf("4,ENCRYPTED")!=-1){var se=U.getDecryptedKeyHex(t,e),Se=new fe;return Se.readPKCS5PrvKeyHex(se),Se}if(t.indexOf("-END EC PRIVATE KEY-")!=-1&&t.indexOf("4,ENCRYPTED")!=-1){var ce,ge=d(De=U.getDecryptedKeyHex(t,e),0,[1],"04"),Ue=d(De,0,[2,0],"06"),Ne=d(De,0,[3,0],"03").substr(2);if(F.crypto.OID.oidhex2name[Ue]===void 0)throw new Error("undefined OID(hex) in KJUR.crypto.OID: "+Ue);return(ce=new w({curve:F.crypto.OID.oidhex2name[Ue]})).setPublicKeyHex(Ne),ce.setPrivateKeyHex(ge),ce.isPublic=!1,ce}if(t.indexOf("-END DSA PRIVATE KEY-")!=-1&&t.indexOf("4,ENCRYPTED")!=-1){var De;return N=d(De=U.getDecryptedKeyHex(t,e),0,[1],"02"),K=d(De,0,[2],"02"),Y=d(De,0,[3],"02"),te=d(De,0,[4],"02"),de=d(De,0,[5],"02"),(ge=new k).setPrivate(new W(N,16),new W(K,16),new W(Y,16),new W(te,16),new W(de,16)),ge}if(t.indexOf("-END ENCRYPTED PRIVATE KEY-")!=-1)return U.getKeyFromEncryptedPKCS8PEM(t,e);throw new Error("not supported argument")},qe.generateKeypair=function(t,e){if(t=="RSA"){var i=e;(w=new fe).generate(i,"10001"),w.isPrivate=!0,w.isPublic=!0;var a=new fe,d=w.n.toString(16),v=w.e.toString(16);return a.setPublic(d,v),a.isPrivate=!1,a.isPublic=!0,(k={}).prvKeyObj=w,k.pubKeyObj=a,k}if(t=="EC"){var w,k,T=e,I=new F.crypto.ECDSA({curve:T}).generateKeyPairHex();return(w=new F.crypto.ECDSA({curve:T})).setPublicKeyHex(I.ecpubhex),w.setPrivateKeyHex(I.ecprvhex),w.isPrivate=!0,w.isPublic=!1,(a=new F.crypto.ECDSA({curve:T})).setPublicKeyHex(I.ecpubhex),a.isPrivate=!1,a.isPublic=!0,(k={}).prvKeyObj=w,k.pubKeyObj=a,k}throw new Error("unknown algorithm: "+t)},qe.getPEM=function(t,e,i,a,d,v){var w=F,k=w.asn1,T=k.DERObjectIdentifier,I=k.DERInteger,U=k.ASN1Util.newObject,D=k.x509.SubjectPublicKeyInfo,B=w.crypto,$=B.DSA,z=B.ECDSA,Q=fe;function ee(ce){return U({seq:[{int:0},{int:{bigint:ce.n}},{int:ce.e},{int:{bigint:ce.d}},{int:{bigint:ce.p}},{int:{bigint:ce.q}},{int:{bigint:ce.dmp1}},{int:{bigint:ce.dmq1}},{int:{bigint:ce.coeff}}]})}function S(ce){return U({seq:[{int:1},{octstr:{hex:ce.prvKeyHex}},{tag:["a0",!0,{oid:{name:ce.curveName}}]},{tag:["a1",!0,{bitstr:{hex:"00"+ce.pubKeyHex}}]}]})}function O(ce){return U({seq:[{int:0},{int:{bigint:ce.p}},{int:{bigint:ce.q}},{int:{bigint:ce.g}},{int:{bigint:ce.y}},{int:{bigint:ce.x}}]})}if((Q!==void 0&&t instanceof Q||$!==void 0&&t instanceof $||z!==void 0&&t instanceof z)&&t.isPublic==1&&(e===void 0||e=="PKCS8PUB"))return wt(te=new D(t).getEncodedHex(),"PUBLIC KEY");if(e=="PKCS1PRV"&&Q!==void 0&&t instanceof Q&&(i===void 0||i==null)&&t.isPrivate==1)return wt(te=ee(t).getEncodedHex(),"RSA PRIVATE KEY");if(e=="PKCS1PRV"&&z!==void 0&&t instanceof z&&(i===void 0||i==null)&&t.isPrivate==1){var N=new T({name:t.curveName}).getEncodedHex(),K=S(t).getEncodedHex(),Y="";return Y+=wt(N,"EC PARAMETERS"),Y+=wt(K,"EC PRIVATE KEY")}if(e=="PKCS1PRV"&&$!==void 0&&t instanceof $&&(i===void 0||i==null)&&t.isPrivate==1)return wt(te=O(t).getEncodedHex(),"DSA PRIVATE KEY");if(e=="PKCS5PRV"&&Q!==void 0&&t instanceof Q&&i!==void 0&&i!=null&&t.isPrivate==1){var te=ee(t).getEncodedHex();return a===void 0&&(a="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",te,i,a,v)}if(e=="PKCS5PRV"&&z!==void 0&&t instanceof z&&i!==void 0&&i!=null&&t.isPrivate==1)return te=S(t).getEncodedHex(),a===void 0&&(a="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("EC",te,i,a,v);if(e=="PKCS5PRV"&&$!==void 0&&t instanceof $&&i!==void 0&&i!=null&&t.isPrivate==1)return te=O(t).getEncodedHex(),a===void 0&&(a="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("DSA",te,i,a,v);var de=function(ge,Ue){var Ne=se(ge,Ue);return new U({seq:[{seq:[{oid:{name:"pkcs5PBES2"}},{seq:[{seq:[{oid:{name:"pkcs5PBKDF2"}},{seq:[{octstr:{hex:Ne.pbkdf2Salt}},{int:Ne.pbkdf2Iter}]}]},{seq:[{oid:{name:"des-EDE3-CBC"}},{octstr:{hex:Ne.encryptionSchemeIV}}]}]}]},{octstr:{hex:Ne.ciphertext}}]}).getEncodedHex()},se=function(ge,Ue){var Ne=M.lib.WordArray.random(8),De=M.lib.WordArray.random(8),Et=M.PBKDF2(Ue,Ne,{keySize:6,iterations:100}),ct=M.enc.Hex.parse(ge),gt=M.TripleDES.encrypt(ct,Et,{iv:De})+"",We={};return We.ciphertext=gt,We.pbkdf2Salt=M.enc.Hex.stringify(Ne),We.pbkdf2Iter=100,We.encryptionSchemeAlg="DES-EDE3-CBC",We.encryptionSchemeIV=M.enc.Hex.stringify(De),We};if(e=="PKCS8PRV"&&Q!=null&&t instanceof Q&&t.isPrivate==1){var Se=ee(t).getEncodedHex();return te=U({seq:[{int:0},{seq:[{oid:{name:"rsaEncryption"}},{null:!0}]},{octstr:{hex:Se}}]}).getEncodedHex(),i===void 0||i==null?wt(te,"PRIVATE KEY"):wt(K=de(te,i),"ENCRYPTED PRIVATE KEY")}if(e=="PKCS8PRV"&&z!==void 0&&t instanceof z&&t.isPrivate==1)return Se=new U({seq:[{int:1},{octstr:{hex:t.prvKeyHex}},{tag:["a1",!0,{bitstr:{hex:"00"+t.pubKeyHex}}]}]}).getEncodedHex(),te=U({seq:[{int:0},{seq:[{oid:{name:"ecPublicKey"}},{oid:{name:t.curveName}}]},{octstr:{hex:Se}}]}).getEncodedHex(),i===void 0||i==null?wt(te,"PRIVATE KEY"):wt(K=de(te,i),"ENCRYPTED PRIVATE KEY");if(e=="PKCS8PRV"&&$!==void 0&&t instanceof $&&t.isPrivate==1)return Se=new I({bigint:t.x}).getEncodedHex(),te=U({seq:[{int:0},{seq:[{oid:{name:"dsa"}},{seq:[{int:{bigint:t.p}},{int:{bigint:t.q}},{int:{bigint:t.g}}]}]},{octstr:{hex:Se}}]}).getEncodedHex(),i===void 0||i==null?wt(te,"PRIVATE KEY"):wt(K=de(te,i),"ENCRYPTED PRIVATE KEY");throw new Error("unsupported object nor format")},qe.getKeyFromCSRPEM=function(t){var e=Kt(t,"CERTIFICATE REQUEST");return qe.getKeyFromCSRHex(e)},qe.getKeyFromCSRHex=function(t){var e=qe.parseCSRHex(t);return qe.getKey(e.p8pubkeyhex,null,"pkcs8pub")},qe.parseCSRHex=function(t){var e=ue,i=e.getChildIdx,a=e.getTLV,d={},v=t;if(v.substr(0,2)!="30")throw new Error("malformed CSR(code:001)");var w=i(v,0);if(w.length<1)throw new Error("malformed CSR(code:002)");if(v.substr(w[0],2)!="30")throw new Error("malformed CSR(code:003)");var k=i(v,w[0]);if(k.length<3)throw new Error("malformed CSR(code:004)");return d.p8pubkeyhex=a(v,k[2]),d},qe.getKeyID=function(t){var e=qe,i=ue;typeof t=="string"&&t.indexOf("BEGIN ")!=-1&&(t=e.getKey(t));var a=Kt(e.getPEM(t)),d=i.getIdxbyList(a,0,[1]),v=i.getV(a,d).substring(2);return F.crypto.Util.hashHex(v,"sha1")},qe.getJWKFromKey=function(t){var e={};if(t instanceof fe&&t.isPrivate)return e.kty="RSA",e.n=ze(t.n.toString(16)),e.e=ze(t.e.toString(16)),e.d=ze(t.d.toString(16)),e.p=ze(t.p.toString(16)),e.q=ze(t.q.toString(16)),e.dp=ze(t.dmp1.toString(16)),e.dq=ze(t.dmq1.toString(16)),e.qi=ze(t.coeff.toString(16)),e;if(t instanceof fe&&t.isPublic)return e.kty="RSA",e.n=ze(t.n.toString(16)),e.e=ze(t.e.toString(16)),e;if(t instanceof F.crypto.ECDSA&&t.isPrivate){if((a=t.getShortNISTPCurveName())!=="P-256"&&a!=="P-384")throw new Error("unsupported curve name for JWT: "+a);var i=t.getPublicKeyXYHex();return e.kty="EC",e.crv=a,e.x=ze(i.x),e.y=ze(i.y),e.d=ze(t.prvKeyHex),e}if(t instanceof F.crypto.ECDSA&&t.isPublic){var a;if((a=t.getShortNISTPCurveName())!=="P-256"&&a!=="P-384")throw new Error("unsupported curve name for JWT: "+a);return i=t.getPublicKeyXYHex(),e.kty="EC",e.crv=a,e.x=ze(i.x),e.y=ze(i.y),e}throw new Error("not supported key object")},fe.getPosArrayOfChildrenFromHex=function(t){return ue.getChildIdx(t,0)},fe.getHexValueArrayOfChildrenFromHex=function(t){var e,i=ue.getV,a=i(t,(e=fe.getPosArrayOfChildrenFromHex(t))[0]),d=i(t,e[1]),v=i(t,e[2]),w=i(t,e[3]),k=i(t,e[4]),T=i(t,e[5]),I=i(t,e[6]),U=i(t,e[7]),D=i(t,e[8]);return(e=new Array).push(a,d,v,w,k,T,I,U,D),e},fe.prototype.readPrivateKeyFromPEMString=function(t){var e=Kt(t),i=fe.getHexValueArrayOfChildrenFromHex(e);this.setPrivateEx(i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8])},fe.prototype.readPKCS5PrvKeyHex=function(t){var e=fe.getHexValueArrayOfChildrenFromHex(t);this.setPrivateEx(e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},fe.prototype.readPKCS8PrvKeyHex=function(t){var e,i,a,d,v,w,k,T,I=ue,U=I.getVbyListEx;if(I.isASN1HEX(t)===!1)throw new Error("not ASN.1 hex string");try{e=U(t,0,[2,0,1],"02"),i=U(t,0,[2,0,2],"02"),a=U(t,0,[2,0,3],"02"),d=U(t,0,[2,0,4],"02"),v=U(t,0,[2,0,5],"02"),w=U(t,0,[2,0,6],"02"),k=U(t,0,[2,0,7],"02"),T=U(t,0,[2,0,8],"02")}catch{throw new Error("malformed PKCS#8 plain RSA private key")}this.setPrivateEx(e,i,a,d,v,w,k,T)},fe.prototype.readPKCS5PubKeyHex=function(t){var e=ue,i=e.getV;if(e.isASN1HEX(t)===!1)throw new Error("keyHex is not ASN.1 hex string");var a=e.getChildIdx(t,0);if(a.length!==2||t.substr(a[0],2)!=="02"||t.substr(a[1],2)!=="02")throw new Error("wrong hex for PKCS#5 public key");var d=i(t,a[0]),v=i(t,a[1]);this.setPublic(d,v)},fe.prototype.readPKCS8PubKeyHex=function(t){var e=ue;if(e.isASN1HEX(t)===!1)throw new Error("not ASN.1 hex string");if(e.getTLVbyListEx(t,0,[0,0])!=="06092a864886f70d010101")throw new Error("not PKCS8 RSA public key");var i=e.getTLVbyListEx(t,0,[1,0]);this.readPKCS5PubKeyHex(i)},fe.prototype.readCertPubKeyHex=function(t,e){var i,a;(i=new Xe).readCertHex(t),a=i.getPublicKeyHex(),this.readPKCS8PubKeyHex(a)};function Ci(t,e){for(var i="",a=e/4-t.length,d=0;d<a;d++)i+="0";return i+t}function xi(t,e,i){for(var a="",d=0;a.length<e;)a+=Rt(i(Mt(t+String.fromCharCode.apply(String,[(4278190080&d)>>24,(16711680&d)>>16,(65280&d)>>8,255&d])))),d+=1;return a}function Ri(t){for(var e in F.crypto.Util.DIGESTINFOHEAD){var i=F.crypto.Util.DIGESTINFOHEAD[e],a=i.length;if(t.substring(0,a)==i)return[e,t.substring(a)]}return[]}function Xe(t){var e,i=ue,a=i.getChildIdx,d=i.getV,v=i.getTLV,w=i.getVbyList,k=i.getVbyListEx,T=i.getTLVbyList,I=i.getTLVbyListEx,U=i.getIdxbyList,D=i.getIdxbyListEx,B=i.getVidx,$=i.getInt,z=i.oidname,Q=i.hextooidstr,ee=Kt;try{e=F.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV}catch{}this.HEX2STAG={"0c":"utf8",13:"prn",16:"ia5","1a":"vis","1e":"bmp"},this.hex=null,this.version=0,this.foffset=0,this.aExtInfo=null,this.getVersion=function(){if(this.hex===null||this.version!==0)return this.version;var S=T(this.hex,0,[0,0]);if(S.substr(0,2)=="a0"){var O=T(S,0,[0]),N=$(O,0);if(N<0||2<N)throw new Error("malformed version field");return this.version=N+1,this.version}return this.version=1,this.foffset=-1,1},this.getSerialNumberHex=function(){return k(this.hex,0,[0,0],"02")},this.getSignatureAlgorithmField=function(){var S=I(this.hex,0,[0,1]);return this.getAlgorithmIdentifierName(S)},this.getAlgorithmIdentifierName=function(S){for(var O in e)if(S===e[O])return O;return z(k(S,0,[0],"06"))},this.getIssuer=function(){return this.getX500Name(this.getIssuerHex())},this.getIssuerHex=function(){return T(this.hex,0,[0,3+this.foffset],"30")},this.getIssuerString=function(){return this.getIssuer().str},this.getSubject=function(){return this.getX500Name(this.getSubjectHex())},this.getSubjectHex=function(){return T(this.hex,0,[0,5+this.foffset],"30")},this.getSubjectString=function(){return this.getSubject().str},this.getNotBefore=function(){var S=w(this.hex,0,[0,4+this.foffset,0]);return S=S.replace(/(..)/g,"%$1"),S=decodeURIComponent(S)},this.getNotAfter=function(){var S=w(this.hex,0,[0,4+this.foffset,1]);return S=S.replace(/(..)/g,"%$1"),S=decodeURIComponent(S)},this.getPublicKeyHex=function(){return i.getTLVbyList(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyIdx=function(){return U(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyContentIdx=function(){var S=this.getPublicKeyIdx();return U(this.hex,S,[1,0],"30")},this.getPublicKey=function(){return qe.getKey(this.getPublicKeyHex(),null,"pkcs8pub")},this.getSignatureAlgorithmName=function(){var S=T(this.hex,0,[1],"30");return this.getAlgorithmIdentifierName(S)},this.getSignatureValueHex=function(){return w(this.hex,0,[2],"03",!0)},this.verifySignature=function(S){var O=this.getSignatureAlgorithmField(),N=this.getSignatureValueHex(),K=T(this.hex,0,[0],"30"),Y=new F.crypto.Signature({alg:O});return Y.init(S),Y.updateHex(K),Y.verify(N)},this.parseExt=function(S){var O,N,K;if(S===void 0){if(K=this.hex,this.version!==3)return-1;O=U(K,0,[0,7,0],"30"),N=a(K,O)}else{K=Kt(S);var Y=U(K,0,[0,3,0,0],"06");if(d(K,Y)!="2a864886f70d01090e")return void(this.aExtInfo=new Array);O=U(K,0,[0,3,0,1,0],"30"),N=a(K,O),this.hex=K}this.aExtInfo=new Array;for(var te=0;te<N.length;te++){var de={critical:!1},se=0;a(K,N[te]).length===3&&(de.critical=!0,se=1),de.oid=i.hextooidstr(w(K,N[te],[0],"06"));var Se=U(K,N[te],[1+se]);de.vidx=B(K,Se),this.aExtInfo.push(de)}},this.getExtInfo=function(S){var O=this.aExtInfo,N=S;if(S.match(/^[0-9.]+$/)||(N=F.asn1.x509.OID.name2oid(S)),N!==""){for(var K=0;K<O.length;K++)if(O[K].oid===N)return O[K]}},this.getExtBasicConstraints=function(S,O){if(S===void 0&&O===void 0){var N=this.getExtInfo("basicConstraints");if(N===void 0)return;S=v(this.hex,N.vidx),O=N.critical}var K={extname:"basicConstraints"};if(O&&(K.critical=!0),S==="3000")return K;if(S==="30030101ff")return K.cA=!0,K;if(S.substr(0,12)==="30060101ff02"){var Y=d(S,10),te=parseInt(Y,16);return K.cA=!0,K.pathLen=te,K}throw new Error("hExtV parse error: "+S)},this.getExtKeyUsage=function(S,O){if(S===void 0&&O===void 0){var N=this.getExtInfo("keyUsage");if(N===void 0)return;S=v(this.hex,N.vidx),O=N.critical}var K={extname:"keyUsage"};return O&&(K.critical=!0),K.names=this.getExtKeyUsageString(S).split(","),K},this.getExtKeyUsageBin=function(S){if(S===void 0){var O=this.getExtInfo("keyUsage");if(O===void 0)return"";S=v(this.hex,O.vidx)}if(S.length!=8&&S.length!=10)throw new Error("malformed key usage value: "+S);var N="000000000000000"+parseInt(S.substr(6),16).toString(2);return S.length==8&&(N=N.slice(-8)),S.length==10&&(N=N.slice(-16)),(N=N.replace(/0+$/,""))==""&&(N="0"),N},this.getExtKeyUsageString=function(S){for(var O=this.getExtKeyUsageBin(S),N=new Array,K=0;K<O.length;K++)O.substr(K,1)=="1"&&N.push(Xe.KEYUSAGE_NAME[K]);return N.join(",")},this.getExtSubjectKeyIdentifier=function(S,O){if(S===void 0&&O===void 0){var N=this.getExtInfo("subjectKeyIdentifier");if(N===void 0)return;S=v(this.hex,N.vidx),O=N.critical}var K={extname:"subjectKeyIdentifier"};O&&(K.critical=!0);var Y=d(S,0);return K.kid={hex:Y},K},this.getExtAuthorityKeyIdentifier=function(S,O){if(S===void 0&&O===void 0){var N=this.getExtInfo("authorityKeyIdentifier");if(N===void 0)return;S=v(this.hex,N.vidx),O=N.critical}var K={extname:"authorityKeyIdentifier"};O&&(K.critical=!0);for(var Y=a(S,0),te=0;te<Y.length;te++){var de=S.substr(Y[te],2);if(de==="80"&&(K.kid={hex:d(S,Y[te])}),de==="a1"){var se=v(S,Y[te]),Se=this.getGeneralNames(se);K.issuer=Se[0].dn}de==="82"&&(K.sn={hex:d(S,Y[te])})}return K},this.getExtExtKeyUsage=function(S,O){if(S===void 0&&O===void 0){var N=this.getExtInfo("extKeyUsage");if(N===void 0)return;S=v(this.hex,N.vidx),O=N.critical}var K={extname:"extKeyUsage",array:[]};O&&(K.critical=!0);for(var Y=a(S,0),te=0;te<Y.length;te++)K.array.push(z(d(S,Y[te])));return K},this.getExtExtKeyUsageName=function(){var S=this.getExtInfo("extKeyUsage");if(S===void 0)return S;var O=new Array,N=v(this.hex,S.vidx);if(N==="")return O;for(var K=a(N,0),Y=0;Y<K.length;Y++)O.push(z(d(N,K[Y])));return O},this.getExtSubjectAltName=function(S,O){if(S===void 0&&O===void 0){var N=this.getExtInfo("subjectAltName");if(N===void 0)return;S=v(this.hex,N.vidx),O=N.critical}var K={extname:"subjectAltName",array:[]};return O&&(K.critical=!0),K.array=this.getGeneralNames(S),K},this.getExtIssuerAltName=function(S,O){if(S===void 0&&O===void 0){var N=this.getExtInfo("issuerAltName");if(N===void 0)return;S=v(this.hex,N.vidx),O=N.critical}var K={extname:"issuerAltName",array:[]};return O&&(K.critical=!0),K.array=this.getGeneralNames(S),K},this.getGeneralNames=function(S){for(var O=a(S,0),N=[],K=0;K<O.length;K++){var Y=this.getGeneralName(v(S,O[K]));Y!==void 0&&N.push(Y)}return N},this.getGeneralName=function(S){var O=S.substr(0,2),N=d(S,0),K=Rt(N);return O=="81"?{rfc822:K}:O=="82"?{dns:K}:O=="86"?{uri:K}:O=="87"?{ip:yn(N)}:O=="a4"?{dn:this.getX500Name(N)}:void 0},this.getExtSubjectAltName2=function(){var S,O,N,K=this.getExtInfo("subjectAltName");if(K===void 0)return K;for(var Y=new Array,te=v(this.hex,K.vidx),de=a(te,0),se=0;se<de.length;se++)N=te.substr(de[se],2),S=d(te,de[se]),N==="81"&&(O=Ye(S),Y.push(["MAIL",O])),N==="82"&&(O=Ye(S),Y.push(["DNS",O])),N==="84"&&(O=Xe.hex2dn(S,0),Y.push(["DN",O])),N==="86"&&(O=Ye(S),Y.push(["URI",O])),N==="87"&&(O=yn(S),Y.push(["IP",O]));return Y},this.getExtCRLDistributionPoints=function(S,O){if(S===void 0&&O===void 0){var N=this.getExtInfo("cRLDistributionPoints");if(N===void 0)return;S=v(this.hex,N.vidx),O=N.critical}var K={extname:"cRLDistributionPoints",array:[]};O&&(K.critical=!0);for(var Y=a(S,0),te=0;te<Y.length;te++){var de=v(S,Y[te]);K.array.push(this.getDistributionPoint(de))}return K},this.getDistributionPoint=function(S){for(var O={},N=a(S,0),K=0;K<N.length;K++){var Y=S.substr(N[K],2),te=v(S,N[K]);Y=="a0"&&(O.dpname=this.getDistributionPointName(te))}return O},this.getDistributionPointName=function(S){for(var O={},N=a(S,0),K=0;K<N.length;K++){var Y=S.substr(N[K],2),te=v(S,N[K]);Y=="a0"&&(O.full=this.getGeneralNames(te))}return O},this.getExtCRLDistributionPointsURI=function(){var S=this.getExtInfo("cRLDistributionPoints");if(S===void 0)return S;for(var O=new Array,N=a(this.hex,S.vidx),K=0;K<N.length;K++)try{var Y=Ye(w(this.hex,N[K],[0,0,0],"86"));O.push(Y)}catch{}return O},this.getExtAIAInfo=function(){var S=this.getExtInfo("authorityInfoAccess");if(S===void 0)return S;for(var O={ocsp:[],caissuer:[]},N=a(this.hex,S.vidx),K=0;K<N.length;K++){var Y=w(this.hex,N[K],[0],"06"),te=w(this.hex,N[K],[1],"86");Y==="2b06010505073001"&&O.ocsp.push(Ye(te)),Y==="2b06010505073002"&&O.caissuer.push(Ye(te))}return O},this.getExtAuthorityInfoAccess=function(S,O){if(S===void 0&&O===void 0){var N=this.getExtInfo("authorityInfoAccess");if(N===void 0)return;S=v(this.hex,N.vidx),O=N.critical}var K={extname:"authorityInfoAccess",array:[]};O&&(K.critical=!0);for(var Y=a(S,0),te=0;te<Y.length;te++){var de=k(S,Y[te],[0],"06"),se=Ye(w(S,Y[te],[1],"86"));if(de=="2b06010505073001")K.array.push({ocsp:se});else{if(de!="2b06010505073002")throw new Error("unknown method: "+de);K.array.push({caissuer:se})}}return K},this.getExtCertificatePolicies=function(S,O){if(S===void 0&&O===void 0){var N=this.getExtInfo("certificatePolicies");if(N===void 0)return;S=v(this.hex,N.vidx),O=N.critical}var K={extname:"certificatePolicies",array:[]};O&&(K.critical=!0);for(var Y=a(S,0),te=0;te<Y.length;te++){var de=v(S,Y[te]),se=this.getPolicyInformation(de);K.array.push(se)}return K},this.getPolicyInformation=function(S){var O={},N=w(S,0,[0],"06");O.policyoid=z(N);var K=D(S,0,[1],"30");if(K!=-1){O.array=[];for(var Y=a(S,K),te=0;te<Y.length;te++){var de=v(S,Y[te]),se=this.getPolicyQualifierInfo(de);O.array.push(se)}}return O},this.getPolicyQualifierInfo=function(S){var O={},N=w(S,0,[0],"06");if(N==="2b06010505070201"){var K=k(S,0,[1],"16");O.cps=Rt(K)}else if(N==="2b06010505070202"){var Y=T(S,0,[1],"30");O.unotice=this.getUserNotice(Y)}return O},this.getUserNotice=function(S){for(var O={},N=a(S,0),K=0;K<N.length;K++){var Y=v(S,N[K]);Y.substr(0,2)!="30"&&(O.exptext=this.getDisplayText(Y))}return O},this.getDisplayText=function(S){var O={};return O.type={"0c":"utf8",16:"ia5","1a":"vis","1e":"bmp"}[S.substr(0,2)],O.str=Rt(d(S,0)),O},this.getExtCRLNumber=function(S,O){var N={extname:"cRLNumber"};if(O&&(N.critical=!0),S.substr(0,2)=="02")return N.num={hex:d(S,0)},N;throw new Error("hExtV parse error: "+S)},this.getExtCRLReason=function(S,O){var N={extname:"cRLReason"};if(O&&(N.critical=!0),S.substr(0,2)=="0a")return N.code=parseInt(d(S,0),16),N;throw new Error("hExtV parse error: "+S)},this.getExtOcspNonce=function(S,O){var N={extname:"ocspNonce"};O&&(N.critical=!0);var K=d(S,0);return N.hex=K,N},this.getExtOcspNoCheck=function(S,O){var N={extname:"ocspNoCheck"};return O&&(N.critical=!0),N},this.getExtAdobeTimeStamp=function(S,O){if(S===void 0&&O===void 0){var N=this.getExtInfo("adobeTimeStamp");if(N===void 0)return;S=v(this.hex,N.vidx),O=N.critical}var K={extname:"adobeTimeStamp"};O&&(K.critical=!0);var Y=a(S,0);if(Y.length>1){var te=v(S,Y[1]),de=this.getGeneralName(te);de.uri!=null&&(K.uri=de.uri)}if(Y.length>2){var se=v(S,Y[2]);se=="0101ff"&&(K.reqauth=!0),se=="010100"&&(K.reqauth=!1)}return K},this.getX500NameRule=function(S){for(var O=null,N=[],K=0;K<S.length;K++)for(var Y=S[K],te=0;te<Y.length;te++)N.push(Y[te]);for(K=0;K<N.length;K++){var de=N[K],se=de.ds,Se=de.value,ce=de.type;if(se!="prn"&&se!="utf8"&&se!="ia5")return"mixed";if(se=="ia5"){if(ce!="CN")return"mixed";if(F.lang.String.isMail(Se))continue;return"mixed"}if(ce=="C"){if(se=="prn")continue;return"mixed"}if(O==null)O=se;else if(O!==se)return"mixed"}return O==null?"prn":O},this.getX500Name=function(S){var O=this.getX500NameArray(S);return{array:O,str:this.dnarraytostr(O)}},this.getX500NameArray=function(S){for(var O=[],N=a(S,0),K=0;K<N.length;K++)O.push(this.getRDN(v(S,N[K])));return O},this.getRDN=function(S){for(var O=[],N=a(S,0),K=0;K<N.length;K++)O.push(this.getAttrTypeAndValue(v(S,N[K])));return O},this.getAttrTypeAndValue=function(S){var O={type:null,value:null,ds:null},N=a(S,0),K=w(S,N[0],[],"06"),Y=w(S,N[1],[]),te=F.asn1.ASN1Util.oidHexToInt(K);return O.type=F.asn1.x509.OID.oid2atype(te),O.ds=this.HEX2STAG[S.substr(N[1],2)],O.ds!="bmp"?O.value=Ye(Y):O.value=Ai(Y),O},this.readCertPEM=function(S){this.readCertHex(ee(S))},this.readCertHex=function(S){this.hex=S,this.getVersion();try{U(this.hex,0,[0,7],"a3"),this.parseExt()}catch{}},this.getParam=function(){var S={};return S.version=this.getVersion(),S.serial={hex:this.getSerialNumberHex()},S.sigalg=this.getSignatureAlgorithmField(),S.issuer=this.getIssuer(),S.notbefore=this.getNotBefore(),S.notafter=this.getNotAfter(),S.subject=this.getSubject(),S.sbjpubkey=wt(this.getPublicKeyHex(),"PUBLIC KEY"),this.aExtInfo.length>0&&(S.ext=this.getExtParamArray()),S.sighex=this.getSignatureValueHex(),S},this.getExtParamArray=function(S){S==null&&D(this.hex,0,[0,"[3]"])!=-1&&(S=I(this.hex,0,[0,"[3]",0],"30"));for(var O=[],N=a(S,0),K=0;K<N.length;K++){var Y=v(S,N[K]),te=this.getExtParam(Y);te!=null&&O.push(te)}return O},this.getExtParam=function(S){var O=a(S,0).length;if(O!=2&&O!=3)throw new Error("wrong number elements in Extension: "+O+" "+S);var N=Q(w(S,0,[0],"06")),K=!1;O==3&&T(S,0,[1])=="0101ff"&&(K=!0);var Y=T(S,0,[O-1,0]),te=void 0;if(N=="2.5.29.14"?te=this.getExtSubjectKeyIdentifier(Y,K):N=="2.5.29.15"?te=this.getExtKeyUsage(Y,K):N=="2.5.29.17"?te=this.getExtSubjectAltName(Y,K):N=="2.5.29.18"?te=this.getExtIssuerAltName(Y,K):N=="2.5.29.19"?te=this.getExtBasicConstraints(Y,K):N=="2.5.29.31"?te=this.getExtCRLDistributionPoints(Y,K):N=="2.5.29.32"?te=this.getExtCertificatePolicies(Y,K):N=="2.5.29.35"?te=this.getExtAuthorityKeyIdentifier(Y,K):N=="2.5.29.37"?te=this.getExtExtKeyUsage(Y,K):N=="1.3.6.1.5.5.7.1.1"?te=this.getExtAuthorityInfoAccess(Y,K):N=="2.5.29.20"?te=this.getExtCRLNumber(Y,K):N=="2.5.29.21"?te=this.getExtCRLReason(Y,K):N=="1.3.6.1.5.5.7.48.1.2"?te=this.getExtOcspNonce(Y,K):N=="1.3.6.1.5.5.7.48.1.5"?te=this.getExtOcspNoCheck(Y,K):N=="1.2.840.113583.1.1.9.1"&&(te=this.getExtAdobeTimeStamp(Y,K)),te!=null)return te;var de={extname:N,extn:Y};return K&&(de.critical=!0),de},this.findExt=function(S,O){for(var N=0;N<S.length;N++)if(S[N].extname==O)return S[N];return null},this.updateExtCDPFullURI=function(S,O){var N=this.findExt(S,"cRLDistributionPoints");if(N!=null&&N.array!=null){for(var K=N.array,Y=0;Y<K.length;Y++)if(K[Y].dpname!=null&&K[Y].dpname.full!=null)for(var te=K[Y].dpname.full,de=0;de<te.length;de++){var se=te[Y];se.uri!=null&&(se.uri=O)}}},this.updateExtAIAOCSP=function(S,O){var N=this.findExt(S,"authorityInfoAccess");if(N!=null&&N.array!=null)for(var K=N.array,Y=0;Y<K.length;Y++)K[Y].ocsp!=null&&(K[Y].ocsp=O)},this.updateExtAIACAIssuer=function(S,O){var N=this.findExt(S,"authorityInfoAccess");if(N!=null&&N.array!=null)for(var K=N.array,Y=0;Y<K.length;Y++)K[Y].caissuer!=null&&(K[Y].caissuer=O)},this.dnarraytostr=function(S){return"/"+S.map(function(O){return function(K){return K.map(function(Y){return function(de){return de.type+"="+de.value}(Y).replace(/\+/,"\\+")}).join("+")}(O).replace(/\//,"\\/")}).join("/")},this.getInfo=function(){var S,O,N,K=function(Et){return JSON.stringify(Et.array).replace(/[\[\]\{\}\"]/g,"")},Y=function(Et){for(var ct="",gt=Et.array,We=0;We<gt.length;We++){var Qe=gt[We];if(ct+="    policy oid: "+Qe.policyoid+`
`,Qe.array!==void 0)for(var it=0;it<Qe.array.length;it++){var yt=Qe.array[it];yt.cps!==void 0&&(ct+="    cps: "+yt.cps+`
`)}}return ct},te=function(Et){for(var ct="",gt=Et.array,We=0;We<gt.length;We++){var Qe=gt[We];try{Qe.dpname.full[0].uri!==void 0&&(ct+="    "+Qe.dpname.full[0].uri+`
`)}catch{}try{Qe.dname.full[0].dn.hex!==void 0&&(ct+="    "+Xe.hex2dn(Qe.dpname.full[0].dn.hex)+`
`)}catch{}}return ct},de=function(Et){for(var ct="",gt=Et.array,We=0;We<gt.length;We++){var Qe=gt[We];Qe.caissuer!==void 0&&(ct+="    caissuer: "+Qe.caissuer+`
`),Qe.ocsp!==void 0&&(ct+="    ocsp: "+Qe.ocsp+`
`)}return ct};if(S=`Basic Fields
`,S+="  serial number: "+this.getSerialNumberHex()+`
`,S+="  signature algorithm: "+this.getSignatureAlgorithmField()+`
`,S+="  issuer: "+this.getIssuerString()+`
`,S+="  notBefore: "+this.getNotBefore()+`
`,S+="  notAfter: "+this.getNotAfter()+`
`,S+="  subject: "+this.getSubjectString()+`
`,S+=`  subject public key info: 
`,S+="    key algorithm: "+(O=this.getPublicKey()).type+`
`,O.type==="RSA"&&(S+="    n="+vn(O.n.toString(16)).substr(0,16)+`...
`,S+="    e="+vn(O.e.toString(16))+`
`),(N=this.aExtInfo)!=null){S+=`X509v3 Extensions:
`;for(var se=0;se<N.length;se++){var Se=N[se],ce=F.asn1.x509.OID.oid2name(Se.oid);ce===""&&(ce=Se.oid);var ge="";if(Se.critical===!0&&(ge="CRITICAL"),S+="  "+ce+" "+ge+`:
`,ce==="basicConstraints"){var Ue=this.getExtBasicConstraints();Ue.cA===void 0?S+=`    {}
`:(S+="    cA=true",Ue.pathLen!==void 0&&(S+=", pathLen="+Ue.pathLen),S+=`
`)}else if(ce==="keyUsage")S+="    "+this.getExtKeyUsageString()+`
`;else if(ce==="subjectKeyIdentifier")S+="    "+this.getExtSubjectKeyIdentifier().kid.hex+`
`;else if(ce==="authorityKeyIdentifier"){var Ne=this.getExtAuthorityKeyIdentifier();Ne.kid!==void 0&&(S+="    kid="+Ne.kid.hex+`
`)}else ce==="extKeyUsage"?S+="    "+this.getExtExtKeyUsage().array.join(", ")+`
`:ce==="subjectAltName"?S+="    "+K(this.getExtSubjectAltName())+`
`:ce==="cRLDistributionPoints"?S+=te(this.getExtCRLDistributionPoints()):ce==="authorityInfoAccess"?S+=de(this.getExtAuthorityInfoAccess()):ce==="certificatePolicies"&&(S+=Y(this.getExtCertificatePolicies()))}}return S+="signature algorithm: "+this.getSignatureAlgorithmName()+`
`,S+="signature: "+this.getSignatureValueHex().substr(0,16)+`...
`},typeof t=="string"&&(t.indexOf("-----BEGIN")!=-1?this.readCertPEM(t):F.lang.String.isHex(t)&&this.readCertHex(t))}fe.prototype.sign=function(t,e){var i=function(d){return F.crypto.Util.hashString(d,e)}(t);return this.signWithMessageHash(i,e)},fe.prototype.signWithMessageHash=function(t,e){var i=St(F.crypto.Util.getPaddedDigestInfoHex(t,e,this.n.bitLength()),16);return Ci(this.doPrivate(i).toString(16),this.n.bitLength())},fe.prototype.signPSS=function(t,e,i){var a=function(v){return F.crypto.Util.hashHex(v,e)}(Mt(t));return i===void 0&&(i=-1),this.signWithMessageHashPSS(a,e,i)},fe.prototype.signWithMessageHashPSS=function(t,e,i){var a,d=Rt(t),v=d.length,w=this.n.bitLength()-1,k=Math.ceil(w/8),T=function(S){return F.crypto.Util.hashHex(S,e)};if(i===-1||i===void 0)i=v;else if(i===-2)i=k-v-2;else if(i<-2)throw new Error("invalid salt length");if(k<v+i+2)throw new Error("data too long");var I="";i>0&&(I=new Array(i),new Re().nextBytes(I),I=String.fromCharCode.apply(String,I));var U=Rt(T(Mt("\0\0\0\0\0\0\0\0"+d+I))),D=[];for(a=0;a<k-i-v-2;a+=1)D[a]=0;var B=String.fromCharCode.apply(String,D)+""+I,$=xi(U,B.length,T),z=[];for(a=0;a<B.length;a+=1)z[a]=B.charCodeAt(a)^$.charCodeAt(a);var Q=65280>>8*k-w&255;for(z[0]&=~Q,a=0;a<v;a++)z.push(U.charCodeAt(a));return z.push(188),Ci(this.doPrivate(new W(z)).toString(16),this.n.bitLength())},fe.prototype.verify=function(t,e){if((e=e.toLowerCase()).match(/^[0-9a-f]+$/)==null)return!1;var i=St(e,16),a=this.n.bitLength();if(i.bitLength()>a)return!1;var d=this.doPublic(i).toString(16);if(d.length+3!=a/4)return!1;var v=Ri(d.replace(/^1f+00/,""));if(v.length==0)return!1;var w=v[0];return v[1]==function(T){return F.crypto.Util.hashString(T,w)}(t)},fe.prototype.verifyWithMessageHash=function(t,e){if(e.length!=Math.ceil(this.n.bitLength()/4))return!1;var i=St(e,16);if(i.bitLength()>this.n.bitLength())return 0;var a=Ri(this.doPublic(i).toString(16).replace(/^1f+00/,""));return a.length==0?!1:(a[0],a[1]==t)},fe.prototype.verifyPSS=function(t,e,i,a){var d=function(w){return F.crypto.Util.hashHex(w,i)}(Mt(t));return a===void 0&&(a=-1),this.verifyWithMessageHashPSS(d,e,i,a)},fe.prototype.verifyWithMessageHashPSS=function(t,e,i,a){if(e.length!=Math.ceil(this.n.bitLength()/4))return!1;var d,v=new W(e,16),w=function(N){return F.crypto.Util.hashHex(N,i)},k=Rt(t),T=k.length,I=this.n.bitLength()-1,U=Math.ceil(I/8);if(a===-1||a===void 0)a=T;else if(a===-2)a=U-T-2;else if(a<-2)throw new Error("invalid salt length");if(U<T+a+2)throw new Error("data too long");var D=this.doPublic(v).toByteArray();for(d=0;d<D.length;d+=1)D[d]&=255;for(;D.length<U;)D.unshift(0);if(D[U-1]!==188)throw new Error("encoded message does not end in 0xbc");var B=(D=String.fromCharCode.apply(String,D)).substr(0,U-T-1),$=D.substr(B.length,T),z=65280>>8*U-I&255;if((B.charCodeAt(0)&z)!=0)throw new Error("bits beyond keysize not zero");var Q=xi($,B.length,w),ee=[];for(d=0;d<B.length;d+=1)ee[d]=B.charCodeAt(d)^Q.charCodeAt(d);ee[0]&=~z;var S=U-T-a-2;for(d=0;d<S;d+=1)if(ee[d]!==0)throw new Error("leftmost octets not zero");if(ee[S]!==1)throw new Error("0x01 marker not found");return $===Rt(w(Mt("\0\0\0\0\0\0\0\0"+k+String.fromCharCode.apply(String,ee.slice(-a)))))},fe.SALT_LEN_HLEN=-1,fe.SALT_LEN_MAX=-2,fe.SALT_LEN_RECOVER=-2,Xe.hex2dn=function(t,e){e===void 0&&(e=0);var i=new Xe;return ue.getTLV(t,e),i.getX500Name(t).str},Xe.hex2rdn=function(t,e){if(e===void 0&&(e=0),t.substr(e,2)!=="31")throw new Error("malformed RDN");for(var i=new Array,a=ue.getChildIdx(t,e),d=0;d<a.length;d++)i.push(Xe.hex2attrTypeValue(t,a[d]));return(i=i.map(function(v){return v.replace("+","\\+")})).join("+")},Xe.hex2attrTypeValue=function(t,e){var i=ue,a=i.getV;if(e===void 0&&(e=0),t.substr(e,2)!=="30")throw new Error("malformed attribute type and value");var d=i.getChildIdx(t,e);d.length!==2||t.substr(d[0],2);var v=a(t,d[0]),w=F.asn1.ASN1Util.oidHexToInt(v);return F.asn1.x509.OID.oid2atype(w)+"="+Rt(a(t,d[1]))},Xe.getPublicKeyFromCertHex=function(t){var e=new Xe;return e.readCertHex(t),e.getPublicKey()},Xe.getPublicKeyFromCertPEM=function(t){var e=new Xe;return e.readCertPEM(t),e.getPublicKey()},Xe.getPublicKeyInfoPropOfCertPEM=function(t){var e,i,a=ue.getVbyList,d={};return d.algparam=null,(e=new Xe).readCertPEM(t),i=e.getPublicKeyHex(),d.keyhex=a(i,0,[1],"03").substr(2),d.algoid=a(i,0,[0,0],"06"),d.algoid==="2a8648ce3d0201"&&(d.algparam=a(i,0,[0,1],"06")),d},Xe.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"],F!==void 0&&F||(o.KJUR=F={}),F.jws!==void 0&&F.jws||(F.jws={}),F.jws.JWS=function(){var t=F.jws.JWS.isSafeJSONString;this.parseJWS=function(e,i){if(this.parsedJWS===void 0||!i&&this.parsedJWS.sigvalH===void 0){var a=e.match(/^([^.]+)\.([^.]+)\.([^.]+)$/);if(a==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var d=a[1],v=a[2],w=a[3],k=d+"."+v;if(this.parsedJWS={},this.parsedJWS.headB64U=d,this.parsedJWS.payloadB64U=v,this.parsedJWS.sigvalB64U=w,this.parsedJWS.si=k,!i){var T=Oe(w),I=St(T,16);this.parsedJWS.sigvalH=T,this.parsedJWS.sigvalBI=I}var U=Dt(d),D=Dt(v);if(this.parsedJWS.headS=U,this.parsedJWS.payloadS=D,!t(U,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+U}}},F.jws.JWS.sign=function(t,e,i,a,d){var v,w,k,T=F,I=T.jws.JWS,U=I.readSafeJSONString,D=I.isSafeJSONString,B=T.crypto,$=(B.ECDSA,B.Mac),z=B.Signature,Q=JSON;if(typeof e!="string"&&(e===void 0?"undefined":A(e))!="object")throw"spHeader must be JSON string or object: "+e;if((e===void 0?"undefined":A(e))=="object"&&(w=e,v=Q.stringify(w)),typeof e=="string"){if(!D(v=e))throw"JWS Head is not safe JSON string: "+v;w=U(v)}if(k=i,(i===void 0?"undefined":A(i))=="object"&&(k=Q.stringify(i)),t!=""&&t!=null||w.alg===void 0||(t=w.alg),t!=""&&t!=null&&w.alg===void 0&&(w.alg=t,v=Q.stringify(w)),t!==w.alg)throw"alg and sHeader.alg doesn't match: "+t+"!="+w.alg;var ee=null;if(I.jwsalg2sigalg[t]===void 0)throw"unsupported alg name: "+t;ee=I.jwsalg2sigalg[t];var S=mr(v)+"."+mr(k),O="";if(ee.substr(0,4)=="Hmac"){if(a===void 0)throw"mac key shall be specified for HS* alg";var N=new $({alg:ee,prov:"cryptojs",pass:a});N.updateString(S),O=N.doFinal()}else if(ee.indexOf("withECDSA")!=-1){(Y=new z({alg:ee})).init(a,d),Y.updateString(S);var K=Y.sign();O=F.crypto.ECDSA.asn1SigToConcatSig(K)}else{var Y;ee!="none"&&((Y=new z({alg:ee})).init(a,d),Y.updateString(S),O=Y.sign())}return S+"."+ze(O)},F.jws.JWS.verify=function(t,e,i){var a,d=F,v=d.jws.JWS,w=v.readSafeJSONString,k=d.crypto,T=k.ECDSA,I=k.Mac,U=k.Signature;A(fe)!==void 0&&(a=fe);var D=t.split(".");if(D.length!==3)return!1;var B=D[0]+"."+D[1],$=Oe(D[2]),z=w(Dt(D[0])),Q=null,ee=null;if(z.alg===void 0)throw"algorithm not specified in header";if(ee=(Q=z.alg).substr(0,2),i!=null&&Object.prototype.toString.call(i)==="[object Array]"&&i.length>0&&(":"+i.join(":")+":").indexOf(":"+Q+":")==-1)throw"algorithm '"+Q+"' not accepted in the list";if(Q!="none"&&e===null)throw"key shall be specified to verify.";if(typeof e=="string"&&e.indexOf("-----BEGIN ")!=-1&&(e=qe.getKey(e)),!(ee!="RS"&&ee!="PS"||e instanceof a))throw"key shall be a RSAKey obj for RS* and PS* algs";if(ee=="ES"&&!(e instanceof T))throw"key shall be a ECDSA obj for ES* algs";var S=null;if(v.jwsalg2sigalg[z.alg]===void 0)throw"unsupported alg name: "+Q;if((S=v.jwsalg2sigalg[Q])=="none")throw"not supported";if(S.substr(0,4)=="Hmac"){if(e===void 0)throw"hexadecimal key shall be specified for HMAC";var O=new I({alg:S,pass:e});return O.updateString(B),$==O.doFinal()}if(S.indexOf("withECDSA")!=-1){var N,K=null;try{K=T.concatSigToASN1Sig($)}catch{return!1}return(N=new U({alg:S})).init(e),N.updateString(B),N.verify(K)}return(N=new U({alg:S})).init(e),N.updateString(B),N.verify($)},F.jws.JWS.parse=function(t){var e,i,a,d=t.split("."),v={};if(d.length!=2&&d.length!=3)throw"malformed sJWS: wrong number of '.' splitted elements";return e=d[0],i=d[1],d.length==3&&(a=d[2]),v.headerObj=F.jws.JWS.readSafeJSONString(Dt(e)),v.payloadObj=F.jws.JWS.readSafeJSONString(Dt(i)),v.headerPP=JSON.stringify(v.headerObj,null,"  "),v.payloadObj==null?v.payloadPP=Dt(i):v.payloadPP=JSON.stringify(v.payloadObj,null,"  "),a!==void 0&&(v.sigHex=Oe(a)),v},F.jws.JWS.verifyJWT=function(t,e,i){var a=F.jws,d=a.JWS,v=d.readSafeJSONString,w=d.inArray,k=d.includedArray,T=t.split("."),I=T[0],U=T[1],D=(Oe(T[2]),v(Dt(I))),B=v(Dt(U));if(D.alg===void 0)return!1;if(i.alg===void 0)throw"acceptField.alg shall be specified";if(!w(D.alg,i.alg)||B.iss!==void 0&&A(i.iss)==="object"&&!w(B.iss,i.iss)||B.sub!==void 0&&A(i.sub)==="object"&&!w(B.sub,i.sub))return!1;if(B.aud!==void 0&&A(i.aud)==="object"){if(typeof B.aud=="string"){if(!w(B.aud,i.aud))return!1}else if(A(B.aud)=="object"&&!k(B.aud,i.aud))return!1}var $=a.IntDate.getNow();return i.verifyAt!==void 0&&typeof i.verifyAt=="number"&&($=i.verifyAt),i.gracePeriod!==void 0&&typeof i.gracePeriod=="number"||(i.gracePeriod=0),!(B.exp!==void 0&&typeof B.exp=="number"&&B.exp+i.gracePeriod<$)&&!(B.nbf!==void 0&&typeof B.nbf=="number"&&$<B.nbf-i.gracePeriod)&&!(B.iat!==void 0&&typeof B.iat=="number"&&$<B.iat-i.gracePeriod)&&(B.jti===void 0||i.jti===void 0||B.jti===i.jti)&&!!d.verify(t,e,i.alg)},F.jws.JWS.includedArray=function(t,e){var i=F.jws.JWS.inArray;if(t===null||(t===void 0?"undefined":A(t))!=="object"||typeof t.length!="number")return!1;for(var a=0;a<t.length;a++)if(!i(t[a],e))return!1;return!0},F.jws.JWS.inArray=function(t,e){if(e===null||(e===void 0?"undefined":A(e))!=="object"||typeof e.length!="number")return!1;for(var i=0;i<e.length;i++)if(e[i]==t)return!0;return!1},F.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS384:"HmacSHA384",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"},F.jws.JWS.isSafeJSONString=function(t,e,i){var a=null;try{return((a=yi(t))===void 0?"undefined":A(a))!="object"||a.constructor===Array?0:(e&&(e[i]=a),1)}catch{return 0}},F.jws.JWS.readSafeJSONString=function(t){var e=null;try{return((e=yi(t))===void 0?"undefined":A(e))!="object"||e.constructor===Array?null:e}catch{return null}},F.jws.JWS.getEncodedSignatureValueFromJWS=function(t){var e=t.match(/^[^.]+\.[^.]+\.([^.]+)$/);if(e==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return e[1]},F.jws.JWS.getJWKthumbprint=function(t){if(t.kty!=="RSA"&&t.kty!=="EC"&&t.kty!=="oct")throw"unsupported algorithm for JWK Thumprint";var e="{";if(t.kty==="RSA"){if(typeof t.n!="string"||typeof t.e!="string")throw"wrong n and e value for RSA key";e+='"e":"'+t.e+'",',e+='"kty":"'+t.kty+'",',e+='"n":"'+t.n+'"}'}else if(t.kty==="EC"){if(typeof t.crv!="string"||typeof t.x!="string"||typeof t.y!="string")throw"wrong crv, x and y value for EC key";e+='"crv":"'+t.crv+'",',e+='"kty":"'+t.kty+'",',e+='"x":"'+t.x+'",',e+='"y":"'+t.y+'"}'}else if(t.kty==="oct"){if(typeof t.k!="string")throw"wrong k value for oct(symmetric) key";e+='"kty":"'+t.kty+'",',e+='"k":"'+t.k+'"}'}var i=Mt(e);return ze(F.crypto.Util.hashHex(i,"sha256"))},F.jws.IntDate={},F.jws.IntDate.get=function(t){var e=F.jws.IntDate,i=e.getNow,a=e.getZulu;if(t=="now")return i();if(t=="now + 1hour")return i()+3600;if(t=="now + 1day")return i()+86400;if(t=="now + 1month")return i()+2592e3;if(t=="now + 1year")return i()+31536e3;if(t.match(/Z$/))return a(t);if(t.match(/^[0-9]+$/))return parseInt(t);throw"unsupported format: "+t},F.jws.IntDate.getZulu=function(t){return Ei(t)},F.jws.IntDate.getNow=function(){return~~(new Date/1e3)},F.jws.IntDate.intDate2UTCString=function(t){return new Date(1e3*t).toUTCString()},F.jws.IntDate.intDate2Zulu=function(t){var e=new Date(1e3*t);return("0000"+e.getUTCFullYear()).slice(-4)+("00"+(e.getUTCMonth()+1)).slice(-2)+("00"+e.getUTCDate()).slice(-2)+("00"+e.getUTCHours()).slice(-2)+("00"+e.getUTCMinutes()).slice(-2)+("00"+e.getUTCSeconds()).slice(-2)+"Z"},o.SecureRandom=Re,o.rng_seed_time=X,o.BigInteger=W,o.RSAKey=fe;var es=F.crypto.EDSA;o.EDSA=es;var ts=F.crypto.DSA;o.DSA=ts;var rs=F.crypto.Signature;o.Signature=rs;var ns=F.crypto.MessageDigest;o.MessageDigest=ns;var is=F.crypto.Mac;o.Mac=is;var os=F.crypto.Cipher;o.Cipher=os,o.KEYUTIL=qe,o.ASN1HEX=ue,o.X509=Xe,o.CryptoJS=M,o.b64tohex=ne,o.b64toBA=ie,o.stoBA=vi,o.BAtos=mi,o.BAtohex=Ur,o.stohex=qt,o.stob64=function(e){return j(qt(e))},o.stob64u=function(e){return Or(j(qt(e)))},o.b64utos=function(e){return mi(ie(_r(e)))},o.b64tob64u=Or,o.b64utob64=_r,o.hex2b64=j,o.hextob64u=ze,o.b64utohex=Oe,o.utf8tob64u=mr,o.b64utoutf8=Dt,o.utf8tob64=function(e){return j(Dr(Nr(e)))},o.b64toutf8=function(e){return decodeURIComponent(Hr(ne(e)))},o.utf8tohex=pn,o.hextoutf8=Ye,o.hextorstr=Rt,o.rstrtohex=Mt,o.hextob64=_i,o.hextob64nl=Si,o.b64nltohex=wi,o.hextopem=wt,o.pemtohex=Kt,o.hextoArrayBuffer=function(e){if(e.length%2!=0)throw"input is not even length";if(e.match(/^[0-9A-Fa-f]+$/)==null)throw"input is not hexadecimal";for(var i=new ArrayBuffer(e.length/2),a=new DataView(i),d=0;d<e.length/2;d++)a.setUint8(d,parseInt(e.substr(2*d,2),16));return i},o.ArrayBuffertohex=function(e){for(var i="",a=new DataView(e),d=0;d<e.byteLength;d++)i+=("00"+a.getUint8(d).toString(16)).slice(-2);return i},o.zulutomsec=gn,o.zulutosec=Ei,o.zulutodate=function(e){return new Date(gn(e))},o.datetozulu=function(e,i,a){var d,v=e.getUTCFullYear();if(i){if(v<1950||2049<v)throw"not proper year for UTCTime: "+v;d=(""+v).slice(-2)}else d=("000"+v).slice(-4);if(d+=("0"+(e.getUTCMonth()+1)).slice(-2),d+=("0"+e.getUTCDate()).slice(-2),d+=("0"+e.getUTCHours()).slice(-2),d+=("0"+e.getUTCMinutes()).slice(-2),d+=("0"+e.getUTCSeconds()).slice(-2),a){var w=e.getUTCMilliseconds();w!==0&&(d+="."+(w=(w=("00"+w).slice(-3)).replace(/0+$/g,"")))}return d+="Z"},o.uricmptohex=Dr,o.hextouricmp=Hr,o.ipv6tohex=bi,o.hextoipv6=Fi,o.hextoip=yn,o.iptohex=function(e){var i="malformed IP address";if(!(e=e.toLowerCase(e)).match(/^[0-9.]+$/)){if(e.match(/^[0-9a-f:]+$/)&&e.indexOf(":")!==-1)return bi(e);throw i}var a=e.split(".");if(a.length!==4)throw i;var d="";try{for(var v=0;v<4;v++)d+=("0"+parseInt(a[v]).toString(16)).slice(-2);return d}catch{throw i}},o.encodeURIComponentAll=Nr,o.newline_toUnix=function(e){return e=e.replace(/\r\n/gm,`
`)},o.newline_toDos=function(e){return e=(e=e.replace(/\r\n/gm,`
`)).replace(/\n/gm,`\r
`)},o.hextoposhex=vn,o.intarystrtohex=function(e){e=(e=(e=e.replace(/^\s*\[\s*/,"")).replace(/\s*\]\s*$/,"")).replace(/\s*/g,"");try{return e.split(/,/).map(function(i,a,d){var v=parseInt(i);if(v<0||255<v)throw"integer not in range 0-255";return("00"+v.toString(16)).slice(-2)}).join("")}catch(i){throw"malformed integer array string: "+i}},o.strdiffidx=function(e,i){var a=e.length;e.length>i.length&&(a=i.length);for(var d=0;d<a;d++)if(e.charCodeAt(d)!=i.charCodeAt(d))return d;return e.length!=i.length?a:-1},o.KJUR=F;var ss=F.crypto;o.crypto=ss;var as=F.asn1;o.asn1=as;var us=F.jws;o.jws=us;var cs=F.lang;o.lang=cs}).call(this,c(28).Buffer)},function(s,o,c){(function(l){/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */var u=c(30),g=c(31),y=c(32);function f(){return p.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function h(V,m){if(f()<m)throw new RangeError("Invalid typed array length");return p.TYPED_ARRAY_SUPPORT?(V=new Uint8Array(m)).__proto__=p.prototype:(V===null&&(V=new p(m)),V.length=m),V}function p(V,m,_){if(!(p.TYPED_ARRAY_SUPPORT||this instanceof p))return new p(V,m,_);if(typeof V=="number"){if(typeof m=="string")throw new Error("If encoding is specified then the first argument must be a string");return b(this,V)}return E(this,V,m,_)}function E(V,m,_,L){if(typeof m=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer!="undefined"&&m instanceof ArrayBuffer?function(X,re,he,ve){if(re.byteLength,he<0||re.byteLength<he)throw new RangeError("'offset' is out of bounds");if(re.byteLength<he+(ve||0))throw new RangeError("'length' is out of bounds");return re=he===void 0&&ve===void 0?new Uint8Array(re):ve===void 0?new Uint8Array(re,he):new Uint8Array(re,he,ve),p.TYPED_ARRAY_SUPPORT?(X=re).__proto__=p.prototype:X=x(X,re),X}(V,m,_,L):typeof m=="string"?function(X,re,he){if(typeof he=="string"&&he!==""||(he="utf8"),!p.isEncoding(he))throw new TypeError('"encoding" must be a valid string encoding');var ve=0|A(re,he),Ce=(X=h(X,ve)).write(re,he);return Ce!==ve&&(X=X.slice(0,Ce)),X}(V,m,_):function(X,re){if(p.isBuffer(re)){var he=0|R(re.length);return(X=h(X,he)).length===0||re.copy(X,0,0,he),X}if(re){if(typeof ArrayBuffer!="undefined"&&re.buffer instanceof ArrayBuffer||"length"in re)return typeof re.length!="number"||function(Ce){return Ce!=Ce}(re.length)?h(X,0):x(X,re);if(re.type==="Buffer"&&y(re.data))return x(X,re.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(V,m)}function C(V){if(typeof V!="number")throw new TypeError('"size" argument must be a number');if(V<0)throw new RangeError('"size" argument must not be negative')}function b(V,m){if(C(m),V=h(V,m<0?0:0|R(m)),!p.TYPED_ARRAY_SUPPORT)for(var _=0;_<m;++_)V[_]=0;return V}function x(V,m){var _=m.length<0?0:0|R(m.length);V=h(V,_);for(var L=0;L<_;L+=1)V[L]=255&m[L];return V}function R(V){if(V>=f())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+f().toString(16)+" bytes");return 0|V}function A(V,m){if(p.isBuffer(V))return V.length;if(typeof ArrayBuffer!="undefined"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(V)||V instanceof ArrayBuffer))return V.byteLength;typeof V!="string"&&(V=""+V);var _=V.length;if(_===0)return 0;for(var L=!1;;)switch(m){case"ascii":case"latin1":case"binary":return _;case"utf8":case"utf-8":case void 0:return _t(V).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*_;case"hex":return _>>>1;case"base64":return tt(V).length;default:if(L)return _t(V).length;m=(""+m).toLowerCase(),L=!0}}function P(V,m,_){var L=!1;if((m===void 0||m<0)&&(m=0),m>this.length||((_===void 0||_>this.length)&&(_=this.length),_<=0)||(_>>>=0)<=(m>>>=0))return"";for(V||(V="utf8");;)switch(V){case"hex":return Ee(this,m,_);case"utf8":case"utf-8":return be(this,m,_);case"ascii":return ae(this,m,_);case"latin1":case"binary":return pe(this,m,_);case"base64":return Te(this,m,_);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Fe(this,m,_);default:if(L)throw new TypeError("Unknown encoding: "+V);V=(V+"").toLowerCase(),L=!0}}function H(V,m,_){var L=V[m];V[m]=V[_],V[_]=L}function M(V,m,_,L,q){if(V.length===0)return-1;if(typeof _=="string"?(L=_,_=0):_>2147483647?_=2147483647:_<-2147483648&&(_=-2147483648),_=+_,isNaN(_)&&(_=q?0:V.length-1),_<0&&(_=V.length+_),_>=V.length){if(q)return-1;_=V.length-1}else if(_<0){if(!q)return-1;_=0}if(typeof m=="string"&&(m=p.from(m,L)),p.isBuffer(m))return m.length===0?-1:G(V,m,_,L,q);if(typeof m=="number")return m&=255,p.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?q?Uint8Array.prototype.indexOf.call(V,m,_):Uint8Array.prototype.lastIndexOf.call(V,m,_):G(V,[m],_,L,q);throw new TypeError("val must be string, number or Buffer")}function G(V,m,_,L,q){var X,re=1,he=V.length,ve=m.length;if(L!==void 0&&((L=String(L).toLowerCase())==="ucs2"||L==="ucs-2"||L==="utf16le"||L==="utf-16le")){if(V.length<2||m.length<2)return-1;re=2,he/=2,ve/=2,_/=2}function Ce(Ot,fe){return re===1?Ot[fe]:Ot.readUInt16BE(fe*re)}if(q){var Ae=-1;for(X=_;X<he;X++)if(Ce(V,X)===Ce(m,Ae===-1?0:X-Ae)){if(Ae===-1&&(Ae=X),X-Ae+1===ve)return Ae*re}else Ae!==-1&&(X-=X-Ae),Ae=-1}else for(_+ve>he&&(_=he-ve),X=_;X>=0;X--){for(var Re=!0,St=0;St<ve;St++)if(Ce(V,X+St)!==Ce(m,St)){Re=!1;break}if(Re)return X}return-1}function J(V,m,_,L){_=Number(_)||0;var q=V.length-_;L?(L=Number(L))>q&&(L=q):L=q;var X=m.length;if(X%2!=0)throw new TypeError("Invalid hex string");L>X/2&&(L=X/2);for(var re=0;re<L;++re){var he=parseInt(m.substr(2*re,2),16);if(isNaN(he))return re;V[_+re]=he}return re}function j(V,m,_,L){return He(_t(m,V.length-_),V,_,L)}function ne(V,m,_,L){return He(function(X){for(var re=[],he=0;he<X.length;++he)re.push(255&X.charCodeAt(he));return re}(m),V,_,L)}function ie(V,m,_,L){return ne(V,m,_,L)}function W(V,m,_,L){return He(tt(m),V,_,L)}function oe(V,m,_,L){return He(function(X,re){for(var he,ve,Ce,Ae=[],Re=0;Re<X.length&&!((re-=2)<0);++Re)ve=(he=X.charCodeAt(Re))>>8,Ce=he%256,Ae.push(Ce),Ae.push(ve);return Ae}(m,V.length-_),V,_,L)}function Te(V,m,_){return m===0&&_===V.length?u.fromByteArray(V):u.fromByteArray(V.slice(m,_))}function be(V,m,_){_=Math.min(V.length,_);for(var L=[],q=m;q<_;){var X,re,he,ve,Ce=V[q],Ae=null,Re=Ce>239?4:Ce>223?3:Ce>191?2:1;if(q+Re<=_)switch(Re){case 1:Ce<128&&(Ae=Ce);break;case 2:(192&(X=V[q+1]))==128&&(ve=(31&Ce)<<6|63&X)>127&&(Ae=ve);break;case 3:X=V[q+1],re=V[q+2],(192&X)==128&&(192&re)==128&&(ve=(15&Ce)<<12|(63&X)<<6|63&re)>2047&&(ve<55296||ve>57343)&&(Ae=ve);break;case 4:X=V[q+1],re=V[q+2],he=V[q+3],(192&X)==128&&(192&re)==128&&(192&he)==128&&(ve=(15&Ce)<<18|(63&X)<<12|(63&re)<<6|63&he)>65535&&ve<1114112&&(Ae=ve)}Ae===null?(Ae=65533,Re=1):Ae>65535&&(Ae-=65536,L.push(Ae>>>10&1023|55296),Ae=56320|1023&Ae),L.push(Ae),q+=Re}return function(Ot){var fe=Ot.length;if(fe<=Z)return String.fromCharCode.apply(String,Ot);for(var Ke="",we=0;we<fe;)Ke+=String.fromCharCode.apply(String,Ot.slice(we,we+=Z));return Ke}(L)}o.Buffer=p,o.SlowBuffer=function(m){return+m!=m&&(m=0),p.alloc(+m)},o.INSPECT_MAX_BYTES=50,p.TYPED_ARRAY_SUPPORT=l.TYPED_ARRAY_SUPPORT!==void 0?l.TYPED_ARRAY_SUPPORT:function(){try{var m=new Uint8Array(1);return m.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},m.foo()===42&&typeof m.subarray=="function"&&m.subarray(1,1).byteLength===0}catch{return!1}}(),o.kMaxLength=f(),p.poolSize=8192,p._augment=function(V){return V.__proto__=p.prototype,V},p.from=function(V,m,_){return E(null,V,m,_)},p.TYPED_ARRAY_SUPPORT&&(p.prototype.__proto__=Uint8Array.prototype,p.__proto__=Uint8Array,typeof Symbol!="undefined"&&Symbol.species&&p[Symbol.species]===p&&Object.defineProperty(p,Symbol.species,{value:null,configurable:!0})),p.alloc=function(V,m,_){return function(q,X,re,he){return C(X),X<=0?h(q,X):re!==void 0?typeof he=="string"?h(q,X).fill(re,he):h(q,X).fill(re):h(q,X)}(null,V,m,_)},p.allocUnsafe=function(V){return b(null,V)},p.allocUnsafeSlow=function(V){return b(null,V)},p.isBuffer=function(m){return!(m==null||!m._isBuffer)},p.compare=function(m,_){if(!p.isBuffer(m)||!p.isBuffer(_))throw new TypeError("Arguments must be Buffers");if(m===_)return 0;for(var L=m.length,q=_.length,X=0,re=Math.min(L,q);X<re;++X)if(m[X]!==_[X]){L=m[X],q=_[X];break}return L<q?-1:q<L?1:0},p.isEncoding=function(m){switch(String(m).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},p.concat=function(m,_){if(!y(m))throw new TypeError('"list" argument must be an Array of Buffers');if(m.length===0)return p.alloc(0);var L;if(_===void 0)for(_=0,L=0;L<m.length;++L)_+=m[L].length;var q=p.allocUnsafe(_),X=0;for(L=0;L<m.length;++L){var re=m[L];if(!p.isBuffer(re))throw new TypeError('"list" argument must be an Array of Buffers');re.copy(q,X),X+=re.length}return q},p.byteLength=A,p.prototype._isBuffer=!0,p.prototype.swap16=function(){var m=this.length;if(m%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var _=0;_<m;_+=2)H(this,_,_+1);return this},p.prototype.swap32=function(){var m=this.length;if(m%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var _=0;_<m;_+=4)H(this,_,_+3),H(this,_+1,_+2);return this},p.prototype.swap64=function(){var m=this.length;if(m%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var _=0;_<m;_+=8)H(this,_,_+7),H(this,_+1,_+6),H(this,_+2,_+5),H(this,_+3,_+4);return this},p.prototype.toString=function(){var m=0|this.length;return m===0?"":arguments.length===0?be(this,0,m):P.apply(this,arguments)},p.prototype.equals=function(m){if(!p.isBuffer(m))throw new TypeError("Argument must be a Buffer");return this===m||p.compare(this,m)===0},p.prototype.inspect=function(){var m="",_=o.INSPECT_MAX_BYTES;return this.length>0&&(m=this.toString("hex",0,_).match(/.{2}/g).join(" "),this.length>_&&(m+=" ... ")),"<Buffer "+m+">"},p.prototype.compare=function(m,_,L,q,X){if(!p.isBuffer(m))throw new TypeError("Argument must be a Buffer");if(_===void 0&&(_=0),L===void 0&&(L=m?m.length:0),q===void 0&&(q=0),X===void 0&&(X=this.length),_<0||L>m.length||q<0||X>this.length)throw new RangeError("out of range index");if(q>=X&&_>=L)return 0;if(q>=X)return-1;if(_>=L)return 1;if(this===m)return 0;for(var re=(X>>>=0)-(q>>>=0),he=(L>>>=0)-(_>>>=0),ve=Math.min(re,he),Ce=this.slice(q,X),Ae=m.slice(_,L),Re=0;Re<ve;++Re)if(Ce[Re]!==Ae[Re]){re=Ce[Re],he=Ae[Re];break}return re<he?-1:he<re?1:0},p.prototype.includes=function(m,_,L){return this.indexOf(m,_,L)!==-1},p.prototype.indexOf=function(m,_,L){return M(this,m,_,L,!0)},p.prototype.lastIndexOf=function(m,_,L){return M(this,m,_,L,!1)},p.prototype.write=function(m,_,L,q){if(_===void 0)q="utf8",L=this.length,_=0;else if(L===void 0&&typeof _=="string")q=_,L=this.length,_=0;else{if(!isFinite(_))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");_|=0,isFinite(L)?(L|=0,q===void 0&&(q="utf8")):(q=L,L=void 0)}var X=this.length-_;if((L===void 0||L>X)&&(L=X),m.length>0&&(L<0||_<0)||_>this.length)throw new RangeError("Attempt to write outside buffer bounds");q||(q="utf8");for(var re=!1;;)switch(q){case"hex":return J(this,m,_,L);case"utf8":case"utf-8":return j(this,m,_,L);case"ascii":return ne(this,m,_,L);case"latin1":case"binary":return ie(this,m,_,L);case"base64":return W(this,m,_,L);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return oe(this,m,_,L);default:if(re)throw new TypeError("Unknown encoding: "+q);q=(""+q).toLowerCase(),re=!0}},p.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Z=4096;function ae(V,m,_){var L="";_=Math.min(V.length,_);for(var q=m;q<_;++q)L+=String.fromCharCode(127&V[q]);return L}function pe(V,m,_){var L="";_=Math.min(V.length,_);for(var q=m;q<_;++q)L+=String.fromCharCode(V[q]);return L}function Ee(V,m,_){var L=V.length;(!m||m<0)&&(m=0),(!_||_<0||_>L)&&(_=L);for(var q="",X=m;X<_;++X)q+=ut(V[X]);return q}function Fe(V,m,_){for(var L=V.slice(m,_),q="",X=0;X<L.length;X+=2)q+=String.fromCharCode(L[X]+256*L[X+1]);return q}function le(V,m,_){if(V%1!=0||V<0)throw new RangeError("offset is not uint");if(V+m>_)throw new RangeError("Trying to access beyond buffer length")}function _e(V,m,_,L,q,X){if(!p.isBuffer(V))throw new TypeError('"buffer" argument must be a Buffer instance');if(m>q||m<X)throw new RangeError('"value" argument is out of bounds');if(_+L>V.length)throw new RangeError("Index out of range")}function Me(V,m,_,L){m<0&&(m=65535+m+1);for(var q=0,X=Math.min(V.length-_,2);q<X;++q)V[_+q]=(m&255<<8*(L?q:1-q))>>>8*(L?q:1-q)}function Ve(V,m,_,L){m<0&&(m=4294967295+m+1);for(var q=0,X=Math.min(V.length-_,4);q<X;++q)V[_+q]=m>>>8*(L?q:3-q)&255}function vt(V,m,_,L,q,X){if(_+L>V.length)throw new RangeError("Index out of range");if(_<0)throw new RangeError("Index out of range")}function mt(V,m,_,L,q){return q||vt(V,0,_,4),g.write(V,m,_,L,23,4),_+4}function Ct(V,m,_,L,q){return q||vt(V,0,_,8),g.write(V,m,_,L,52,8),_+8}p.prototype.slice=function(m,_){var L,q=this.length;if((m=~~m)<0?(m+=q)<0&&(m=0):m>q&&(m=q),(_=_===void 0?q:~~_)<0?(_+=q)<0&&(_=0):_>q&&(_=q),_<m&&(_=m),p.TYPED_ARRAY_SUPPORT)(L=this.subarray(m,_)).__proto__=p.prototype;else{var X=_-m;L=new p(X,void 0);for(var re=0;re<X;++re)L[re]=this[re+m]}return L},p.prototype.readUIntLE=function(m,_,L){m|=0,_|=0,L||le(m,_,this.length);for(var q=this[m],X=1,re=0;++re<_&&(X*=256);)q+=this[m+re]*X;return q},p.prototype.readUIntBE=function(m,_,L){m|=0,_|=0,L||le(m,_,this.length);for(var q=this[m+--_],X=1;_>0&&(X*=256);)q+=this[m+--_]*X;return q},p.prototype.readUInt8=function(m,_){return _||le(m,1,this.length),this[m]},p.prototype.readUInt16LE=function(m,_){return _||le(m,2,this.length),this[m]|this[m+1]<<8},p.prototype.readUInt16BE=function(m,_){return _||le(m,2,this.length),this[m]<<8|this[m+1]},p.prototype.readUInt32LE=function(m,_){return _||le(m,4,this.length),(this[m]|this[m+1]<<8|this[m+2]<<16)+16777216*this[m+3]},p.prototype.readUInt32BE=function(m,_){return _||le(m,4,this.length),16777216*this[m]+(this[m+1]<<16|this[m+2]<<8|this[m+3])},p.prototype.readIntLE=function(m,_,L){m|=0,_|=0,L||le(m,_,this.length);for(var q=this[m],X=1,re=0;++re<_&&(X*=256);)q+=this[m+re]*X;return q>=(X*=128)&&(q-=Math.pow(2,8*_)),q},p.prototype.readIntBE=function(m,_,L){m|=0,_|=0,L||le(m,_,this.length);for(var q=_,X=1,re=this[m+--q];q>0&&(X*=256);)re+=this[m+--q]*X;return re>=(X*=128)&&(re-=Math.pow(2,8*_)),re},p.prototype.readInt8=function(m,_){return _||le(m,1,this.length),128&this[m]?-1*(255-this[m]+1):this[m]},p.prototype.readInt16LE=function(m,_){_||le(m,2,this.length);var L=this[m]|this[m+1]<<8;return 32768&L?4294901760|L:L},p.prototype.readInt16BE=function(m,_){_||le(m,2,this.length);var L=this[m+1]|this[m]<<8;return 32768&L?4294901760|L:L},p.prototype.readInt32LE=function(m,_){return _||le(m,4,this.length),this[m]|this[m+1]<<8|this[m+2]<<16|this[m+3]<<24},p.prototype.readInt32BE=function(m,_){return _||le(m,4,this.length),this[m]<<24|this[m+1]<<16|this[m+2]<<8|this[m+3]},p.prototype.readFloatLE=function(m,_){return _||le(m,4,this.length),g.read(this,m,!0,23,4)},p.prototype.readFloatBE=function(m,_){return _||le(m,4,this.length),g.read(this,m,!1,23,4)},p.prototype.readDoubleLE=function(m,_){return _||le(m,8,this.length),g.read(this,m,!0,52,8)},p.prototype.readDoubleBE=function(m,_){return _||le(m,8,this.length),g.read(this,m,!1,52,8)},p.prototype.writeUIntLE=function(m,_,L,q){m=+m,_|=0,L|=0,q||_e(this,m,_,L,Math.pow(2,8*L)-1,0);var X=1,re=0;for(this[_]=255&m;++re<L&&(X*=256);)this[_+re]=m/X&255;return _+L},p.prototype.writeUIntBE=function(m,_,L,q){m=+m,_|=0,L|=0,q||_e(this,m,_,L,Math.pow(2,8*L)-1,0);var X=L-1,re=1;for(this[_+X]=255&m;--X>=0&&(re*=256);)this[_+X]=m/re&255;return _+L},p.prototype.writeUInt8=function(m,_,L){return m=+m,_|=0,L||_e(this,m,_,1,255,0),p.TYPED_ARRAY_SUPPORT||(m=Math.floor(m)),this[_]=255&m,_+1},p.prototype.writeUInt16LE=function(m,_,L){return m=+m,_|=0,L||_e(this,m,_,2,65535,0),p.TYPED_ARRAY_SUPPORT?(this[_]=255&m,this[_+1]=m>>>8):Me(this,m,_,!0),_+2},p.prototype.writeUInt16BE=function(m,_,L){return m=+m,_|=0,L||_e(this,m,_,2,65535,0),p.TYPED_ARRAY_SUPPORT?(this[_]=m>>>8,this[_+1]=255&m):Me(this,m,_,!1),_+2},p.prototype.writeUInt32LE=function(m,_,L){return m=+m,_|=0,L||_e(this,m,_,4,4294967295,0),p.TYPED_ARRAY_SUPPORT?(this[_+3]=m>>>24,this[_+2]=m>>>16,this[_+1]=m>>>8,this[_]=255&m):Ve(this,m,_,!0),_+4},p.prototype.writeUInt32BE=function(m,_,L){return m=+m,_|=0,L||_e(this,m,_,4,4294967295,0),p.TYPED_ARRAY_SUPPORT?(this[_]=m>>>24,this[_+1]=m>>>16,this[_+2]=m>>>8,this[_+3]=255&m):Ve(this,m,_,!1),_+4},p.prototype.writeIntLE=function(m,_,L,q){if(m=+m,_|=0,!q){var X=Math.pow(2,8*L-1);_e(this,m,_,L,X-1,-X)}var re=0,he=1,ve=0;for(this[_]=255&m;++re<L&&(he*=256);)m<0&&ve===0&&this[_+re-1]!==0&&(ve=1),this[_+re]=(m/he>>0)-ve&255;return _+L},p.prototype.writeIntBE=function(m,_,L,q){if(m=+m,_|=0,!q){var X=Math.pow(2,8*L-1);_e(this,m,_,L,X-1,-X)}var re=L-1,he=1,ve=0;for(this[_+re]=255&m;--re>=0&&(he*=256);)m<0&&ve===0&&this[_+re+1]!==0&&(ve=1),this[_+re]=(m/he>>0)-ve&255;return _+L},p.prototype.writeInt8=function(m,_,L){return m=+m,_|=0,L||_e(this,m,_,1,127,-128),p.TYPED_ARRAY_SUPPORT||(m=Math.floor(m)),m<0&&(m=255+m+1),this[_]=255&m,_+1},p.prototype.writeInt16LE=function(m,_,L){return m=+m,_|=0,L||_e(this,m,_,2,32767,-32768),p.TYPED_ARRAY_SUPPORT?(this[_]=255&m,this[_+1]=m>>>8):Me(this,m,_,!0),_+2},p.prototype.writeInt16BE=function(m,_,L){return m=+m,_|=0,L||_e(this,m,_,2,32767,-32768),p.TYPED_ARRAY_SUPPORT?(this[_]=m>>>8,this[_+1]=255&m):Me(this,m,_,!1),_+2},p.prototype.writeInt32LE=function(m,_,L){return m=+m,_|=0,L||_e(this,m,_,4,2147483647,-2147483648),p.TYPED_ARRAY_SUPPORT?(this[_]=255&m,this[_+1]=m>>>8,this[_+2]=m>>>16,this[_+3]=m>>>24):Ve(this,m,_,!0),_+4},p.prototype.writeInt32BE=function(m,_,L){return m=+m,_|=0,L||_e(this,m,_,4,2147483647,-2147483648),m<0&&(m=4294967295+m+1),p.TYPED_ARRAY_SUPPORT?(this[_]=m>>>24,this[_+1]=m>>>16,this[_+2]=m>>>8,this[_+3]=255&m):Ve(this,m,_,!1),_+4},p.prototype.writeFloatLE=function(m,_,L){return mt(this,m,_,!0,L)},p.prototype.writeFloatBE=function(m,_,L){return mt(this,m,_,!1,L)},p.prototype.writeDoubleLE=function(m,_,L){return Ct(this,m,_,!0,L)},p.prototype.writeDoubleBE=function(m,_,L){return Ct(this,m,_,!1,L)},p.prototype.copy=function(m,_,L,q){if(L||(L=0),q||q===0||(q=this.length),_>=m.length&&(_=m.length),_||(_=0),q>0&&q<L&&(q=L),q===L||m.length===0||this.length===0)return 0;if(_<0)throw new RangeError("targetStart out of bounds");if(L<0||L>=this.length)throw new RangeError("sourceStart out of bounds");if(q<0)throw new RangeError("sourceEnd out of bounds");q>this.length&&(q=this.length),m.length-_<q-L&&(q=m.length-_+L);var X,re=q-L;if(this===m&&L<_&&_<q)for(X=re-1;X>=0;--X)m[X+_]=this[X+L];else if(re<1e3||!p.TYPED_ARRAY_SUPPORT)for(X=0;X<re;++X)m[X+_]=this[X+L];else Uint8Array.prototype.set.call(m,this.subarray(L,L+re),_);return re},p.prototype.fill=function(m,_,L,q){if(typeof m=="string"){if(typeof _=="string"?(q=_,_=0,L=this.length):typeof L=="string"&&(q=L,L=this.length),m.length===1){var X=m.charCodeAt(0);X<256&&(m=X)}if(q!==void 0&&typeof q!="string")throw new TypeError("encoding must be a string");if(typeof q=="string"&&!p.isEncoding(q))throw new TypeError("Unknown encoding: "+q)}else typeof m=="number"&&(m&=255);if(_<0||this.length<_||this.length<L)throw new RangeError("Out of range index");if(L<=_)return this;var re;if(_>>>=0,L=L===void 0?this.length:L>>>0,m||(m=0),typeof m=="number")for(re=_;re<L;++re)this[re]=m;else{var he=p.isBuffer(m)?m:_t(new p(m,q).toString()),ve=he.length;for(re=0;re<L-_;++re)this[re+_]=he[re%ve]}return this};var Vt=/[^+\/0-9A-Za-z-_]/g;function ut(V){return V<16?"0"+V.toString(16):V.toString(16)}function _t(V,m){var _;m=m||1/0;for(var L=V.length,q=null,X=[],re=0;re<L;++re){if((_=V.charCodeAt(re))>55295&&_<57344){if(!q){if(_>56319){(m-=3)>-1&&X.push(239,191,189);continue}if(re+1===L){(m-=3)>-1&&X.push(239,191,189);continue}q=_;continue}if(_<56320){(m-=3)>-1&&X.push(239,191,189),q=_;continue}_=65536+(q-55296<<10|_-56320)}else q&&(m-=3)>-1&&X.push(239,191,189);if(q=null,_<128){if((m-=1)<0)break;X.push(_)}else if(_<2048){if((m-=2)<0)break;X.push(_>>6|192,63&_|128)}else if(_<65536){if((m-=3)<0)break;X.push(_>>12|224,_>>6&63|128,63&_|128)}else{if(!(_<1114112))throw new Error("Invalid code point");if((m-=4)<0)break;X.push(_>>18|240,_>>12&63|128,_>>6&63|128,63&_|128)}}return X}function tt(V){return u.toByteArray(function(_){if((_=function(q){return q.trim?q.trim():q.replace(/^\s+|\s+$/g,"")}(_).replace(Vt,"")).length<2)return"";for(;_.length%4!=0;)_+="=";return _}(V))}function He(V,m,_,L){for(var q=0;q<L&&!(q+_>=m.length||q>=V.length);++q)m[q+_]=V[q];return q}}).call(this,c(29))},function(s,o){var c;c=function(){return this}();try{c=c||new Function("return this")()}catch{typeof window=="object"&&(c=window)}s.exports=c},function(s,o,c){o.byteLength=function(b){var x=p(b),R=x[0],A=x[1];return 3*(R+A)/4-A},o.toByteArray=function(b){var x,R,A=p(b),P=A[0],H=A[1],M=new g(function(ne,ie,W){return 3*(ie+W)/4-W}(0,P,H)),G=0,J=H>0?P-4:P;for(R=0;R<J;R+=4)x=u[b.charCodeAt(R)]<<18|u[b.charCodeAt(R+1)]<<12|u[b.charCodeAt(R+2)]<<6|u[b.charCodeAt(R+3)],M[G++]=x>>16&255,M[G++]=x>>8&255,M[G++]=255&x;return H===2&&(x=u[b.charCodeAt(R)]<<2|u[b.charCodeAt(R+1)]>>4,M[G++]=255&x),H===1&&(x=u[b.charCodeAt(R)]<<10|u[b.charCodeAt(R+1)]<<4|u[b.charCodeAt(R+2)]>>2,M[G++]=x>>8&255,M[G++]=255&x),M},o.fromByteArray=function(b){for(var x,R=b.length,A=R%3,P=[],H=16383,M=0,G=R-A;M<G;M+=H)P.push(E(b,M,M+H>G?G:M+H));return A===1?(x=b[R-1],P.push(l[x>>2]+l[x<<4&63]+"==")):A===2&&(x=(b[R-2]<<8)+b[R-1],P.push(l[x>>10]+l[x>>4&63]+l[x<<2&63]+"=")),P.join("")};for(var l=[],u=[],g=typeof Uint8Array!="undefined"?Uint8Array:Array,y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f=0,h=y.length;f<h;++f)l[f]=y[f],u[y.charCodeAt(f)]=f;function p(C){var b=C.length;if(b%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var x=C.indexOf("=");return x===-1&&(x=b),[x,x===b?0:4-x%4]}function E(C,b,x){for(var R,A,P=[],H=b;H<x;H+=3)R=(C[H]<<16&16711680)+(C[H+1]<<8&65280)+(255&C[H+2]),P.push(l[(A=R)>>18&63]+l[A>>12&63]+l[A>>6&63]+l[63&A]);return P.join("")}u["-".charCodeAt(0)]=62,u["_".charCodeAt(0)]=63},function(s,o){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */o.read=function(c,l,u,g,y){var f,h,p=8*y-g-1,E=(1<<p)-1,C=E>>1,b=-7,x=u?y-1:0,R=u?-1:1,A=c[l+x];for(x+=R,f=A&(1<<-b)-1,A>>=-b,b+=p;b>0;f=256*f+c[l+x],x+=R,b-=8);for(h=f&(1<<-b)-1,f>>=-b,b+=g;b>0;h=256*h+c[l+x],x+=R,b-=8);if(f===0)f=1-C;else{if(f===E)return h?NaN:1/0*(A?-1:1);h+=Math.pow(2,g),f-=C}return(A?-1:1)*h*Math.pow(2,f-g)},o.write=function(c,l,u,g,y,f){var h,p,E,C=8*f-y-1,b=(1<<C)-1,x=b>>1,R=y===23?Math.pow(2,-24)-Math.pow(2,-77):0,A=g?0:f-1,P=g?1:-1,H=l<0||l===0&&1/l<0?1:0;for(l=Math.abs(l),isNaN(l)||l===1/0?(p=isNaN(l)?1:0,h=b):(h=Math.floor(Math.log(l)/Math.LN2),l*(E=Math.pow(2,-h))<1&&(h--,E*=2),(l+=h+x>=1?R/E:R*Math.pow(2,1-x))*E>=2&&(h++,E/=2),h+x>=b?(p=0,h=b):h+x>=1?(p=(l*E-1)*Math.pow(2,y),h+=x):(p=l*Math.pow(2,x-1)*Math.pow(2,y),h=0));y>=8;c[u+A]=255&p,A+=P,p/=256,y-=8);for(h=h<<y|p,C+=y;C>0;c[u+A]=255&h,A+=P,h/=256,C-=8);c[u+A-P]|=128*H}},function(s,o){var c={}.toString;s.exports=Array.isArray||function(l){return c.call(l)=="[object Array]"}},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(g){var y=g.jws,f=g.KeyUtil,h=g.X509,p=g.crypto,E=g.hextob64u,C=g.b64tohex,b=g.AllowedSigningAlgs;return function(){function x(){(function(A,P){if(!(A instanceof P))throw new TypeError("Cannot call a class as a function")})(this,x)}return x.parseJwt=function(A){l.Log.debug("JoseUtil.parseJwt");try{var P=y.JWS.parse(A);return{header:P.headerObj,payload:P.payloadObj}}catch(H){l.Log.error(H)}},x.validateJwt=function(A,P,H,M,G,J,j){l.Log.debug("JoseUtil.validateJwt");try{if(P.kty==="RSA")if(P.e&&P.n)P=f.getKey(P);else{if(!P.x5c||!P.x5c.length)return l.Log.error("JoseUtil.validateJwt: RSA key missing key material",P),Promise.reject(new Error("RSA key missing key material"));var ne=C(P.x5c[0]);P=h.getPublicKeyFromCertHex(ne)}else{if(P.kty!=="EC")return l.Log.error("JoseUtil.validateJwt: Unsupported key type",P&&P.kty),Promise.reject(new Error(P.kty));if(!(P.crv&&P.x&&P.y))return l.Log.error("JoseUtil.validateJwt: EC key missing key material",P),Promise.reject(new Error("EC key missing key material"));P=f.getKey(P)}return x._validateJwt(A,P,H,M,G,J,j)}catch(ie){return l.Log.error(ie&&ie.message||ie),Promise.reject("JWT validation failed")}},x.validateJwtAttributes=function(A,P,H,M,G,J){M||(M=0),G||(G=parseInt(Date.now()/1e3));var j=x.parseJwt(A).payload;if(!j.iss)return l.Log.error("JoseUtil._validateJwt: issuer was not provided"),Promise.reject(new Error("issuer was not provided"));if(j.iss!==P)return l.Log.error("JoseUtil._validateJwt: Invalid issuer in token",j.iss),Promise.reject(new Error("Invalid issuer in token: "+j.iss));if(!j.aud)return l.Log.error("JoseUtil._validateJwt: aud was not provided"),Promise.reject(new Error("aud was not provided"));if(!(j.aud===H||Array.isArray(j.aud)&&j.aud.indexOf(H)>=0))return l.Log.error("JoseUtil._validateJwt: Invalid audience in token",j.aud),Promise.reject(new Error("Invalid audience in token: "+j.aud));if(j.azp&&j.azp!==H)return l.Log.error("JoseUtil._validateJwt: Invalid azp in token",j.azp),Promise.reject(new Error("Invalid azp in token: "+j.azp));if(!J){var ne=G+M,ie=G-M;if(!j.iat)return l.Log.error("JoseUtil._validateJwt: iat was not provided"),Promise.reject(new Error("iat was not provided"));if(ne<j.iat)return l.Log.error("JoseUtil._validateJwt: iat is in the future",j.iat),Promise.reject(new Error("iat is in the future: "+j.iat));if(j.nbf&&ne<j.nbf)return l.Log.error("JoseUtil._validateJwt: nbf is in the future",j.nbf),Promise.reject(new Error("nbf is in the future: "+j.nbf));if(!j.exp)return l.Log.error("JoseUtil._validateJwt: exp was not provided"),Promise.reject(new Error("exp was not provided"));if(j.exp<ie)return l.Log.error("JoseUtil._validateJwt: exp is in the past",j.exp),Promise.reject(new Error("exp is in the past:"+j.exp))}return Promise.resolve(j)},x._validateJwt=function(A,P,H,M,G,J,j){return x.validateJwtAttributes(A,H,M,G,J,j).then(function(ne){try{return y.JWS.verify(A,P,b)?ne:(l.Log.error("JoseUtil._validateJwt: signature validation failed"),Promise.reject(new Error("signature validation failed")))}catch(ie){return l.Log.error(ie&&ie.message||ie),Promise.reject(new Error("signature validation failed"))}})},x.hashString=function(A,P){try{return p.Util.hashString(A,P)}catch(H){l.Log.error(H)}},x.hexToBase64Url=function(A){try{return E(A)}catch(P){l.Log.error(P)}},x}()};var l=c(0);s.exports=o.default},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.SigninResponse=void 0;var l=function(){function y(f,h){for(var p=0;p<h.length;p++){var E=h[p];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(f,E.key,E)}}return function(f,h,p){return h&&y(f.prototype,h),p&&y(f,p),f}}(),u=c(3);function g(y,f){if(!(y instanceof f))throw new TypeError("Cannot call a class as a function")}o.SigninResponse=function(){function y(f){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#";g(this,y);var p=u.UrlUtility.parseUrlFragment(f,h);this.error=p.error,this.error_description=p.error_description,this.error_uri=p.error_uri,this.code=p.code,this.state=p.state,this.id_token=p.id_token,this.session_state=p.session_state,this.access_token=p.access_token,this.token_type=p.token_type,this.scope=p.scope,this.profile=void 0,this.expires_in=p.expires_in}return l(y,[{key:"expires_in",get:function(){if(this.expires_at){var h=parseInt(Date.now()/1e3);return this.expires_at-h}},set:function(h){var p=parseInt(h);if(typeof p=="number"&&p>0){var E=parseInt(Date.now()/1e3);this.expires_at=E+p}}},{key:"expired",get:function(){var h=this.expires_in;if(h!==void 0)return h<=0}},{key:"scopes",get:function(){return(this.scope||"").split(" ")}},{key:"isOpenIdConnect",get:function(){return this.scopes.indexOf("openid")>=0||!!this.id_token}}]),y}()},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.SignoutRequest=void 0;var l=c(0),u=c(3),g=c(9);o.SignoutRequest=function y(f){var h=f.url,p=f.id_token_hint,E=f.post_logout_redirect_uri,C=f.data,b=f.extraQueryParams,x=f.request_type;if(function(P,H){if(!(P instanceof H))throw new TypeError("Cannot call a class as a function")}(this,y),!h)throw l.Log.error("SignoutRequest.ctor: No url passed"),new Error("url");for(var R in p&&(h=u.UrlUtility.addQueryParam(h,"id_token_hint",p)),E&&(h=u.UrlUtility.addQueryParam(h,"post_logout_redirect_uri",E),C&&(this.state=new g.State({data:C,request_type:x}),h=u.UrlUtility.addQueryParam(h,"state",this.state.id))),b)h=u.UrlUtility.addQueryParam(h,R,b[R]);this.url=h}},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.SignoutResponse=void 0;var l=c(3);o.SignoutResponse=function u(g){(function(h,p){if(!(h instanceof p))throw new TypeError("Cannot call a class as a function")})(this,u);var y=l.UrlUtility.parseUrlFragment(g,"?");this.error=y.error,this.error_description=y.error_description,this.error_uri=y.error_uri,this.state=y.state}},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.InMemoryWebStorage=void 0;var l=function(){function g(y,f){for(var h=0;h<f.length;h++){var p=f[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(y,p.key,p)}}return function(y,f,h){return f&&g(y.prototype,f),h&&g(y,h),y}}(),u=c(0);o.InMemoryWebStorage=function(){function g(){(function(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")})(this,g),this._data={}}return g.prototype.getItem=function(f){return u.Log.debug("InMemoryWebStorage.getItem",f),this._data[f]},g.prototype.setItem=function(f,h){u.Log.debug("InMemoryWebStorage.setItem",f),this._data[f]=h},g.prototype.removeItem=function(f){u.Log.debug("InMemoryWebStorage.removeItem",f),delete this._data[f]},g.prototype.key=function(f){return Object.getOwnPropertyNames(this._data)[f]},l(g,[{key:"length",get:function(){return Object.getOwnPropertyNames(this._data).length}}]),g}()},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.UserManager=void 0;var l=function(){function H(M,G){for(var J=0;J<G.length;J++){var j=G[J];j.enumerable=j.enumerable||!1,j.configurable=!0,"value"in j&&(j.writable=!0),Object.defineProperty(M,j.key,j)}}return function(M,G,J){return G&&H(M.prototype,G),J&&H(M,J),M}}(),u=c(0),g=c(10),y=c(39),f=c(15),h=c(45),p=c(47),E=c(18),C=c(8),b=c(20),x=c(11),R=c(4);function A(H,M){if(!(H instanceof M))throw new TypeError("Cannot call a class as a function")}function P(H,M){if(!H)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!M||typeof M!="object"&&typeof M!="function"?H:M}o.UserManager=function(H){function M(){var G=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},J=arguments.length>1&&arguments[1]!==void 0?arguments[1]:p.SilentRenewService,j=arguments.length>2&&arguments[2]!==void 0?arguments[2]:E.SessionMonitor,ne=arguments.length>3&&arguments[3]!==void 0?arguments[3]:b.TokenRevocationClient,ie=arguments.length>4&&arguments[4]!==void 0?arguments[4]:x.TokenClient,W=arguments.length>5&&arguments[5]!==void 0?arguments[5]:R.JoseUtil;A(this,M),G instanceof y.UserManagerSettings||(G=new y.UserManagerSettings(G));var oe=P(this,H.call(this,G));return oe._events=new h.UserManagerEvents(G),oe._silentRenewService=new J(oe),oe.settings.automaticSilentRenew&&(u.Log.debug("UserManager.ctor: automaticSilentRenew is configured, setting up silent renew"),oe.startSilentRenew()),oe.settings.monitorSession&&(u.Log.debug("UserManager.ctor: monitorSession is configured, setting up session monitor"),oe._sessionMonitor=new j(oe)),oe._tokenRevocationClient=new ne(oe._settings),oe._tokenClient=new ie(oe._settings),oe._joseUtil=W,oe}return function(J,j){if(typeof j!="function"&&j!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof j);J.prototype=Object.create(j&&j.prototype,{constructor:{value:J,enumerable:!1,writable:!0,configurable:!0}}),j&&(Object.setPrototypeOf?Object.setPrototypeOf(J,j):J.__proto__=j)}(M,H),M.prototype.getUser=function(){var J=this;return this._loadUser().then(function(j){return j?(u.Log.info("UserManager.getUser: user loaded"),J._events.load(j,!1),j):(u.Log.info("UserManager.getUser: user not found in storage"),null)})},M.prototype.removeUser=function(){var J=this;return this.storeUser(null).then(function(){u.Log.info("UserManager.removeUser: user removed from storage"),J._events.unload()})},M.prototype.signinRedirect=function(){var J=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(J=Object.assign({},J)).request_type="si:r";var j={useReplaceToNavigate:J.useReplaceToNavigate};return this._signinStart(J,this._redirectNavigator,j).then(function(){u.Log.info("UserManager.signinRedirect: successful")})},M.prototype.signinRedirectCallback=function(J){return this._signinEnd(J||this._redirectNavigator.url).then(function(j){return j.profile&&j.profile.sub?u.Log.info("UserManager.signinRedirectCallback: successful, signed in sub: ",j.profile.sub):u.Log.info("UserManager.signinRedirectCallback: no sub"),j})},M.prototype.signinPopup=function(){var J=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(J=Object.assign({},J)).request_type="si:p";var j=J.redirect_uri||this.settings.popup_redirect_uri||this.settings.redirect_uri;return j?(J.redirect_uri=j,J.display="popup",this._signin(J,this._popupNavigator,{startUrl:j,popupWindowFeatures:J.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:J.popupWindowTarget||this.settings.popupWindowTarget}).then(function(ne){return ne&&(ne.profile&&ne.profile.sub?u.Log.info("UserManager.signinPopup: signinPopup successful, signed in sub: ",ne.profile.sub):u.Log.info("UserManager.signinPopup: no sub")),ne})):(u.Log.error("UserManager.signinPopup: No popup_redirect_uri or redirect_uri configured"),Promise.reject(new Error("No popup_redirect_uri or redirect_uri configured")))},M.prototype.signinPopupCallback=function(J){return this._signinCallback(J,this._popupNavigator).then(function(j){return j&&(j.profile&&j.profile.sub?u.Log.info("UserManager.signinPopupCallback: successful, signed in sub: ",j.profile.sub):u.Log.info("UserManager.signinPopupCallback: no sub")),j}).catch(function(j){u.Log.error(j.message)})},M.prototype.signinSilent=function(){var J=this,j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return j=Object.assign({},j),this._loadUser().then(function(ne){return ne&&ne.refresh_token?(j.refresh_token=ne.refresh_token,J._useRefreshToken(j)):(j.request_type="si:s",j.id_token_hint=j.id_token_hint||J.settings.includeIdTokenInSilentRenew&&ne&&ne.id_token,ne&&J._settings.validateSubOnSilentRenew&&(u.Log.debug("UserManager.signinSilent, subject prior to silent renew: ",ne.profile.sub),j.current_sub=ne.profile.sub),J._signinSilentIframe(j))})},M.prototype._useRefreshToken=function(){var J=this,j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._tokenClient.exchangeRefreshToken(j).then(function(ne){return ne?ne.access_token?J._loadUser().then(function(ie){if(ie){var W=Promise.resolve();return ne.id_token&&(W=J._validateIdTokenFromTokenRefreshToken(ie.profile,ne.id_token)),W.then(function(){return u.Log.debug("UserManager._useRefreshToken: refresh token response success"),ie.id_token=ne.id_token||ie.id_token,ie.access_token=ne.access_token,ie.refresh_token=ne.refresh_token||ie.refresh_token,ie.expires_in=ne.expires_in,J.storeUser(ie).then(function(){return J._events.load(ie),ie})})}return null}):(u.Log.error("UserManager._useRefreshToken: No access token returned from token endpoint"),Promise.reject("No access token returned from token endpoint")):(u.Log.error("UserManager._useRefreshToken: No response returned from token endpoint"),Promise.reject("No response returned from token endpoint"))})},M.prototype._validateIdTokenFromTokenRefreshToken=function(J,j){var ne=this;return this._metadataService.getIssuer().then(function(ie){return ne.settings.getEpochTime().then(function(W){return ne._joseUtil.validateJwtAttributes(j,ie,ne._settings.client_id,ne._settings.clockSkew,W).then(function(oe){return oe?oe.sub!==J.sub?(u.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: sub in id_token does not match current sub"),Promise.reject(new Error("sub in id_token does not match current sub"))):oe.auth_time&&oe.auth_time!==J.auth_time?(u.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: auth_time in id_token does not match original auth_time"),Promise.reject(new Error("auth_time in id_token does not match original auth_time"))):oe.azp&&oe.azp!==J.azp?(u.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: azp in id_token does not match original azp"),Promise.reject(new Error("azp in id_token does not match original azp"))):!oe.azp&&J.azp?(u.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: azp not in id_token, but present in original id_token"),Promise.reject(new Error("azp not in id_token, but present in original id_token"))):void 0:(u.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: Failed to validate id_token"),Promise.reject(new Error("Failed to validate id_token")))})})})},M.prototype._signinSilentIframe=function(){var J=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},j=J.redirect_uri||this.settings.silent_redirect_uri||this.settings.redirect_uri;return j?(J.redirect_uri=j,J.prompt=J.prompt||"none",this._signin(J,this._iframeNavigator,{startUrl:j,silentRequestTimeout:J.silentRequestTimeout||this.settings.silentRequestTimeout}).then(function(ne){return ne&&(ne.profile&&ne.profile.sub?u.Log.info("UserManager.signinSilent: successful, signed in sub: ",ne.profile.sub):u.Log.info("UserManager.signinSilent: no sub")),ne})):(u.Log.error("UserManager.signinSilent: No silent_redirect_uri configured"),Promise.reject(new Error("No silent_redirect_uri configured")))},M.prototype.signinSilentCallback=function(J){return this._signinCallback(J,this._iframeNavigator).then(function(j){return j&&(j.profile&&j.profile.sub?u.Log.info("UserManager.signinSilentCallback: successful, signed in sub: ",j.profile.sub):u.Log.info("UserManager.signinSilentCallback: no sub")),j})},M.prototype.signinCallback=function(J){var j=this;return this.readSigninResponseState(J).then(function(ne){var ie=ne.state;return ne.response,ie.request_type==="si:r"?j.signinRedirectCallback(J):ie.request_type==="si:p"?j.signinPopupCallback(J):ie.request_type==="si:s"?j.signinSilentCallback(J):Promise.reject(new Error("invalid response_type in state"))})},M.prototype.signoutCallback=function(J,j){var ne=this;return this.readSignoutResponseState(J).then(function(ie){var W=ie.state,oe=ie.response;return W?W.request_type==="so:r"?ne.signoutRedirectCallback(J):W.request_type==="so:p"?ne.signoutPopupCallback(J,j):Promise.reject(new Error("invalid response_type in state")):oe})},M.prototype.querySessionStatus=function(){var J=this,j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(j=Object.assign({},j)).request_type="si:s";var ne=j.redirect_uri||this.settings.silent_redirect_uri||this.settings.redirect_uri;return ne?(j.redirect_uri=ne,j.prompt="none",j.response_type=j.response_type||this.settings.query_status_response_type,j.scope=j.scope||"openid",j.skipUserInfo=!0,this._signinStart(j,this._iframeNavigator,{startUrl:ne,silentRequestTimeout:j.silentRequestTimeout||this.settings.silentRequestTimeout}).then(function(ie){return J.processSigninResponse(ie.url).then(function(W){if(u.Log.debug("UserManager.querySessionStatus: got signin response"),W.session_state&&W.profile.sub)return u.Log.info("UserManager.querySessionStatus: querySessionStatus success for sub: ",W.profile.sub),{session_state:W.session_state,sub:W.profile.sub,sid:W.profile.sid};u.Log.info("querySessionStatus successful, user not authenticated")}).catch(function(W){if(W.session_state&&J.settings.monitorAnonymousSession&&(W.message=="login_required"||W.message=="consent_required"||W.message=="interaction_required"||W.message=="account_selection_required"))return u.Log.info("UserManager.querySessionStatus: querySessionStatus success for anonymous user"),{session_state:W.session_state};throw W})})):(u.Log.error("UserManager.querySessionStatus: No silent_redirect_uri configured"),Promise.reject(new Error("No silent_redirect_uri configured")))},M.prototype._signin=function(J,j){var ne=this,ie=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._signinStart(J,j,ie).then(function(W){return ne._signinEnd(W.url,J)})},M.prototype._signinStart=function(J,j){var ne=this,ie=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return j.prepare(ie).then(function(W){return u.Log.debug("UserManager._signinStart: got navigator window handle"),ne.createSigninRequest(J).then(function(oe){return u.Log.debug("UserManager._signinStart: got signin request"),ie.url=oe.url,ie.id=oe.state.id,W.navigate(ie)}).catch(function(oe){throw W.close&&(u.Log.debug("UserManager._signinStart: Error after preparing navigator, closing navigator window"),W.close()),oe})})},M.prototype._signinEnd=function(J){var j=this,ne=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.processSigninResponse(J).then(function(ie){u.Log.debug("UserManager._signinEnd: got signin response");var W=new f.User(ie);if(ne.current_sub){if(ne.current_sub!==W.profile.sub)return u.Log.debug("UserManager._signinEnd: current user does not match user returned from signin. sub from signin: ",W.profile.sub),Promise.reject(new Error("login_required"));u.Log.debug("UserManager._signinEnd: current user matches user returned from signin")}return j.storeUser(W).then(function(){return u.Log.debug("UserManager._signinEnd: user stored"),j._events.load(W),W})})},M.prototype._signinCallback=function(J,j){u.Log.debug("UserManager._signinCallback");var ne=this._settings.response_mode==="query"||!this._settings.response_mode&&C.SigninRequest.isCode(this._settings.response_type)?"?":"#";return j.callback(J,void 0,ne)},M.prototype.signoutRedirect=function(){var J=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(J=Object.assign({},J)).request_type="so:r";var j=J.post_logout_redirect_uri||this.settings.post_logout_redirect_uri;j&&(J.post_logout_redirect_uri=j);var ne={useReplaceToNavigate:J.useReplaceToNavigate};return this._signoutStart(J,this._redirectNavigator,ne).then(function(){u.Log.info("UserManager.signoutRedirect: successful")})},M.prototype.signoutRedirectCallback=function(J){return this._signoutEnd(J||this._redirectNavigator.url).then(function(j){return u.Log.info("UserManager.signoutRedirectCallback: successful"),j})},M.prototype.signoutPopup=function(){var J=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(J=Object.assign({},J)).request_type="so:p";var j=J.post_logout_redirect_uri||this.settings.popup_post_logout_redirect_uri||this.settings.post_logout_redirect_uri;return J.post_logout_redirect_uri=j,J.display="popup",J.post_logout_redirect_uri&&(J.state=J.state||{}),this._signout(J,this._popupNavigator,{startUrl:j,popupWindowFeatures:J.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:J.popupWindowTarget||this.settings.popupWindowTarget}).then(function(){u.Log.info("UserManager.signoutPopup: successful")})},M.prototype.signoutPopupCallback=function(J,j){return j===void 0&&typeof J=="boolean"&&(j=J,J=null),this._popupNavigator.callback(J,j,"?").then(function(){u.Log.info("UserManager.signoutPopupCallback: successful")})},M.prototype._signout=function(J,j){var ne=this,ie=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._signoutStart(J,j,ie).then(function(W){return ne._signoutEnd(W.url)})},M.prototype._signoutStart=function(){var J=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},j=this,ne=arguments[1],ie=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return ne.prepare(ie).then(function(W){return u.Log.debug("UserManager._signoutStart: got navigator window handle"),j._loadUser().then(function(oe){return u.Log.debug("UserManager._signoutStart: loaded current user from storage"),(j._settings.revokeAccessTokenOnSignout?j._revokeInternal(oe):Promise.resolve()).then(function(){var Te=J.id_token_hint||oe&&oe.id_token;return Te&&(u.Log.debug("UserManager._signoutStart: Setting id_token into signout request"),J.id_token_hint=Te),j.removeUser().then(function(){return u.Log.debug("UserManager._signoutStart: user removed, creating signout request"),j.createSignoutRequest(J).then(function(be){return u.Log.debug("UserManager._signoutStart: got signout request"),ie.url=be.url,be.state&&(ie.id=be.state.id),W.navigate(ie)})})})}).catch(function(oe){throw W.close&&(u.Log.debug("UserManager._signoutStart: Error after preparing navigator, closing navigator window"),W.close()),oe})})},M.prototype._signoutEnd=function(J){return this.processSignoutResponse(J).then(function(j){return u.Log.debug("UserManager._signoutEnd: got signout response"),j})},M.prototype.revokeAccessToken=function(){var J=this;return this._loadUser().then(function(j){return J._revokeInternal(j,!0).then(function(ne){if(ne)return u.Log.debug("UserManager.revokeAccessToken: removing token properties from user and re-storing"),j.access_token=null,j.refresh_token=null,j.expires_at=null,j.token_type=null,J.storeUser(j).then(function(){u.Log.debug("UserManager.revokeAccessToken: user stored"),J._events.load(j)})})}).then(function(){u.Log.info("UserManager.revokeAccessToken: access token revoked successfully")})},M.prototype._revokeInternal=function(J,j){var ne=this;if(J){var ie=J.access_token,W=J.refresh_token;return this._revokeAccessTokenInternal(ie,j).then(function(oe){return ne._revokeRefreshTokenInternal(W,j).then(function(Te){return oe||Te||u.Log.debug("UserManager.revokeAccessToken: no need to revoke due to no token(s), or JWT format"),oe||Te})})}return Promise.resolve(!1)},M.prototype._revokeAccessTokenInternal=function(J,j){return!J||J.indexOf(".")>=0?Promise.resolve(!1):this._tokenRevocationClient.revoke(J,j).then(function(){return!0})},M.prototype._revokeRefreshTokenInternal=function(J,j){return J?this._tokenRevocationClient.revoke(J,j,"refresh_token").then(function(){return!0}):Promise.resolve(!1)},M.prototype.startSilentRenew=function(){this._silentRenewService.start()},M.prototype.stopSilentRenew=function(){this._silentRenewService.stop()},M.prototype._loadUser=function(){return this._userStore.get(this._userStoreKey).then(function(J){return J?(u.Log.debug("UserManager._loadUser: user storageString loaded"),f.User.fromStorageString(J)):(u.Log.debug("UserManager._loadUser: no user storageString"),null)})},M.prototype.storeUser=function(J){if(J){u.Log.debug("UserManager.storeUser: storing user");var j=J.toStorageString();return this._userStore.set(this._userStoreKey,j)}return u.Log.debug("storeUser.storeUser: removing user"),this._userStore.remove(this._userStoreKey)},l(M,[{key:"_redirectNavigator",get:function(){return this.settings.redirectNavigator}},{key:"_popupNavigator",get:function(){return this.settings.popupNavigator}},{key:"_iframeNavigator",get:function(){return this.settings.iframeNavigator}},{key:"_userStore",get:function(){return this.settings.userStore}},{key:"events",get:function(){return this._events}},{key:"_userStoreKey",get:function(){return"user:"+this.settings.authority+":"+this.settings.client_id}}]),M}(g.OidcClient)},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.UserManagerSettings=void 0;var l=function(){function x(R,A){for(var P=0;P<A.length;P++){var H=A[P];H.enumerable=H.enumerable||!1,H.configurable=!0,"value"in H&&(H.writable=!0),Object.defineProperty(R,H.key,H)}}return function(R,A,P){return A&&x(R.prototype,A),P&&x(R,P),R}}(),u=(c(0),c(5)),g=c(40),y=c(41),f=c(43),h=c(6),p=c(1),E=c(8);function C(x,R){if(!(x instanceof R))throw new TypeError("Cannot call a class as a function")}function b(x,R){if(!x)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!R||typeof R!="object"&&typeof R!="function"?x:R}o.UserManagerSettings=function(x){function R(){var A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},P=A.popup_redirect_uri,H=A.popup_post_logout_redirect_uri,M=A.popupWindowFeatures,G=A.popupWindowTarget,J=A.silent_redirect_uri,j=A.silentRequestTimeout,ne=A.automaticSilentRenew,ie=ne!==void 0&&ne,W=A.validateSubOnSilentRenew,oe=W!==void 0&&W,Te=A.includeIdTokenInSilentRenew,be=Te===void 0||Te,Z=A.monitorSession,ae=Z===void 0||Z,pe=A.monitorAnonymousSession,Ee=pe!==void 0&&pe,Fe=A.checkSessionInterval,le=Fe===void 0?2e3:Fe,_e=A.stopCheckSessionOnError,Me=_e===void 0||_e,Ve=A.query_status_response_type,vt=A.revokeAccessTokenOnSignout,mt=vt!==void 0&&vt,Ct=A.accessTokenExpiringNotificationTime,Vt=Ct===void 0?60:Ct,ut=A.redirectNavigator,_t=ut===void 0?new g.RedirectNavigator:ut,tt=A.popupNavigator,He=tt===void 0?new y.PopupNavigator:tt,V=A.iframeNavigator,m=V===void 0?new f.IFrameNavigator:V,_=A.userStore,L=_===void 0?new h.WebStorageStateStore({store:p.Global.sessionStorage}):_;C(this,R);var q=b(this,x.call(this,arguments[0]));return q._popup_redirect_uri=P,q._popup_post_logout_redirect_uri=H,q._popupWindowFeatures=M,q._popupWindowTarget=G,q._silent_redirect_uri=J,q._silentRequestTimeout=j,q._automaticSilentRenew=ie,q._validateSubOnSilentRenew=oe,q._includeIdTokenInSilentRenew=be,q._accessTokenExpiringNotificationTime=Vt,q._monitorSession=ae,q._monitorAnonymousSession=Ee,q._checkSessionInterval=le,q._stopCheckSessionOnError=Me,Ve?q._query_status_response_type=Ve:arguments[0]&&arguments[0].response_type?q._query_status_response_type=E.SigninRequest.isOidc(arguments[0].response_type)?"id_token":"code":q._query_status_response_type="id_token",q._revokeAccessTokenOnSignout=mt,q._redirectNavigator=_t,q._popupNavigator=He,q._iframeNavigator=m,q._userStore=L,q}return function(P,H){if(typeof H!="function"&&H!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof H);P.prototype=Object.create(H&&H.prototype,{constructor:{value:P,enumerable:!1,writable:!0,configurable:!0}}),H&&(Object.setPrototypeOf?Object.setPrototypeOf(P,H):P.__proto__=H)}(R,x),l(R,[{key:"popup_redirect_uri",get:function(){return this._popup_redirect_uri}},{key:"popup_post_logout_redirect_uri",get:function(){return this._popup_post_logout_redirect_uri}},{key:"popupWindowFeatures",get:function(){return this._popupWindowFeatures}},{key:"popupWindowTarget",get:function(){return this._popupWindowTarget}},{key:"silent_redirect_uri",get:function(){return this._silent_redirect_uri}},{key:"silentRequestTimeout",get:function(){return this._silentRequestTimeout}},{key:"automaticSilentRenew",get:function(){return this._automaticSilentRenew}},{key:"validateSubOnSilentRenew",get:function(){return this._validateSubOnSilentRenew}},{key:"includeIdTokenInSilentRenew",get:function(){return this._includeIdTokenInSilentRenew}},{key:"accessTokenExpiringNotificationTime",get:function(){return this._accessTokenExpiringNotificationTime}},{key:"monitorSession",get:function(){return this._monitorSession}},{key:"monitorAnonymousSession",get:function(){return this._monitorAnonymousSession}},{key:"checkSessionInterval",get:function(){return this._checkSessionInterval}},{key:"stopCheckSessionOnError",get:function(){return this._stopCheckSessionOnError}},{key:"query_status_response_type",get:function(){return this._query_status_response_type}},{key:"revokeAccessTokenOnSignout",get:function(){return this._revokeAccessTokenOnSignout}},{key:"redirectNavigator",get:function(){return this._redirectNavigator}},{key:"popupNavigator",get:function(){return this._popupNavigator}},{key:"iframeNavigator",get:function(){return this._iframeNavigator}},{key:"userStore",get:function(){return this._userStore}}]),R}(u.OidcClientSettings)},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.RedirectNavigator=void 0;var l=function(){function g(y,f){for(var h=0;h<f.length;h++){var p=f[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(y,p.key,p)}}return function(y,f,h){return f&&g(y.prototype,f),h&&g(y,h),y}}(),u=c(0);o.RedirectNavigator=function(){function g(){(function(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")})(this,g)}return g.prototype.prepare=function(){return Promise.resolve(this)},g.prototype.navigate=function(f){return f&&f.url?(f.useReplaceToNavigate?window.location.replace(f.url):window.location=f.url,Promise.resolve()):(u.Log.error("RedirectNavigator.navigate: No url provided"),Promise.reject(new Error("No url provided")))},l(g,[{key:"url",get:function(){return window.location.href}}]),g}()},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.PopupNavigator=void 0;var l=c(0),u=c(42);o.PopupNavigator=function(){function g(){(function(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")})(this,g)}return g.prototype.prepare=function(f){var h=new u.PopupWindow(f);return Promise.resolve(h)},g.prototype.callback=function(f,h,p){l.Log.debug("PopupNavigator.callback");try{return u.PopupWindow.notifyOpener(f,h,p),Promise.resolve()}catch(E){return Promise.reject(E)}},g}()},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.PopupWindow=void 0;var l=function(){function y(f,h){for(var p=0;p<h.length;p++){var E=h[p];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(f,E.key,E)}}return function(f,h,p){return h&&y(f.prototype,h),p&&y(f,p),f}}(),u=c(0),g=c(3);o.PopupWindow=function(){function y(f){var h=this;(function(b,x){if(!(b instanceof x))throw new TypeError("Cannot call a class as a function")})(this,y),this._promise=new Promise(function(C,b){h._resolve=C,h._reject=b});var p=f.popupWindowTarget||"_blank",E=f.popupWindowFeatures||"location=no,toolbar=no,width=500,height=500,left=100,top=100;";this._popup=window.open("",p,E),this._popup&&(u.Log.debug("PopupWindow.ctor: popup successfully created"),this._checkForPopupClosedTimer=window.setInterval(this._checkForPopupClosed.bind(this),500))}return y.prototype.navigate=function(h){return this._popup?h&&h.url?(u.Log.debug("PopupWindow.navigate: Setting URL in popup"),this._id=h.id,this._id&&(window["popupCallback_"+h.id]=this._callback.bind(this)),this._popup.focus(),this._popup.window.location=h.url):(this._error("PopupWindow.navigate: no url provided"),this._error("No url provided")):this._error("PopupWindow.navigate: Error opening popup window"),this.promise},y.prototype._success=function(h){u.Log.debug("PopupWindow.callback: Successful response from popup window"),this._cleanup(),this._resolve(h)},y.prototype._error=function(h){u.Log.error("PopupWindow.error: ",h),this._cleanup(),this._reject(new Error(h))},y.prototype.close=function(){this._cleanup(!1)},y.prototype._cleanup=function(h){u.Log.debug("PopupWindow.cleanup"),window.clearInterval(this._checkForPopupClosedTimer),this._checkForPopupClosedTimer=null,delete window["popupCallback_"+this._id],this._popup&&!h&&this._popup.close(),this._popup=null},y.prototype._checkForPopupClosed=function(){this._popup&&!this._popup.closed||this._error("Popup window closed")},y.prototype._callback=function(h,p){this._cleanup(p),h?(u.Log.debug("PopupWindow.callback success"),this._success({url:h})):(u.Log.debug("PopupWindow.callback: Invalid response from popup"),this._error("Invalid response from popup"))},y.notifyOpener=function(h,p,E){if(window.opener){if(h=h||window.location.href){var C=g.UrlUtility.parseUrlFragment(h,E);if(C.state){var b="popupCallback_"+C.state,x=window.opener[b];x?(u.Log.debug("PopupWindow.notifyOpener: passing url message to opener"),x(h,p)):u.Log.warn("PopupWindow.notifyOpener: no matching callback found on opener")}else u.Log.warn("PopupWindow.notifyOpener: no state found in response url")}}else u.Log.warn("PopupWindow.notifyOpener: no window.opener. Can't complete notification.")},l(y,[{key:"promise",get:function(){return this._promise}}]),y}()},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.IFrameNavigator=void 0;var l=c(0),u=c(44);o.IFrameNavigator=function(){function g(){(function(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")})(this,g)}return g.prototype.prepare=function(f){var h=new u.IFrameWindow(f);return Promise.resolve(h)},g.prototype.callback=function(f){l.Log.debug("IFrameNavigator.callback");try{return u.IFrameWindow.notifyParent(f),Promise.resolve()}catch(h){return Promise.reject(h)}},g}()},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.IFrameWindow=void 0;var l=function(){function g(y,f){for(var h=0;h<f.length;h++){var p=f[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(y,p.key,p)}}return function(y,f,h){return f&&g(y.prototype,f),h&&g(y,h),y}}(),u=c(0);o.IFrameWindow=function(){function g(y){var f=this;(function(p,E){if(!(p instanceof E))throw new TypeError("Cannot call a class as a function")})(this,g),this._promise=new Promise(function(h,p){f._resolve=h,f._reject=p}),this._boundMessageEvent=this._message.bind(this),window.addEventListener("message",this._boundMessageEvent,!1),this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="absolute",this._frame.width=0,this._frame.height=0,window.document.body.appendChild(this._frame)}return g.prototype.navigate=function(f){if(f&&f.url){var h=f.silentRequestTimeout||1e4;u.Log.debug("IFrameWindow.navigate: Using timeout of:",h),this._timer=window.setTimeout(this._timeout.bind(this),h),this._frame.src=f.url}else this._error("No url provided");return this.promise},g.prototype._success=function(f){this._cleanup(),u.Log.debug("IFrameWindow: Successful response from frame window"),this._resolve(f)},g.prototype._error=function(f){this._cleanup(),u.Log.error(f),this._reject(new Error(f))},g.prototype.close=function(){this._cleanup()},g.prototype._cleanup=function(){this._frame&&(u.Log.debug("IFrameWindow: cleanup"),window.removeEventListener("message",this._boundMessageEvent,!1),window.clearTimeout(this._timer),window.document.body.removeChild(this._frame),this._timer=null,this._frame=null,this._boundMessageEvent=null)},g.prototype._timeout=function(){u.Log.debug("IFrameWindow.timeout"),this._error("Frame window timed out")},g.prototype._message=function(f){if(u.Log.debug("IFrameWindow.message"),this._timer&&f.origin===this._origin&&f.source===this._frame.contentWindow&&typeof f.data=="string"&&(f.data.startsWith("http://")||f.data.startsWith("https://"))){var h=f.data;h?this._success({url:h}):this._error("Invalid response from frame")}},g.notifyParent=function(f){u.Log.debug("IFrameWindow.notifyParent"),(f=f||window.location.href)&&(u.Log.debug("IFrameWindow.notifyParent: posting url message to parent"),window.parent.postMessage(f,location.protocol+"//"+location.host))},l(g,[{key:"promise",get:function(){return this._promise}},{key:"_origin",get:function(){return location.protocol+"//"+location.host}}]),g}()},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.UserManagerEvents=void 0;var l=c(0),u=c(16),g=c(17);o.UserManagerEvents=function(y){function f(h){(function(C,b){if(!(C instanceof b))throw new TypeError("Cannot call a class as a function")})(this,f);var p=function(C,b){if(!C)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||typeof b!="object"&&typeof b!="function"?C:b}(this,y.call(this,h));return p._userLoaded=new g.Event("User loaded"),p._userUnloaded=new g.Event("User unloaded"),p._silentRenewError=new g.Event("Silent renew error"),p._userSignedIn=new g.Event("User signed in"),p._userSignedOut=new g.Event("User signed out"),p._userSessionChanged=new g.Event("User session changed"),p}return function(p,E){if(typeof E!="function"&&E!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof E);p.prototype=Object.create(E&&E.prototype,{constructor:{value:p,enumerable:!1,writable:!0,configurable:!0}}),E&&(Object.setPrototypeOf?Object.setPrototypeOf(p,E):p.__proto__=E)}(f,y),f.prototype.load=function(p){var E=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];l.Log.debug("UserManagerEvents.load"),y.prototype.load.call(this,p),E&&this._userLoaded.raise(p)},f.prototype.unload=function(){l.Log.debug("UserManagerEvents.unload"),y.prototype.unload.call(this),this._userUnloaded.raise()},f.prototype.addUserLoaded=function(p){this._userLoaded.addHandler(p)},f.prototype.removeUserLoaded=function(p){this._userLoaded.removeHandler(p)},f.prototype.addUserUnloaded=function(p){this._userUnloaded.addHandler(p)},f.prototype.removeUserUnloaded=function(p){this._userUnloaded.removeHandler(p)},f.prototype.addSilentRenewError=function(p){this._silentRenewError.addHandler(p)},f.prototype.removeSilentRenewError=function(p){this._silentRenewError.removeHandler(p)},f.prototype._raiseSilentRenewError=function(p){l.Log.debug("UserManagerEvents._raiseSilentRenewError",p.message),this._silentRenewError.raise(p)},f.prototype.addUserSignedIn=function(p){this._userSignedIn.addHandler(p)},f.prototype.removeUserSignedIn=function(p){this._userSignedIn.removeHandler(p)},f.prototype._raiseUserSignedIn=function(){l.Log.debug("UserManagerEvents._raiseUserSignedIn"),this._userSignedIn.raise()},f.prototype.addUserSignedOut=function(p){this._userSignedOut.addHandler(p)},f.prototype.removeUserSignedOut=function(p){this._userSignedOut.removeHandler(p)},f.prototype._raiseUserSignedOut=function(){l.Log.debug("UserManagerEvents._raiseUserSignedOut"),this._userSignedOut.raise()},f.prototype.addUserSessionChanged=function(p){this._userSessionChanged.addHandler(p)},f.prototype.removeUserSessionChanged=function(p){this._userSessionChanged.removeHandler(p)},f.prototype._raiseUserSessionChanged=function(){l.Log.debug("UserManagerEvents._raiseUserSessionChanged"),this._userSessionChanged.raise()},f}(u.AccessTokenEvents)},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.Timer=void 0;var l=function(){function p(E,C){for(var b=0;b<C.length;b++){var x=C[b];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(E,x.key,x)}}return function(E,C,b){return C&&p(E.prototype,C),b&&p(E,b),E}}(),u=c(0),g=c(1),y=c(17);function f(p,E){if(!(p instanceof E))throw new TypeError("Cannot call a class as a function")}function h(p,E){if(!p)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!E||typeof E!="object"&&typeof E!="function"?p:E}o.Timer=function(p){function E(C){var b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:g.Global.timer,x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;f(this,E);var R=h(this,p.call(this,C));return R._timer=b,R._nowFunc=x||function(){return Date.now()/1e3},R}return function(b,x){if(typeof x!="function"&&x!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof x);b.prototype=Object.create(x&&x.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}}),x&&(Object.setPrototypeOf?Object.setPrototypeOf(b,x):b.__proto__=x)}(E,p),E.prototype.init=function(b){b<=0&&(b=1),b=parseInt(b);var x=this.now+b;if(this.expiration===x&&this._timerHandle)u.Log.debug("Timer.init timer "+this._name+" skipping initialization since already initialized for expiration:",this.expiration);else{this.cancel(),u.Log.debug("Timer.init timer "+this._name+" for duration:",b),this._expiration=x;var R=5;b<R&&(R=b),this._timerHandle=this._timer.setInterval(this._callback.bind(this),1e3*R)}},E.prototype.cancel=function(){this._timerHandle&&(u.Log.debug("Timer.cancel: ",this._name),this._timer.clearInterval(this._timerHandle),this._timerHandle=null)},E.prototype._callback=function(){var b=this._expiration-this.now;u.Log.debug("Timer.callback; "+this._name+" timer expires in:",b),this._expiration<=this.now&&(this.cancel(),p.prototype.raise.call(this))},l(E,[{key:"now",get:function(){return parseInt(this._nowFunc())}},{key:"expiration",get:function(){return this._expiration}}]),E}(y.Event)},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.SilentRenewService=void 0;var l=c(0);o.SilentRenewService=function(){function u(g){(function(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")})(this,u),this._userManager=g}return u.prototype.start=function(){this._callback||(this._callback=this._tokenExpiring.bind(this),this._userManager.events.addAccessTokenExpiring(this._callback),this._userManager.getUser().then(function(y){}).catch(function(y){l.Log.error("SilentRenewService.start: Error from getUser:",y.message)}))},u.prototype.stop=function(){this._callback&&(this._userManager.events.removeAccessTokenExpiring(this._callback),delete this._callback)},u.prototype._tokenExpiring=function(){var y=this;this._userManager.signinSilent().then(function(f){l.Log.debug("SilentRenewService._tokenExpiring: Silent token renewal successful")},function(f){l.Log.error("SilentRenewService._tokenExpiring: Error from signinSilent:",f.message),y._userManager.events._raiseSilentRenewError(f)})},u}()},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.CordovaPopupNavigator=void 0;var l=c(21);o.CordovaPopupNavigator=function(){function u(){(function(y,f){if(!(y instanceof f))throw new TypeError("Cannot call a class as a function")})(this,u)}return u.prototype.prepare=function(y){var f=new l.CordovaPopupWindow(y);return Promise.resolve(f)},u}()},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.CordovaIFrameNavigator=void 0;var l=c(21);o.CordovaIFrameNavigator=function(){function u(){(function(y,f){if(!(y instanceof f))throw new TypeError("Cannot call a class as a function")})(this,u)}return u.prototype.prepare=function(y){y.popupWindowFeatures="hidden=yes";var f=new l.CordovaPopupWindow(y);return Promise.resolve(f)},u}()},function(s,o,c){Object.defineProperty(o,"__esModule",{value:!0}),o.Version="1.11.6"}])})})(bt);function Qu(r,n){var s,o,c,l;throw r.error==="invalid_redirect_uri"?new Error(`Dynamic client registration failed: the provided redirect uri [${(s=n.redirectUrl)===null||s===void 0?void 0:s.toString()}] is invalid - ${(o=r.error_description)!==null&&o!==void 0?o:""}`):r.error==="invalid_client_metadata"?new Error(`Dynamic client registration failed: the provided client metadata ${JSON.stringify(n)} is invalid - ${(c=r.error_description)!==null&&c!==void 0?c:""}`):new Error(`Dynamic client registration failed: ${r.error} - ${(l=r.error_description)!==null&&l!==void 0?l:""}`)}function Zu(r,n){if(r.client_id===void 0)throw new Error(`Dynamic client registration failed: no client_id has been found on ${JSON.stringify(r)}`);if(n.redirectUrl&&(r.redirect_uris===void 0||r.redirect_uris[0]!==n.redirectUrl.toString()))throw new Error(`Dynamic client registration failed: the returned redirect URIs ${JSON.stringify(r.redirect_uris)} don't match the provided ${JSON.stringify([n.redirectUrl.toString()])}`)}async function ec(r,n){var s;if(!n.registrationEndpoint)throw new Error("Dynamic Registration could not be completed because the issuer has no registration endpoint.");if(!Array.isArray(n.idTokenSigningAlgValuesSupported))throw new Error("The OIDC issuer discovery profile is missing the 'id_token_signing_alg_values_supported' value, which is mandatory.");const o=xe.determineSigningAlg(n.idTokenSigningAlgValuesSupported,xe.PREFERRED_SIGNING_ALG),c={client_name:r.clientName,application_type:"web",redirect_uris:[(s=r.redirectUrl)===null||s===void 0?void 0:s.toString()],subject_type:"public",token_endpoint_auth_method:"client_secret_basic",id_token_signed_response_alg:o,grant_types:["authorization_code","refresh_token"]},l={"Content-Type":"application/json"},u=await fetch(n.registrationEndpoint.toString(),{method:"POST",headers:l,body:JSON.stringify(c)});if(u.ok){const g=await u.json();return Zu(g,r),{clientId:g.client_id,clientSecret:g.client_secret,idTokenSignedResponseAlg:g.id_token_signed_response_alg,clientType:"dynamic"}}throw u.status===400&&Qu(await u.json(),r),new Error(`Dynamic client registration failed: the server returned ${u.status} ${u.statusText} - ${await u.text()}`)}function tc(r){return r.error!==void 0&&typeof r.error=="string"}function ji(r){return r.error_description!==void 0&&typeof r.error_description=="string"}function rc(r){return r.error_uri!==void 0&&typeof r.error_uri=="string"}function nc(r){return r.access_token!==void 0&&typeof r.access_token=="string"}function ic(r){return r.id_token!==void 0&&typeof r.id_token=="string"}function oc(r){return r.refresh_token!==void 0&&typeof r.refresh_token=="string"}function sc(r){return r.token_type!==void 0&&typeof r.token_type=="string"}function ac(r){return r.expires_in===void 0||typeof r.expires_in=="number"}function uc(r,n){if(n.grantType&&(!r.grantTypesSupported||!r.grantTypesSupported.includes(n.grantType)))throw new Error(`The issuer [${r.issuer}] does not support the [${n.grantType}] grant`);if(!r.tokenEndpoint)throw new Error(`This issuer [${r.issuer}] does not have a token endpoint`)}function zo(r,n){if(tc(r))throw new xe.OidcProviderError(`Token endpoint returned error [${r.error}]${ji(r)?`: ${r.error_description}`:""}${rc(r)?` (see ${r.error_uri})`:""}`,r.error,ji(r)?r.error_description:void 0);if(!nc(r))throw new xe.InvalidResponseError(["access_token"]);if(!ic(r))throw new xe.InvalidResponseError(["id_token"]);if(!sc(r))throw new xe.InvalidResponseError(["token_type"]);if(!ac(r))throw new xe.InvalidResponseError(["expires_in"]);if(!n&&r.token_type.toLowerCase()!=="bearer")throw new Error(`Invalid token endpoint response: requested a [Bearer] token, but got a 'token_type' value of [${r.token_type}].`);return r}async function cc(r,n,s,o){uc(r,s);const c={"content-type":"application/x-www-form-urlencoded"};let l;o&&(l=await xe.generateDpopKeyPair(),c.DPoP=await xe.createDpopHeader(r.tokenEndpoint,"POST",l)),n.clientSecret&&(c.Authorization=`Basic ${btoa(`${n.clientId}:${n.clientSecret}`)}`);const u={grant_type:s.grantType,redirect_uri:s.redirectUrl,code:s.code,code_verifier:s.codeVerifier,client_id:n.clientId},g={method:"POST",headers:c,body:new URLSearchParams(u).toString()},f=await(await await fetch(r.tokenEndpoint,g)).json(),h=zo(f,o),p=await xe.getWebidFromTokenPayload(h.id_token,r.jwksUri,r.issuer,n.clientId);return{accessToken:h.access_token,idToken:h.id_token,refreshToken:oc(h)?h.refresh_token:void 0,webId:p,dpopKey:l,expiresIn:h.expires_in}}async function lc(r){let n;try{const s=new bt.exports.OidcClient({response_mode:"query",loadUserInfo:!1});if(n=await s.processSigninResponse(r),s.settings.metadata===void 0)throw new Error("Cannot retrieve issuer metadata from client information in storage.");if(s.settings.metadata.jwks_uri===void 0)throw new Error("Missing some issuer metadata from client information in storage: 'jwks_uri' is undefined");if(s.settings.metadata.issuer===void 0)throw new Error("Missing some issuer metadata from client information in storage: 'issuer' is undefined");if(s.settings.client_id===void 0)throw new Error("Missing some client information in storage: 'client_id' is undefined");const o=await xe.getWebidFromTokenPayload(n.id_token,s.settings.metadata.jwks_uri,s.settings.metadata.issuer,s.settings.client_id);return{accessToken:n.access_token,idToken:n.id_token,webId:o,refreshToken:n.refresh_token}}catch(s){throw new Error(`Problem handling Auth Code Grant (Flow) redirect - URL [${r}]: ${s}`)}}async function dc(r,n,s){return cc(r,n,s,!0)}const hc=r=>{try{return new URL(r),!0}catch{return!1}};async function fc(r,n,s,o){if(s.clientId===void 0)throw new Error("No client ID available when trying to refresh the access token.");const c={grant_type:"refresh_token",refresh_token:r,scope:xe.DEFAULT_SCOPES};let l={};o!==void 0&&(l={DPoP:await xe.createDpopHeader(n.tokenEndpoint,"POST",o)});let u={};s.clientSecret!==void 0?u={Authorization:`Basic ${btoa(`${s.clientId}:${s.clientSecret}`)}`}:hc(s.clientId)&&(c.client_id=s.clientId);const g=await fetch(n.tokenEndpoint,{method:"POST",body:new URLSearchParams(c).toString(),headers:{...l,...u,"Content-Type":"application/x-www-form-urlencoded"}});let y;try{y=await g.json()}catch{throw new Error(`The token endpoint of issuer ${n.issuer} returned a malformed response.`)}const f=zo(y,o!==void 0),h=await xe.getWebidFromTokenPayload(f.id_token,n.jwksUri,n.issuer,s.clientId);return{accessToken:f.access_token,idToken:f.id_token,refreshToken:typeof f.refresh_token=="string"?f.refresh_token:void 0,webId:h,dpopKey:o,expiresIn:f.expires_in}}function pc(r){const n=new URL(r);return n.searchParams.delete("code"),n.searchParams.delete("state"),n.hash="",n.toString()}async function gc(){await new bt.exports.OidcClient({response_mode:"query"}).clearStaleState(new bt.exports.WebStorageStateStore({}));const n=window.localStorage,s=[];for(let o=0;o<=n.length;o+=1){const c=n.key(o);c&&(c.match(/^oidc\..+$/)||c.match(/^solidClientAuthenticationUser:.+$/))&&s.push(c)}s.forEach(o=>n.removeItem(o))}var yc=Object.freeze(Object.defineProperty({__proto__:null,clearOidcPersistentStorage:gc,getBearerToken:lc,getDpopToken:dc,refresh:fc,registerClient:ec,removeOidcQueryParam:pc,CordovaIFrameNavigator:bt.exports.CordovaIFrameNavigator,CordovaPopupNavigator:bt.exports.CordovaPopupNavigator,InMemoryWebStorage:bt.exports.InMemoryWebStorage,Log:bt.exports.Log,OidcClient:bt.exports.OidcClient,SessionMonitor:bt.exports.SessionMonitor,User:bt.exports.User,UserManager:bt.exports.UserManager,Version:bt.exports.Version,WebStorageStateStore:bt.exports.WebStorageStateStore},Symbol.toStringTag,{value:"Module"})),vr=Kn(yc);Object.defineProperty(ai,"__esModule",{value:!0});const vc=xe,mc=vr,Wi=(r,n)=>window.fetch(r,n);class _c{constructor(n,s,o,c,l){this.loginHandler=n,this.redirectHandler=s,this.logoutHandler=o,this.sessionInfoManager=c,this.issuerConfigFetcher=l,this.login=async(u,g)=>{var y,f;await this.sessionInfoManager.clear(u.sessionId);const h=(0,mc.removeOidcQueryParam)((y=u.redirectUrl)!==null&&y!==void 0?y:window.location.href);await this.loginHandler.handle({...u,redirectUrl:h,clientName:(f=u.clientName)!==null&&f!==void 0?f:u.clientId,eventEmitter:g})},this.fetch=Wi,this.logout=async u=>{await this.logoutHandler.handle(u),this.fetch=Wi},this.getSessionInfo=async u=>this.sessionInfoManager.get(u),this.getAllSessionInfo=async()=>this.sessionInfoManager.getAll(),this.validateCurrentSession=async u=>{const g=await this.sessionInfoManager.get(u);return g===void 0||g.clientAppId===void 0||g.issuer===void 0?null:g},this.handleIncomingRedirect=async(u,g)=>{try{const y=await this.redirectHandler.handle(u,g);return this.fetch=y.fetch.bind(window),this.cleanUrlAfterRedirect(u),{isLoggedIn:y.isLoggedIn,webId:y.webId,sessionId:y.sessionId,expirationDate:y.expirationDate}}catch(y){this.cleanUrlAfterRedirect(u),g.emit(vc.EVENTS.ERROR,"redirect",y);return}}}cleanUrlAfterRedirect(n){const s=new URL(n);s.searchParams.delete("state"),s.searchParams.delete("code"),s.searchParams.delete("id_token"),s.searchParams.delete("access_token"),s.searchParams.delete("error"),s.searchParams.delete("error_description"),window.history.replaceState(null,"",s.toString())}}ai.default=_c;var ui={};Object.defineProperty(ui,"__esModule",{value:!0});const xn=xe;function Ji(r){return typeof r.oidcIssuer=="string"}function Vi(r){return typeof r.redirectUrl=="string"}class Sc{constructor(n,s,o,c){this.storageUtility=n,this.oidcHandler=s,this.issuerConfigFetcher=o,this.clientRegistrar=c}async canHandle(n){return Ji(n)&&Vi(n)}async handle(n){if(!Ji(n))throw new xn.ConfigurationError(`OidcLoginHandler requires an OIDC issuer: missing property 'oidcIssuer' in ${JSON.stringify(n)}`);if(!Vi(n))throw new xn.ConfigurationError(`OidcLoginHandler requires a redirect URL: missing property 'redirectUrl' in ${JSON.stringify(n)}`);const s=await this.issuerConfigFetcher.fetchConfig(n.oidcIssuer),o=await(0,xn.handleRegistration)(n,s,this.storageUtility,this.clientRegistrar),c={issuer:s.issuer,dpop:n.tokenType.toLowerCase()==="dpop",...n,issuerConfiguration:s,client:o};return this.oidcHandler.handle(c)}}ui.default=Sc;var ci={};Object.defineProperty(ci,"__esModule",{value:!0});const wc=xe,Ec=vr;class bc{constructor(n,s){this.storageUtility=n,this.redirector=s}async canHandle(n){return!!(n.issuerConfiguration.grantTypesSupported&&n.issuerConfiguration.grantTypesSupported.indexOf("authorization_code")>-1)}async handle(n){var s;const o={authority:n.issuer.toString(),client_id:n.client.clientId,client_secret:n.client.clientSecret,redirect_uri:n.redirectUrl.toString(),post_logout_redirect_uri:n.redirectUrl.toString(),response_type:"code",scope:wc.DEFAULT_SCOPES,filterProtocolClaims:!0,loadUserInfo:!1,code_verifier:!0,prompt:(s=n.prompt)!==null&&s!==void 0?s:"consent"},c=new Ec.OidcClient(o),{redirector:l}=this,u=this.storageUtility;try{const g=await c.createSigninRequest();await Promise.all([u.setForUser(g.state._id,{sessionId:n.sessionId}),u.setForUser(n.sessionId,{codeVerifier:g.state._code_verifier,issuer:n.issuer.toString(),redirectUrl:n.redirectUrl,dpop:n.dpop?"true":"false"})]),l.redirect(g.url.toString(),{handleRedirect:n.handleRedirect})}catch(g){console.error(g)}}}ci.default=bc;var Yo={},ln={};Object.defineProperty(ln,"__esModule",{value:!0});ln.appendToUrlPathname=void 0;function Fc(r,n){const s=new URL(r),o=s.pathname;return s.pathname=`${o}${o.endsWith("/")?"":"/"}${n.startsWith("/")?n.substring(1):n}`,s.toString()}ln.appendToUrlPathname=Fc;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.WELL_KNOWN_OPENID_CONFIG=void 0;const n=xe,s=ln;r.WELL_KNOWN_OPENID_CONFIG=".well-known/openid-configuration";const o={issuer:{toKey:"issuer",convertToUrl:!0},authorization_endpoint:{toKey:"authorizationEndpoint",convertToUrl:!0},token_endpoint:{toKey:"tokenEndpoint",convertToUrl:!0},userinfo_endpoint:{toKey:"userinfoEndpoint",convertToUrl:!0},jwks_uri:{toKey:"jwksUri",convertToUrl:!0},registration_endpoint:{toKey:"registrationEndpoint",convertToUrl:!0},scopes_supported:{toKey:"scopesSupported"},response_types_supported:{toKey:"responseTypesSupported"},response_modes_supported:{toKey:"responseModesSupported"},grant_types_supported:{toKey:"grantTypesSupported"},acr_values_supported:{toKey:"acrValuesSupported"},subject_types_supported:{toKey:"subjectTypesSupported"},id_token_signing_alg_values_supported:{toKey:"idTokenSigningAlgValuesSupported"},id_token_encryption_alg_values_supported:{toKey:"idTokenEncryptionAlgValuesSupported"},id_token_encryption_enc_values_supported:{toKey:"idTokenEncryptionEncValuesSupported"},userinfo_signing_alg_values_supported:{toKey:"userinfoSigningAlgValuesSupported"},userinfo_encryption_alg_values_supported:{toKey:"userinfoEncryptionAlgValuesSupported"},userinfo_encryption_enc_values_supported:{toKey:"userinfoEncryptionEncValuesSupported"},request_object_signing_alg_values_supported:{toKey:"requestObjectSigningAlgValuesSupported"},request_object_encryption_alg_values_supported:{toKey:"requestObjectEncryptionAlgValuesSupported"},request_object_encryption_enc_values_supported:{toKey:"requestObjectEncryptionEncValuesSupported"},token_endpoint_auth_methods_supported:{toKey:"tokenEndpointAuthMethodsSupported"},token_endpoint_auth_signing_alg_values_supported:{toKey:"tokenEndpointAuthSigningAlgValuesSupported"},display_values_supported:{toKey:"displayValuesSupported"},claim_types_supported:{toKey:"claimTypesSupported"},claims_supported:{toKey:"claimsSupported"},service_documentation:{toKey:"serviceDocumentation"},claims_locales_supported:{toKey:"claimsLocalesSupported"},ui_locales_supported:{toKey:"uiLocalesSupported"},claims_parameter_supported:{toKey:"claimsParameterSupported"},request_parameter_supported:{toKey:"requestParameterSupported"},request_uri_parameter_supported:{toKey:"requestUriParameterSupported"},require_request_uri_registration:{toKey:"requireRequestUriRegistration"},op_policy_uri:{toKey:"opPolicyUri",convertToUrl:!0},op_tos_uri:{toKey:"opTosUri",convertToUrl:!0}};function c(u){const g={};return Object.keys(u).forEach(y=>{o[y]&&(g[o[y].toKey]=u[y])}),Array.isArray(g.scopesSupported)||(g.scopesSupported=["openid"]),g}class l{constructor(g){this.storageUtility=g}static getLocalStorageKey(g){return`issuerConfig:${g}`}async fetchConfig(g){let y;const f=(0,s.appendToUrlPathname)(g,r.WELL_KNOWN_OPENID_CONFIG),h=await window.fetch(f);try{y=c(await h.json())}catch(p){throw new n.ConfigurationError(`[${g.toString()}] has an invalid configuration: ${p.message}`)}return await this.storageUtility.set(l.getLocalStorageKey(g),JSON.stringify(y)),y}}r.default=l})(Yo);var dn={},Wt={};Object.defineProperty(Wt,"__esModule",{value:!0});Wt.SessionInfoManager=Wt.clear=Wt.getUnauthenticatedSession=void 0;const Ac=xe,Pc=oi,Tc=vr;function Cc(){return{isLoggedIn:!1,sessionId:(0,Pc.v4)(),fetch}}Wt.getUnauthenticatedSession=Cc;async function Xo(r,n){await Promise.all([n.deleteAllUserData(r,{secure:!1}),n.deleteAllUserData(r,{secure:!0}),n.delete("clientKey",{secure:!1})]),await(0,Tc.clearOidcPersistentStorage)()}Wt.clear=Xo;class xc{constructor(n){this.storageUtility=n}update(n,s){throw new Error("Not Implemented")}async get(n){var s;const o=await this.storageUtility.getForUser(n,"isLoggedIn",{secure:!0}),c=await this.storageUtility.getForUser(n,"webId",{secure:!0}),l=await this.storageUtility.getForUser(n,"clientId",{secure:!1}),u=await this.storageUtility.getForUser(n,"clientSecret",{secure:!1}),g=await this.storageUtility.getForUser(n,"redirectUrl",{secure:!1}),y=await this.storageUtility.getForUser(n,"refreshToken",{secure:!0}),f=await this.storageUtility.getForUser(n,"issuer",{secure:!1}),h=(s=await this.storageUtility.getForUser(n,"tokenType",{secure:!1}))!==null&&s!==void 0?s:"DPoP";if(!(0,Ac.isSupportedTokenType)(h))throw new Error(`Tokens of type [${h}] are not supported.`);if(!(l===void 0&&o===void 0&&c===void 0&&y===void 0))return{sessionId:n,webId:c,isLoggedIn:o==="true",redirectUrl:g,refreshToken:y,issuer:f,clientAppId:l,clientAppSecret:u,tokenType:h}}async getAll(){throw new Error("Not implemented")}async clear(n){return Xo(n,this.storageUtility)}async register(n){throw new Error("Not implemented")}async getRegisteredSessionIdAll(){throw new Error("Not implemented")}async clearAll(){throw new Error("Not implemented")}}Wt.SessionInfoManager=xc;Object.defineProperty(dn,"__esModule",{value:!0});dn.FallbackRedirectHandler=void 0;const Rc=Wt;class Ic{async canHandle(n){try{return new URL(n),!0}catch(s){throw new Error(`[${n}] is not a valid URL, and cannot be used as a redirect URL: ${s}`)}}async handle(n){return(0,Rc.getUnauthenticatedSession)()}}dn.FallbackRedirectHandler=Ic;var li={};Object.defineProperty(li,"__esModule",{value:!0});class kc{constructor(n){this.sessionInfoManager=n}async canHandle(){return!0}async handle(n){await this.sessionInfoManager.clear(n)}}li.default=kc;var hn={};Object.defineProperty(hn,"__esModule",{value:!0});hn.AuthCodeRedirectHandler=void 0;const qi=xe,$i=vr;class Uc{constructor(n,s,o,c,l){this.storageUtility=n,this.sessionInfoManager=s,this.issuerConfigFetcher=o,this.clientRegistrar=c,this.tokerRefresher=l}async canHandle(n){try{const s=new URL(n);return s.searchParams.get("code")!==null&&s.searchParams.get("state")!==null}catch(s){throw new Error(`[${n}] is not a valid URL, and cannot be used as a redirect URL: ${s}`)}}async handle(n,s){if(!await this.canHandle(n))throw new Error(`AuthCodeRedirectHandler cannot handle [${n}]: it is missing one of [code, state].`);const o=new URL(n),c=o.searchParams.get("state"),l=await this.storageUtility.getForUser(c,"sessionId",{errorIfNull:!0}),{issuerConfig:u,codeVerifier:g,redirectUrl:y,dpop:f}=await(0,qi.loadOidcContextFromStorage)(l,this.storageUtility,this.issuerConfigFetcher);if(g===void 0)throw new Error(`The code verifier for session ${l} is missing from storage.`);if(y===void 0)throw new Error(`The redirect URL for session ${l} is missing from storage.`);const h=await this.clientRegistrar.getClient({sessionId:l},u);let p;const E=Date.now();f?(p=await(0,$i.getDpopToken)(u,h,{grantType:"authorization_code",code:o.searchParams.get("code"),codeVerifier:g,redirectUrl:y}),window.localStorage.removeItem(`oidc.${c}`)):p=await(0,$i.getBearerToken)(o.toString());let C;p.refreshToken!==void 0&&(C={sessionId:l,refreshToken:p.refreshToken,tokenRefresher:this.tokerRefresher});const b=await(0,qi.buildAuthenticatedFetch)(fetch,p.accessToken,{dpopKey:p.dpopKey,refreshOptions:C,eventEmitter:s,expiresIn:p.expiresIn});await this.storageUtility.setForUser(l,{webId:p.webId,isLoggedIn:"true"},{secure:!0}),o.searchParams.delete("code"),await this.storageUtility.setForUser(l,{redirectUrl:o.toString()},{secure:!1});const x=await this.sessionInfoManager.get(l);if(!x)throw new Error(`Could not retrieve session: [${l}].`);return Object.assign(x,{fetch:b,expirationDate:typeof p.expiresIn=="number"?E+p.expiresIn*1e3:null})}}hn.AuthCodeRedirectHandler=Uc;var di={};Object.defineProperty(di,"__esModule",{value:!0});const Oc=xe;class Dc extends Oc.AggregateHandler{constructor(n){super(n)}}di.default=Dc;var hi={};Object.defineProperty(hi,"__esModule",{value:!0});class Hc{get storage(){return window.localStorage}async get(n){return this.storage.getItem(n)||void 0}async set(n,s){this.storage.setItem(n,s)}async delete(n){this.storage.removeItem(n)}}hi.default=Hc;var fi={};Object.defineProperty(fi,"__esModule",{value:!0});class Nc{redirect(n,s){s&&s.handleRedirect?s.handleRedirect(n):s&&s.redirectByReplacingState?window.history.replaceState({},"",n):window.location.href=n}}fi.default=Nc;var pi={};Object.defineProperty(pi,"__esModule",{value:!0});const Lc=vr;class Mc{constructor(n){this.storageUtility=n}async getClient(n,s){const[o,c]=await Promise.all([this.storageUtility.getForUser(n.sessionId,"clientId",{secure:!1}),this.storageUtility.getForUser(n.sessionId,"clientSecret",{secure:!1})]);if(o)return{clientId:o,clientSecret:c,clientType:"dynamic"};try{const l=await(0,Lc.registerClient)(n,s),u={clientId:l.clientId};return l.clientSecret&&(u.clientSecret=l.clientSecret),l.idTokenSignedResponseAlg&&(u.idTokenSignedResponseAlg=l.idTokenSignedResponseAlg),await this.storageUtility.setForUser(n.sessionId,u,{secure:!1}),l}catch(l){throw new Error(`Client registration failed: [${l}]`)}}}pi.default=Mc;var fn={};Object.defineProperty(fn,"__esModule",{value:!0});fn.ErrorOidcHandler=void 0;const Kc=xe,Bc=Wt;class jc{async canHandle(n){try{return new URL(n).searchParams.has("error")}catch(s){throw new Error(`[${n}] is not a valid URL, and cannot be used as a redirect URL: ${s}`)}}async handle(n,s){if(s!==void 0){const o=new URL(n),c=o.searchParams.get("error"),l=o.searchParams.get("error_description");s.emit(Kc.EVENTS.ERROR,c,l)}return(0,Bc.getUnauthenticatedSession)()}}fn.ErrorOidcHandler=jc;var gi={};Object.defineProperty(gi,"__esModule",{value:!0});const Gi=xe,Wc=vr;class Jc{constructor(n,s,o){this.storageUtility=n,this.issuerConfigFetcher=s,this.clientRegistrar=o}async refresh(n,s,o,c){const l=await(0,Gi.loadOidcContextFromStorage)(n,this.storageUtility,this.issuerConfigFetcher),u=await this.clientRegistrar.getClient({sessionId:n},l.issuerConfig);if(s===void 0)throw new Error(`Session [${n}] has no refresh token to allow it to refresh its access token.`);if(l.dpop&&o===void 0)throw new Error(`For session [${n}], the key bound to the DPoP access token must be provided to refresh said access token.`);const g=await(0,Wc.refresh)(s,l.issuerConfig,u,o);return g.refreshToken!==void 0&&(c==null||c.emit(Gi.EVENTS.NEW_REFRESH_TOKEN,g.refreshToken),await this.storageUtility.setForUser(n,{refreshToken:g.refreshToken})),g}}gi.default=Jc;var Lt=$e&&$e.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(kr,"__esModule",{value:!0});kr.getClientAuthenticationWithDependencies=void 0;const Vc=xe,qc=Lt(si),$c=Lt(ai),Gc=Lt(ui),zc=Lt(ci),Yc=Lt(Yo),Xc=dn,Qc=Lt(li),Zc=Wt,el=hn,tl=Lt(di),rl=Lt(hi),nl=Lt(fi),il=Lt(pi),ol=fn,sl=Lt(gi);function al(r){const n=new Vc.InMemoryStorage,s=r.secureStorage||n,o=r.insecureStorage||new rl.default,c=new qc.default(s,o),l=new Yc.default(c),u=new il.default(c),g=new Zc.SessionInfoManager(c),y=new sl.default(c,l,u),f=new Gc.default(c,new zc.default(c,new nl.default),l,u),h=new tl.default([new ol.ErrorOidcHandler,new el.AuthCodeRedirectHandler(c,g,l,u,y),new Xc.FallbackRedirectHandler]);return new $c.default(f,h,new Qc.default(g),g,l)}kr.getClientAuthenticationWithDependencies=al;var yr={};Object.defineProperty(yr,"__esModule",{value:!0});yr.KEY_CURRENT_URL=yr.KEY_CURRENT_SESSION=void 0;const Qo=xe;yr.KEY_CURRENT_SESSION=`${Qo.SOLID_CLIENT_AUTHN_KEY_PREFIX}currentSession`;yr.KEY_CURRENT_URL=`${Qo.SOLID_CLIENT_AUTHN_KEY_PREFIX}currentUrl`;Object.defineProperty(or,"__esModule",{value:!0});or.Session=or.silentlyAuthenticate=void 0;const ul=Bn.exports,kt=xe,cl=oi,zi=kr,dr=yr;async function Zo(r,n,s){var o;const c=await n.validateCurrentSession(r);return c!==null?(window.localStorage.setItem(dr.KEY_CURRENT_URL,window.location.href),await n.login({sessionId:r,prompt:"none",oidcIssuer:c.issuer,redirectUrl:c.redirectUrl,clientId:c.clientAppId,clientSecret:c.clientAppSecret,tokenType:(o=c.tokenType)!==null&&o!==void 0?o:"DPoP"},s),!0):!1}or.silentlyAuthenticate=Zo;function ll(r){return!!(r!=null&&r.isLoggedIn)}class dl extends ul.EventEmitter{constructor(n={},s){super(),this.tokenRequestInProgress=!1,this.login=async o=>{var c;return await this.clientAuthentication.login({sessionId:this.info.sessionId,...o,tokenType:(c=o.tokenType)!==null&&c!==void 0?c:"DPoP"},this),new Promise(()=>{})},this.fetch=async(o,c)=>this.clientAuthentication.fetch(o,c),this.internalLogout=async o=>{window.localStorage.removeItem(dr.KEY_CURRENT_SESSION),await this.clientAuthentication.logout(this.info.sessionId),this.info.isLoggedIn=!1,o&&this.emit(kt.EVENTS.LOGOUT)},this.logout=async()=>this.internalLogout(!0),this.handleIncomingRedirect=async(o={})=>{var c;if(this.info.isLoggedIn)return this.info;if(this.tokenRequestInProgress)return;const l=typeof o=="string"?{url:o}:o,u=(c=l.url)!==null&&c!==void 0?c:window.location.href;this.tokenRequestInProgress=!0;const g=await this.clientAuthentication.handleIncomingRedirect(u,this);if(ll(g)){this.setSessionInfo(g);const y=window.localStorage.getItem(dr.KEY_CURRENT_URL);y===null?this.emit(kt.EVENTS.LOGIN):(window.localStorage.removeItem(dr.KEY_CURRENT_URL),this.emit(kt.EVENTS.SESSION_RESTORED,y))}else if(l.restorePreviousSession===!0){const y=window.localStorage.getItem(dr.KEY_CURRENT_SESSION);if(y!==null&&await Zo(y,this.clientAuthentication,this))return new Promise(()=>{})}return this.tokenRequestInProgress=!1,g},n.clientAuthentication?this.clientAuthentication=n.clientAuthentication:n.secureStorage&&n.insecureStorage?this.clientAuthentication=(0,zi.getClientAuthenticationWithDependencies)({secureStorage:n.secureStorage,insecureStorage:n.insecureStorage}):this.clientAuthentication=(0,zi.getClientAuthenticationWithDependencies)({}),n.sessionInfo?this.info={sessionId:n.sessionInfo.sessionId,isLoggedIn:!1,webId:n.sessionInfo.webId}:this.info={sessionId:s!=null?s:(0,cl.v4)(),isLoggedIn:!1},this.on(kt.EVENTS.LOGIN,()=>window.localStorage.setItem(dr.KEY_CURRENT_SESSION,this.info.sessionId)),this.on(kt.EVENTS.SESSION_EXPIRED,()=>this.internalLogout(!1)),this.on(kt.EVENTS.ERROR,()=>this.internalLogout(!1))}onLogin(n){this.on(kt.EVENTS.LOGIN,n)}onLogout(n){this.on(kt.EVENTS.LOGOUT,n)}onError(n){this.on(kt.EVENTS.ERROR,n)}onSessionRestore(n){this.on(kt.EVENTS.SESSION_RESTORED,n)}onSessionExpiration(n){this.on(kt.EVENTS.SESSION_EXPIRED,n)}setSessionInfo(n){this.info.isLoggedIn=n.isLoggedIn,this.info.webId=n.webId,this.info.sessionId=n.sessionId,this.info.expirationDate=n.expirationDate,this.on(kt.EVENTS.SESSION_EXTENDED,s=>{this.info.expirationDate=Date.now()+s*1e3})}}or.Session=dl;var rt={};Object.defineProperty(rt,"__esModule",{value:!0});rt.onSessionRestore=rt.onLogout=rt.onLogin=rt.handleIncomingRedirect=rt.logout=rt.login=rt.fetch=rt.getDefaultSession=void 0;const hl=or;let Rn;function er(){return typeof Rn=="undefined"&&(Rn=new hl.Session),Rn}rt.getDefaultSession=er;const fl=(...r)=>er().fetch(...r);rt.fetch=fl;const pl=(...r)=>er().login(...r);rt.login=pl;const gl=(...r)=>er().logout(...r);rt.logout=gl;const yl=(...r)=>er().handleIncomingRedirect(...r);rt.handleIncomingRedirect=yl;const vl=(...r)=>er().onLogin(...r);rt.onLogin=vl;const ml=(...r)=>er().onLogout(...r);rt.onLogout=ml;const _l=(...r)=>er().onSessionRestore(...r);rt.onSessionRestore=_l;(function(r){var n=$e&&$e.__createBinding||(Object.create?function(u,g,y,f){f===void 0&&(f=y);var h=Object.getOwnPropertyDescriptor(g,y);(!h||("get"in h?!g.__esModule:h.writable||h.configurable))&&(h={enumerable:!0,get:function(){return g[y]}}),Object.defineProperty(u,f,h)}:function(u,g,y,f){f===void 0&&(f=y),u[f]=g[y]}),s=$e&&$e.__exportStar||function(u,g){for(var y in u)y!=="default"&&!Object.prototype.hasOwnProperty.call(g,y)&&n(g,u,y)};Object.defineProperty(r,"__esModule",{value:!0}),r.InMemoryStorage=r.ConfigurationError=r.NotImplementedError=r.getClientAuthenticationWithDependencies=r.Session=void 0;var o=or;Object.defineProperty(r,"Session",{enumerable:!0,get:function(){return o.Session}});var c=kr;Object.defineProperty(r,"getClientAuthenticationWithDependencies",{enumerable:!0,get:function(){return c.getClientAuthenticationWithDependencies}}),s(rt,r);var l=xe;Object.defineProperty(r,"NotImplementedError",{enumerable:!0,get:function(){return l.NotImplementedError}}),Object.defineProperty(r,"ConfigurationError",{enumerable:!0,get:function(){return l.ConfigurationError}}),Object.defineProperty(r,"InMemoryStorage",{enumerable:!0,get:function(){return l.InMemoryStorage}})})(zt);function Sl(){const{subscribe:r,set:n}=hs({loading:!0,userSession:zt.getDefaultSession().info,storageLocation:"",podUrl:""});return{subscribe:r,set:n,init:async(s,o)=>{await zt.handleIncomingRedirect({restorePreviousSession:!0}),s=s||localStorage.getItem("storageLocation")||"http://localhost:3000/johndoe",o=o||localStorage.getItem("podUrl")||"johndoe",n({loading:!1,userSession:zt.getDefaultSession().info,storageLocation:s,podUrl:o})},signIn:async(s,o,c)=>{if(!s)throw new Error("Please enter a pod URL");if(!o)throw new Error("Please enter a storage location");s.indexOf("//")<0&&(s="http://"+s),localStorage.setItem("podUrl",s),localStorage.setItem("storageLocation",o);try{zt.getDefaultSession().info.isLoggedIn||await zt.login({oidcIssuer:s,clientName:"Project-IDLab",redirectUrl:c}),n({loading:!1,userSession:zt.getDefaultSession().info,storageLocation:o,podUrl:s})}catch(l){throw new Error(gs(l).message)}},signOut:async()=>{await zt.getDefaultSession().logout(),n({loading:!1,userSession:zt.getDefaultSession().info,storageLocation:"",podUrl:""})}}}var bl=Sl();export{$e as a,El as c,zt as d,Bn as e,Kn as g,gs as t,bl as u};
