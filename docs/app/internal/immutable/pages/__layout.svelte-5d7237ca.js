import{S as or,i as sr,s as ar,e as be,k as Ie,t as dt,c as Se,a as Te,d as de,m as xe,h as ft,b as fe,I as Ye,g as Me,J as ue,n as Ut,o as he,p as Dt,q as le,j as Yt,K as _n,L as Nn,E as Zt,M as xr,N as Rr,O as Ur,P as Dr,Q as kt,R as vt,G as Vr,T as gr,U as yr,w as je,x as We,y as Ve,V as vr,B as $e,v as bs,W as Ka,l as Cr,X as Ba,Y as wn,Z as Ln,_ as Br,$ as ja}from"../chunks/index-c908d7e2.js";import{u as Wa,t as vn,m as Xr,a as Qr,b as gn,p as Zr,T as xo,U as Ro,P as Uo}from"../chunks/eventStore-a416bbcc.js";import{B as Or,I as Hi}from"../chunks/Button-a94b5f95.js";import{T as Ss,P as Ni,S as Es,L as Fs,B as As,C as yi}from"../chunks/index-dd833d83.js";import{c as $r}from"../chunks/singletons-cdeec3fd.js";import{b as Va}from"../chunks/paths-1c47712a.js";import"../chunks/index-b8e02857.js";var gt=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function Li(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach(function(n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}),e}var yn={},jr={},Mi={exports:{}},en=typeof Reflect=="object"?Reflect:null,Do=en&&typeof en.apply=="function"?en.apply:function(e,n,r){return Function.prototype.apply.call(e,n,r)},Dn;en&&typeof en.ownKeys=="function"?Dn=en.ownKeys:Object.getOwnPropertySymbols?Dn=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Dn=function(e){return Object.getOwnPropertyNames(e)};function $a(t){console&&console.warn&&console.warn(t)}var Ps=Number.isNaN||function(e){return e!==e};function Xe(){Xe.init.call(this)}Mi.exports=Xe;Mi.exports.once=Ga;Xe.EventEmitter=Xe;Xe.prototype._events=void 0;Xe.prototype._eventsCount=0;Xe.prototype._maxListeners=void 0;var Oo=10;function qn(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(Xe,"defaultMaxListeners",{enumerable:!0,get:function(){return Oo},set:function(t){if(typeof t!="number"||t<0||Ps(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");Oo=t}});Xe.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Xe.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Ps(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function ks(t){return t._maxListeners===void 0?Xe.defaultMaxListeners:t._maxListeners}Xe.prototype.getMaxListeners=function(){return ks(this)};Xe.prototype.emit=function(e){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var s=e==="error",c=this._events;if(c!==void 0)s=s&&c.error===void 0;else if(!s)return!1;if(s){var u;if(n.length>0&&(u=n[0]),u instanceof Error)throw u;var p=new Error("Unhandled error."+(u?" ("+u.message+")":""));throw p.context=u,p}var y=c[e];if(y===void 0)return!1;if(typeof y=="function")Do(y,this,n);else for(var f=y.length,d=Rs(y,f),r=0;r<f;++r)Do(d[r],this,n);return!0};function Ts(t,e,n,r){var s,c,u;if(qn(n),c=t._events,c===void 0?(c=t._events=Object.create(null),t._eventsCount=0):(c.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),c=t._events),u=c[e]),u===void 0)u=c[e]=n,++t._eventsCount;else if(typeof u=="function"?u=c[e]=r?[n,u]:[u,n]:r?u.unshift(n):u.push(n),s=ks(t),s>0&&u.length>s&&!u.warned){u.warned=!0;var p=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");p.name="MaxListenersExceededWarning",p.emitter=t,p.type=e,p.count=u.length,$a(p)}return t}Xe.prototype.addListener=function(e,n){return Ts(this,e,n,!1)};Xe.prototype.on=Xe.prototype.addListener;Xe.prototype.prependListener=function(e,n){return Ts(this,e,n,!0)};function Ja(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Cs(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},s=Ja.bind(r);return s.listener=n,r.wrapFn=s,s}Xe.prototype.once=function(e,n){return qn(n),this.on(e,Cs(this,e,n)),this};Xe.prototype.prependOnceListener=function(e,n){return qn(n),this.prependListener(e,Cs(this,e,n)),this};Xe.prototype.removeListener=function(e,n){var r,s,c,u,p;if(qn(n),s=this._events,s===void 0)return this;if(r=s[e],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,r.listener||n));else if(typeof r!="function"){for(c=-1,u=r.length-1;u>=0;u--)if(r[u]===n||r[u].listener===n){p=r[u].listener,c=u;break}if(c<0)return this;c===0?r.shift():qa(r,c),r.length===1&&(s[e]=r[0]),s.removeListener!==void 0&&this.emit("removeListener",e,p||n)}return this};Xe.prototype.off=Xe.prototype.removeListener;Xe.prototype.removeAllListeners=function(e){var n,r,s;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var c=Object.keys(r),u;for(s=0;s<c.length;++s)u=c[s],u!=="removeListener"&&this.removeAllListeners(u);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(s=n.length-1;s>=0;s--)this.removeListener(e,n[s]);return this};function Is(t,e,n){var r=t._events;if(r===void 0)return[];var s=r[e];return s===void 0?[]:typeof s=="function"?n?[s.listener||s]:[s]:n?za(s):Rs(s,s.length)}Xe.prototype.listeners=function(e){return Is(this,e,!0)};Xe.prototype.rawListeners=function(e){return Is(this,e,!1)};Xe.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):xs.call(t,e)};Xe.prototype.listenerCount=xs;function xs(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}Xe.prototype.eventNames=function(){return this._eventsCount>0?Dn(this._events):[]};function Rs(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function qa(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function za(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function Ga(t,e){return new Promise(function(n,r){function s(u){t.removeListener(e,c),r(u)}function c(){typeof t.removeListener=="function"&&t.removeListener("error",s),n([].slice.call(arguments))}Us(t,e,c,{once:!0}),e!=="error"&&Ya(t,s,{once:!0})})}function Ya(t,e,n){typeof t.on=="function"&&Us(t,"error",e,n)}function Us(t,e,n,r){if(typeof t.on=="function")r.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function s(c){r.once&&t.removeEventListener(e,s),n(c)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var ze={},Gt={};Object.defineProperty(Gt,"__esModule",{value:!0});Gt.DEFAULT_SCOPES=Gt.REFRESH_BEFORE_EXPIRATION_SECONDS=Gt.EVENTS=Gt.PREFERRED_SIGNING_ALG=Gt.SOLID_CLIENT_AUTHN_KEY_PREFIX=void 0;Gt.SOLID_CLIENT_AUTHN_KEY_PREFIX="solidClientAuthn:";Gt.PREFERRED_SIGNING_ALG=["ES256","RS256"];Gt.EVENTS={ERROR:"error",LOGIN:"login",LOGOUT:"logout",NEW_REFRESH_TOKEN:"newRefreshToken",SESSION_EXPIRED:"sessionExpired",SESSION_EXTENDED:"sessionExtended",SESSION_RESTORED:"sessionRestore",TIMEOUT_SET:"timeoutSet"};Gt.REFRESH_BEFORE_EXPIRATION_SECONDS=5;const Xa="openid",Qa="offline_access",Za="webid";Gt.DEFAULT_SCOPES=[Xa,Qa,Za].join(" ");var Ki={},zn={};Object.defineProperty(zn,"__esModule",{value:!0});class Ar extends Error{constructor(e,n,r=!0){super(typeof e=="string"?Ar.substituteParams(e,n):Ar.appendErrorIri(Ar.lookupErrorIri(e,n),e,r))}httpResponse(e,n=!0){return this.message=Ar.appendHttpResponseDetails(this.message,e,n),this.httpErrorResponse=e,this}hasHttpResponse(){return this.httpErrorResponse!==void 0}getHttpResponse(){return this.httpErrorResponse}getHttpStatusCode(){if(this.httpErrorResponse===void 0)throw new Ar("This InruptError was not provided with a HTTP response - so we can't get its HTTP Status Code.");return this.httpErrorResponse.status}getHttpStatusText(){if(this.httpErrorResponse===void 0)throw new Ar("This InruptError was not provided with a HTTP response - so we can't get its HTTP Status Text!");return this.httpErrorResponse.statusText}static determineIfVocabTerm(e){return e.strict!==void 0}static lookupErrorIri(e,n){if(Ar.determineIfVocabTerm(e)){const r=n===void 0?e.message:e.messageParams(...n);return r===void 0?`Looked up error message IRI [${e.value}], but found no message value.`:r}return`Error message looked up at: [${e.value}]${n===void 0?"":`, with params [${n.toString()}]`}`}static appendHttpResponseDetails(e,n,r){return r&&typeof n!="undefined"?`${e} HTTP details: status code [${n.status}], status text [${n.statusText}].`:e}static appendErrorIri(e,n,r){return r?`${e} Error IRI: [${n.value}].`:e}static substituteParams(e,n){let r=e;if(n!==void 0){const s=e.split("{{").length-1;if(s!==n.length)throw new Error(`Setting parameters on message [${e}], but it requires [${s}] params and we received [${n.length}].`);for(let c=0;c<n.length;c+=1){const u=`{{${c}}}`;r=r.replace(u,n[c])}}return r}}zn.default=Ar;var eu=gt&&gt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Ki,"__esModule",{value:!0});const tu=eu(zn);class ru{constructor(e){this.handleables=e}async getProperHandler(e){const n=await Promise.all(this.handleables.map(r=>r.canHandle(...e)));for(let r=0;r<n.length;r+=1)if(n[r])return this.handleables[r];return null}async canHandle(...e){return await this.getProperHandler(e)!==null}async handle(...e){const n=await this.getProperHandler(e);if(n)return n.handle(...e);throw new tu.default(`[${this.constructor.name}] cannot find a suitable handler for: ${e.map(r=>{try{return JSON.stringify(r)}catch{return r.toString()}}).join(", ")}`)}}Ki.default=ru;var tn={},Mn={exports:{}};(function(t,e){var n=typeof self!="undefined"?self:gt,r=function(){function c(){this.fetch=!1,this.DOMException=n.DOMException}return c.prototype=n,new c}();(function(c){(function(u){var p={searchParams:"URLSearchParams"in c,iterable:"Symbol"in c&&"iterator"in Symbol,blob:"FileReader"in c&&"Blob"in c&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in c,arrayBuffer:"ArrayBuffer"in c};function y(G){return G&&DataView.prototype.isPrototypeOf(G)}if(p.arrayBuffer)var f=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],d=ArrayBuffer.isView||function(G){return G&&f.indexOf(Object.prototype.toString.call(G))>-1};function h(G){if(typeof G!="string"&&(G=String(G)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(G))throw new TypeError("Invalid character in header field name");return G.toLowerCase()}function v(G){return typeof G!="string"&&(G=String(G)),G}function E(G){var se={next:function(){var ve=G.shift();return{done:ve===void 0,value:ve}}};return p.iterable&&(se[Symbol.iterator]=function(){return se}),se}function m(G){this.map={},G instanceof m?G.forEach(function(se,ve){this.append(ve,se)},this):Array.isArray(G)?G.forEach(function(se){this.append(se[0],se[1])},this):G&&Object.getOwnPropertyNames(G).forEach(function(se){this.append(se,G[se])},this)}m.prototype.append=function(G,se){G=h(G),se=v(se);var ve=this.map[G];this.map[G]=ve?ve+", "+se:se},m.prototype.delete=function(G){delete this.map[h(G)]},m.prototype.get=function(G){return G=h(G),this.has(G)?this.map[G]:null},m.prototype.has=function(G){return this.map.hasOwnProperty(h(G))},m.prototype.set=function(G,se){this.map[h(G)]=v(se)},m.prototype.forEach=function(G,se){for(var ve in this.map)this.map.hasOwnProperty(ve)&&G.call(se,this.map[ve],ve,this)},m.prototype.keys=function(){var G=[];return this.forEach(function(se,ve){G.push(ve)}),E(G)},m.prototype.values=function(){var G=[];return this.forEach(function(se){G.push(se)}),E(G)},m.prototype.entries=function(){var G=[];return this.forEach(function(se,ve){G.push([ve,se])}),E(G)},p.iterable&&(m.prototype[Symbol.iterator]=m.prototype.entries);function A(G){if(G.bodyUsed)return Promise.reject(new TypeError("Already read"));G.bodyUsed=!0}function F(G){return new Promise(function(se,ve){G.onload=function(){se(G.result)},G.onerror=function(){ve(G.error)}})}function _(G){var se=new FileReader,ve=F(se);return se.readAsArrayBuffer(G),ve}function P(G){var se=new FileReader,ve=F(se);return se.readAsText(G),ve}function C(G){for(var se=new Uint8Array(G),ve=new Array(se.length),Re=0;Re<se.length;Re++)ve[Re]=String.fromCharCode(se[Re]);return ve.join("")}function R(G){if(G.slice)return G.slice(0);var se=new Uint8Array(G.byteLength);return se.set(new Uint8Array(G)),se.buffer}function V(){return this.bodyUsed=!1,this._initBody=function(G){this._bodyInit=G,G?typeof G=="string"?this._bodyText=G:p.blob&&Blob.prototype.isPrototypeOf(G)?this._bodyBlob=G:p.formData&&FormData.prototype.isPrototypeOf(G)?this._bodyFormData=G:p.searchParams&&URLSearchParams.prototype.isPrototypeOf(G)?this._bodyText=G.toString():p.arrayBuffer&&p.blob&&y(G)?(this._bodyArrayBuffer=R(G.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):p.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(G)||d(G))?this._bodyArrayBuffer=R(G):this._bodyText=G=Object.prototype.toString.call(G):this._bodyText="",this.headers.get("content-type")||(typeof G=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):p.searchParams&&URLSearchParams.prototype.isPrototypeOf(G)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},p.blob&&(this.blob=function(){var G=A(this);if(G)return G;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?A(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(_)}),this.text=function(){var G=A(this);if(G)return G;if(this._bodyBlob)return P(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(C(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},p.formData&&(this.formData=function(){return this.text().then(Y)}),this.json=function(){return this.text().then(JSON.parse)},this}var j=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function B(G){var se=G.toUpperCase();return j.indexOf(se)>-1?se:G}function Z(G,se){se=se||{};var ve=se.body;if(G instanceof Z){if(G.bodyUsed)throw new TypeError("Already read");this.url=G.url,this.credentials=G.credentials,se.headers||(this.headers=new m(G.headers)),this.method=G.method,this.mode=G.mode,this.signal=G.signal,!ve&&G._bodyInit!=null&&(ve=G._bodyInit,G.bodyUsed=!0)}else this.url=String(G);if(this.credentials=se.credentials||this.credentials||"same-origin",(se.headers||!this.headers)&&(this.headers=new m(se.headers)),this.method=B(se.method||this.method||"GET"),this.mode=se.mode||this.mode||null,this.signal=se.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&ve)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(ve)}Z.prototype.clone=function(){return new Z(this,{body:this._bodyInit})};function Y(G){var se=new FormData;return G.trim().split("&").forEach(function(ve){if(ve){var Re=ve.split("="),Oe=Re.shift().replace(/\+/g," "),ge=Re.join("=").replace(/\+/g," ");se.append(decodeURIComponent(Oe),decodeURIComponent(ge))}}),se}function O(G){var se=new m,ve=G.replace(/\r?\n[\t ]+/g," ");return ve.split(/\r?\n/).forEach(function(Re){var Oe=Re.split(":"),ge=Oe.shift().trim();if(ge){var Ue=Oe.join(":").trim();se.append(ge,Ue)}}),se}V.call(Z.prototype);function oe(G,se){se||(se={}),this.type="default",this.status=se.status===void 0?200:se.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in se?se.statusText:"OK",this.headers=new m(se.headers),this.url=se.url||"",this._initBody(G)}V.call(oe.prototype),oe.prototype.clone=function(){return new oe(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new m(this.headers),url:this.url})},oe.error=function(){var G=new oe(null,{status:0,statusText:""});return G.type="error",G};var _e=[301,302,303,307,308];oe.redirect=function(G,se){if(_e.indexOf(se)===-1)throw new RangeError("Invalid status code");return new oe(null,{status:se,headers:{location:G}})},u.DOMException=c.DOMException;try{new u.DOMException}catch{u.DOMException=function(se,ve){this.message=se,this.name=ve;var Re=Error(se);this.stack=Re.stack},u.DOMException.prototype=Object.create(Error.prototype),u.DOMException.prototype.constructor=u.DOMException}function ke(G,se){return new Promise(function(ve,Re){var Oe=new Z(G,se);if(Oe.signal&&Oe.signal.aborted)return Re(new u.DOMException("Aborted","AbortError"));var ge=new XMLHttpRequest;function Ue(){ge.abort()}ge.onload=function(){var qe={status:ge.status,statusText:ge.statusText,headers:O(ge.getAllResponseHeaders()||"")};qe.url="responseURL"in ge?ge.responseURL:qe.headers.get("X-Request-URL");var rt="response"in ge?ge.response:ge.responseText;ve(new oe(rt,qe))},ge.onerror=function(){Re(new TypeError("Network request failed"))},ge.ontimeout=function(){Re(new TypeError("Network request failed"))},ge.onabort=function(){Re(new u.DOMException("Aborted","AbortError"))},ge.open(Oe.method,Oe.url,!0),Oe.credentials==="include"?ge.withCredentials=!0:Oe.credentials==="omit"&&(ge.withCredentials=!1),"responseType"in ge&&p.blob&&(ge.responseType="blob"),Oe.headers.forEach(function(qe,rt){ge.setRequestHeader(rt,qe)}),Oe.signal&&(Oe.signal.addEventListener("abort",Ue),ge.onreadystatechange=function(){ge.readyState===4&&Oe.signal.removeEventListener("abort",Ue)}),ge.send(typeof Oe._bodyInit=="undefined"?null:Oe._bodyInit)})}return ke.polyfill=!0,c.fetch||(c.fetch=ke,c.Headers=m,c.Request=Z,c.Response=oe),u.Headers=m,u.Request=Z,u.Response=oe,u.fetch=ke,Object.defineProperty(u,"__esModule",{value:!0}),u})({})})(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var s=r;e=s.fetch,e.default=s.fetch,e.fetch=s.fetch,e.Headers=s.Headers,e.Request=s.Request,e.Response=s.Response,t.exports=e})(Mn,Mn.exports);var De=crypto;const Xt=t=>t instanceof CryptoKey,nu=async(t,e)=>{const n=`SHA-${t.slice(-3)}`;return new Uint8Array(await De.subtle.digest(n,e))};var Ds=nu;const lt=new TextEncoder,ir=new TextDecoder,Kn=2**32;function br(...t){const e=t.reduce((s,{length:c})=>s+c,0),n=new Uint8Array(e);let r=0;return t.forEach(s=>{n.set(s,r),r+=s.length}),n}function iu(t,e){return br(lt.encode(t),new Uint8Array([0]),e)}function ki(t,e,n){if(e<0||e>=Kn)throw new RangeError(`value must be >= 0 and <= ${Kn-1}. Received ${e}`);t.set([e>>>24,e>>>16,e>>>8,e&255],n)}function Os(t){const e=Math.floor(t/Kn),n=t%Kn,r=new Uint8Array(8);return ki(r,e,0),ki(r,n,4),r}function Bi(t){const e=new Uint8Array(4);return ki(e,t),e}function vi(t){return br(Bi(t.length),t)}async function ou(t,e,n){const r=Math.ceil((e>>3)/32),s=new Uint8Array(r*32);for(let c=0;c<r;c++){const u=new Uint8Array(4+t.length+n.length);u.set(Bi(c+1)),u.set(t,4),u.set(n,4+t.length),s.set(await Ds("sha256",u),c*32)}return s.slice(0,e>>3)}const ji=t=>{let e=t;typeof e=="string"&&(e=lt.encode(e));const n=32768,r=[];for(let s=0;s<e.length;s+=n)r.push(String.fromCharCode.apply(null,e.subarray(s,s+n)));return btoa(r.join(""))},yt=t=>ji(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),Hs=t=>{const e=atob(t),n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n},Ft=t=>{let e=t;e instanceof Uint8Array&&(e=ir.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return Hs(e)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};class Ot extends Error{constructor(e){var n;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(n=Error.captureStackTrace)===null||n===void 0||n.call(Error,this,this.constructor)}static get code(){return"ERR_JOSE_GENERIC"}}class Qt extends Ot{constructor(e,n="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=n,this.reason=r}static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}}class Ti extends Ot{constructor(e,n="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_EXPIRED",this.claim=n,this.reason=r}static get code(){return"ERR_JWT_EXPIRED"}}class Bn extends Ot{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}}class Je extends Ot{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}}class mn extends Ot{constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}}class Pe extends Ot{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}}class Qe extends Ot{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}}class zt extends Ot{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}}class Ns extends Ot{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}static get code(){return"ERR_JWK_INVALID"}}class jn extends Ot{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}static get code(){return"ERR_JWKS_INVALID"}}class Wi extends Ot{constructor(){super(...arguments),this.code="ERR_JWKS_NO_MATCHING_KEY",this.message="no applicable key found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_NO_MATCHING_KEY"}}class Ls extends Ot{constructor(){super(...arguments),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS",this.message="multiple matching keys found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_MULTIPLE_MATCHING_KEYS"}}class Ms extends Ot{constructor(){super(...arguments),this.code="ERR_JWKS_TIMEOUT",this.message="request timed out"}static get code(){return"ERR_JWKS_TIMEOUT"}}class Vi extends Ot{constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}var su=Object.freeze(Object.defineProperty({__proto__:null,JOSEError:Ot,JWTClaimValidationFailed:Qt,JWTExpired:Ti,JOSEAlgNotAllowed:Bn,JOSENotSupported:Je,JWEDecryptionFailed:mn,JWEInvalid:Pe,JWSInvalid:Qe,JWTInvalid:zt,JWKInvalid:Ns,JWKSInvalid:jn,JWKSNoMatchingKey:Wi,JWKSMultipleMatchingKeys:Ls,JWKSTimeout:Ms,JWSSignatureVerificationFailed:Vi},Symbol.toStringTag,{value:"Module"})),Gn=De.getRandomValues.bind(De);function Ks(t){switch(t){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new Je(`Unsupported JWE Algorithm: ${t}`)}}var Bs=t=>Gn(new Uint8Array(Ks(t)>>3));const au=(t,e)=>{if(e.length<<3!==Ks(t))throw new Pe("Invalid Initialization Vector length")};var js=au;const uu=(t,e)=>{if(t.length<<3!==e)throw new Pe("Invalid Content Encryption Key length")};var Wn=uu;const cu=(t,e)=>{if(!(t instanceof Uint8Array))throw new TypeError("First argument must be a buffer");if(!(e instanceof Uint8Array))throw new TypeError("Second argument must be a buffer");if(t.length!==e.length)throw new TypeError("Input buffers must have the same length");const n=t.length;let r=0,s=-1;for(;++s<n;)r|=t[s]^e[s];return r===0};var lu=cu;function Jr(){return typeof WebSocketPair=="function"}function Rt(t,e="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${e} must be ${t}`)}function mr(t,e){return t.name===e}function On(t){return parseInt(t.name.slice(4),10)}function du(t){switch(t){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function Ws(t,e){if(e.length&&!e.some(n=>t.usages.includes(n))){let n="CryptoKey does not support this operation, its usages must include ";if(e.length>2){const r=e.pop();n+=`one of ${e.join(", ")}, or ${r}.`}else e.length===2?n+=`one of ${e[0]} or ${e[1]}.`:n+=`${e[0]}.`;throw new TypeError(n)}}function fu(t,e,...n){switch(e){case"HS256":case"HS384":case"HS512":{if(!mr(t.algorithm,"HMAC"))throw Rt("HMAC");const r=parseInt(e.slice(2),10);if(On(t.algorithm.hash)!==r)throw Rt(`SHA-${r}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!mr(t.algorithm,"RSASSA-PKCS1-v1_5"))throw Rt("RSASSA-PKCS1-v1_5");const r=parseInt(e.slice(2),10);if(On(t.algorithm.hash)!==r)throw Rt(`SHA-${r}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!mr(t.algorithm,"RSA-PSS"))throw Rt("RSA-PSS");const r=parseInt(e.slice(2),10);if(On(t.algorithm.hash)!==r)throw Rt(`SHA-${r}`,"algorithm.hash");break}case(Jr()&&"EdDSA"):{if(!mr(t.algorithm,"NODE-ED25519"))throw Rt("NODE-ED25519");break}case"ES256":case"ES384":case"ES512":{if(!mr(t.algorithm,"ECDSA"))throw Rt("ECDSA");const r=du(e);if(t.algorithm.namedCurve!==r)throw Rt(r,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}Ws(t,n)}function Ir(t,e,...n){switch(e){case"A128GCM":case"A192GCM":case"A256GCM":{if(!mr(t.algorithm,"AES-GCM"))throw Rt("AES-GCM");const r=parseInt(e.slice(1,4),10);if(t.algorithm.length!==r)throw Rt(r,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if(!mr(t.algorithm,"AES-KW"))throw Rt("AES-KW");const r=parseInt(e.slice(1,4),10);if(t.algorithm.length!==r)throw Rt(r,"algorithm.length");break}case"ECDH":if(!mr(t.algorithm,"ECDH"))throw Rt("ECDH");break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if(!mr(t.algorithm,"PBKDF2"))throw Rt("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(!mr(t.algorithm,"RSA-OAEP"))throw Rt("RSA-OAEP");const r=parseInt(e.slice(9),10)||1;if(On(t.algorithm.hash)!==r)throw Rt(`SHA-${r}`,"algorithm.hash");break}default:throw new TypeError("CryptoKey does not support this operation")}Ws(t,n)}var Ct=(t,...e)=>{let n="Key must be ";if(e.length>2){const r=e.pop();n+=`one of type ${e.join(", ")}, or ${r}.`}else e.length===2?n+=`one of type ${e[0]} or ${e[1]}.`:n+=`of type ${e[0]}.`;return t==null?n+=` Received ${t}`:typeof t=="function"&&t.name?n+=` Received function ${t.name}`:typeof t=="object"&&t!=null&&t.constructor&&t.constructor.name&&(n+=` Received an instance of ${t.constructor.name}`),n},Vs=t=>Xt(t);const ut=["CryptoKey"];async function hu(t,e,n,r,s,c){if(!(e instanceof Uint8Array))throw new TypeError(Ct(e,"Uint8Array"));const u=parseInt(t.slice(1,4),10),p=await De.subtle.importKey("raw",e.subarray(u>>3),"AES-CBC",!1,["decrypt"]),y=await De.subtle.importKey("raw",e.subarray(0,u>>3),{hash:`SHA-${u<<1}`,name:"HMAC"},!1,["sign"]),f=br(c,r,n,Os(c.length<<3)),d=new Uint8Array((await De.subtle.sign("HMAC",y,f)).slice(0,u>>3));let h;try{h=lu(s,d)}catch{}if(!h)throw new mn;let v;try{v=new Uint8Array(await De.subtle.decrypt({iv:r,name:"AES-CBC"},p,n))}catch{}if(!v)throw new mn;return v}async function pu(t,e,n,r,s,c){let u;e instanceof Uint8Array?u=await De.subtle.importKey("raw",e,"AES-GCM",!1,["decrypt"]):(Ir(e,t,"decrypt"),u=e);try{return new Uint8Array(await De.subtle.decrypt({additionalData:c,iv:r,name:"AES-GCM",tagLength:128},u,br(n,s)))}catch{throw new mn}}const gu=async(t,e,n,r,s,c)=>{if(!Xt(e)&&!(e instanceof Uint8Array))throw new TypeError(Ct(e,...ut,"Uint8Array"));switch(js(t,r),t){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return e instanceof Uint8Array&&Wn(e,parseInt(t.slice(-3),10)),hu(t,e,n,r,s,c);case"A128GCM":case"A192GCM":case"A256GCM":return e instanceof Uint8Array&&Wn(e,parseInt(t.slice(1,4),10)),pu(t,e,n,r,s,c);default:throw new Je("Unsupported JWE Content Encryption Algorithm")}};var $s=gu;const yu=async()=>{throw new Je('JWE "zip" (Compression Algorithm) Header Parameter is not supported by your javascript runtime. You need to use the `inflateRaw` decrypt option to provide Inflate Raw implementation.')},vu=async()=>{throw new Je('JWE "zip" (Compression Algorithm) Header Parameter is not supported by your javascript runtime. You need to use the `deflateRaw` encrypt option to provide Deflate Raw implementation.')},mu=(...t)=>{const e=t.filter(Boolean);if(e.length===0||e.length===1)return!0;let n;for(const r of e){const s=Object.keys(r);if(!n||n.size===0){n=new Set(s);continue}for(const c of s){if(n.has(c))return!1;n.add(c)}}return!0};var bn=mu;function _u(t){return typeof t=="object"&&t!==null}function Tt(t){if(!_u(t)||Object.prototype.toString.call(t)!=="[object Object]")return!1;if(Object.getPrototypeOf(t)===null)return!0;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}const wu=[{hash:"SHA-256",name:"HMAC"},!0,["sign"]];var Yn=wu;function Js(t,e){if(t.algorithm.length!==parseInt(e.slice(1,4),10))throw new TypeError(`Invalid key size for alg: ${e}`)}function qs(t,e,n){if(Xt(t))return Ir(t,e,n),t;if(t instanceof Uint8Array)return De.subtle.importKey("raw",t,"AES-KW",!0,[n]);throw new TypeError(Ct(t,...ut,"Uint8Array"))}const Ci=async(t,e,n)=>{const r=await qs(e,t,"wrapKey");Js(r,t);const s=await De.subtle.importKey("raw",n,...Yn);return new Uint8Array(await De.subtle.wrapKey("raw",s,r,"AES-KW"))},Ii=async(t,e,n)=>{const r=await qs(e,t,"unwrapKey");Js(r,t);const s=await De.subtle.unwrapKey("raw",n,r,"AES-KW",...Yn);return new Uint8Array(await De.subtle.exportKey("raw",s))};async function zs(t,e,n,r,s=new Uint8Array(0),c=new Uint8Array(0)){if(!Xt(t))throw new TypeError(Ct(t,...ut));if(Ir(t,"ECDH"),!Xt(e))throw new TypeError(Ct(e,...ut));Ir(e,"ECDH","deriveBits");const u=br(vi(lt.encode(n)),vi(s),vi(c),Bi(r)),p=new Uint8Array(await De.subtle.deriveBits({name:"ECDH",public:t},e,Math.ceil(parseInt(e.algorithm.namedCurve.slice(-3),10)/8)<<3));return ou(p,r,u)}async function bu(t){if(!Xt(t))throw new TypeError(Ct(t,...ut));return De.subtle.generateKey(t.algorithm,!0,["deriveBits"])}function Gs(t){if(!Xt(t))throw new TypeError(Ct(t,...ut));return["P-256","P-384","P-521"].includes(t.algorithm.namedCurve)}function Su(t){if(!(t instanceof Uint8Array)||t.length<8)throw new Pe("PBES2 Salt Input must be 8 or more octets")}function Eu(t,e){if(t instanceof Uint8Array)return De.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits"]);if(Xt(t))return Ir(t,e,"deriveBits","deriveKey"),t;throw new TypeError(Ct(t,...ut,"Uint8Array"))}async function Ys(t,e,n,r){Su(t);const s=iu(e,t),c=parseInt(e.slice(13,16),10),u={hash:`SHA-${e.slice(8,11)}`,iterations:n,name:"PBKDF2",salt:s},p={length:c,name:"AES-KW"},y=await Eu(r,e);if(y.usages.includes("deriveBits"))return new Uint8Array(await De.subtle.deriveBits(u,y,c));if(y.usages.includes("deriveKey"))return De.subtle.deriveKey(u,y,p,!1,["wrapKey","unwrapKey"]);throw new TypeError('PBKDF2 key "usages" must include "deriveBits" or "deriveKey"')}const Fu=async(t,e,n,r=2048,s=Gn(new Uint8Array(16)))=>{const c=await Ys(s,t,r,e);return{encryptedKey:await Ci(t.slice(-6),c,n),p2c:r,p2s:yt(s)}},Au=async(t,e,n,r,s)=>{const c=await Ys(s,t,r,e);return Ii(t.slice(-6),c,n)};function Vn(t){switch(t){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return"RSA-OAEP";default:throw new Je(`alg ${t} is not supported either by JOSE or your javascript runtime`)}}var Xn=(t,e)=>{if(t.startsWith("RS")||t.startsWith("PS")){const{modulusLength:n}=e.algorithm;if(typeof n!="number"||n<2048)throw new TypeError(`${t} requires key modulusLength to be 2048 bits or larger`)}};const Pu=async(t,e,n)=>{if(!Xt(e))throw new TypeError(Ct(e,...ut));if(Ir(e,t,"encrypt","wrapKey"),Xn(t,e),e.usages.includes("encrypt"))return new Uint8Array(await De.subtle.encrypt(Vn(t),e,n));if(e.usages.includes("wrapKey")){const r=await De.subtle.importKey("raw",n,...Yn);return new Uint8Array(await De.subtle.wrapKey("raw",r,e,Vn(t)))}throw new TypeError('RSA-OAEP key "usages" must include "encrypt" or "wrapKey" for this operation')},ku=async(t,e,n)=>{if(!Xt(e))throw new TypeError(Ct(e,...ut));if(Ir(e,t,"decrypt","unwrapKey"),Xn(t,e),e.usages.includes("decrypt"))return new Uint8Array(await De.subtle.decrypt(Vn(t),e,n));if(e.usages.includes("unwrapKey")){const r=await De.subtle.unwrapKey("raw",n,e,Vn(t),...Yn);return new Uint8Array(await De.subtle.exportKey("raw",r))}throw new TypeError('RSA-OAEP key "usages" must include "decrypt" or "unwrapKey" for this operation')};function $i(t){switch(t){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new Je(`Unsupported JWE Algorithm: ${t}`)}}var Kr=t=>Gn(new Uint8Array($i(t)>>3)),Xs=(t,e)=>{const n=(t.match(/.{1,64}/g)||[]).join(`
`);return`-----BEGIN ${e}-----
${n}
-----END ${e}-----`};const Qs=async(t,e,n)=>{if(!Xt(n))throw new TypeError(Ct(n,...ut));if(!n.extractable)throw new TypeError("CryptoKey is not extractable");if(n.type!==t)throw new TypeError(`key is not a ${t} key`);return Xs(ji(new Uint8Array(await De.subtle.exportKey(e,n))),`${t.toUpperCase()} KEY`)},Tu=t=>Qs("public","spki",t),Cu=t=>Qs("private","pkcs8",t),pn=(t,e,n=0)=>{n===0&&(e.unshift(e.length),e.unshift(6));let r=t.indexOf(e[0],n);if(r===-1)return!1;const s=t.subarray(r,r+e.length);return s.length!==e.length?!1:s.every((c,u)=>c===e[u])||pn(t,e,r+1)},Ho=t=>{switch(!0){case pn(t,[42,134,72,206,61,3,1,7]):return"P-256";case pn(t,[43,129,4,0,34]):return"P-384";case pn(t,[43,129,4,0,35]):return"P-521";case(Jr()&&pn(t,[43,101,112])):return"Ed25519";default:throw new Je("Invalid or unsupported EC Key Curve or OKP Key Sub Type")}},Zs=async(t,e,n,r,s)=>{var c;let u,p;const y=new Uint8Array(atob(n.replace(t,"")).split("").map(d=>d.charCodeAt(0))),f=e==="spki";switch(r){case"PS256":case"PS384":case"PS512":u={name:"RSA-PSS",hash:`SHA-${r.slice(-3)}`},p=f?["verify"]:["sign"];break;case"RS256":case"RS384":case"RS512":u={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${r.slice(-3)}`},p=f?["verify"]:["sign"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":u={name:"RSA-OAEP",hash:`SHA-${parseInt(r.slice(-3),10)||1}`},p=f?["encrypt","wrapKey"]:["decrypt","unwrapKey"];break;case"ES256":u={name:"ECDSA",namedCurve:"P-256"},p=f?["verify"]:["sign"];break;case"ES384":u={name:"ECDSA",namedCurve:"P-384"},p=f?["verify"]:["sign"];break;case"ES512":u={name:"ECDSA",namedCurve:"P-521"},p=f?["verify"]:["sign"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":u={name:"ECDH",namedCurve:Ho(y)},p=f?[]:["deriveBits"];break;case(Jr()&&"EdDSA"):const d=Ho(y).toUpperCase();u={name:`NODE-${d}`,namedCurve:`NODE-${d}`},p=f?["verify"]:["sign"];break;default:throw new Je('Invalid or unsupported "alg" (Algorithm) value')}return De.subtle.importKey(e,y,u,(c=s==null?void 0:s.extractable)!==null&&c!==void 0?c:!1,p)},Iu=(t,e,n)=>Zs(/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g,"pkcs8",t,e,n),ea=(t,e,n)=>Zs(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g,"spki",t,e,n);function xu(t){let e,n;switch(t.kty){case"oct":{switch(t.alg){case"HS256":case"HS384":case"HS512":e={name:"HMAC",hash:`SHA-${t.alg.slice(-3)}`},n=["sign","verify"];break;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":throw new Je(`${t.alg} keys cannot be imported as CryptoKey instances`);case"A128GCM":case"A192GCM":case"A256GCM":case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":e={name:"AES-GCM"},n=["encrypt","decrypt"];break;case"A128KW":case"A192KW":case"A256KW":e={name:"AES-KW"},n=["wrapKey","unwrapKey"];break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":e={name:"PBKDF2"},n=["deriveBits"];break;default:throw new Je('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"RSA":{switch(t.alg){case"PS256":case"PS384":case"PS512":e={name:"RSA-PSS",hash:`SHA-${t.alg.slice(-3)}`},n=t.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":e={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${t.alg.slice(-3)}`},n=t.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":e={name:"RSA-OAEP",hash:`SHA-${parseInt(t.alg.slice(-3),10)||1}`},n=t.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new Je('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(t.alg){case"ES256":e={name:"ECDSA",namedCurve:"P-256"},n=t.d?["sign"]:["verify"];break;case"ES384":e={name:"ECDSA",namedCurve:"P-384"},n=t.d?["sign"]:["verify"];break;case"ES512":e={name:"ECDSA",namedCurve:"P-521"},n=t.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:"ECDH",namedCurve:t.crv},n=t.d?["deriveBits"]:[];break;default:throw new Je('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case(Jr()&&"OKP"):if(t.alg!=="EdDSA")throw new Je('Invalid or unsupported JWK "alg" (Algorithm) Parameter value');switch(t.crv){case"Ed25519":e={name:"NODE-ED25519",namedCurve:"NODE-ED25519"},n=t.d?["sign"]:["verify"];break;default:throw new Je('Invalid or unsupported JWK "crv" (Subtype of Key Pair) Parameter value')}break;default:throw new Je('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:e,keyUsages:n}}const Ru=async t=>{var e,n;const{algorithm:r,keyUsages:s}=xu(t),c=[r,(e=t.ext)!==null&&e!==void 0?e:!1,(n=t.key_ops)!==null&&n!==void 0?n:s];if(r.name==="PBKDF2")return De.subtle.importKey("raw",Ft(t.k),...c);const u={...t};return delete u.alg,De.subtle.importKey("jwk",u,...c)};var No=Ru;function Lo(t){let e=[],n=0;for(;n<t.length;){let r=ta(t.subarray(n));e.push(r),n+=r.byteLength}return e}function ta(t){let e=0,n=t[0]&31;if(e++,n===31){for(n=0;t[e]>=128;)n=n*128+t[e]-128,e++;n=n*128+t[e]-128,e++}let r=0;if(t[e]<128)r=t[e],e++;else{let c=t[e]&127;e++,r=0;for(let u=0;u<c;u++)r=r*256+t[e],e++}if(r===128){for(r=0;t[e+r]!==0||t[e+r+1]!==0;)r++;const c=e+r+2;return{byteLength:c,contents:t.subarray(e,e+r),raw:t.subarray(0,c)}}const s=e+r;return{byteLength:s,contents:t.subarray(e,s),raw:t.subarray(0,s)}}function Uu(t){const e=Lo(Lo(ta(t).contents)[0].contents);return ji(e[e[0].raw[0]===160?6:5].raw)}function Du(t){const e=t.replace(/(?:-----(?:BEGIN|END) CERTIFICATE-----|\s)/g,""),n=Hs(e);return Xs(Uu(n),"PUBLIC KEY")}async function Ou(t,e,n){if(typeof t!="string"||t.indexOf("-----BEGIN PUBLIC KEY-----")!==0)throw new TypeError('"spki" must be SPKI formatted string');return ea(t,e,n)}async function Hu(t,e,n){if(typeof t!="string"||t.indexOf("-----BEGIN CERTIFICATE-----")!==0)throw new TypeError('"x509" must be X.509 formatted string');const r=Du(t);return ea(r,e,n)}async function Nu(t,e,n){if(typeof t!="string"||t.indexOf("-----BEGIN PRIVATE KEY-----")!==0)throw new TypeError('"pkcs8" must be PCKS8 formatted string');return Iu(t,e,n)}async function Qn(t,e,n){if(!Tt(t))throw new TypeError("JWK must be an object");if(e||(e=t.alg),typeof e!="string"||!e)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');switch(t.kty){case"oct":if(typeof t.k!="string"||!t.k)throw new TypeError('missing "k" (Key Value) Parameter value');return n!=null||(n=t.ext!==!0),n?No({...t,alg:e,ext:!1}):Ft(t.k);case"RSA":if(t.oth!==void 0)throw new Je('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return No({...t,alg:e});default:throw new Je('Unsupported "kty" (Key Type) Parameter value')}}const Lu=t=>{if(!(t instanceof Uint8Array)){if(!Vs(t))throw new TypeError(Ct(t,...ut,"Uint8Array"));if(t.type!=="secret")throw new TypeError(`${ut.join(" or ")} instances for symmetric algorithms must be of type "secret"`)}},Mu=(t,e)=>{if(!Vs(t))throw new TypeError(Ct(t,...ut));if(t.type==="secret")throw new TypeError(`${ut.join(" or ")} instances for asymmetric algorithms must not be of type "secret"`);if(e==="sign"&&t.type==="public")throw new TypeError(`${ut.join(" or ")} instances for asymmetric algorithm signing must be of type "private"`);if(e==="decrypt"&&t.type==="public")throw new TypeError(`${ut.join(" or ")} instances for asymmetric algorithm decryption must be of type "private"`);if(t.algorithm&&e==="verify"&&t.type==="private")throw new TypeError(`${ut.join(" or ")} instances for asymmetric algorithm verifying must be of type "public"`);if(t.algorithm&&e==="encrypt"&&t.type==="private")throw new TypeError(`${ut.join(" or ")} instances for asymmetric algorithm encryption must be of type "public"`)},Ku=(t,e,n)=>{t.startsWith("HS")||t==="dir"||t.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(t)?Lu(e):Mu(e,n)};var Zn=Ku;async function Bu(t,e,n,r,s){if(!(n instanceof Uint8Array))throw new TypeError(Ct(n,"Uint8Array"));const c=parseInt(t.slice(1,4),10),u=await De.subtle.importKey("raw",n.subarray(c>>3),"AES-CBC",!1,["encrypt"]),p=await De.subtle.importKey("raw",n.subarray(0,c>>3),{hash:`SHA-${c<<1}`,name:"HMAC"},!1,["sign"]),y=new Uint8Array(await De.subtle.encrypt({iv:r,name:"AES-CBC"},u,e)),f=br(s,r,y,Os(s.length<<3)),d=new Uint8Array((await De.subtle.sign("HMAC",p,f)).slice(0,c>>3));return{ciphertext:y,tag:d}}async function ju(t,e,n,r,s){let c;n instanceof Uint8Array?c=await De.subtle.importKey("raw",n,"AES-GCM",!1,["encrypt"]):(Ir(n,t,"encrypt"),c=n);const u=new Uint8Array(await De.subtle.encrypt({additionalData:s,iv:r,name:"AES-GCM",tagLength:128},c,e)),p=u.slice(-16);return{ciphertext:u.slice(0,-16),tag:p}}const Wu=async(t,e,n,r,s)=>{if(!Xt(n)&&!(n instanceof Uint8Array))throw new TypeError(Ct(n,...ut,"Uint8Array"));switch(js(t,r),t){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return n instanceof Uint8Array&&Wn(n,parseInt(t.slice(-3),10)),Bu(t,e,n,r,s);case"A128GCM":case"A192GCM":case"A256GCM":return n instanceof Uint8Array&&Wn(n,parseInt(t.slice(1,4),10)),ju(t,e,n,r,s);default:throw new Je("Unsupported JWE Content Encryption Algorithm")}};var xi=Wu;async function Vu(t,e,n,r){const s=t.slice(0,7);r||(r=Bs(s));const{ciphertext:c,tag:u}=await xi(s,n,e,r,new Uint8Array(0));return{encryptedKey:c,iv:yt(r),tag:yt(u)}}async function $u(t,e,n,r,s){const c=t.slice(0,7);return $s(c,e,n,r,s,new Uint8Array(0))}async function Ju(t,e,n,r){switch(Zn(t,e,"decrypt"),t){case"dir":{if(n!==void 0)throw new Pe("Encountered unexpected JWE Encrypted Key");return e}case"ECDH-ES":if(n!==void 0)throw new Pe("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!Tt(r.epk))throw new Pe('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(!Gs(e))throw new Je("ECDH with the provided key is not allowed or not supported by your javascript runtime");const s=await Qn(r.epk,t);let c,u;if(r.apu!==void 0){if(typeof r.apu!="string")throw new Pe('JOSE Header "apu" (Agreement PartyUInfo) invalid');c=Ft(r.apu)}if(r.apv!==void 0){if(typeof r.apv!="string")throw new Pe('JOSE Header "apv" (Agreement PartyVInfo) invalid');u=Ft(r.apv)}const p=await zs(s,e,t==="ECDH-ES"?r.enc:t,t==="ECDH-ES"?$i(r.enc):parseInt(t.slice(-5,-2),10),c,u);if(t==="ECDH-ES")return p;if(n===void 0)throw new Pe("JWE Encrypted Key missing");return Ii(t.slice(-6),p,n)}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(n===void 0)throw new Pe("JWE Encrypted Key missing");return ku(t,e,n)}case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{if(n===void 0)throw new Pe("JWE Encrypted Key missing");if(typeof r.p2c!="number")throw new Pe('JOSE Header "p2c" (PBES2 Count) missing or invalid');if(typeof r.p2s!="string")throw new Pe('JOSE Header "p2s" (PBES2 Salt) missing or invalid');return Au(t,e,n,r.p2c,Ft(r.p2s))}case"A128KW":case"A192KW":case"A256KW":{if(n===void 0)throw new Pe("JWE Encrypted Key missing");return Ii(t,e,n)}case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{if(n===void 0)throw new Pe("JWE Encrypted Key missing");if(typeof r.iv!="string")throw new Pe('JOSE Header "iv" (Initialization Vector) missing or invalid');if(typeof r.tag!="string")throw new Pe('JOSE Header "tag" (Authentication Tag) missing or invalid');const s=Ft(r.iv),c=Ft(r.tag);return $u(t,e,n,s,c)}default:throw new Je('Invalid or unsupported "alg" (JWE Algorithm) header value')}}function Sn(t,e,n,r,s){if(s.crit!==void 0&&r.crit===void 0)throw new t('"crit" (Critical) Header Parameter MUST be integrity protected');if(!r||r.crit===void 0)return new Set;if(!Array.isArray(r.crit)||r.crit.length===0||r.crit.some(u=>typeof u!="string"||u.length===0))throw new t('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let c;n!==void 0?c=new Map([...Object.entries(n),...e.entries()]):c=e;for(const u of r.crit){if(!c.has(u))throw new Je(`Extension Header Parameter "${u}" is not recognized`);if(s[u]===void 0)throw new t(`Extension Header Parameter "${u}" is missing`);if(c.get(u)&&r[u]===void 0)throw new t(`Extension Header Parameter "${u}" MUST be integrity protected`)}return new Set(r.crit)}const qu=(t,e)=>{if(e!==void 0&&(!Array.isArray(e)||e.some(n=>typeof n!="string")))throw new TypeError(`"${t}" option must be an array of strings`);if(!!e)return new Set(e)};var Ri=qu;async function Ji(t,e,n){var r;if(!Tt(t))throw new Pe("Flattened JWE must be an object");if(t.protected===void 0&&t.header===void 0&&t.unprotected===void 0)throw new Pe("JOSE Header missing");if(typeof t.iv!="string")throw new Pe("JWE Initialization Vector missing or incorrect type");if(typeof t.ciphertext!="string")throw new Pe("JWE Ciphertext missing or incorrect type");if(typeof t.tag!="string")throw new Pe("JWE Authentication Tag missing or incorrect type");if(t.protected!==void 0&&typeof t.protected!="string")throw new Pe("JWE Protected Header incorrect type");if(t.encrypted_key!==void 0&&typeof t.encrypted_key!="string")throw new Pe("JWE Encrypted Key incorrect type");if(t.aad!==void 0&&typeof t.aad!="string")throw new Pe("JWE AAD incorrect type");if(t.header!==void 0&&!Tt(t.header))throw new Pe("JWE Shared Unprotected Header incorrect type");if(t.unprotected!==void 0&&!Tt(t.unprotected))throw new Pe("JWE Per-Recipient Unprotected Header incorrect type");let s;if(t.protected){const C=Ft(t.protected);try{s=JSON.parse(ir.decode(C))}catch{throw new Pe("JWE Protected Header is invalid")}}if(!bn(s,t.header,t.unprotected))throw new Pe("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");const c={...s,...t.header,...t.unprotected};if(Sn(Pe,new Map,n==null?void 0:n.crit,s,c),c.zip!==void 0){if(!s||!s.zip)throw new Pe('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if(c.zip!=="DEF")throw new Je('Unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}const{alg:u,enc:p}=c;if(typeof u!="string"||!u)throw new Pe("missing JWE Algorithm (alg) in JWE Header");if(typeof p!="string"||!p)throw new Pe("missing JWE Encryption Algorithm (enc) in JWE Header");const y=n&&Ri("keyManagementAlgorithms",n.keyManagementAlgorithms),f=n&&Ri("contentEncryptionAlgorithms",n.contentEncryptionAlgorithms);if(y&&!y.has(u))throw new Bn('"alg" (Algorithm) Header Parameter not allowed');if(f&&!f.has(p))throw new Bn('"enc" (Encryption Algorithm) Header Parameter not allowed');let d;t.encrypted_key!==void 0&&(d=Ft(t.encrypted_key));let h=!1;typeof e=="function"&&(e=await e(s,t),h=!0);let v;try{v=await Ju(u,e,d,c)}catch(C){if(C instanceof TypeError)throw C;v=Kr(p)}const E=Ft(t.iv),m=Ft(t.tag),A=lt.encode((r=t.protected)!==null&&r!==void 0?r:"");let F;t.aad!==void 0?F=br(A,lt.encode("."),lt.encode(t.aad)):F=A;let _=await $s(p,v,Ft(t.ciphertext),E,m,F);c.zip==="DEF"&&(_=await((n==null?void 0:n.inflateRaw)||yu)(_));const P={plaintext:_};return t.protected!==void 0&&(P.protectedHeader=s),t.aad!==void 0&&(P.additionalAuthenticatedData=Ft(t.aad)),t.unprotected!==void 0&&(P.sharedUnprotectedHeader=t.unprotected),t.header!==void 0&&(P.unprotectedHeader=t.header),h?{...P,key:e}:P}async function ra(t,e,n){if(t instanceof Uint8Array&&(t=ir.decode(t)),typeof t!="string")throw new Pe("Compact JWE must be a string or Uint8Array");const{0:r,1:s,2:c,3:u,4:p,length:y}=t.split(".");if(y!==5)throw new Pe("Invalid Compact JWE");const f=await Ji({ciphertext:u,iv:c||void 0,protected:r||void 0,tag:p||void 0,encrypted_key:s||void 0},e,n),d={plaintext:f.plaintext,protectedHeader:f.protectedHeader};return typeof e=="function"?{...d,key:f.key}:d}async function zu(t,e,n){if(!Tt(t))throw new Pe("General JWE must be an object");if(!Array.isArray(t.recipients)||!t.recipients.every(Tt))throw new Pe("JWE Recipients missing or incorrect type");if(!t.recipients.length)throw new Pe("JWE Recipients has no members");for(const r of t.recipients)try{return await Ji({aad:t.aad,ciphertext:t.ciphertext,encrypted_key:r.encrypted_key,header:r.header,iv:t.iv,protected:t.protected,tag:t.tag,unprotected:t.unprotected},e,n)}catch{}throw new mn}const Gu=async t=>{if(t instanceof Uint8Array)return{kty:"oct",k:yt(t)};if(!Xt(t))throw new TypeError(Ct(t,...ut,"Uint8Array"));if(!t.extractable)throw new TypeError("non-extractable CryptoKey cannot be exported as a JWK");const{ext:e,key_ops:n,alg:r,use:s,...c}=await De.subtle.exportKey("jwk",t);return c};var Yu=Gu;async function Xu(t){return Tu(t)}async function Qu(t){return Cu(t)}async function na(t){return Yu(t)}async function ia(t,e,n,r,s={}){let c,u,p;switch(Zn(t,n,"encrypt"),t){case"dir":{p=n;break}case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!Gs(n))throw new Je("ECDH with the provided key is not allowed or not supported by your javascript runtime");const{apu:y,apv:f}=s;let{epk:d}=s;d||(d=(await bu(n)).privateKey);const{x:h,y:v,crv:E,kty:m}=await na(d),A=await zs(n,d,t==="ECDH-ES"?e:t,t==="ECDH-ES"?$i(e):parseInt(t.slice(-5,-2),10),y,f);if(u={epk:{x:h,crv:E,kty:m}},m==="EC"&&(u.epk.y=v),y&&(u.apu=yt(y)),f&&(u.apv=yt(f)),t==="ECDH-ES"){p=A;break}p=r||Kr(e);const F=t.slice(-6);c=await Ci(F,A,p);break}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{p=r||Kr(e),c=await Pu(t,n,p);break}case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{p=r||Kr(e);const{p2c:y,p2s:f}=s;({encryptedKey:c,...u}=await Fu(t,n,p,y,f));break}case"A128KW":case"A192KW":case"A256KW":{p=r||Kr(e),c=await Ci(t,n,p);break}case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{p=r||Kr(e);const{iv:y}=s;({encryptedKey:c,...u}=await Vu(t,n,p,y));break}default:throw new Je('Invalid or unsupported "alg" (JWE Algorithm) header value')}return{cek:p,encryptedKey:c,parameters:u}}const oa=Symbol();class $n{constructor(e){if(!(e instanceof Uint8Array))throw new TypeError("plaintext must be an instance of Uint8Array");this._plaintext=e}setKeyManagementParameters(e){if(this._keyManagementParameters)throw new TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setSharedUnprotectedHeader(e){if(this._sharedUnprotectedHeader)throw new TypeError("setSharedUnprotectedHeader can only be called once");return this._sharedUnprotectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}setAdditionalAuthenticatedData(e){return this._aad=e,this}setContentEncryptionKey(e){if(this._cek)throw new TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}setInitializationVector(e){if(this._iv)throw new TypeError("setInitializationVector can only be called once");return this._iv=e,this}async encrypt(e,n){if(!this._protectedHeader&&!this._unprotectedHeader&&!this._sharedUnprotectedHeader)throw new Pe("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");if(!bn(this._protectedHeader,this._unprotectedHeader,this._sharedUnprotectedHeader))throw new Pe("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");const r={...this._protectedHeader,...this._unprotectedHeader,...this._sharedUnprotectedHeader};if(Sn(Pe,new Map,n==null?void 0:n.crit,this._protectedHeader,r),r.zip!==void 0){if(!this._protectedHeader||!this._protectedHeader.zip)throw new Pe('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if(r.zip!=="DEF")throw new Je('Unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}const{alg:s,enc:c}=r;if(typeof s!="string"||!s)throw new Pe('JWE "alg" (Algorithm) Header Parameter missing or invalid');if(typeof c!="string"||!c)throw new Pe('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');let u;if(s==="dir"){if(this._cek)throw new TypeError("setContentEncryptionKey cannot be called when using Direct Encryption")}else if(s==="ECDH-ES"&&this._cek)throw new TypeError("setContentEncryptionKey cannot be called when using Direct Key Agreement");let p;{let m;({cek:p,encryptedKey:u,parameters:m}=await ia(s,c,e,this._cek,this._keyManagementParameters)),m&&(n&&oa in n?this._unprotectedHeader?this._unprotectedHeader={...this._unprotectedHeader,...m}:this.setUnprotectedHeader(m):this._protectedHeader?this._protectedHeader={...this._protectedHeader,...m}:this.setProtectedHeader(m))}this._iv||(this._iv=Bs(c));let y,f,d;this._protectedHeader?f=lt.encode(yt(JSON.stringify(this._protectedHeader))):f=lt.encode(""),this._aad?(d=yt(this._aad),y=br(f,lt.encode("."),lt.encode(d))):y=f;let h,v;if(r.zip==="DEF"){const m=await((n==null?void 0:n.deflateRaw)||vu)(this._plaintext);({ciphertext:h,tag:v}=await xi(c,m,p,this._iv,y))}else({ciphertext:h,tag:v}=await xi(c,this._plaintext,p,this._iv,y));const E={ciphertext:yt(h),iv:yt(this._iv),tag:yt(v)};return u&&(E.encrypted_key=yt(u)),d&&(E.aad=d),this._protectedHeader&&(E.protected=ir.decode(f)),this._sharedUnprotectedHeader&&(E.unprotected=this._sharedUnprotectedHeader),this._unprotectedHeader&&(E.header=this._unprotectedHeader),E}}class Zu{constructor(e,n,r){this.parent=e,this.key=n,this.options=r}setUnprotectedHeader(e){if(this.unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=e,this}addRecipient(...e){return this.parent.addRecipient(...e)}encrypt(...e){return this.parent.encrypt(...e)}done(){return this.parent}}class ec{constructor(e){this._recipients=[],this._plaintext=e}addRecipient(e,n){const r=new Zu(this,e,{crit:n==null?void 0:n.crit});return this._recipients.push(r),r}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setSharedUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setSharedUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}setAdditionalAuthenticatedData(e){return this._aad=e,this}async encrypt(e){var n,r,s;if(!this._recipients.length)throw new Pe("at least one recipient must be added");if(e={deflateRaw:e==null?void 0:e.deflateRaw},this._recipients.length===1){const[y]=this._recipients,f=await new $n(this._plaintext).setAdditionalAuthenticatedData(this._aad).setProtectedHeader(this._protectedHeader).setSharedUnprotectedHeader(this._unprotectedHeader).setUnprotectedHeader(y.unprotectedHeader).encrypt(y.key,{...y.options,...e});let d={ciphertext:f.ciphertext,iv:f.iv,recipients:[{}],tag:f.tag};return f.aad&&(d.aad=f.aad),f.protected&&(d.protected=f.protected),f.unprotected&&(d.unprotected=f.unprotected),f.encrypted_key&&(d.recipients[0].encrypted_key=f.encrypted_key),f.header&&(d.recipients[0].header=f.header),d}let c;for(let y=0;y<this._recipients.length;y++){const f=this._recipients[y];if(!bn(this._protectedHeader,this._unprotectedHeader,f.unprotectedHeader))throw new Pe("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");const d={...this._protectedHeader,...this._unprotectedHeader,...f.unprotectedHeader},{alg:h}=d;if(typeof h!="string"||!h)throw new Pe('JWE "alg" (Algorithm) Header Parameter missing or invalid');if(h==="dir"||h==="ECDH-ES")throw new Pe('"dir" and "ECDH-ES" alg may only be used with a single recipient');if(typeof d.enc!="string"||!d.enc)throw new Pe('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if(!c)c=d.enc;else if(c!==d.enc)throw new Pe('JWE "enc" (Encryption Algorithm) Header Parameter must be the same for all recipients');if(Sn(Pe,new Map,f.options.crit,this._protectedHeader,d),d.zip!==void 0&&(!this._protectedHeader||!this._protectedHeader.zip))throw new Pe('JWE "zip" (Compression Algorithm) Header MUST be integrity protected')}const u=Kr(c);let p={ciphertext:"",iv:"",recipients:[],tag:""};for(let y=0;y<this._recipients.length;y++){const f=this._recipients[y],d={};p.recipients.push(d);const v={...this._protectedHeader,...this._unprotectedHeader,...f.unprotectedHeader}.alg.startsWith("PBES2")?2048+y:void 0;if(y===0){const A=await new $n(this._plaintext).setAdditionalAuthenticatedData(this._aad).setContentEncryptionKey(u).setProtectedHeader(this._protectedHeader).setSharedUnprotectedHeader(this._unprotectedHeader).setUnprotectedHeader(f.unprotectedHeader).setKeyManagementParameters({p2c:v}).encrypt(f.key,{...f.options,...e,[oa]:!0});p.ciphertext=A.ciphertext,p.iv=A.iv,p.tag=A.tag,A.aad&&(p.aad=A.aad),A.protected&&(p.protected=A.protected),A.unprotected&&(p.unprotected=A.unprotected),d.encrypted_key=A.encrypted_key,A.header&&(d.header=A.header);continue}const{encryptedKey:E,parameters:m}=await ia(((n=f.unprotectedHeader)===null||n===void 0?void 0:n.alg)||((r=this._protectedHeader)===null||r===void 0?void 0:r.alg)||((s=this._unprotectedHeader)===null||s===void 0?void 0:s.alg),c,f.key,u,{p2c:v});d.encrypted_key=yt(E),(f.unprotectedHeader||m)&&(d.header={...f.unprotectedHeader,...m})}return p}}function sa(t,e){const n=`SHA-${t.slice(-3)}`;switch(t){case"HS256":case"HS384":case"HS512":return{hash:n,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:n,name:"RSA-PSS",saltLength:t.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:n,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:n,name:"ECDSA",namedCurve:e.namedCurve};case(Jr()&&"EdDSA"):const{namedCurve:r}=e;return{name:r,namedCurve:r};default:throw new Je(`alg ${t} is not supported either by JOSE or your javascript runtime`)}}function aa(t,e,n){if(Xt(e))return fu(e,t,n),e;if(e instanceof Uint8Array){if(!t.startsWith("HS"))throw new TypeError(Ct(e,...ut));return De.subtle.importKey("raw",e,{hash:`SHA-${t.slice(-3)}`,name:"HMAC"},!1,[n])}throw new TypeError(Ct(e,...ut,"Uint8Array"))}const tc=async(t,e,n,r)=>{const s=await aa(t,e,"verify");Xn(t,s);const c=sa(t,s.algorithm);try{return await De.subtle.verify(c,s,n,r)}catch{return!1}};var rc=tc;async function qi(t,e,n){var r;if(!Tt(t))throw new Qe("Flattened JWS must be an object");if(t.protected===void 0&&t.header===void 0)throw new Qe('Flattened JWS must have either of the "protected" or "header" members');if(t.protected!==void 0&&typeof t.protected!="string")throw new Qe("JWS Protected Header incorrect type");if(t.payload===void 0)throw new Qe("JWS Payload missing");if(typeof t.signature!="string")throw new Qe("JWS Signature missing or incorrect type");if(t.header!==void 0&&!Tt(t.header))throw new Qe("JWS Unprotected Header incorrect type");let s={};if(t.protected){const F=Ft(t.protected);try{s=JSON.parse(ir.decode(F))}catch{throw new Qe("JWS Protected Header is invalid")}}if(!bn(s,t.header))throw new Qe("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const c={...s,...t.header},u=Sn(Qe,new Map([["b64",!0]]),n==null?void 0:n.crit,s,c);let p=!0;if(u.has("b64")&&(p=s.b64,typeof p!="boolean"))throw new Qe('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:y}=c;if(typeof y!="string"||!y)throw new Qe('JWS "alg" (Algorithm) Header Parameter missing or invalid');const f=n&&Ri("algorithms",n.algorithms);if(f&&!f.has(y))throw new Bn('"alg" (Algorithm) Header Parameter not allowed');if(p){if(typeof t.payload!="string")throw new Qe("JWS Payload must be a string")}else if(typeof t.payload!="string"&&!(t.payload instanceof Uint8Array))throw new Qe("JWS Payload must be a string or an Uint8Array instance");let d=!1;typeof e=="function"&&(e=await e(s,t),d=!0),Zn(y,e,"verify");const h=br(lt.encode((r=t.protected)!==null&&r!==void 0?r:""),lt.encode("."),typeof t.payload=="string"?lt.encode(t.payload):t.payload),v=Ft(t.signature);if(!await rc(y,e,v,h))throw new Vi;let m;p?m=Ft(t.payload):typeof t.payload=="string"?m=lt.encode(t.payload):m=t.payload;const A={payload:m};return t.protected!==void 0&&(A.protectedHeader=s),t.header!==void 0&&(A.unprotectedHeader=t.header),d?{...A,key:e}:A}async function ua(t,e,n){if(t instanceof Uint8Array&&(t=ir.decode(t)),typeof t!="string")throw new Qe("Compact JWS must be a string or Uint8Array");const{0:r,1:s,2:c,length:u}=t.split(".");if(u!==3)throw new Qe("Invalid Compact JWS");const p=await qi({payload:s,protected:r,signature:c},e,n),y={payload:p.payload,protectedHeader:p.protectedHeader};return typeof e=="function"?{...y,key:p.key}:y}async function nc(t,e,n){if(!Tt(t))throw new Qe("General JWS must be an object");if(!Array.isArray(t.signatures)||!t.signatures.every(Tt))throw new Qe("JWS Signatures missing or incorrect type");for(const r of t.signatures)try{return await qi({header:r.header,payload:t.payload,protected:r.protected,signature:r.signature},e,n)}catch{}throw new Vi}var Hn=t=>Math.floor(t.getTime()/1e3);const ca=60,la=ca*60,zi=la*24,ic=zi*7,oc=zi*365.25,sc=/^(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)$/i;var Jn=t=>{const e=sc.exec(t);if(!e)throw new TypeError("Invalid time period format");const n=parseFloat(e[1]);switch(e[2].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":return Math.round(n);case"minute":case"minutes":case"min":case"mins":case"m":return Math.round(n*ca);case"hour":case"hours":case"hr":case"hrs":case"h":return Math.round(n*la);case"day":case"days":case"d":return Math.round(n*zi);case"week":case"weeks":case"w":return Math.round(n*ic);default:return Math.round(n*oc)}};const Mo=t=>t.toLowerCase().replace(/^application\//,""),ac=(t,e)=>typeof t=="string"?e.includes(t):Array.isArray(t)?e.some(Set.prototype.has.bind(new Set(t))):!1;var Gi=(t,e,n={})=>{const{typ:r}=n;if(r&&(typeof t.typ!="string"||Mo(t.typ)!==Mo(r)))throw new Qt('unexpected "typ" JWT header value',"typ","check_failed");let s;try{s=JSON.parse(ir.decode(e))}catch{}if(!Tt(s))throw new zt("JWT Claims Set must be a top-level JSON object");const{issuer:c}=n;if(c&&!(Array.isArray(c)?c:[c]).includes(s.iss))throw new Qt('unexpected "iss" claim value',"iss","check_failed");const{subject:u}=n;if(u&&s.sub!==u)throw new Qt('unexpected "sub" claim value',"sub","check_failed");const{audience:p}=n;if(p&&!ac(s.aud,typeof p=="string"?[p]:p))throw new Qt('unexpected "aud" claim value',"aud","check_failed");let y;switch(typeof n.clockTolerance){case"string":y=Jn(n.clockTolerance);break;case"number":y=n.clockTolerance;break;case"undefined":y=0;break;default:throw new TypeError("Invalid clockTolerance option type")}const{currentDate:f}=n,d=Hn(f||new Date);if((s.iat!==void 0||n.maxTokenAge)&&typeof s.iat!="number")throw new Qt('"iat" claim must be a number',"iat","invalid");if(s.nbf!==void 0){if(typeof s.nbf!="number")throw new Qt('"nbf" claim must be a number',"nbf","invalid");if(s.nbf>d+y)throw new Qt('"nbf" claim timestamp check failed',"nbf","check_failed")}if(s.exp!==void 0){if(typeof s.exp!="number")throw new Qt('"exp" claim must be a number',"exp","invalid");if(s.exp<=d-y)throw new Ti('"exp" claim timestamp check failed',"exp","check_failed")}if(n.maxTokenAge){const h=d-s.iat,v=typeof n.maxTokenAge=="number"?n.maxTokenAge:Jn(n.maxTokenAge);if(h-y>v)throw new Ti('"iat" claim timestamp check failed (too far in the past)',"iat","check_failed");if(h<0-y)throw new Qt('"iat" claim timestamp check failed (it should be in the past)',"iat","check_failed")}return s};async function uc(t,e,n){var r;const s=await ua(t,e,n);if(((r=s.protectedHeader.crit)===null||r===void 0?void 0:r.includes("b64"))&&s.protectedHeader.b64===!1)throw new zt("JWTs MUST NOT use unencoded payload");const u={payload:Gi(s.protectedHeader,s.payload,n),protectedHeader:s.protectedHeader};return typeof e=="function"?{...u,key:s.key}:u}async function cc(t,e,n){const r=await ra(t,e,n),s=Gi(r.protectedHeader,r.plaintext,n),{protectedHeader:c}=r;if(c.iss!==void 0&&c.iss!==s.iss)throw new Qt('replicated "iss" claim header parameter mismatch',"iss","mismatch");if(c.sub!==void 0&&c.sub!==s.sub)throw new Qt('replicated "sub" claim header parameter mismatch',"sub","mismatch");if(c.aud!==void 0&&JSON.stringify(c.aud)!==JSON.stringify(s.aud))throw new Qt('replicated "aud" claim header parameter mismatch',"aud","mismatch");const u={payload:s,protectedHeader:c};return typeof e=="function"?{...u,key:r.key}:u}class da{constructor(e){this._flattened=new $n(e)}setContentEncryptionKey(e){return this._flattened.setContentEncryptionKey(e),this}setInitializationVector(e){return this._flattened.setInitializationVector(e),this}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}setKeyManagementParameters(e){return this._flattened.setKeyManagementParameters(e),this}async encrypt(e,n){const r=await this._flattened.encrypt(e,n);return[r.protected,r.encrypted_key,r.iv,r.ciphertext,r.tag].join(".")}}const lc=async(t,e,n)=>{const r=await aa(t,e,"sign");Xn(t,r);const s=await De.subtle.sign(sa(t,r.algorithm),r,n);return new Uint8Array(s)};var dc=lc;class Yi{constructor(e){if(!(e instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,n){if(!this._protectedHeader&&!this._unprotectedHeader)throw new Qe("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!bn(this._protectedHeader,this._unprotectedHeader))throw new Qe("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const r={...this._protectedHeader,...this._unprotectedHeader},s=Sn(Qe,new Map([["b64",!0]]),n==null?void 0:n.crit,this._protectedHeader,r);let c=!0;if(s.has("b64")&&(c=this._protectedHeader.b64,typeof c!="boolean"))throw new Qe('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:u}=r;if(typeof u!="string"||!u)throw new Qe('JWS "alg" (Algorithm) Header Parameter missing or invalid');Zn(u,e,"sign");let p=this._payload;c&&(p=lt.encode(yt(p)));let y;this._protectedHeader?y=lt.encode(yt(JSON.stringify(this._protectedHeader))):y=lt.encode("");const f=br(y,lt.encode("."),p),d=await dc(u,e,f),h={signature:yt(d),payload:""};return c&&(h.payload=ir.decode(p)),this._unprotectedHeader&&(h.header=this._unprotectedHeader),this._protectedHeader&&(h.protected=ir.decode(y)),h}}class fa{constructor(e){this._flattened=new Yi(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,n){const r=await this._flattened.sign(e,n);if(r.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${r.protected}.${r.payload}.${r.signature}`}}class fc{constructor(e,n,r){this.parent=e,this.key=n,this.options=r}setProtectedHeader(e){if(this.protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this.protectedHeader=e,this}setUnprotectedHeader(e){if(this.unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=e,this}addSignature(...e){return this.parent.addSignature(...e)}sign(...e){return this.parent.sign(...e)}done(){return this.parent}}class hc{constructor(e){this._signatures=[],this._payload=e}addSignature(e,n){const r=new fc(this,e,n);return this._signatures.push(r),r}async sign(){if(!this._signatures.length)throw new Qe("at least one signature must be added");const e={signatures:[],payload:""};for(let n=0;n<this._signatures.length;n++){const r=this._signatures[n],s=new Yi(this._payload);s.setProtectedHeader(r.protectedHeader),s.setUnprotectedHeader(r.unprotectedHeader);const{payload:c,...u}=await s.sign(r.key,r.options);if(n===0)e.payload=c;else if(e.payload!==c)throw new Qe("inconsistent use of JWS Unencoded Payload Option (RFC7797)");e.signatures.push(u)}return e}}class Xi{constructor(e){if(!Tt(e))throw new TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return typeof e=="number"?this._payload={...this._payload,nbf:e}:this._payload={...this._payload,nbf:Hn(new Date)+Jn(e)},this}setExpirationTime(e){return typeof e=="number"?this._payload={...this._payload,exp:e}:this._payload={...this._payload,exp:Hn(new Date)+Jn(e)},this}setIssuedAt(e){return typeof e=="undefined"?this._payload={...this._payload,iat:Hn(new Date)}:this._payload={...this._payload,iat:e},this}}class pc extends Xi{setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,n){var r;const s=new fa(lt.encode(JSON.stringify(this._payload)));if(s.setProtectedHeader(this._protectedHeader),Array.isArray((r=this._protectedHeader)===null||r===void 0?void 0:r.crit)&&this._protectedHeader.crit.includes("b64")&&this._protectedHeader.b64===!1)throw new zt("JWTs MUST NOT use unencoded payload");return s.sign(e,n)}}class gc extends Xi{setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setKeyManagementParameters(e){if(this._keyManagementParameters)throw new TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}setContentEncryptionKey(e){if(this._cek)throw new TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}setInitializationVector(e){if(this._iv)throw new TypeError("setInitializationVector can only be called once");return this._iv=e,this}replicateIssuerAsHeader(){return this._replicateIssuerAsHeader=!0,this}replicateSubjectAsHeader(){return this._replicateSubjectAsHeader=!0,this}replicateAudienceAsHeader(){return this._replicateAudienceAsHeader=!0,this}async encrypt(e,n){const r=new da(lt.encode(JSON.stringify(this._payload)));return this._replicateIssuerAsHeader&&(this._protectedHeader={...this._protectedHeader,iss:this._payload.iss}),this._replicateSubjectAsHeader&&(this._protectedHeader={...this._protectedHeader,sub:this._payload.sub}),this._replicateAudienceAsHeader&&(this._protectedHeader={...this._protectedHeader,aud:this._payload.aud}),r.setProtectedHeader(this._protectedHeader),this._iv&&r.setInitializationVector(this._iv),this._cek&&r.setContentEncryptionKey(this._cek),this._keyManagementParameters&&r.setKeyManagementParameters(this._keyManagementParameters),r.encrypt(e,n)}}const kr=(t,e)=>{if(typeof t!="string"||!t)throw new Ns(`${e} missing or invalid`)};async function yc(t,e="sha256"){if(!Tt(t))throw new TypeError("JWK must be an object");if(e!=="sha256"&&e!=="sha384"&&e!=="sha512")throw new TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');let n;switch(t.kty){case"EC":kr(t.crv,'"crv" (Curve) Parameter'),kr(t.x,'"x" (X Coordinate) Parameter'),kr(t.y,'"y" (Y Coordinate) Parameter'),n={crv:t.crv,kty:t.kty,x:t.x,y:t.y};break;case"OKP":kr(t.crv,'"crv" (Subtype of Key Pair) Parameter'),kr(t.x,'"x" (Public Key) Parameter'),n={crv:t.crv,kty:t.kty,x:t.x};break;case"RSA":kr(t.e,'"e" (Exponent) Parameter'),kr(t.n,'"n" (Modulus) Parameter'),n={e:t.e,kty:t.kty,n:t.n};break;case"oct":kr(t.k,'"k" (Key Value) Parameter'),n={k:t.k,kty:t.kty};break;default:throw new Je('"kty" (Key Type) Parameter missing or unsupported')}const r=lt.encode(JSON.stringify(n));return yt(await Ds(e,r))}async function vc(t,e){const n={...t,...e.header};if(!Tt(n.jwk))throw new Qe('"jwk" (JSON Web Key) Header Parameter must be a JSON object');const r=await Qn({...n.jwk,ext:!0},n.alg,!0);if(r instanceof Uint8Array||r.type!=="public")throw new Qe('"jwk" (JSON Web Key) Header Parameter must be a public key');return r}function mc(t){switch(typeof t=="string"&&t.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new Je('Unsupported "alg" value for a JSON Web Key Set')}}function ha(t){return t&&typeof t=="object"&&Array.isArray(t.keys)&&t.keys.every(_c)}function _c(t){return Tt(t)}function wc(t){return typeof structuredClone=="function"?structuredClone(t):JSON.parse(JSON.stringify(t))}class Ui{constructor(e){if(this._cached=new WeakMap,!ha(e))throw new jn("JSON Web Key Set malformed");this._jwks=wc(e)}async getKey(e,n){const{alg:r,kid:s}={...e,...n.header},c=mc(r),u=this._jwks.keys.filter(d=>{let h=c===d.kty;if(h&&typeof s=="string"&&(h=s===d.kid),h&&typeof d.alg=="string"&&(h=r===d.alg),h&&typeof d.use=="string"&&(h=d.use==="sig"),h&&Array.isArray(d.key_ops)&&(h=d.key_ops.includes("verify")),h&&r==="EdDSA"&&(h=d.crv==="Ed25519"||d.crv==="Ed448"),h)switch(r){case"ES256":h=d.crv==="P-256";break;case"ES256K":h=d.crv==="secp256k1";break;case"ES384":h=d.crv==="P-384";break;case"ES512":h=d.crv==="P-521";break}return h}),{0:p,length:y}=u;if(y===0)throw new Wi;if(y!==1)throw new Ls;const f=this._cached.get(p)||this._cached.set(p,{}).get(p);if(f[r]===void 0){const d=await Qn({...p,ext:!0},r);if(d instanceof Uint8Array||d.type!=="public")throw new jn("JSON Web Key Set members must be public keys");f[r]=d}return f[r]}}function bc(t){return Ui.prototype.getKey.bind(new Ui(t))}const Sc=async(t,e,n)=>{let r,s,c=!1;typeof AbortController=="function"&&(r=new AbortController,s=setTimeout(()=>{c=!0,r.abort()},e));const u=await fetch(t.href,{signal:r?r.signal:void 0,redirect:"manual",headers:n.headers}).catch(p=>{throw c?new Ms:p});if(s!==void 0&&clearTimeout(s),u.status!==200)throw new Ot("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await u.json()}catch{throw new Ot("Failed to parse the JSON Web Key Set HTTP response as JSON")}};var Ec=Sc;class Ko extends Ui{constructor(e,n){if(super({keys:[]}),this._jwks=void 0,!(e instanceof URL))throw new TypeError("url must be an instance of URL");this._url=new URL(e.href),this._options={agent:n==null?void 0:n.agent,headers:n==null?void 0:n.headers},this._timeoutDuration=typeof(n==null?void 0:n.timeoutDuration)=="number"?n==null?void 0:n.timeoutDuration:5e3,this._cooldownDuration=typeof(n==null?void 0:n.cooldownDuration)=="number"?n==null?void 0:n.cooldownDuration:3e4,this._cacheMaxAge=typeof(n==null?void 0:n.cacheMaxAge)=="number"?n==null?void 0:n.cacheMaxAge:6e5}coolingDown(){return typeof this._jwksTimestamp=="number"?Date.now()<this._jwksTimestamp+this._cooldownDuration:!1}fresh(){return typeof this._jwksTimestamp=="number"?Date.now()<this._jwksTimestamp+this._cacheMaxAge:!1}async getKey(e,n){(!this._jwks||!this.fresh())&&await this.reload();try{return await super.getKey(e,n)}catch(r){if(r instanceof Wi&&this.coolingDown()===!1)return await this.reload(),super.getKey(e,n);throw r}}async reload(){if(this._pendingFetch&&Jr())return new Promise(e=>{const n=()=>{this._pendingFetch===void 0?e():setTimeout(n,5)};n()});this._pendingFetch||(this._pendingFetch=Ec(this._url,this._timeoutDuration,this._options).then(e=>{if(!ha(e))throw new jn("JSON Web Key Set malformed");this._jwks={keys:e.keys},this._jwksTimestamp=Date.now(),this._pendingFetch=void 0}).catch(e=>{throw this._pendingFetch=void 0,e})),await this._pendingFetch}}function Fc(t,e){return Ko.prototype.getKey.bind(new Ko(t,e))}class Ac extends Xi{encode(){const e=yt(JSON.stringify({alg:"none"})),n=yt(JSON.stringify(this._payload));return`${e}.${n}.`}static decode(e,n){if(typeof e!="string")throw new zt("Unsecured JWT must be a string");const{0:r,1:s,2:c,length:u}=e.split(".");if(u!==3||c!=="")throw new zt("Invalid Unsecured JWT");let p;try{if(p=JSON.parse(ir.decode(Ft(r))),p.alg!=="none")throw new Error}catch{throw new zt("Invalid Unsecured JWT")}return{payload:Gi(p,Ft(s),n),header:p}}}const Pc=yt,Qi=Ft;var kc=Object.freeze(Object.defineProperty({__proto__:null,encode:Pc,decode:Qi},Symbol.toStringTag,{value:"Module"}));function Tc(t){let e;if(typeof t=="string"){const n=t.split(".");(n.length===3||n.length===5)&&([e]=n)}else if(typeof t=="object"&&t)if("protected"in t)e=t.protected;else throw new TypeError("Token does not contain a Protected Header");try{if(typeof e!="string"||!e)throw new Error;const n=JSON.parse(ir.decode(Qi(e)));if(!Tt(n))throw new Error;return n}catch{throw new TypeError("Invalid Token or Protected Header formatting")}}function Cc(t){if(typeof t!="string")throw new zt("JWTs must use Compact JWS serialization, JWT must be a string");const{1:e,length:n}=t.split(".");if(n===5)throw new zt("Only JWTs using Compact JWS serialization can be decoded");if(n!==3)throw new zt("Invalid JWT");if(!e)throw new zt("JWTs must contain a payload");let r;try{r=Qi(e)}catch{throw new zt("Failed to parse the base64url encoded payload")}let s;try{s=JSON.parse(ir.decode(r))}catch{throw new zt("Failed to parse the decoded payload as JSON")}if(!Tt(s))throw new zt("Invalid JWT Claims Set");return s}async function Ic(t,e){var n;let r,s,c;switch(t){case"HS256":case"HS384":case"HS512":r=parseInt(t.slice(-3),10),s={name:"HMAC",hash:`SHA-${r}`,length:r},c=["sign","verify"];break;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return r=parseInt(t.slice(-3),10),Gn(new Uint8Array(r>>3));case"A128KW":case"A192KW":case"A256KW":r=parseInt(t.slice(1,4),10),s={name:"AES-KW",length:r},c=["wrapKey","unwrapKey"];break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":case"A128GCM":case"A192GCM":case"A256GCM":r=parseInt(t.slice(1,4),10),s={name:"AES-GCM",length:r},c=["encrypt","decrypt"];break;default:throw new Je('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return De.subtle.generateKey(s,(n=e==null?void 0:e.extractable)!==null&&n!==void 0?n:!1,c)}function mi(t){var e;const n=(e=t==null?void 0:t.modulusLength)!==null&&e!==void 0?e:2048;if(typeof n!="number"||n<2048)throw new Je("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");return n}async function xc(t,e){var n,r;let s,c;switch(t){case"PS256":case"PS384":case"PS512":s={name:"RSA-PSS",hash:`SHA-${t.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:mi(e)},c=["sign","verify"];break;case"RS256":case"RS384":case"RS512":s={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${t.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:mi(e)},c=["sign","verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":s={name:"RSA-OAEP",hash:`SHA-${parseInt(t.slice(-3),10)||1}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:mi(e)},c=["decrypt","unwrapKey","encrypt","wrapKey"];break;case"ES256":s={name:"ECDSA",namedCurve:"P-256"},c=["sign","verify"];break;case"ES384":s={name:"ECDSA",namedCurve:"P-384"},c=["sign","verify"];break;case"ES512":s={name:"ECDSA",namedCurve:"P-521"},c=["sign","verify"];break;case(Jr()&&"EdDSA"):switch(e==null?void 0:e.crv){case void 0:case"Ed25519":s={name:"NODE-ED25519",namedCurve:"NODE-ED25519"},c=["sign","verify"];break;default:throw new Je("Invalid or unsupported crv option provided")}break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":s={name:"ECDH",namedCurve:(n=e==null?void 0:e.crv)!==null&&n!==void 0?n:"P-256"},c=["deriveKey","deriveBits"];break;default:throw new Je('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return De.subtle.generateKey(s,(r=e==null?void 0:e.extractable)!==null&&r!==void 0?r:!1,c)}async function Rc(t,e){return xc(t,e)}async function Uc(t,e){return Ic(t,e)}var Dc=Object.freeze(Object.defineProperty({__proto__:null,errors:su,base64url:kc,compactDecrypt:ra,flattenedDecrypt:Ji,generalDecrypt:zu,GeneralEncrypt:ec,compactVerify:ua,flattenedVerify:qi,generalVerify:nc,jwtVerify:uc,jwtDecrypt:cc,CompactEncrypt:da,FlattenedEncrypt:$n,CompactSign:fa,FlattenedSign:Yi,GeneralSign:hc,SignJWT:pc,EncryptJWT:gc,calculateJwkThumbprint:yc,EmbeddedJWK:vc,createLocalJWKSet:bc,createRemoteJWKSet:Fc,UnsecuredJWT:Ac,exportPKCS8:Qu,exportSPKI:Xu,exportJWK:na,importSPKI:Ou,importPKCS8:Nu,importX509:Hu,importJWK:Qn,decodeProtectedHeader:Tc,decodeJwt:Cc,generateKeyPair:Rc,generateSecret:Uc},Symbol.toStringTag,{value:"Module"})),Zi=Li(Dc);Object.defineProperty(tn,"__esModule",{value:!0});tn.getWebidFromTokenPayload=tn.fetchJwks=void 0;const Oc=Mn.exports,Bo=Zi;async function pa(t,e){const n=await(0,Oc.fetch)(t);if(n.status!==200)throw new Error(`Could not fetch JWKS for [${e}] at [${t}]: ${n.status} ${n.statusText}`);let r;try{r=(await n.json()).keys[0]}catch(s){throw new Error(`Malformed JWKS for [${e}] at [${t}]: ${s.message}`)}return r}tn.fetchJwks=pa;async function Hc(t,e,n,r){const s=await pa(e,n);let c;try{const{payload:u}=await(0,Bo.jwtVerify)(t,await(0,Bo.importJWK)(s),{issuer:n,audience:r});c=u}catch(u){throw new Error(`Token verification failed: ${u.stack}`)}if(typeof c.webid=="string")return c.webid;if(typeof c.sub!="string")throw new Error(`The token ${JSON.stringify(c)} is invalid: it has no 'webid' claim and no 'sub' claim.`);try{return new URL(c.sub),c.sub}catch(u){throw new Error(`The token has no 'webid' claim, and its 'sub' claim of [${c.sub}] is invalid as a URL - error [${u}].`)}}tn.getWebidFromTokenPayload=Hc;var ei={};Object.defineProperty(ei,"__esModule",{value:!0});ei.isSupportedTokenType=void 0;function Nc(t){return typeof t=="string"&&["DPoP","Bearer"].includes(t)}ei.isSupportedTokenType=Nc;var ti={};Object.defineProperty(ti,"__esModule",{value:!0});ti.USER_SESSION_PREFIX=void 0;ti.USER_SESSION_PREFIX="solidClientAuthenticationUser";var rn={};Object.defineProperty(rn,"__esModule",{value:!0});rn.handleRegistration=rn.determineSigningAlg=void 0;function jo(t){try{return new URL(t),!0}catch{return!1}}function Lc(t,e){var n;return(n=e.find(r=>t.includes(r)))!==null&&n!==void 0?n:null}rn.determineSigningAlg=Lc;function Mc(t,e){return t.clientId!==void 0&&!jo(t.clientId)?"static":e.scopesSupported.includes("webid")&&t.clientId!==void 0&&jo(t.clientId)?"solid-oidc":"dynamic"}async function Kc(t,e,n,r){const s=Mc(t,e);return s==="dynamic"?r.getClient({sessionId:t.sessionId,clientName:t.clientName,redirectUrl:t.redirectUrl},e):(await n.setForUser(t.sessionId,{clientId:t.clientId}),t.clientSecret&&await n.setForUser(t.sessionId,{clientSecret:t.clientSecret}),t.clientName&&await n.setForUser(t.sessionId,{clientName:t.clientName}),{clientId:t.clientId,clientSecret:t.clientSecret,clientName:t.clientName,clientType:s})}rn.handleRegistration=Kc;var _r={},Bc=gt&&gt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(_r,"__esModule",{value:!0});_r.saveSessionInfoToStorage=_r.loadOidcContextFromStorage=_r.getSessionIdFromOauthState=void 0;const jc=Zi,_i=Bc(zn);async function Wc(t,e){return t.getForUser(e,"sessionId")}_r.getSessionIdFromOauthState=Wc;async function Vc(t,e,n){try{const[r,s,c,u]=await Promise.all([e.getForUser(t,"issuer",{errorIfNull:!0}),e.getForUser(t,"codeVerifier"),e.getForUser(t,"redirectUrl"),e.getForUser(t,"dpop",{errorIfNull:!0})]);await e.deleteForUser(t,"codeVerifier");const p=await n.fetchConfig(r);return{codeVerifier:s,redirectUrl:c,issuerConfig:p,dpop:u==="true"}}catch(r){throw new Error(`Failed to retrieve OIDC context from storage associated with session [${t}]: ${r}`)}}_r.loadOidcContextFromStorage=Vc;async function $c(t,e,n,r,s,c,u){s!==void 0&&await t.setForUser(e,{refreshToken:s},{secure:c}),n!==void 0&&await t.setForUser(e,{webId:n},{secure:c}),r!==void 0&&await t.setForUser(e,{isLoggedIn:r},{secure:c}),u!==void 0&&await t.setForUser(e,{publicKey:JSON.stringify(u.publicKey),privateKey:JSON.stringify(await(0,jc.exportJWK)(u.privateKey))},{secure:c})}_r.saveSessionInfoToStorage=$c;class Jc{constructor(e,n){this.secureStorage=e,this.insecureStorage=n}getKey(e){return`solidClientAuthenticationUser:${e}`}async getUserData(e,n){const r=await(n?this.secureStorage:this.insecureStorage).get(this.getKey(e));if(r===void 0)return{};try{return JSON.parse(r)}catch{throw new _i.default(`Data for user [${e}] in [${n?"secure":"unsecure"}] storage is corrupted - expected valid JSON, but got: ${r}`)}}async setUserData(e,n,r){await(r?this.secureStorage:this.insecureStorage).set(this.getKey(e),JSON.stringify(n))}async get(e,n){const r=await(n!=null&&n.secure?this.secureStorage:this.insecureStorage).get(e);if(r===void 0&&(n==null?void 0:n.errorIfNull))throw new _i.default(`[${e}] is not stored`);return r}async set(e,n,r){return(r!=null&&r.secure?this.secureStorage:this.insecureStorage).set(e,n)}async delete(e,n){return(n!=null&&n.secure?this.secureStorage:this.insecureStorage).delete(e)}async getForUser(e,n,r){const s=await this.getUserData(e,r==null?void 0:r.secure);let c;if((!s||!s[n])&&(c=void 0),c=s[n],c===void 0&&(r==null?void 0:r.errorIfNull))throw new _i.default(`Field [${n}] for user [${e}] is not stored`);return c||void 0}async setForUser(e,n,r){let s;try{s=await this.getUserData(e,r==null?void 0:r.secure)}catch{s={}}await this.setUserData(e,{...s,...n},r==null?void 0:r.secure)}async deleteForUser(e,n,r){const s=await this.getUserData(e,r==null?void 0:r.secure);delete s[n],await this.setUserData(e,s,r==null?void 0:r.secure)}async deleteAllUserData(e,n){await(n!=null&&n.secure?this.secureStorage:this.insecureStorage).delete(this.getKey(e))}}_r.default=Jc;var eo={};Object.defineProperty(eo,"__esModule",{value:!0});class qc{constructor(){this.map={}}async get(e){return this.map[e]||void 0}async set(e,n){this.map[e]=n}async delete(e){delete this.map[e]}}eo.default=qc;var to={};Object.defineProperty(to,"__esModule",{value:!0});class zc extends Error{constructor(e){super(e)}}to.default=zc;var ro={};Object.defineProperty(ro,"__esModule",{value:!0});class Gc extends Error{constructor(e){super(`[${e}] is not implemented`)}}ro.default=Gc;var En={};Object.defineProperty(En,"__esModule",{value:!0});En.InvalidResponseError=void 0;class Yc extends Error{constructor(e){super(`Invalid response from OIDC provider: missing fields ${e}`),this.missingFields=e}}En.InvalidResponseError=Yc;var Fn={};Object.defineProperty(Fn,"__esModule",{value:!0});Fn.OidcProviderError=void 0;class Xc extends Error{constructor(e,n,r){super(e),this.error=n,this.errorDescription=r}}Fn.OidcProviderError=Xc;var Wr={},Un,Qc=new Uint8Array(16);function ga(){if(!Un&&(Un=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Un))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Un(Qc)}var Zc=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function ri(t){return typeof t=="string"&&Zc.test(t)}var xt=[];for(var wi=0;wi<256;++wi)xt.push((wi+256).toString(16).substr(1));function ni(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=(xt[t[e+0]]+xt[t[e+1]]+xt[t[e+2]]+xt[t[e+3]]+"-"+xt[t[e+4]]+xt[t[e+5]]+"-"+xt[t[e+6]]+xt[t[e+7]]+"-"+xt[t[e+8]]+xt[t[e+9]]+"-"+xt[t[e+10]]+xt[t[e+11]]+xt[t[e+12]]+xt[t[e+13]]+xt[t[e+14]]+xt[t[e+15]]).toLowerCase();if(!ri(n))throw TypeError("Stringified UUID is invalid");return n}var Wo,bi,Si=0,Ei=0;function el(t,e,n){var r=e&&n||0,s=e||new Array(16);t=t||{};var c=t.node||Wo,u=t.clockseq!==void 0?t.clockseq:bi;if(c==null||u==null){var p=t.random||(t.rng||ga)();c==null&&(c=Wo=[p[0]|1,p[1],p[2],p[3],p[4],p[5]]),u==null&&(u=bi=(p[6]<<8|p[7])&16383)}var y=t.msecs!==void 0?t.msecs:Date.now(),f=t.nsecs!==void 0?t.nsecs:Ei+1,d=y-Si+(f-Ei)/1e4;if(d<0&&t.clockseq===void 0&&(u=u+1&16383),(d<0||y>Si)&&t.nsecs===void 0&&(f=0),f>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Si=y,Ei=f,bi=u,y+=122192928e5;var h=((y&268435455)*1e4+f)%4294967296;s[r++]=h>>>24&255,s[r++]=h>>>16&255,s[r++]=h>>>8&255,s[r++]=h&255;var v=y/4294967296*1e4&268435455;s[r++]=v>>>8&255,s[r++]=v&255,s[r++]=v>>>24&15|16,s[r++]=v>>>16&255,s[r++]=u>>>8|128,s[r++]=u&255;for(var E=0;E<6;++E)s[r+E]=c[E];return e||ni(s)}function ya(t){if(!ri(t))throw TypeError("Invalid UUID");var e,n=new Uint8Array(16);return n[0]=(e=parseInt(t.slice(0,8),16))>>>24,n[1]=e>>>16&255,n[2]=e>>>8&255,n[3]=e&255,n[4]=(e=parseInt(t.slice(9,13),16))>>>8,n[5]=e&255,n[6]=(e=parseInt(t.slice(14,18),16))>>>8,n[7]=e&255,n[8]=(e=parseInt(t.slice(19,23),16))>>>8,n[9]=e&255,n[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,n[11]=e/4294967296&255,n[12]=e>>>24&255,n[13]=e>>>16&255,n[14]=e>>>8&255,n[15]=e&255,n}function tl(t){t=unescape(encodeURIComponent(t));for(var e=[],n=0;n<t.length;++n)e.push(t.charCodeAt(n));return e}var rl="6ba7b810-9dad-11d1-80b4-00c04fd430c8",nl="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function va(t,e,n){function r(s,c,u,p){if(typeof s=="string"&&(s=tl(s)),typeof c=="string"&&(c=ya(c)),c.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var y=new Uint8Array(16+s.length);if(y.set(c),y.set(s,c.length),y=n(y),y[6]=y[6]&15|e,y[8]=y[8]&63|128,u){p=p||0;for(var f=0;f<16;++f)u[p+f]=y[f];return u}return ni(y)}try{r.name=t}catch{}return r.DNS=rl,r.URL=nl,r}function il(t){if(typeof t=="string"){var e=unescape(encodeURIComponent(t));t=new Uint8Array(e.length);for(var n=0;n<e.length;++n)t[n]=e.charCodeAt(n)}return ol(sl(al(t),t.length*8))}function ol(t){for(var e=[],n=t.length*32,r="0123456789abcdef",s=0;s<n;s+=8){var c=t[s>>5]>>>s%32&255,u=parseInt(r.charAt(c>>>4&15)+r.charAt(c&15),16);e.push(u)}return e}function ma(t){return(t+64>>>9<<4)+14+1}function sl(t,e){t[e>>5]|=128<<e%32,t[ma(e)-1]=e;for(var n=1732584193,r=-271733879,s=-1732584194,c=271733878,u=0;u<t.length;u+=16){var p=n,y=r,f=s,d=c;n=Nt(n,r,s,c,t[u],7,-680876936),c=Nt(c,n,r,s,t[u+1],12,-389564586),s=Nt(s,c,n,r,t[u+2],17,606105819),r=Nt(r,s,c,n,t[u+3],22,-1044525330),n=Nt(n,r,s,c,t[u+4],7,-176418897),c=Nt(c,n,r,s,t[u+5],12,1200080426),s=Nt(s,c,n,r,t[u+6],17,-1473231341),r=Nt(r,s,c,n,t[u+7],22,-45705983),n=Nt(n,r,s,c,t[u+8],7,1770035416),c=Nt(c,n,r,s,t[u+9],12,-1958414417),s=Nt(s,c,n,r,t[u+10],17,-42063),r=Nt(r,s,c,n,t[u+11],22,-1990404162),n=Nt(n,r,s,c,t[u+12],7,1804603682),c=Nt(c,n,r,s,t[u+13],12,-40341101),s=Nt(s,c,n,r,t[u+14],17,-1502002290),r=Nt(r,s,c,n,t[u+15],22,1236535329),n=Lt(n,r,s,c,t[u+1],5,-165796510),c=Lt(c,n,r,s,t[u+6],9,-1069501632),s=Lt(s,c,n,r,t[u+11],14,643717713),r=Lt(r,s,c,n,t[u],20,-373897302),n=Lt(n,r,s,c,t[u+5],5,-701558691),c=Lt(c,n,r,s,t[u+10],9,38016083),s=Lt(s,c,n,r,t[u+15],14,-660478335),r=Lt(r,s,c,n,t[u+4],20,-405537848),n=Lt(n,r,s,c,t[u+9],5,568446438),c=Lt(c,n,r,s,t[u+14],9,-1019803690),s=Lt(s,c,n,r,t[u+3],14,-187363961),r=Lt(r,s,c,n,t[u+8],20,1163531501),n=Lt(n,r,s,c,t[u+13],5,-1444681467),c=Lt(c,n,r,s,t[u+2],9,-51403784),s=Lt(s,c,n,r,t[u+7],14,1735328473),r=Lt(r,s,c,n,t[u+12],20,-1926607734),n=Mt(n,r,s,c,t[u+5],4,-378558),c=Mt(c,n,r,s,t[u+8],11,-2022574463),s=Mt(s,c,n,r,t[u+11],16,1839030562),r=Mt(r,s,c,n,t[u+14],23,-35309556),n=Mt(n,r,s,c,t[u+1],4,-1530992060),c=Mt(c,n,r,s,t[u+4],11,1272893353),s=Mt(s,c,n,r,t[u+7],16,-155497632),r=Mt(r,s,c,n,t[u+10],23,-1094730640),n=Mt(n,r,s,c,t[u+13],4,681279174),c=Mt(c,n,r,s,t[u],11,-358537222),s=Mt(s,c,n,r,t[u+3],16,-722521979),r=Mt(r,s,c,n,t[u+6],23,76029189),n=Mt(n,r,s,c,t[u+9],4,-640364487),c=Mt(c,n,r,s,t[u+12],11,-421815835),s=Mt(s,c,n,r,t[u+15],16,530742520),r=Mt(r,s,c,n,t[u+2],23,-995338651),n=Kt(n,r,s,c,t[u],6,-198630844),c=Kt(c,n,r,s,t[u+7],10,1126891415),s=Kt(s,c,n,r,t[u+14],15,-1416354905),r=Kt(r,s,c,n,t[u+5],21,-57434055),n=Kt(n,r,s,c,t[u+12],6,1700485571),c=Kt(c,n,r,s,t[u+3],10,-1894986606),s=Kt(s,c,n,r,t[u+10],15,-1051523),r=Kt(r,s,c,n,t[u+1],21,-2054922799),n=Kt(n,r,s,c,t[u+8],6,1873313359),c=Kt(c,n,r,s,t[u+15],10,-30611744),s=Kt(s,c,n,r,t[u+6],15,-1560198380),r=Kt(r,s,c,n,t[u+13],21,1309151649),n=Kt(n,r,s,c,t[u+4],6,-145523070),c=Kt(c,n,r,s,t[u+11],10,-1120210379),s=Kt(s,c,n,r,t[u+2],15,718787259),r=Kt(r,s,c,n,t[u+9],21,-343485551),n=Tr(n,p),r=Tr(r,y),s=Tr(s,f),c=Tr(c,d)}return[n,r,s,c]}function al(t){if(t.length===0)return[];for(var e=t.length*8,n=new Uint32Array(ma(e)),r=0;r<e;r+=8)n[r>>5]|=(t[r/8]&255)<<r%32;return n}function Tr(t,e){var n=(t&65535)+(e&65535),r=(t>>16)+(e>>16)+(n>>16);return r<<16|n&65535}function ul(t,e){return t<<e|t>>>32-e}function ii(t,e,n,r,s,c){return Tr(ul(Tr(Tr(e,t),Tr(r,c)),s),n)}function Nt(t,e,n,r,s,c,u){return ii(e&n|~e&r,t,e,s,c,u)}function Lt(t,e,n,r,s,c,u){return ii(e&r|n&~r,t,e,s,c,u)}function Mt(t,e,n,r,s,c,u){return ii(e^n^r,t,e,s,c,u)}function Kt(t,e,n,r,s,c,u){return ii(n^(e|~r),t,e,s,c,u)}var cl=va("v3",48,il),ll=cl;function dl(t,e,n){t=t||{};var r=t.random||(t.rng||ga)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){n=n||0;for(var s=0;s<16;++s)e[n+s]=r[s];return e}return ni(r)}function fl(t,e,n,r){switch(t){case 0:return e&n^~e&r;case 1:return e^n^r;case 2:return e&n^e&r^n&r;case 3:return e^n^r}}function Fi(t,e){return t<<e|t>>>32-e}function hl(t){var e=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof t=="string"){var r=unescape(encodeURIComponent(t));t=[];for(var s=0;s<r.length;++s)t.push(r.charCodeAt(s))}else Array.isArray(t)||(t=Array.prototype.slice.call(t));t.push(128);for(var c=t.length/4+2,u=Math.ceil(c/16),p=new Array(u),y=0;y<u;++y){for(var f=new Uint32Array(16),d=0;d<16;++d)f[d]=t[y*64+d*4]<<24|t[y*64+d*4+1]<<16|t[y*64+d*4+2]<<8|t[y*64+d*4+3];p[y]=f}p[u-1][14]=(t.length-1)*8/Math.pow(2,32),p[u-1][14]=Math.floor(p[u-1][14]),p[u-1][15]=(t.length-1)*8&4294967295;for(var h=0;h<u;++h){for(var v=new Uint32Array(80),E=0;E<16;++E)v[E]=p[h][E];for(var m=16;m<80;++m)v[m]=Fi(v[m-3]^v[m-8]^v[m-14]^v[m-16],1);for(var A=n[0],F=n[1],_=n[2],P=n[3],C=n[4],R=0;R<80;++R){var V=Math.floor(R/20),j=Fi(A,5)+fl(V,F,_,P)+C+e[V]+v[R]>>>0;C=P,P=_,_=Fi(F,30)>>>0,F=A,A=j}n[0]=n[0]+A>>>0,n[1]=n[1]+F>>>0,n[2]=n[2]+_>>>0,n[3]=n[3]+P>>>0,n[4]=n[4]+C>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,n[0]&255,n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,n[1]&255,n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,n[2]&255,n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,n[3]&255,n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,n[4]&255]}var pl=va("v5",80,hl),gl=pl,yl="00000000-0000-0000-0000-000000000000";function vl(t){if(!ri(t))throw TypeError("Invalid UUID");return parseInt(t.substr(14,1),16)}var ml=Object.freeze(Object.defineProperty({__proto__:null,v1:el,v3:ll,v4:dl,v5:gl,NIL:yl,version:vl,validate:ri,stringify:ni,parse:ya},Symbol.toStringTag,{value:"Module"})),no=Li(ml);Object.defineProperty(Wr,"__esModule",{value:!0});Wr.generateDpopKeyPair=Wr.createDpopHeader=void 0;const Di=Zi,_l=no,Oi=Gt;function wl(t){const e=new URL(t);return new URL(e.pathname,e.origin).toString()}async function bl(t,e,n){return new Di.SignJWT({htu:wl(t),htm:e.toUpperCase(),jti:(0,_l.v4)()}).setProtectedHeader({alg:Oi.PREFERRED_SIGNING_ALG[0],jwk:n.publicKey,typ:"dpop+jwt"}).setIssuedAt().sign(n.privateKey,{})}Wr.createDpopHeader=bl;async function Sl(){const{privateKey:t,publicKey:e}=await(0,Di.generateKeyPair)(Oi.PREFERRED_SIGNING_ALG[0]),n={privateKey:t,publicKey:await(0,Di.exportJWK)(e)};return[n.publicKey.alg]=Oi.PREFERRED_SIGNING_ALG,n}Wr.generateDpopKeyPair=Sl;var _a={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.buildAuthenticatedFetch=t.DEFAULT_EXPIRATION_TIME_SECONDS=void 0;const e=Mn.exports,n=Gt,r=Wr,s=Fn,c=En;t.DEFAULT_EXPIRATION_TIME_SECONDS=600;function u(E){return[401,403].includes(E)}async function p(E,m,A,F){var _;const P=new e.Headers(F==null?void 0:F.headers);return P.set("Authorization",`DPoP ${m}`),P.set("DPoP",await(0,r.createDpopHeader)(E,(_=F==null?void 0:F.method)!==null&&_!==void 0?_:"get",A)),{...F,headers:P}}async function y(E,m,A,F){if(A!==void 0)return p(E,m,A,F);const _=new e.Headers(F==null?void 0:F.headers);return _.set("Authorization",`Bearer ${m}`),{...F,headers:_}}async function f(E,m,A,F,_){return E(A,await y(A.toString(),m,_,F))}async function d(E,m,A){var F;const _=await E.tokenRefresher.refresh(E.sessionId,E.refreshToken,m);return A==null||A.emit(n.EVENTS.SESSION_EXTENDED,(F=_.expiresIn)!==null&&F!==void 0?F:t.DEFAULT_EXPIRATION_TIME_SECONDS),typeof _.refreshToken=="string"&&(A==null||A.emit(n.EVENTS.NEW_REFRESH_TOKEN,_.refreshToken)),{accessToken:_.accessToken,refreshToken:_.refreshToken,expiresIn:_.expiresIn}}const h=E=>E!==void 0?E-n.REFRESH_BEFORE_EXPIRATION_SECONDS>0?E-n.REFRESH_BEFORE_EXPIRATION_SECONDS:E:t.DEFAULT_EXPIRATION_TIME_SECONDS;async function v(E,m,A){var F;let _=m,P;const C=A==null?void 0:A.refreshOptions;if(C!==void 0){const R=async()=>{var V,j,B,Z;try{const{accessToken:Y,refreshToken:O,expiresIn:oe}=await d(C,A.dpopKey,A.eventEmitter);_=Y,O!==void 0&&(C.refreshToken=O),clearTimeout(P),P=setTimeout(R,h(oe)*1e3),(V=A.eventEmitter)===null||V===void 0||V.emit(n.EVENTS.TIMEOUT_SET,P)}catch(Y){Y instanceof s.OidcProviderError&&((j=A==null?void 0:A.eventEmitter)===null||j===void 0||j.emit(n.EVENTS.ERROR,Y.error,Y.errorDescription),(B=A==null?void 0:A.eventEmitter)===null||B===void 0||B.emit(n.EVENTS.SESSION_EXPIRED)),Y instanceof c.InvalidResponseError&&Y.missingFields.includes("access_token")&&((Z=A==null?void 0:A.eventEmitter)===null||Z===void 0||Z.emit(n.EVENTS.SESSION_EXPIRED))}};P=setTimeout(R,h(A.expiresIn)*1e3),(F=A.eventEmitter)===null||F===void 0||F.emit(n.EVENTS.TIMEOUT_SET,P)}else if(A!==void 0&&A.eventEmitter!==void 0){const R=setTimeout(()=>{A.eventEmitter.emit(n.EVENTS.SESSION_EXPIRED)},h(A.expiresIn)*1e3);A.eventEmitter.emit(n.EVENTS.TIMEOUT_SET,R)}return async(R,V)=>{let j=await f(E,_,R,V,A==null?void 0:A.dpopKey);const B=!j.ok&&!u(j.status);return j.ok||B||j.url!==R&&(A==null?void 0:A.dpopKey)!==void 0&&(j=await f(E,_,j.url,V,A.dpopKey)),j}}t.buildAuthenticatedFetch=v})(_a);var wa={};(function(t){var e=gt&&gt.__importDefault||function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(t,"__esModule",{value:!0}),t.mockStorageUtility=t.mockStorage=t.StorageUtilityMock=t.StorageUtilityGetResponse=void 0;const n=e(_r);t.StorageUtilityGetResponse="getResponse",t.StorageUtilityMock={get:async(c,u)=>t.StorageUtilityGetResponse,set:async(c,u)=>{},delete:async c=>{},getForUser:async(c,u,p)=>t.StorageUtilityGetResponse,setForUser:async(c,u,p)=>{},deleteForUser:async(c,u,p)=>{},deleteAllUserData:async(c,u)=>{}};const r=c=>{const u=c;return{get:async p=>{if(u[p]!==void 0)return typeof u[p]=="string"?u[p]:JSON.stringify(u[p])},set:async(p,y)=>{u[p]=y},delete:async p=>{delete u[p]}}};t.mockStorage=r;const s=(c,u=!1)=>u?new n.default((0,t.mockStorage)(c),(0,t.mockStorage)({})):new n.default((0,t.mockStorage)({}),(0,t.mockStorage)(c));t.mockStorageUtility=s})(wa);(function(t){var e=gt&&gt.__createBinding||(Object.create?function(P,C,R,V){V===void 0&&(V=R);var j=Object.getOwnPropertyDescriptor(C,R);(!j||("get"in j?!C.__esModule:j.writable||j.configurable))&&(j={enumerable:!0,get:function(){return C[R]}}),Object.defineProperty(P,V,j)}:function(P,C,R,V){V===void 0&&(V=R),P[V]=C[R]}),n=gt&&gt.__exportStar||function(P,C){for(var R in P)R!=="default"&&!Object.prototype.hasOwnProperty.call(C,R)&&e(C,P,R)},r=gt&&gt.__importDefault||function(P){return P&&P.__esModule?P:{default:P}};Object.defineProperty(t,"__esModule",{value:!0}),t.StorageUtilityGetResponse=t.StorageUtilityMock=t.mockStorageUtility=t.mockStorage=t.buildAuthenticatedFetch=t.generateDpopKeyPair=t.createDpopHeader=t.OidcProviderError=t.InvalidResponseError=t.NotImplementedError=t.ConfigurationError=t.InMemoryStorage=t.getSessionIdFromOauthState=t.saveSessionInfoToStorage=t.loadOidcContextFromStorage=t.StorageUtility=t.determineSigningAlg=t.handleRegistration=t.USER_SESSION_PREFIX=t.isSupportedTokenType=t.fetchJwks=t.getWebidFromTokenPayload=t.AggregateHandler=void 0,n(Gt,t);var s=Ki;Object.defineProperty(t,"AggregateHandler",{enumerable:!0,get:function(){return r(s).default}});var c=tn;Object.defineProperty(t,"getWebidFromTokenPayload",{enumerable:!0,get:function(){return c.getWebidFromTokenPayload}}),Object.defineProperty(t,"fetchJwks",{enumerable:!0,get:function(){return c.fetchJwks}});var u=ei;Object.defineProperty(t,"isSupportedTokenType",{enumerable:!0,get:function(){return u.isSupportedTokenType}});var p=ti;Object.defineProperty(t,"USER_SESSION_PREFIX",{enumerable:!0,get:function(){return p.USER_SESSION_PREFIX}});var y=rn;Object.defineProperty(t,"handleRegistration",{enumerable:!0,get:function(){return y.handleRegistration}}),Object.defineProperty(t,"determineSigningAlg",{enumerable:!0,get:function(){return y.determineSigningAlg}});var f=_r;Object.defineProperty(t,"StorageUtility",{enumerable:!0,get:function(){return r(f).default}}),Object.defineProperty(t,"loadOidcContextFromStorage",{enumerable:!0,get:function(){return f.loadOidcContextFromStorage}}),Object.defineProperty(t,"saveSessionInfoToStorage",{enumerable:!0,get:function(){return f.saveSessionInfoToStorage}}),Object.defineProperty(t,"getSessionIdFromOauthState",{enumerable:!0,get:function(){return f.getSessionIdFromOauthState}});var d=eo;Object.defineProperty(t,"InMemoryStorage",{enumerable:!0,get:function(){return r(d).default}});var h=to;Object.defineProperty(t,"ConfigurationError",{enumerable:!0,get:function(){return r(h).default}});var v=ro;Object.defineProperty(t,"NotImplementedError",{enumerable:!0,get:function(){return r(v).default}});var E=En;Object.defineProperty(t,"InvalidResponseError",{enumerable:!0,get:function(){return E.InvalidResponseError}});var m=Fn;Object.defineProperty(t,"OidcProviderError",{enumerable:!0,get:function(){return m.OidcProviderError}});var A=Wr;Object.defineProperty(t,"createDpopHeader",{enumerable:!0,get:function(){return A.createDpopHeader}}),Object.defineProperty(t,"generateDpopKeyPair",{enumerable:!0,get:function(){return A.generateDpopKeyPair}});var F=_a;Object.defineProperty(t,"buildAuthenticatedFetch",{enumerable:!0,get:function(){return F.buildAuthenticatedFetch}});var _=wa;Object.defineProperty(t,"mockStorage",{enumerable:!0,get:function(){return _.mockStorage}}),Object.defineProperty(t,"mockStorageUtility",{enumerable:!0,get:function(){return _.mockStorageUtility}}),Object.defineProperty(t,"StorageUtilityMock",{enumerable:!0,get:function(){return _.StorageUtilityMock}}),Object.defineProperty(t,"StorageUtilityGetResponse",{enumerable:!0,get:function(){return _.StorageUtilityGetResponse}})})(ze);var An={},io={};Object.defineProperty(io,"__esModule",{value:!0});const El=ze;class Fl extends El.StorageUtility{constructor(e,n){super(e,n)}}io.default=Fl;var oo={},qt={exports:{}};(function(t,e){(function(r,s){t.exports=s()})(gt,function(){return function(n){var r={};function s(c){if(r[c])return r[c].exports;var u=r[c]={i:c,l:!1,exports:{}};return n[c].call(u.exports,u,u.exports,s),u.l=!0,u.exports}return s.m=n,s.c=r,s.d=function(c,u,p){s.o(c,u)||Object.defineProperty(c,u,{enumerable:!0,get:p})},s.r=function(c){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(c,"__esModule",{value:!0})},s.t=function(c,u){if(1&u&&(c=s(c)),8&u||4&u&&typeof c=="object"&&c&&c.__esModule)return c;var p=Object.create(null);if(s.r(p),Object.defineProperty(p,"default",{enumerable:!0,value:c}),2&u&&typeof c!="string")for(var y in c)s.d(p,y,function(f){return c[f]}.bind(null,y));return p},s.n=function(c){var u=c&&c.__esModule?function(){return c.default}:function(){return c};return s.d(u,"a",u),u},s.o=function(c,u){return Object.prototype.hasOwnProperty.call(c,u)},s.p="",s(s.s=22)}([function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0});var c=function(){function f(d,h){for(var v=0;v<h.length;v++){var E=h[v];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(d,E.key,E)}}return function(d,h,v){return h&&f(d.prototype,h),v&&f(d,v),d}}(),u={debug:function(){},info:function(){},warn:function(){},error:function(){}},p=void 0,y=void 0;(r.Log=function(){function f(){(function(h,v){if(!(h instanceof v))throw new TypeError("Cannot call a class as a function")})(this,f)}return f.reset=function(){y=3,p=u},f.debug=function(){if(y>=4){for(var h=arguments.length,v=Array(h),E=0;E<h;E++)v[E]=arguments[E];p.debug.apply(p,Array.from(v))}},f.info=function(){if(y>=3){for(var h=arguments.length,v=Array(h),E=0;E<h;E++)v[E]=arguments[E];p.info.apply(p,Array.from(v))}},f.warn=function(){if(y>=2){for(var h=arguments.length,v=Array(h),E=0;E<h;E++)v[E]=arguments[E];p.warn.apply(p,Array.from(v))}},f.error=function(){if(y>=1){for(var h=arguments.length,v=Array(h),E=0;E<h;E++)v[E]=arguments[E];p.error.apply(p,Array.from(v))}},c(f,null,[{key:"NONE",get:function(){return 0}},{key:"ERROR",get:function(){return 1}},{key:"WARN",get:function(){return 2}},{key:"INFO",get:function(){return 3}},{key:"DEBUG",get:function(){return 4}},{key:"level",get:function(){return y},set:function(h){if(!(0<=h&&h<=4))throw new Error("Invalid log level");y=h}},{key:"logger",get:function(){return p},set:function(h){if(!h.debug&&h.info&&(h.debug=h.info),!(h.debug&&h.info&&h.warn&&h.error))throw new Error("Invalid logger");p=h}}]),f}()).reset()},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0});var c=function(){function f(d,h){for(var v=0;v<h.length;v++){var E=h[v];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(d,E.key,E)}}return function(d,h,v){return h&&f(d.prototype,h),v&&f(d,v),d}}(),u={setInterval:function(f){function d(h,v){return f.apply(this,arguments)}return d.toString=function(){return f.toString()},d}(function(f,d){return setInterval(f,d)}),clearInterval:function(f){function d(h){return f.apply(this,arguments)}return d.toString=function(){return f.toString()},d}(function(f){return clearInterval(f)})},p=!1,y=null;r.Global=function(){function f(){(function(h,v){if(!(h instanceof v))throw new TypeError("Cannot call a class as a function")})(this,f)}return f._testing=function(){p=!0},f.setXMLHttpRequest=function(h){y=h},c(f,null,[{key:"location",get:function(){if(!p)return location}},{key:"localStorage",get:function(){if(!p&&typeof window!="undefined")return localStorage}},{key:"sessionStorage",get:function(){if(!p&&typeof window!="undefined")return sessionStorage}},{key:"XMLHttpRequest",get:function(){if(!p&&typeof window!="undefined")return y||XMLHttpRequest}},{key:"timer",get:function(){if(!p)return u}}]),f}()},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.MetadataService=void 0;var c=function(){function d(h,v){for(var E=0;E<v.length;E++){var m=v[E];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(h,m.key,m)}}return function(h,v,E){return v&&d(h.prototype,v),E&&d(h,E),h}}(),u=s(0),p=s(7);function y(d,h){if(!(d instanceof h))throw new TypeError("Cannot call a class as a function")}var f=".well-known/openid-configuration";r.MetadataService=function(){function d(h){var v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:p.JsonService;if(y(this,d),!h)throw u.Log.error("MetadataService: No settings passed to MetadataService"),new Error("settings");this._settings=h,this._jsonService=new v(["application/jwk-set+json"])}return d.prototype.resetSigningKeys=function(){this._settings=this._settings||{},this._settings.signingKeys=void 0},d.prototype.getMetadata=function(){var v=this;return this._settings.metadata?(u.Log.debug("MetadataService.getMetadata: Returning metadata from settings"),Promise.resolve(this._settings.metadata)):this.metadataUrl?(u.Log.debug("MetadataService.getMetadata: getting metadata from",this.metadataUrl),this._jsonService.getJson(this.metadataUrl).then(function(E){u.Log.debug("MetadataService.getMetadata: json received");var m=v._settings.metadataSeed||{};return v._settings.metadata=Object.assign({},m,E),v._settings.metadata})):(u.Log.error("MetadataService.getMetadata: No authority or metadataUrl configured on settings"),Promise.reject(new Error("No authority or metadataUrl configured on settings")))},d.prototype.getIssuer=function(){return this._getMetadataProperty("issuer")},d.prototype.getAuthorizationEndpoint=function(){return this._getMetadataProperty("authorization_endpoint")},d.prototype.getUserInfoEndpoint=function(){return this._getMetadataProperty("userinfo_endpoint")},d.prototype.getTokenEndpoint=function(){var v=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];return this._getMetadataProperty("token_endpoint",v)},d.prototype.getCheckSessionIframe=function(){return this._getMetadataProperty("check_session_iframe",!0)},d.prototype.getEndSessionEndpoint=function(){return this._getMetadataProperty("end_session_endpoint",!0)},d.prototype.getRevocationEndpoint=function(){return this._getMetadataProperty("revocation_endpoint",!0)},d.prototype.getKeysEndpoint=function(){return this._getMetadataProperty("jwks_uri",!0)},d.prototype._getMetadataProperty=function(v){var E=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return u.Log.debug("MetadataService.getMetadataProperty for: "+v),this.getMetadata().then(function(m){if(u.Log.debug("MetadataService.getMetadataProperty: metadata recieved"),m[v]===void 0){if(E===!0)return void u.Log.warn("MetadataService.getMetadataProperty: Metadata does not contain optional property "+v);throw u.Log.error("MetadataService.getMetadataProperty: Metadata does not contain property "+v),new Error("Metadata does not contain property "+v)}return m[v]})},d.prototype.getSigningKeys=function(){var v=this;return this._settings.signingKeys?(u.Log.debug("MetadataService.getSigningKeys: Returning signingKeys from settings"),Promise.resolve(this._settings.signingKeys)):this._getMetadataProperty("jwks_uri").then(function(E){return u.Log.debug("MetadataService.getSigningKeys: jwks_uri received",E),v._jsonService.getJson(E).then(function(m){if(u.Log.debug("MetadataService.getSigningKeys: key set received",m),!m.keys)throw u.Log.error("MetadataService.getSigningKeys: Missing keys on keyset"),new Error("Missing keys on keyset");return v._settings.signingKeys=m.keys,v._settings.signingKeys})})},c(d,[{key:"metadataUrl",get:function(){return this._metadataUrl||(this._settings.metadataUrl?this._metadataUrl=this._settings.metadataUrl:(this._metadataUrl=this._settings.authority,this._metadataUrl&&this._metadataUrl.indexOf(f)<0&&(this._metadataUrl[this._metadataUrl.length-1]!=="/"&&(this._metadataUrl+="/"),this._metadataUrl+=f))),this._metadataUrl}}]),d}()},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.UrlUtility=void 0;var c=s(0),u=s(1);r.UrlUtility=function(){function p(){(function(f,d){if(!(f instanceof d))throw new TypeError("Cannot call a class as a function")})(this,p)}return p.addQueryParam=function(f,d,h){return f.indexOf("?")<0&&(f+="?"),f[f.length-1]!=="?"&&(f+="&"),f+=encodeURIComponent(d),f+="=",f+=encodeURIComponent(h)},p.parseUrlFragment=function(f){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#",h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:u.Global;typeof f!="string"&&(f=h.location.href);var v=f.lastIndexOf(d);v>=0&&(f=f.substr(v+1)),d==="?"&&(v=f.indexOf("#"))>=0&&(f=f.substr(0,v));for(var E,m={},A=/([^&=]+)=([^&]*)/g,F=0;E=A.exec(f);)if(m[decodeURIComponent(E[1])]=decodeURIComponent(E[2].replace(/\+/g," ")),F++>50)return c.Log.error("UrlUtility.parseUrlFragment: response exceeded expected number of parameters",f),{error:"Response exceeded expected number of parameters"};for(var _ in m)return m;return{}},p}()},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.JoseUtil=void 0;var c=s(26),u=function(y){return y&&y.__esModule?y:{default:y}}(s(33));r.JoseUtil=(0,u.default)({jws:c.jws,KeyUtil:c.KeyUtil,X509:c.X509,crypto:c.crypto,hextob64u:c.hextob64u,b64tohex:c.b64tohex,AllowedSigningAlgs:c.AllowedSigningAlgs})},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.OidcClientSettings=void 0;var c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(_){return typeof _}:function(_){return _&&typeof Symbol=="function"&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _},u=function(){function _(P,C){for(var R=0;R<C.length;R++){var V=C[R];V.enumerable=V.enumerable||!1,V.configurable=!0,"value"in V&&(V.writable=!0),Object.defineProperty(P,V.key,V)}}return function(P,C,R){return C&&_(P.prototype,C),R&&_(P,R),P}}(),p=s(0),y=s(23),f=s(6),d=s(24),h=s(2);function v(_,P){if(!(_ instanceof P))throw new TypeError("Cannot call a class as a function")}var E=".well-known/openid-configuration",m="id_token",A="openid",F="client_secret_post";r.OidcClientSettings=function(){function _(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},C=P.authority,R=P.metadataUrl,V=P.metadata,j=P.signingKeys,B=P.metadataSeed,Z=P.client_id,Y=P.client_secret,O=P.response_type,oe=O===void 0?m:O,_e=P.scope,ke=_e===void 0?A:_e,G=P.redirect_uri,se=P.post_logout_redirect_uri,ve=P.client_authentication,Re=ve===void 0?F:ve,Oe=P.prompt,ge=P.display,Ue=P.max_age,qe=P.ui_locales,rt=P.acr_values,ht=P.resource,mt=P.response_mode,At=P.filterProtocolClaims,Wt=At===void 0||At,st=P.loadUserInfo,ce=st===void 0||st,Ee=P.staleStateAge,He=Ee===void 0?900:Ee,J=P.clockSkew,w=J===void 0?300:J,S=P.clockService,L=S===void 0?new y.ClockService:S,q=P.userInfoJwtIssuer,ee=q===void 0?"OP":q,ie=P.mergeClaims,we=ie!==void 0&&ie,Ce=P.stateStore,Be=Ce===void 0?new f.WebStorageStateStore:Ce,Ke=P.ResponseValidatorCtor,Ge=Ke===void 0?d.ResponseValidator:Ke,Vt=P.MetadataServiceCtor,ur=Vt===void 0?h.MetadataService:Vt,Fe=P.extraQueryParams,ot=Fe===void 0?{}:Fe,Le=P.extraTokenParams,er=Le===void 0?{}:Le;v(this,_),this._authority=C,this._metadataUrl=R,this._metadata=V,this._metadataSeed=B,this._signingKeys=j,this._client_id=Z,this._client_secret=Y,this._response_type=oe,this._scope=ke,this._redirect_uri=G,this._post_logout_redirect_uri=se,this._client_authentication=Re,this._prompt=Oe,this._display=ge,this._max_age=Ue,this._ui_locales=qe,this._acr_values=rt,this._resource=ht,this._response_mode=mt,this._filterProtocolClaims=!!Wt,this._loadUserInfo=!!ce,this._staleStateAge=He,this._clockSkew=w,this._clockService=L,this._userInfoJwtIssuer=ee,this._mergeClaims=!!we,this._stateStore=Be,this._validator=new Ge(this),this._metadataService=new ur(this),this._extraQueryParams=(ot===void 0?"undefined":c(ot))==="object"?ot:{},this._extraTokenParams=(er===void 0?"undefined":c(er))==="object"?er:{}}return _.prototype.getEpochTime=function(){return this._clockService.getEpochTime()},u(_,[{key:"client_id",get:function(){return this._client_id},set:function(C){if(this._client_id)throw p.Log.error("OidcClientSettings.set_client_id: client_id has already been assigned."),new Error("client_id has already been assigned.");this._client_id=C}},{key:"client_secret",get:function(){return this._client_secret}},{key:"response_type",get:function(){return this._response_type}},{key:"scope",get:function(){return this._scope}},{key:"redirect_uri",get:function(){return this._redirect_uri}},{key:"post_logout_redirect_uri",get:function(){return this._post_logout_redirect_uri}},{key:"client_authentication",get:function(){return this._client_authentication}},{key:"prompt",get:function(){return this._prompt}},{key:"display",get:function(){return this._display}},{key:"max_age",get:function(){return this._max_age}},{key:"ui_locales",get:function(){return this._ui_locales}},{key:"acr_values",get:function(){return this._acr_values}},{key:"resource",get:function(){return this._resource}},{key:"response_mode",get:function(){return this._response_mode}},{key:"authority",get:function(){return this._authority},set:function(C){if(this._authority)throw p.Log.error("OidcClientSettings.set_authority: authority has already been assigned."),new Error("authority has already been assigned.");this._authority=C}},{key:"metadataUrl",get:function(){return this._metadataUrl||(this._metadataUrl=this.authority,this._metadataUrl&&this._metadataUrl.indexOf(E)<0&&(this._metadataUrl[this._metadataUrl.length-1]!=="/"&&(this._metadataUrl+="/"),this._metadataUrl+=E)),this._metadataUrl}},{key:"metadata",get:function(){return this._metadata},set:function(C){this._metadata=C}},{key:"metadataSeed",get:function(){return this._metadataSeed},set:function(C){this._metadataSeed=C}},{key:"signingKeys",get:function(){return this._signingKeys},set:function(C){this._signingKeys=C}},{key:"filterProtocolClaims",get:function(){return this._filterProtocolClaims}},{key:"loadUserInfo",get:function(){return this._loadUserInfo}},{key:"staleStateAge",get:function(){return this._staleStateAge}},{key:"clockSkew",get:function(){return this._clockSkew}},{key:"userInfoJwtIssuer",get:function(){return this._userInfoJwtIssuer}},{key:"mergeClaims",get:function(){return this._mergeClaims}},{key:"stateStore",get:function(){return this._stateStore}},{key:"validator",get:function(){return this._validator}},{key:"metadataService",get:function(){return this._metadataService}},{key:"extraQueryParams",get:function(){return this._extraQueryParams},set:function(C){(C===void 0?"undefined":c(C))==="object"?this._extraQueryParams=C:this._extraQueryParams={}}},{key:"extraTokenParams",get:function(){return this._extraTokenParams},set:function(C){(C===void 0?"undefined":c(C))==="object"?this._extraTokenParams=C:this._extraTokenParams={}}}]),_}()},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.WebStorageStateStore=void 0;var c=s(0),u=s(1);function p(y,f){if(!(y instanceof f))throw new TypeError("Cannot call a class as a function")}r.WebStorageStateStore=function(){function y(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=f.prefix,h=d===void 0?"oidc.":d,v=f.store,E=v===void 0?u.Global.localStorage:v;p(this,y),this._store=E,this._prefix=h}return y.prototype.set=function(d,h){return c.Log.debug("WebStorageStateStore.set",d),d=this._prefix+d,this._store.setItem(d,h),Promise.resolve()},y.prototype.get=function(d){c.Log.debug("WebStorageStateStore.get",d),d=this._prefix+d;var h=this._store.getItem(d);return Promise.resolve(h)},y.prototype.remove=function(d){c.Log.debug("WebStorageStateStore.remove",d),d=this._prefix+d;var h=this._store.getItem(d);return this._store.removeItem(d),Promise.resolve(h)},y.prototype.getAllKeys=function(){c.Log.debug("WebStorageStateStore.getAllKeys");for(var d=[],h=0;h<this._store.length;h++){var v=this._store.key(h);v.indexOf(this._prefix)===0&&d.push(v.substr(this._prefix.length))}return Promise.resolve(d)},y}()},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.JsonService=void 0;var c=s(0),u=s(1);function p(y,f){if(!(y instanceof f))throw new TypeError("Cannot call a class as a function")}r.JsonService=function(){function y(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:u.Global.XMLHttpRequest,h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;p(this,y),f&&Array.isArray(f)?this._contentTypes=f.slice():this._contentTypes=[],this._contentTypes.push("application/json"),h&&this._contentTypes.push("application/jwt"),this._XMLHttpRequest=d,this._jwtHandler=h}return y.prototype.getJson=function(d,h){var v=this;if(!d)throw c.Log.error("JsonService.getJson: No url passed"),new Error("url");return c.Log.debug("JsonService.getJson, url: ",d),new Promise(function(E,m){var A=new v._XMLHttpRequest;A.open("GET",d);var F=v._contentTypes,_=v._jwtHandler;A.onload=function(){if(c.Log.debug("JsonService.getJson: HTTP response received, status",A.status),A.status===200){var P=A.getResponseHeader("Content-Type");if(P){var C=F.find(function(R){if(P.startsWith(R))return!0});if(C=="application/jwt")return void _(A).then(E,m);if(C)try{return void E(JSON.parse(A.responseText))}catch(R){return c.Log.error("JsonService.getJson: Error parsing JSON response",R.message),void m(R)}}m(Error("Invalid response Content-Type: "+P+", from URL: "+d))}else m(Error(A.statusText+" ("+A.status+")"))},A.onerror=function(){c.Log.error("JsonService.getJson: network error"),m(Error("Network Error"))},h&&(c.Log.debug("JsonService.getJson: token passed, setting Authorization header"),A.setRequestHeader("Authorization","Bearer "+h)),A.send()})},y.prototype.postForm=function(d,h,v){var E=this;if(!d)throw c.Log.error("JsonService.postForm: No url passed"),new Error("url");return c.Log.debug("JsonService.postForm, url: ",d),new Promise(function(m,A){var F=new E._XMLHttpRequest;F.open("POST",d);var _=E._contentTypes;F.onload=function(){if(c.Log.debug("JsonService.postForm: HTTP response received, status",F.status),F.status!==200){if(F.status===400&&(j=F.getResponseHeader("Content-Type"))&&_.find(function(B){if(j.startsWith(B))return!0}))try{var V=JSON.parse(F.responseText);if(V&&V.error)return c.Log.error("JsonService.postForm: Error from server: ",V.error),void A(new Error(V.error))}catch(B){return c.Log.error("JsonService.postForm: Error parsing JSON response",B.message),void A(B)}A(Error(F.statusText+" ("+F.status+")"))}else{var j;if((j=F.getResponseHeader("Content-Type"))&&_.find(function(B){if(j.startsWith(B))return!0}))try{return void m(JSON.parse(F.responseText))}catch(B){return c.Log.error("JsonService.postForm: Error parsing JSON response",B.message),void A(B)}A(Error("Invalid response Content-Type: "+j+", from URL: "+d))}},F.onerror=function(){c.Log.error("JsonService.postForm: network error"),A(Error("Network Error"))};var P="";for(var C in h){var R=h[C];R&&(P.length>0&&(P+="&"),P+=encodeURIComponent(C),P+="=",P+=encodeURIComponent(R))}F.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),v!==void 0&&F.setRequestHeader("Authorization","Basic "+btoa(v)),F.send(P)})},y}()},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.SigninRequest=void 0;var c=s(0),u=s(3),p=s(13);r.SigninRequest=function(){function y(f){var d=f.url,h=f.client_id,v=f.redirect_uri,E=f.response_type,m=f.scope,A=f.authority,F=f.data,_=f.prompt,P=f.display,C=f.max_age,R=f.ui_locales,V=f.id_token_hint,j=f.login_hint,B=f.acr_values,Z=f.resource,Y=f.response_mode,O=f.request,oe=f.request_uri,_e=f.extraQueryParams,ke=f.request_type,G=f.client_secret,se=f.extraTokenParams,ve=f.skipUserInfo;if(function(ht,mt){if(!(ht instanceof mt))throw new TypeError("Cannot call a class as a function")}(this,y),!d)throw c.Log.error("SigninRequest.ctor: No url passed"),new Error("url");if(!h)throw c.Log.error("SigninRequest.ctor: No client_id passed"),new Error("client_id");if(!v)throw c.Log.error("SigninRequest.ctor: No redirect_uri passed"),new Error("redirect_uri");if(!E)throw c.Log.error("SigninRequest.ctor: No response_type passed"),new Error("response_type");if(!m)throw c.Log.error("SigninRequest.ctor: No scope passed"),new Error("scope");if(!A)throw c.Log.error("SigninRequest.ctor: No authority passed"),new Error("authority");var Re=y.isOidc(E),Oe=y.isCode(E);Y||(Y=y.isCode(E)?"query":null),this.state=new p.SigninState({nonce:Re,data:F,client_id:h,authority:A,redirect_uri:v,code_verifier:Oe,request_type:ke,response_mode:Y,client_secret:G,scope:m,extraTokenParams:se,skipUserInfo:ve}),d=u.UrlUtility.addQueryParam(d,"client_id",h),d=u.UrlUtility.addQueryParam(d,"redirect_uri",v),d=u.UrlUtility.addQueryParam(d,"response_type",E),d=u.UrlUtility.addQueryParam(d,"scope",m),d=u.UrlUtility.addQueryParam(d,"state",this.state.id),Re&&(d=u.UrlUtility.addQueryParam(d,"nonce",this.state.nonce)),Oe&&(d=u.UrlUtility.addQueryParam(d,"code_challenge",this.state.code_challenge),d=u.UrlUtility.addQueryParam(d,"code_challenge_method","S256"));var ge={prompt:_,display:P,max_age:C,ui_locales:R,id_token_hint:V,login_hint:j,acr_values:B,resource:Z,request:O,request_uri:oe,response_mode:Y};for(var Ue in ge)ge[Ue]&&(d=u.UrlUtility.addQueryParam(d,Ue,ge[Ue]));for(var qe in _e)d=u.UrlUtility.addQueryParam(d,qe,_e[qe]);this.url=d}return y.isOidc=function(d){return!!d.split(/\s+/g).filter(function(h){return h==="id_token"})[0]},y.isOAuth=function(d){return!!d.split(/\s+/g).filter(function(h){return h==="token"})[0]},y.isCode=function(d){return!!d.split(/\s+/g).filter(function(h){return h==="code"})[0]},y}()},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.State=void 0;var c=function(){function f(d,h){for(var v=0;v<h.length;v++){var E=h[v];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(d,E.key,E)}}return function(d,h,v){return h&&f(d.prototype,h),v&&f(d,v),d}}(),u=s(0),p=function(d){return d&&d.__esModule?d:{default:d}}(s(14));function y(f,d){if(!(f instanceof d))throw new TypeError("Cannot call a class as a function")}r.State=function(){function f(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=d.id,v=d.data,E=d.created,m=d.request_type;y(this,f),this._id=h||(0,p.default)(),this._data=v,this._created=typeof E=="number"&&E>0?E:parseInt(Date.now()/1e3),this._request_type=m}return f.prototype.toStorageString=function(){return u.Log.debug("State.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type})},f.fromStorageString=function(h){return u.Log.debug("State.fromStorageString"),new f(JSON.parse(h))},f.clearStaleState=function(h,v){var E=Date.now()/1e3-v;return h.getAllKeys().then(function(m){u.Log.debug("State.clearStaleState: got keys",m);for(var A=[],F=function(R){var V=m[R];P=h.get(V).then(function(j){var B=!1;if(j)try{var Z=f.fromStorageString(j);u.Log.debug("State.clearStaleState: got item from key: ",V,Z.created),Z.created<=E&&(B=!0)}catch(Y){u.Log.error("State.clearStaleState: Error parsing state for key",V,Y.message),B=!0}else u.Log.debug("State.clearStaleState: no item in storage for key: ",V),B=!0;if(B)return u.Log.debug("State.clearStaleState: removed item for key: ",V),h.remove(V)}),A.push(P)},_=0;_<m.length;_++){var P;F(_)}return u.Log.debug("State.clearStaleState: waiting on promise count:",A.length),Promise.all(A)})},c(f,[{key:"id",get:function(){return this._id}},{key:"data",get:function(){return this._data}},{key:"created",get:function(){return this._created}},{key:"request_type",get:function(){return this._request_type}}]),f}()},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.OidcClient=void 0;var c=function(){function F(_,P){for(var C=0;C<P.length;C++){var R=P[C];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(_,R.key,R)}}return function(_,P,C){return P&&F(_.prototype,P),C&&F(_,C),_}}(),u=s(0),p=s(5),y=s(12),f=s(8),d=s(34),h=s(35),v=s(36),E=s(13),m=s(9);function A(F,_){if(!(F instanceof _))throw new TypeError("Cannot call a class as a function")}r.OidcClient=function(){function F(){var _=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};A(this,F),_ instanceof p.OidcClientSettings?this._settings=_:this._settings=new p.OidcClientSettings(_)}return F.prototype.createSigninRequest=function(){var P=this,C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},R=C.response_type,V=C.scope,j=C.redirect_uri,B=C.data,Z=C.state,Y=C.prompt,O=C.display,oe=C.max_age,_e=C.ui_locales,ke=C.id_token_hint,G=C.login_hint,se=C.acr_values,ve=C.resource,Re=C.request,Oe=C.request_uri,ge=C.response_mode,Ue=C.extraQueryParams,qe=C.extraTokenParams,rt=C.request_type,ht=C.skipUserInfo,mt=arguments[1];u.Log.debug("OidcClient.createSigninRequest");var At=this._settings.client_id;R=R||this._settings.response_type,V=V||this._settings.scope,j=j||this._settings.redirect_uri,Y=Y||this._settings.prompt,O=O||this._settings.display,oe=oe||this._settings.max_age,_e=_e||this._settings.ui_locales,se=se||this._settings.acr_values,ve=ve||this._settings.resource,ge=ge||this._settings.response_mode,Ue=Ue||this._settings.extraQueryParams,qe=qe||this._settings.extraTokenParams;var Wt=this._settings.authority;return f.SigninRequest.isCode(R)&&R!=="code"?Promise.reject(new Error("OpenID Connect hybrid flow is not supported")):this._metadataService.getAuthorizationEndpoint().then(function(st){u.Log.debug("OidcClient.createSigninRequest: Received authorization endpoint",st);var ce=new f.SigninRequest({url:st,client_id:At,redirect_uri:j,response_type:R,scope:V,data:B||Z,authority:Wt,prompt:Y,display:O,max_age:oe,ui_locales:_e,id_token_hint:ke,login_hint:G,acr_values:se,resource:ve,request:Re,request_uri:Oe,extraQueryParams:Ue,extraTokenParams:qe,request_type:rt,response_mode:ge,client_secret:P._settings.client_secret,skipUserInfo:ht}),Ee=ce.state;return(mt=mt||P._stateStore).set(Ee.id,Ee.toStorageString()).then(function(){return ce})})},F.prototype.readSigninResponseState=function(P,C){var R=arguments.length>2&&arguments[2]!==void 0&&arguments[2];u.Log.debug("OidcClient.readSigninResponseState");var V=this._settings.response_mode==="query"||!this._settings.response_mode&&f.SigninRequest.isCode(this._settings.response_type),j=V?"?":"#",B=new d.SigninResponse(P,j);if(!B.state)return u.Log.error("OidcClient.readSigninResponseState: No state in response"),Promise.reject(new Error("No state in response"));C=C||this._stateStore;var Z=R?C.remove.bind(C):C.get.bind(C);return Z(B.state).then(function(Y){if(!Y)throw u.Log.error("OidcClient.readSigninResponseState: No matching state found in storage"),new Error("No matching state found in storage");return{state:E.SigninState.fromStorageString(Y),response:B}})},F.prototype.processSigninResponse=function(P,C){var R=this;return u.Log.debug("OidcClient.processSigninResponse"),this.readSigninResponseState(P,C,!0).then(function(V){var j=V.state,B=V.response;return u.Log.debug("OidcClient.processSigninResponse: Received state from storage; validating response"),R._validator.validateSigninResponse(j,B)})},F.prototype.createSignoutRequest=function(){var P=this,C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},R=C.id_token_hint,V=C.data,j=C.state,B=C.post_logout_redirect_uri,Z=C.extraQueryParams,Y=C.request_type,O=arguments[1];return u.Log.debug("OidcClient.createSignoutRequest"),B=B||this._settings.post_logout_redirect_uri,Z=Z||this._settings.extraQueryParams,this._metadataService.getEndSessionEndpoint().then(function(oe){if(!oe)throw u.Log.error("OidcClient.createSignoutRequest: No end session endpoint url returned"),new Error("no end session endpoint");u.Log.debug("OidcClient.createSignoutRequest: Received end session endpoint",oe);var _e=new h.SignoutRequest({url:oe,id_token_hint:R,post_logout_redirect_uri:B,data:V||j,extraQueryParams:Z,request_type:Y}),ke=_e.state;return ke&&(u.Log.debug("OidcClient.createSignoutRequest: Signout request has state to persist"),(O=O||P._stateStore).set(ke.id,ke.toStorageString())),_e})},F.prototype.readSignoutResponseState=function(P,C){var R=arguments.length>2&&arguments[2]!==void 0&&arguments[2];u.Log.debug("OidcClient.readSignoutResponseState");var V=new v.SignoutResponse(P);if(!V.state)return u.Log.debug("OidcClient.readSignoutResponseState: No state in response"),V.error?(u.Log.warn("OidcClient.readSignoutResponseState: Response was error: ",V.error),Promise.reject(new y.ErrorResponse(V))):Promise.resolve({state:void 0,response:V});var j=V.state;C=C||this._stateStore;var B=R?C.remove.bind(C):C.get.bind(C);return B(j).then(function(Z){if(!Z)throw u.Log.error("OidcClient.readSignoutResponseState: No matching state found in storage"),new Error("No matching state found in storage");return{state:m.State.fromStorageString(Z),response:V}})},F.prototype.processSignoutResponse=function(P,C){var R=this;return u.Log.debug("OidcClient.processSignoutResponse"),this.readSignoutResponseState(P,C,!0).then(function(V){var j=V.state,B=V.response;return j?(u.Log.debug("OidcClient.processSignoutResponse: Received state from storage; validating response"),R._validator.validateSignoutResponse(j,B)):(u.Log.debug("OidcClient.processSignoutResponse: No state from storage; skipping validating response"),B)})},F.prototype.clearStaleState=function(P){return u.Log.debug("OidcClient.clearStaleState"),P=P||this._stateStore,m.State.clearStaleState(P,this.settings.staleStateAge)},c(F,[{key:"_stateStore",get:function(){return this.settings.stateStore}},{key:"_validator",get:function(){return this.settings.validator}},{key:"_metadataService",get:function(){return this.settings.metadataService}},{key:"settings",get:function(){return this._settings}},{key:"metadataService",get:function(){return this._metadataService}}]),F}()},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.TokenClient=void 0;var c=s(7),u=s(2),p=s(0);function y(f,d){if(!(f instanceof d))throw new TypeError("Cannot call a class as a function")}r.TokenClient=function(){function f(d){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:c.JsonService,v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:u.MetadataService;if(y(this,f),!d)throw p.Log.error("TokenClient.ctor: No settings passed"),new Error("settings");this._settings=d,this._jsonService=new h,this._metadataService=new v(this._settings)}return f.prototype.exchangeCode=function(){var h=this,v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(v=Object.assign({},v)).grant_type=v.grant_type||"authorization_code",v.client_id=v.client_id||this._settings.client_id,v.client_secret=v.client_secret||this._settings.client_secret,v.redirect_uri=v.redirect_uri||this._settings.redirect_uri;var E=void 0,m=v._client_authentication||this._settings._client_authentication;return delete v._client_authentication,v.code?v.redirect_uri?v.code_verifier?v.client_id?v.client_secret||m!="client_secret_basic"?(m=="client_secret_basic"&&(E=v.client_id+":"+v.client_secret,delete v.client_id,delete v.client_secret),this._metadataService.getTokenEndpoint(!1).then(function(A){return p.Log.debug("TokenClient.exchangeCode: Received token endpoint"),h._jsonService.postForm(A,v,E).then(function(F){return p.Log.debug("TokenClient.exchangeCode: response received"),F})})):(p.Log.error("TokenClient.exchangeCode: No client_secret passed"),Promise.reject(new Error("A client_secret is required"))):(p.Log.error("TokenClient.exchangeCode: No client_id passed"),Promise.reject(new Error("A client_id is required"))):(p.Log.error("TokenClient.exchangeCode: No code_verifier passed"),Promise.reject(new Error("A code_verifier is required"))):(p.Log.error("TokenClient.exchangeCode: No redirect_uri passed"),Promise.reject(new Error("A redirect_uri is required"))):(p.Log.error("TokenClient.exchangeCode: No code passed"),Promise.reject(new Error("A code is required")))},f.prototype.exchangeRefreshToken=function(){var h=this,v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(v=Object.assign({},v)).grant_type=v.grant_type||"refresh_token",v.client_id=v.client_id||this._settings.client_id,v.client_secret=v.client_secret||this._settings.client_secret;var E=void 0,m=v._client_authentication||this._settings._client_authentication;return delete v._client_authentication,v.refresh_token?v.client_id?(m=="client_secret_basic"&&(E=v.client_id+":"+v.client_secret,delete v.client_id,delete v.client_secret),this._metadataService.getTokenEndpoint(!1).then(function(A){return p.Log.debug("TokenClient.exchangeRefreshToken: Received token endpoint"),h._jsonService.postForm(A,v,E).then(function(F){return p.Log.debug("TokenClient.exchangeRefreshToken: response received"),F})})):(p.Log.error("TokenClient.exchangeRefreshToken: No client_id passed"),Promise.reject(new Error("A client_id is required"))):(p.Log.error("TokenClient.exchangeRefreshToken: No refresh_token passed"),Promise.reject(new Error("A refresh_token is required")))},f}()},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.ErrorResponse=void 0;var c=s(0);function u(y,f){if(!(y instanceof f))throw new TypeError("Cannot call a class as a function")}function p(y,f){if(!y)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!f||typeof f!="object"&&typeof f!="function"?y:f}r.ErrorResponse=function(y){function f(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=d.error,v=d.error_description,E=d.error_uri,m=d.state,A=d.session_state;if(u(this,f),!h)throw c.Log.error("No error passed to ErrorResponse"),new Error("error");var F=p(this,y.call(this,v||h));return F.name="ErrorResponse",F.error=h,F.error_description=v,F.error_uri=E,F.state=m,F.session_state=A,F}return function(h,v){if(typeof v!="function"&&v!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof v);h.prototype=Object.create(v&&v.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),v&&(Object.setPrototypeOf?Object.setPrototypeOf(h,v):h.__proto__=v)}(f,y),f}(Error)},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.SigninState=void 0;var c=function(){function v(E,m){for(var A=0;A<m.length;A++){var F=m[A];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(E,F.key,F)}}return function(E,m,A){return m&&v(E.prototype,m),A&&v(E,A),E}}(),u=s(0),p=s(9),y=s(4),f=function(E){return E&&E.__esModule?E:{default:E}}(s(14));function d(v,E){if(!(v instanceof E))throw new TypeError("Cannot call a class as a function")}function h(v,E){if(!v)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!E||typeof E!="object"&&typeof E!="function"?v:E}r.SigninState=function(v){function E(){var m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},A=m.nonce,F=m.authority,_=m.client_id,P=m.redirect_uri,C=m.code_verifier,R=m.response_mode,V=m.client_secret,j=m.scope,B=m.extraTokenParams,Z=m.skipUserInfo;d(this,E);var Y=h(this,v.call(this,arguments[0]));if(A===!0?Y._nonce=(0,f.default)():A&&(Y._nonce=A),C===!0?Y._code_verifier=(0,f.default)()+(0,f.default)()+(0,f.default)():C&&(Y._code_verifier=C),Y.code_verifier){var O=y.JoseUtil.hashString(Y.code_verifier,"SHA256");Y._code_challenge=y.JoseUtil.hexToBase64Url(O)}return Y._redirect_uri=P,Y._authority=F,Y._client_id=_,Y._response_mode=R,Y._client_secret=V,Y._scope=j,Y._extraTokenParams=B,Y._skipUserInfo=Z,Y}return function(A,F){if(typeof F!="function"&&F!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof F);A.prototype=Object.create(F&&F.prototype,{constructor:{value:A,enumerable:!1,writable:!0,configurable:!0}}),F&&(Object.setPrototypeOf?Object.setPrototypeOf(A,F):A.__proto__=F)}(E,v),E.prototype.toStorageString=function(){return u.Log.debug("SigninState.toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,nonce:this.nonce,code_verifier:this.code_verifier,redirect_uri:this.redirect_uri,authority:this.authority,client_id:this.client_id,response_mode:this.response_mode,client_secret:this.client_secret,scope:this.scope,extraTokenParams:this.extraTokenParams,skipUserInfo:this.skipUserInfo})},E.fromStorageString=function(A){return u.Log.debug("SigninState.fromStorageString"),new E(JSON.parse(A))},c(E,[{key:"nonce",get:function(){return this._nonce}},{key:"authority",get:function(){return this._authority}},{key:"client_id",get:function(){return this._client_id}},{key:"redirect_uri",get:function(){return this._redirect_uri}},{key:"code_verifier",get:function(){return this._code_verifier}},{key:"code_challenge",get:function(){return this._code_challenge}},{key:"response_mode",get:function(){return this._response_mode}},{key:"client_secret",get:function(){return this._client_secret}},{key:"scope",get:function(){return this._scope}},{key:"extraTokenParams",get:function(){return this._extraTokenParams}},{key:"skipUserInfo",get:function(){return this._skipUserInfo}}]),E}(p.State)},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(){return(c!="undefined"&&c!==null&&c.getRandomValues!==void 0?u:p)().replace(/-/g,"")};var c=typeof window!="undefined"?window.crypto||window.msCrypto:null;function u(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(y){return(y^c.getRandomValues(new Uint8Array(1))[0]&15>>y/4).toString(16)})}function p(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(y){return(y^16*Math.random()>>y/4).toString(16)})}n.exports=r.default},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.User=void 0;var c=function(){function p(y,f){for(var d=0;d<f.length;d++){var h=f[d];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(y,h.key,h)}}return function(y,f,d){return f&&p(y.prototype,f),d&&p(y,d),y}}(),u=s(0);r.User=function(){function p(y){var f=y.id_token,d=y.session_state,h=y.access_token,v=y.refresh_token,E=y.token_type,m=y.scope,A=y.profile,F=y.expires_at,_=y.state;(function(C,R){if(!(C instanceof R))throw new TypeError("Cannot call a class as a function")})(this,p),this.id_token=f,this.session_state=d,this.access_token=h,this.refresh_token=v,this.token_type=E,this.scope=m,this.profile=A,this.expires_at=F,this.state=_}return p.prototype.toStorageString=function(){return u.Log.debug("User.toStorageString"),JSON.stringify({id_token:this.id_token,session_state:this.session_state,access_token:this.access_token,refresh_token:this.refresh_token,token_type:this.token_type,scope:this.scope,profile:this.profile,expires_at:this.expires_at})},p.fromStorageString=function(f){return u.Log.debug("User.fromStorageString"),new p(JSON.parse(f))},c(p,[{key:"expires_in",get:function(){if(this.expires_at){var f=parseInt(Date.now()/1e3);return this.expires_at-f}},set:function(f){var d=parseInt(f);if(typeof d=="number"&&d>0){var h=parseInt(Date.now()/1e3);this.expires_at=h+d}}},{key:"expired",get:function(){var f=this.expires_in;if(f!==void 0)return f<=0}},{key:"scopes",get:function(){return(this.scope||"").split(" ")}}]),p}()},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.AccessTokenEvents=void 0;var c=s(0),u=s(46);function p(y,f){if(!(y instanceof f))throw new TypeError("Cannot call a class as a function")}r.AccessTokenEvents=function(){function y(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=f.accessTokenExpiringNotificationTime,h=d===void 0?60:d,v=f.accessTokenExpiringTimer,E=v===void 0?new u.Timer("Access token expiring"):v,m=f.accessTokenExpiredTimer,A=m===void 0?new u.Timer("Access token expired"):m;p(this,y),this._accessTokenExpiringNotificationTime=h,this._accessTokenExpiring=E,this._accessTokenExpired=A}return y.prototype.load=function(d){if(d.access_token&&d.expires_in!==void 0){var h=d.expires_in;if(c.Log.debug("AccessTokenEvents.load: access token present, remaining duration:",h),h>0){var v=h-this._accessTokenExpiringNotificationTime;v<=0&&(v=1),c.Log.debug("AccessTokenEvents.load: registering expiring timer in:",v),this._accessTokenExpiring.init(v)}else c.Log.debug("AccessTokenEvents.load: canceling existing expiring timer becase we're past expiration."),this._accessTokenExpiring.cancel();var E=h+1;c.Log.debug("AccessTokenEvents.load: registering expired timer in:",E),this._accessTokenExpired.init(E)}else this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()},y.prototype.unload=function(){c.Log.debug("AccessTokenEvents.unload: canceling existing access token timers"),this._accessTokenExpiring.cancel(),this._accessTokenExpired.cancel()},y.prototype.addAccessTokenExpiring=function(d){this._accessTokenExpiring.addHandler(d)},y.prototype.removeAccessTokenExpiring=function(d){this._accessTokenExpiring.removeHandler(d)},y.prototype.addAccessTokenExpired=function(d){this._accessTokenExpired.addHandler(d)},y.prototype.removeAccessTokenExpired=function(d){this._accessTokenExpired.removeHandler(d)},y}()},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.Event=void 0;var c=s(0);r.Event=function(){function u(p){(function(f,d){if(!(f instanceof d))throw new TypeError("Cannot call a class as a function")})(this,u),this._name=p,this._callbacks=[]}return u.prototype.addHandler=function(y){this._callbacks.push(y)},u.prototype.removeHandler=function(y){var f=this._callbacks.findIndex(function(d){return d===y});f>=0&&this._callbacks.splice(f,1)},u.prototype.raise=function(){c.Log.debug("Event: Raising event: "+this._name);for(var y=0;y<this._callbacks.length;y++){var f;(f=this._callbacks)[y].apply(f,arguments)}},u}()},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.SessionMonitor=void 0;var c=function(){function d(h,v){for(var E=0;E<v.length;E++){var m=v[E];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(h,m.key,m)}}return function(h,v,E){return v&&d(h.prototype,v),E&&d(h,E),h}}(),u=s(0),p=s(19),y=s(1);function f(d,h){if(!(d instanceof h))throw new TypeError("Cannot call a class as a function")}r.SessionMonitor=function(){function d(h){var v=this,E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:p.CheckSessionIFrame,m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:y.Global.timer;if(f(this,d),!h)throw u.Log.error("SessionMonitor.ctor: No user manager passed to SessionMonitor"),new Error("userManager");this._userManager=h,this._CheckSessionIFrameCtor=E,this._timer=m,this._userManager.events.addUserLoaded(this._start.bind(this)),this._userManager.events.addUserUnloaded(this._stop.bind(this)),Promise.resolve(this._userManager.getUser().then(function(A){A?v._start(A):v._settings.monitorAnonymousSession&&v._userManager.querySessionStatus().then(function(F){var _={session_state:F.session_state};F.sub&&F.sid&&(_.profile={sub:F.sub,sid:F.sid}),v._start(_)}).catch(function(F){u.Log.error("SessionMonitor ctor: error from querySessionStatus:",F.message)})}).catch(function(A){u.Log.error("SessionMonitor ctor: error from getUser:",A.message)}))}return d.prototype._start=function(v){var E=this,m=v.session_state;m&&(v.profile?(this._sub=v.profile.sub,this._sid=v.profile.sid,u.Log.debug("SessionMonitor._start: session_state:",m,", sub:",this._sub)):(this._sub=void 0,this._sid=void 0,u.Log.debug("SessionMonitor._start: session_state:",m,", anonymous user")),this._checkSessionIFrame?this._checkSessionIFrame.start(m):this._metadataService.getCheckSessionIframe().then(function(A){if(A){u.Log.debug("SessionMonitor._start: Initializing check session iframe");var F=E._client_id,_=E._checkSessionInterval,P=E._stopCheckSessionOnError;E._checkSessionIFrame=new E._CheckSessionIFrameCtor(E._callback.bind(E),F,A,_,P),E._checkSessionIFrame.load().then(function(){E._checkSessionIFrame.start(m)})}else u.Log.warn("SessionMonitor._start: No check session iframe found in the metadata")}).catch(function(A){u.Log.error("SessionMonitor._start: Error from getCheckSessionIframe:",A.message)}))},d.prototype._stop=function(){var v=this;if(this._sub=void 0,this._sid=void 0,this._checkSessionIFrame&&(u.Log.debug("SessionMonitor._stop"),this._checkSessionIFrame.stop()),this._settings.monitorAnonymousSession)var E=this._timer.setInterval(function(){v._timer.clearInterval(E),v._userManager.querySessionStatus().then(function(m){var A={session_state:m.session_state};m.sub&&m.sid&&(A.profile={sub:m.sub,sid:m.sid}),v._start(A)}).catch(function(m){u.Log.error("SessionMonitor: error from querySessionStatus:",m.message)})},1e3)},d.prototype._callback=function(){var v=this;this._userManager.querySessionStatus().then(function(E){var m=!0;E?E.sub===v._sub?(m=!1,v._checkSessionIFrame.start(E.session_state),E.sid===v._sid?u.Log.debug("SessionMonitor._callback: Same sub still logged in at OP, restarting check session iframe; session_state:",E.session_state):(u.Log.debug("SessionMonitor._callback: Same sub still logged in at OP, session state has changed, restarting check session iframe; session_state:",E.session_state),v._userManager.events._raiseUserSessionChanged())):u.Log.debug("SessionMonitor._callback: Different subject signed into OP:",E.sub):u.Log.debug("SessionMonitor._callback: Subject no longer signed into OP"),m&&(v._sub?(u.Log.debug("SessionMonitor._callback: SessionMonitor._callback; raising signed out event"),v._userManager.events._raiseUserSignedOut()):(u.Log.debug("SessionMonitor._callback: SessionMonitor._callback; raising signed in event"),v._userManager.events._raiseUserSignedIn()))}).catch(function(E){v._sub&&(u.Log.debug("SessionMonitor._callback: Error calling queryCurrentSigninSession; raising signed out event",E.message),v._userManager.events._raiseUserSignedOut())})},c(d,[{key:"_settings",get:function(){return this._userManager.settings}},{key:"_metadataService",get:function(){return this._userManager.metadataService}},{key:"_client_id",get:function(){return this._settings.client_id}},{key:"_checkSessionInterval",get:function(){return this._settings.checkSessionInterval}},{key:"_stopCheckSessionOnError",get:function(){return this._settings.stopCheckSessionOnError}}]),d}()},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.CheckSessionIFrame=void 0;var c=s(0);function u(p,y){if(!(p instanceof y))throw new TypeError("Cannot call a class as a function")}r.CheckSessionIFrame=function(){function p(y,f,d,h){var v=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];u(this,p),this._callback=y,this._client_id=f,this._url=d,this._interval=h||2e3,this._stopOnError=v;var E=d.indexOf("/",d.indexOf("//")+2);this._frame_origin=d.substr(0,E),this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="absolute",this._frame.style.display="none",this._frame.width=0,this._frame.height=0,this._frame.src=d}return p.prototype.load=function(){var f=this;return new Promise(function(d){f._frame.onload=function(){d()},window.document.body.appendChild(f._frame),f._boundMessageEvent=f._message.bind(f),window.addEventListener("message",f._boundMessageEvent,!1)})},p.prototype._message=function(f){f.origin===this._frame_origin&&f.source===this._frame.contentWindow&&(f.data==="error"?(c.Log.error("CheckSessionIFrame: error message from check session op iframe"),this._stopOnError&&this.stop()):f.data==="changed"?(c.Log.debug("CheckSessionIFrame: changed message from check session op iframe"),this.stop(),this._callback()):c.Log.debug("CheckSessionIFrame: "+f.data+" message from check session op iframe"))},p.prototype.start=function(f){var d=this;if(this._session_state!==f){c.Log.debug("CheckSessionIFrame.start"),this.stop(),this._session_state=f;var h=function(){d._frame.contentWindow.postMessage(d._client_id+" "+d._session_state,d._frame_origin)};h(),this._timer=window.setInterval(h,this._interval)}},p.prototype.stop=function(){this._session_state=null,this._timer&&(c.Log.debug("CheckSessionIFrame.stop"),window.clearInterval(this._timer),this._timer=null)},p}()},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.TokenRevocationClient=void 0;var c=s(0),u=s(2),p=s(1);function y(h,v){if(!(h instanceof v))throw new TypeError("Cannot call a class as a function")}var f="access_token",d="refresh_token";r.TokenRevocationClient=function(){function h(v){var E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:p.Global.XMLHttpRequest,m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:u.MetadataService;if(y(this,h),!v)throw c.Log.error("TokenRevocationClient.ctor: No settings provided"),new Error("No settings provided.");this._settings=v,this._XMLHttpRequestCtor=E,this._metadataService=new m(this._settings)}return h.prototype.revoke=function(E,m){var A=this,F=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"access_token";if(!E)throw c.Log.error("TokenRevocationClient.revoke: No token provided"),new Error("No token provided.");if(F!==f&&F!=d)throw c.Log.error("TokenRevocationClient.revoke: Invalid token type"),new Error("Invalid token type.");return this._metadataService.getRevocationEndpoint().then(function(_){if(_){c.Log.debug("TokenRevocationClient.revoke: Revoking "+F);var P=A._settings.client_id,C=A._settings.client_secret;return A._revoke(_,P,C,E,F)}if(m)throw c.Log.error("TokenRevocationClient.revoke: Revocation not supported"),new Error("Revocation not supported")})},h.prototype._revoke=function(E,m,A,F,_){var P=this;return new Promise(function(C,R){var V=new P._XMLHttpRequestCtor;V.open("POST",E),V.onload=function(){c.Log.debug("TokenRevocationClient.revoke: HTTP response received, status",V.status),V.status===200?C():R(Error(V.statusText+" ("+V.status+")"))},V.onerror=function(){c.Log.debug("TokenRevocationClient.revoke: Network Error."),R("Network Error")};var j="client_id="+encodeURIComponent(m);A&&(j+="&client_secret="+encodeURIComponent(A)),j+="&token_type_hint="+encodeURIComponent(_),j+="&token="+encodeURIComponent(F),V.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),V.send(j)})},h}()},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.CordovaPopupWindow=void 0;var c=function(){function p(y,f){for(var d=0;d<f.length;d++){var h=f[d];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(y,h.key,h)}}return function(y,f,d){return f&&p(y.prototype,f),d&&p(y,d),y}}(),u=s(0);r.CordovaPopupWindow=function(){function p(y){var f=this;(function(h,v){if(!(h instanceof v))throw new TypeError("Cannot call a class as a function")})(this,p),this._promise=new Promise(function(d,h){f._resolve=d,f._reject=h}),this.features=y.popupWindowFeatures||"location=no,toolbar=no,zoom=no",this.target=y.popupWindowTarget||"_blank",this.redirect_uri=y.startUrl,u.Log.debug("CordovaPopupWindow.ctor: redirect_uri: "+this.redirect_uri)}return p.prototype._isInAppBrowserInstalled=function(f){return["cordova-plugin-inappbrowser","cordova-plugin-inappbrowser.inappbrowser","org.apache.cordova.inappbrowser"].some(function(d){return f.hasOwnProperty(d)})},p.prototype.navigate=function(f){if(f&&f.url){if(!window.cordova)return this._error("cordova is undefined");var d=window.cordova.require("cordova/plugin_list").metadata;if(this._isInAppBrowserInstalled(d)===!1)return this._error("InAppBrowser plugin not found");this._popup=cordova.InAppBrowser.open(f.url,this.target,this.features),this._popup?(u.Log.debug("CordovaPopupWindow.navigate: popup successfully created"),this._exitCallbackEvent=this._exitCallback.bind(this),this._loadStartCallbackEvent=this._loadStartCallback.bind(this),this._popup.addEventListener("exit",this._exitCallbackEvent,!1),this._popup.addEventListener("loadstart",this._loadStartCallbackEvent,!1)):this._error("Error opening popup window")}else this._error("No url provided");return this.promise},p.prototype._loadStartCallback=function(f){f.url.indexOf(this.redirect_uri)===0&&this._success({url:f.url})},p.prototype._exitCallback=function(f){this._error(f)},p.prototype._success=function(f){this._cleanup(),u.Log.debug("CordovaPopupWindow: Successful response from cordova popup window"),this._resolve(f)},p.prototype._error=function(f){this._cleanup(),u.Log.error(f),this._reject(new Error(f))},p.prototype.close=function(){this._cleanup()},p.prototype._cleanup=function(){this._popup&&(u.Log.debug("CordovaPopupWindow: cleaning up popup"),this._popup.removeEventListener("exit",this._exitCallbackEvent,!1),this._popup.removeEventListener("loadstart",this._loadStartCallbackEvent,!1),this._popup.close()),this._popup=null},c(p,[{key:"promise",get:function(){return this._promise}}]),p}()},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0});var c=s(0),u=s(10),p=s(5),y=s(6),f=s(37),d=s(38),h=s(16),v=s(2),E=s(48),m=s(49),A=s(19),F=s(20),_=s(18),P=s(1),C=s(15),R=s(50);r.default={Version:R.Version,Log:c.Log,OidcClient:u.OidcClient,OidcClientSettings:p.OidcClientSettings,WebStorageStateStore:y.WebStorageStateStore,InMemoryWebStorage:f.InMemoryWebStorage,UserManager:d.UserManager,AccessTokenEvents:h.AccessTokenEvents,MetadataService:v.MetadataService,CordovaPopupNavigator:E.CordovaPopupNavigator,CordovaIFrameNavigator:m.CordovaIFrameNavigator,CheckSessionIFrame:A.CheckSessionIFrame,TokenRevocationClient:F.TokenRevocationClient,SessionMonitor:_.SessionMonitor,Global:P.Global,User:C.User},n.exports=r.default},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.ClockService=function(){function c(){(function(p,y){if(!(p instanceof y))throw new TypeError("Cannot call a class as a function")})(this,c)}return c.prototype.getEpochTime=function(){return Promise.resolve(Date.now()/1e3|0)},c}()},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.ResponseValidator=void 0;var c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},u=s(0),p=s(2),y=s(25),f=s(11),d=s(12),h=s(4);function v(m,A){if(!(m instanceof A))throw new TypeError("Cannot call a class as a function")}var E=["nonce","at_hash","iat","nbf","exp","aud","iss","c_hash"];r.ResponseValidator=function(){function m(A){var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:p.MetadataService,_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:y.UserInfoService,P=arguments.length>3&&arguments[3]!==void 0?arguments[3]:h.JoseUtil,C=arguments.length>4&&arguments[4]!==void 0?arguments[4]:f.TokenClient;if(v(this,m),!A)throw u.Log.error("ResponseValidator.ctor: No settings passed to ResponseValidator"),new Error("settings");this._settings=A,this._metadataService=new F(this._settings),this._userInfoService=new _(this._settings),this._joseUtil=P,this._tokenClient=new C(this._settings)}return m.prototype.validateSigninResponse=function(F,_){var P=this;return u.Log.debug("ResponseValidator.validateSigninResponse"),this._processSigninParams(F,_).then(function(C){return u.Log.debug("ResponseValidator.validateSigninResponse: state processed"),P._validateTokens(F,C).then(function(R){return u.Log.debug("ResponseValidator.validateSigninResponse: tokens validated"),P._processClaims(F,R).then(function(V){return u.Log.debug("ResponseValidator.validateSigninResponse: claims processed"),V})})})},m.prototype.validateSignoutResponse=function(F,_){return F.id!==_.state?(u.Log.error("ResponseValidator.validateSignoutResponse: State does not match"),Promise.reject(new Error("State does not match"))):(u.Log.debug("ResponseValidator.validateSignoutResponse: state validated"),_.state=F.data,_.error?(u.Log.warn("ResponseValidator.validateSignoutResponse: Response was error",_.error),Promise.reject(new d.ErrorResponse(_))):Promise.resolve(_))},m.prototype._processSigninParams=function(F,_){if(F.id!==_.state)return u.Log.error("ResponseValidator._processSigninParams: State does not match"),Promise.reject(new Error("State does not match"));if(!F.client_id)return u.Log.error("ResponseValidator._processSigninParams: No client_id on state"),Promise.reject(new Error("No client_id on state"));if(!F.authority)return u.Log.error("ResponseValidator._processSigninParams: No authority on state"),Promise.reject(new Error("No authority on state"));if(this._settings.authority){if(this._settings.authority&&this._settings.authority!==F.authority)return u.Log.error("ResponseValidator._processSigninParams: authority mismatch on settings vs. signin state"),Promise.reject(new Error("authority mismatch on settings vs. signin state"))}else this._settings.authority=F.authority;if(this._settings.client_id){if(this._settings.client_id&&this._settings.client_id!==F.client_id)return u.Log.error("ResponseValidator._processSigninParams: client_id mismatch on settings vs. signin state"),Promise.reject(new Error("client_id mismatch on settings vs. signin state"))}else this._settings.client_id=F.client_id;return u.Log.debug("ResponseValidator._processSigninParams: state validated"),_.state=F.data,_.error?(u.Log.warn("ResponseValidator._processSigninParams: Response was error",_.error),Promise.reject(new d.ErrorResponse(_))):F.nonce&&!_.id_token?(u.Log.error("ResponseValidator._processSigninParams: Expecting id_token in response"),Promise.reject(new Error("No id_token in response"))):!F.nonce&&_.id_token?(u.Log.error("ResponseValidator._processSigninParams: Not expecting id_token in response"),Promise.reject(new Error("Unexpected id_token in response"))):F.code_verifier&&!_.code?(u.Log.error("ResponseValidator._processSigninParams: Expecting code in response"),Promise.reject(new Error("No code in response"))):!F.code_verifier&&_.code?(u.Log.error("ResponseValidator._processSigninParams: Not expecting code in response"),Promise.reject(new Error("Unexpected code in response"))):(_.scope||(_.scope=F.scope),Promise.resolve(_))},m.prototype._processClaims=function(F,_){var P=this;if(_.isOpenIdConnect){if(u.Log.debug("ResponseValidator._processClaims: response is OIDC, processing claims"),_.profile=this._filterProtocolClaims(_.profile),F.skipUserInfo!==!0&&this._settings.loadUserInfo&&_.access_token)return u.Log.debug("ResponseValidator._processClaims: loading user info"),this._userInfoService.getClaims(_.access_token).then(function(C){return u.Log.debug("ResponseValidator._processClaims: user info claims received from user info endpoint"),C.sub!==_.profile.sub?(u.Log.error("ResponseValidator._processClaims: sub from user info endpoint does not match sub in id_token"),Promise.reject(new Error("sub from user info endpoint does not match sub in id_token"))):(_.profile=P._mergeClaims(_.profile,C),u.Log.debug("ResponseValidator._processClaims: user info claims received, updated profile:",_.profile),_)});u.Log.debug("ResponseValidator._processClaims: not loading user info")}else u.Log.debug("ResponseValidator._processClaims: response is not OIDC, not processing claims");return Promise.resolve(_)},m.prototype._mergeClaims=function(F,_){var P=Object.assign({},F);for(var C in _){var R=_[C];Array.isArray(R)||(R=[R]);for(var V=0;V<R.length;V++){var j=R[V];P[C]?Array.isArray(P[C])?P[C].indexOf(j)<0&&P[C].push(j):P[C]!==j&&((j===void 0?"undefined":c(j))==="object"&&this._settings.mergeClaims?P[C]=this._mergeClaims(P[C],j):P[C]=[P[C],j]):P[C]=j}}return P},m.prototype._filterProtocolClaims=function(F){u.Log.debug("ResponseValidator._filterProtocolClaims, incoming claims:",F);var _=Object.assign({},F);return this._settings._filterProtocolClaims?(E.forEach(function(P){delete _[P]}),u.Log.debug("ResponseValidator._filterProtocolClaims: protocol claims filtered",_)):u.Log.debug("ResponseValidator._filterProtocolClaims: protocol claims not filtered"),_},m.prototype._validateTokens=function(F,_){return _.code?(u.Log.debug("ResponseValidator._validateTokens: Validating code"),this._processCode(F,_)):_.id_token?_.access_token?(u.Log.debug("ResponseValidator._validateTokens: Validating id_token and access_token"),this._validateIdTokenAndAccessToken(F,_)):(u.Log.debug("ResponseValidator._validateTokens: Validating id_token"),this._validateIdToken(F,_)):(u.Log.debug("ResponseValidator._validateTokens: No code to process or id_token to validate"),Promise.resolve(_))},m.prototype._processCode=function(F,_){var P=this,C={client_id:F.client_id,client_secret:F.client_secret,code:_.code,redirect_uri:F.redirect_uri,code_verifier:F.code_verifier};return F.extraTokenParams&&c(F.extraTokenParams)==="object"&&Object.assign(C,F.extraTokenParams),this._tokenClient.exchangeCode(C).then(function(R){for(var V in R)_[V]=R[V];return _.id_token?(u.Log.debug("ResponseValidator._processCode: token response successful, processing id_token"),P._validateIdTokenAttributes(F,_)):(u.Log.debug("ResponseValidator._processCode: token response successful, returning response"),_)})},m.prototype._validateIdTokenAttributes=function(F,_){var P=this;return this._metadataService.getIssuer().then(function(C){var R=F.client_id,V=P._settings.clockSkew;return u.Log.debug("ResponseValidator._validateIdTokenAttributes: Validaing JWT attributes; using clock skew (in seconds) of: ",V),P._settings.getEpochTime().then(function(j){return P._joseUtil.validateJwtAttributes(_.id_token,C,R,V,j).then(function(B){return F.nonce&&F.nonce!==B.nonce?(u.Log.error("ResponseValidator._validateIdTokenAttributes: Invalid nonce in id_token"),Promise.reject(new Error("Invalid nonce in id_token"))):B.sub?(_.profile=B,_):(u.Log.error("ResponseValidator._validateIdTokenAttributes: No sub present in id_token"),Promise.reject(new Error("No sub present in id_token")))})})})},m.prototype._validateIdTokenAndAccessToken=function(F,_){var P=this;return this._validateIdToken(F,_).then(function(C){return P._validateAccessToken(C)})},m.prototype._getSigningKeyForJwt=function(F){var _=this;return this._metadataService.getSigningKeys().then(function(P){var C=F.header.kid;if(!P)return u.Log.error("ResponseValidator._validateIdToken: No signing keys from metadata"),Promise.reject(new Error("No signing keys from metadata"));u.Log.debug("ResponseValidator._validateIdToken: Received signing keys");var R=void 0;if(C)R=P.filter(function(V){return V.kid===C})[0];else{if((P=_._filterByAlg(P,F.header.alg)).length>1)return u.Log.error("ResponseValidator._validateIdToken: No kid found in id_token and more than one key found in metadata"),Promise.reject(new Error("No kid found in id_token and more than one key found in metadata"));R=P[0]}return Promise.resolve(R)})},m.prototype._getSigningKeyForJwtWithSingleRetry=function(F){var _=this;return this._getSigningKeyForJwt(F).then(function(P){return P?Promise.resolve(P):(_._metadataService.resetSigningKeys(),_._getSigningKeyForJwt(F))})},m.prototype._validateIdToken=function(F,_){var P=this;if(!F.nonce)return u.Log.error("ResponseValidator._validateIdToken: No nonce on state"),Promise.reject(new Error("No nonce on state"));var C=this._joseUtil.parseJwt(_.id_token);return C&&C.header&&C.payload?F.nonce!==C.payload.nonce?(u.Log.error("ResponseValidator._validateIdToken: Invalid nonce in id_token"),Promise.reject(new Error("Invalid nonce in id_token"))):this._metadataService.getIssuer().then(function(R){return u.Log.debug("ResponseValidator._validateIdToken: Received issuer"),P._getSigningKeyForJwtWithSingleRetry(C).then(function(V){if(!V)return u.Log.error("ResponseValidator._validateIdToken: No key matching kid or alg found in signing keys"),Promise.reject(new Error("No key matching kid or alg found in signing keys"));var j=F.client_id,B=P._settings.clockSkew;return u.Log.debug("ResponseValidator._validateIdToken: Validaing JWT; using clock skew (in seconds) of: ",B),P._joseUtil.validateJwt(_.id_token,V,R,j,B).then(function(){return u.Log.debug("ResponseValidator._validateIdToken: JWT validation successful"),C.payload.sub?(_.profile=C.payload,_):(u.Log.error("ResponseValidator._validateIdToken: No sub present in id_token"),Promise.reject(new Error("No sub present in id_token")))})})}):(u.Log.error("ResponseValidator._validateIdToken: Failed to parse id_token",C),Promise.reject(new Error("Failed to parse id_token")))},m.prototype._filterByAlg=function(F,_){var P=null;if(_.startsWith("RS"))P="RSA";else if(_.startsWith("PS"))P="PS";else{if(!_.startsWith("ES"))return u.Log.debug("ResponseValidator._filterByAlg: alg not supported: ",_),[];P="EC"}return u.Log.debug("ResponseValidator._filterByAlg: Looking for keys that match kty: ",P),F=F.filter(function(C){return C.kty===P}),u.Log.debug("ResponseValidator._filterByAlg: Number of keys that match kty: ",P,F.length),F},m.prototype._validateAccessToken=function(F){if(!F.profile)return u.Log.error("ResponseValidator._validateAccessToken: No profile loaded from id_token"),Promise.reject(new Error("No profile loaded from id_token"));if(!F.profile.at_hash)return u.Log.error("ResponseValidator._validateAccessToken: No at_hash in id_token"),Promise.reject(new Error("No at_hash in id_token"));if(!F.id_token)return u.Log.error("ResponseValidator._validateAccessToken: No id_token"),Promise.reject(new Error("No id_token"));var _=this._joseUtil.parseJwt(F.id_token);if(!_||!_.header)return u.Log.error("ResponseValidator._validateAccessToken: Failed to parse id_token",_),Promise.reject(new Error("Failed to parse id_token"));var P=_.header.alg;if(!P||P.length!==5)return u.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",P),Promise.reject(new Error("Unsupported alg: "+P));var C=P.substr(2,3);if(!C)return u.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",P,C),Promise.reject(new Error("Unsupported alg: "+P));if((C=parseInt(C))!==256&&C!==384&&C!==512)return u.Log.error("ResponseValidator._validateAccessToken: Unsupported alg:",P,C),Promise.reject(new Error("Unsupported alg: "+P));var R="sha"+C,V=this._joseUtil.hashString(F.access_token,R);if(!V)return u.Log.error("ResponseValidator._validateAccessToken: access_token hash failed:",R),Promise.reject(new Error("Failed to validate at_hash"));var j=V.substr(0,V.length/2),B=this._joseUtil.hexToBase64Url(j);return B!==F.profile.at_hash?(u.Log.error("ResponseValidator._validateAccessToken: Failed to validate at_hash",B,F.profile.at_hash),Promise.reject(new Error("Failed to validate at_hash"))):(u.Log.debug("ResponseValidator._validateAccessToken: success"),Promise.resolve(F))},m}()},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.UserInfoService=void 0;var c=s(7),u=s(2),p=s(0),y=s(4);function f(d,h){if(!(d instanceof h))throw new TypeError("Cannot call a class as a function")}r.UserInfoService=function(){function d(h){var v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:c.JsonService,E=arguments.length>2&&arguments[2]!==void 0?arguments[2]:u.MetadataService,m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:y.JoseUtil;if(f(this,d),!h)throw p.Log.error("UserInfoService.ctor: No settings passed"),new Error("settings");this._settings=h,this._jsonService=new v(void 0,void 0,this._getClaimsFromJwt.bind(this)),this._metadataService=new E(this._settings),this._joseUtil=m}return d.prototype.getClaims=function(v){var E=this;return v?this._metadataService.getUserInfoEndpoint().then(function(m){return p.Log.debug("UserInfoService.getClaims: received userinfo url",m),E._jsonService.getJson(m,v).then(function(A){return p.Log.debug("UserInfoService.getClaims: claims received",A),A})}):(p.Log.error("UserInfoService.getClaims: No token passed"),Promise.reject(new Error("A token is required")))},d.prototype._getClaimsFromJwt=function(v){var E=this;try{var m=this._joseUtil.parseJwt(v.responseText);if(!m||!m.header||!m.payload)return p.Log.error("UserInfoService._getClaimsFromJwt: Failed to parse JWT",m),Promise.reject(new Error("Failed to parse id_token"));var A=m.header.kid,F=void 0;switch(this._settings.userInfoJwtIssuer){case"OP":F=this._metadataService.getIssuer();break;case"ANY":F=Promise.resolve(m.payload.iss);break;default:F=Promise.resolve(this._settings.userInfoJwtIssuer)}return F.then(function(_){return p.Log.debug("UserInfoService._getClaimsFromJwt: Received issuer:"+_),E._metadataService.getSigningKeys().then(function(P){if(!P)return p.Log.error("UserInfoService._getClaimsFromJwt: No signing keys from metadata"),Promise.reject(new Error("No signing keys from metadata"));p.Log.debug("UserInfoService._getClaimsFromJwt: Received signing keys");var C=void 0;if(A)C=P.filter(function(j){return j.kid===A})[0];else{if((P=E._filterByAlg(P,m.header.alg)).length>1)return p.Log.error("UserInfoService._getClaimsFromJwt: No kid found in id_token and more than one key found in metadata"),Promise.reject(new Error("No kid found in id_token and more than one key found in metadata"));C=P[0]}if(!C)return p.Log.error("UserInfoService._getClaimsFromJwt: No key matching kid or alg found in signing keys"),Promise.reject(new Error("No key matching kid or alg found in signing keys"));var R=E._settings.client_id,V=E._settings.clockSkew;return p.Log.debug("UserInfoService._getClaimsFromJwt: Validaing JWT; using clock skew (in seconds) of: ",V),E._joseUtil.validateJwt(v.responseText,C,_,R,V,void 0,!0).then(function(){return p.Log.debug("UserInfoService._getClaimsFromJwt: JWT validation successful"),m.payload})})})}catch(_){return p.Log.error("UserInfoService._getClaimsFromJwt: Error parsing JWT response",_.message),void reject(_)}},d.prototype._filterByAlg=function(v,E){var m=null;if(E.startsWith("RS"))m="RSA";else if(E.startsWith("PS"))m="PS";else{if(!E.startsWith("ES"))return p.Log.debug("UserInfoService._filterByAlg: alg not supported: ",E),[];m="EC"}return p.Log.debug("UserInfoService._filterByAlg: Looking for keys that match kty: ",m),v=v.filter(function(A){return A.kty===m}),p.Log.debug("UserInfoService._filterByAlg: Number of keys that match kty: ",m,v.length),v},d}()},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.AllowedSigningAlgs=r.b64tohex=r.hextob64u=r.crypto=r.X509=r.KeyUtil=r.jws=void 0;var c=s(27);r.jws=c.jws,r.KeyUtil=c.KEYUTIL,r.X509=c.X509,r.crypto=c.crypto,r.hextob64u=c.hextob64u,r.b64tohex=c.b64tohex,r.AllowedSigningAlgs=["RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"]},function(n,r,s){(function(c){Object.defineProperty(r,"__esModule",{value:!0});var u,p,y,f,d,h,v,E,m,A,F,_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},P={userAgent:!1},C={},R=R||(u=Math,y=(p={}).lib={},f=y.Base=function(){function o(){}return{extend:function(a){o.prototype=this;var l=new o;return a&&l.mixIn(a),l.hasOwnProperty("init")||(l.init=function(){l.$super.init.apply(this,arguments)}),l.init.prototype=l,l.$super=this,l},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var l in a)a.hasOwnProperty(l)&&(this[l]=a[l]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),d=y.WordArray=f.extend({init:function(i,a){i=this.words=i||[],this.sigBytes=a!=null?a:4*i.length},toString:function(i){return(i||v).stringify(this)},concat:function(i){var a=this.words,l=i.words,g=this.sigBytes,b=i.sigBytes;if(this.clamp(),g%4)for(var T=0;T<b;T++){var D=l[T>>>2]>>>24-T%4*8&255;a[g+T>>>2]|=D<<24-(g+T)%4*8}else for(T=0;T<b;T+=4)a[g+T>>>2]=l[T>>>2];return this.sigBytes+=b,this},clamp:function(){var i=this.words,a=this.sigBytes;i[a>>>2]&=4294967295<<32-a%4*8,i.length=u.ceil(a/4)},clone:function(){var i=f.clone.call(this);return i.words=this.words.slice(0),i},random:function(i){for(var a=[],l=0;l<i;l+=4)a.push(4294967296*u.random()|0);return new d.init(a,i)}}),h=p.enc={},v=h.Hex={stringify:function(i){for(var a=i.words,l=i.sigBytes,g=[],b=0;b<l;b++){var T=a[b>>>2]>>>24-b%4*8&255;g.push((T>>>4).toString(16)),g.push((15&T).toString(16))}return g.join("")},parse:function(i){for(var a=i.length,l=[],g=0;g<a;g+=2)l[g>>>3]|=parseInt(i.substr(g,2),16)<<24-g%8*4;return new d.init(l,a/2)}},E=h.Latin1={stringify:function(i){for(var a=i.words,l=i.sigBytes,g=[],b=0;b<l;b++){var T=a[b>>>2]>>>24-b%4*8&255;g.push(String.fromCharCode(T))}return g.join("")},parse:function(i){for(var a=i.length,l=[],g=0;g<a;g++)l[g>>>2]|=(255&i.charCodeAt(g))<<24-g%4*8;return new d.init(l,a)}},m=h.Utf8={stringify:function(i){try{return decodeURIComponent(escape(E.stringify(i)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(i){return E.parse(unescape(encodeURIComponent(i)))}},A=y.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new d.init,this._nDataBytes=0},_append:function(i){typeof i=="string"&&(i=m.parse(i)),this._data.concat(i),this._nDataBytes+=i.sigBytes},_process:function(i){var a=this._data,l=a.words,g=a.sigBytes,b=this.blockSize,T=g/(4*b),D=(T=i?u.ceil(T):u.max((0|T)-this._minBufferSize,0))*b,x=u.min(4*D,g);if(D){for(var U=0;U<D;U+=b)this._doProcessBlock(l,U);var H=l.splice(0,D);a.sigBytes-=x}return new d.init(H,x)},clone:function(){var i=f.clone.call(this);return i._data=this._data.clone(),i},_minBufferSize:0}),y.Hasher=A.extend({cfg:f.extend(),init:function(i){this.cfg=this.cfg.extend(i),this.reset()},reset:function(){A.reset.call(this),this._doReset()},update:function(i){return this._append(i),this._process(),this},finalize:function(i){return i&&this._append(i),this._doFinalize()},blockSize:16,_createHelper:function(i){return function(a,l){return new i.init(l).finalize(a)}},_createHmacHelper:function(i){return function(a,l){return new F.HMAC.init(i,l).finalize(a)}}}),F=p.algo={},p);(function(o){var i,a=(i=R).lib,l=a.Base,g=a.WordArray;(i=i.x64={}).Word=l.extend({init:function(T,D){this.high=T,this.low=D}}),i.WordArray=l.extend({init:function(T,D){T=this.words=T||[],this.sigBytes=D!=null?D:8*T.length},toX32:function(){for(var T=this.words,D=T.length,x=[],U=0;U<D;U++){var H=T[U];x.push(H.high),x.push(H.low)}return g.create(x,this.sigBytes)},clone:function(){for(var T=l.clone.call(this),D=T.words=this.words.slice(0),x=D.length,U=0;U<x;U++)D[U]=D[U].clone();return T}})})(),function(){var o=R,i=o.lib.WordArray;o.enc.Base64={stringify:function(l){var g=l.words,b=l.sigBytes,T=this._map;l.clamp(),l=[];for(var D=0;D<b;D+=3)for(var x=(g[D>>>2]>>>24-D%4*8&255)<<16|(g[D+1>>>2]>>>24-(D+1)%4*8&255)<<8|g[D+2>>>2]>>>24-(D+2)%4*8&255,U=0;4>U&&D+.75*U<b;U++)l.push(T.charAt(x>>>6*(3-U)&63));if(g=T.charAt(64))for(;l.length%4;)l.push(g);return l.join("")},parse:function(l){var g=l.length,b=this._map;(T=b.charAt(64))&&(T=l.indexOf(T))!=-1&&(g=T);for(var T=[],D=0,x=0;x<g;x++)if(x%4){var U=b.indexOf(l.charAt(x-1))<<x%4*2,H=b.indexOf(l.charAt(x))>>>6-x%4*2;T[D>>>2]|=(U|H)<<24-D%4*8,D++}return i.create(T,D)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(o){for(var i=R,a=(g=i.lib).WordArray,l=g.Hasher,g=i.algo,b=[],T=[],D=function(te){return 4294967296*(te-(0|te))|0},x=2,U=0;64>U;){var H;e:{H=x;for(var M=o.sqrt(H),$=2;$<=M;$++)if(!(H%$)){H=!1;break e}H=!0}H&&(8>U&&(b[U]=D(o.pow(x,.5))),T[U]=D(o.pow(x,1/3)),U++),x++}var z=[];g=g.SHA256=l.extend({_doReset:function(){this._hash=new a.init(b.slice(0))},_doProcessBlock:function(te,re){for(var k=this._hash.words,N=k[0],K=k[1],W=k[2],Q=k[3],ne=k[4],me=k[5],ae=k[6],Ne=k[7],ye=0;64>ye;ye++){if(16>ye)z[ye]=0|te[re+ye];else{var Ae=z[ye-15],Ze=z[ye-2];z[ye]=((Ae<<25|Ae>>>7)^(Ae<<14|Ae>>>18)^Ae>>>3)+z[ye-7]+((Ze<<15|Ze>>>17)^(Ze<<13|Ze>>>19)^Ze>>>10)+z[ye-16]}Ae=Ne+((ne<<26|ne>>>6)^(ne<<21|ne>>>11)^(ne<<7|ne>>>25))+(ne&me^~ne&ae)+T[ye]+z[ye],Ze=((N<<30|N>>>2)^(N<<19|N>>>13)^(N<<10|N>>>22))+(N&K^N&W^K&W),Ne=ae,ae=me,me=ne,ne=Q+Ae|0,Q=W,W=K,K=N,N=Ae+Ze|0}k[0]=k[0]+N|0,k[1]=k[1]+K|0,k[2]=k[2]+W|0,k[3]=k[3]+Q|0,k[4]=k[4]+ne|0,k[5]=k[5]+me|0,k[6]=k[6]+ae|0,k[7]=k[7]+Ne|0},_doFinalize:function(){var te=this._data,re=te.words,k=8*this._nDataBytes,N=8*te.sigBytes;return re[N>>>5]|=128<<24-N%32,re[14+(N+64>>>9<<4)]=o.floor(k/4294967296),re[15+(N+64>>>9<<4)]=k,te.sigBytes=4*re.length,this._process(),this._hash},clone:function(){var te=l.clone.call(this);return te._hash=this._hash.clone(),te}}),i.SHA256=l._createHelper(g),i.HmacSHA256=l._createHmacHelper(g)}(Math),function(){function o(){return l.create.apply(l,arguments)}for(var i=R,a=i.lib.Hasher,l=(b=i.x64).Word,g=b.WordArray,b=i.algo,T=[o(1116352408,3609767458),o(1899447441,602891725),o(3049323471,3964484399),o(3921009573,2173295548),o(961987163,4081628472),o(1508970993,3053834265),o(2453635748,2937671579),o(2870763221,3664609560),o(3624381080,2734883394),o(310598401,1164996542),o(607225278,1323610764),o(1426881987,3590304994),o(1925078388,4068182383),o(2162078206,991336113),o(2614888103,633803317),o(3248222580,3479774868),o(3835390401,2666613458),o(4022224774,944711139),o(264347078,2341262773),o(604807628,2007800933),o(770255983,1495990901),o(1249150122,1856431235),o(1555081692,3175218132),o(1996064986,2198950837),o(2554220882,3999719339),o(2821834349,766784016),o(2952996808,2566594879),o(3210313671,3203337956),o(3336571891,1034457026),o(3584528711,2466948901),o(113926993,3758326383),o(338241895,168717936),o(666307205,1188179964),o(773529912,1546045734),o(1294757372,1522805485),o(1396182291,2643833823),o(1695183700,2343527390),o(1986661051,1014477480),o(2177026350,1206759142),o(2456956037,344077627),o(2730485921,1290863460),o(2820302411,3158454273),o(3259730800,3505952657),o(3345764771,106217008),o(3516065817,3606008344),o(3600352804,1432725776),o(4094571909,1467031594),o(275423344,851169720),o(430227734,3100823752),o(506948616,1363258195),o(659060556,3750685593),o(883997877,3785050280),o(958139571,3318307427),o(1322822218,3812723403),o(1537002063,2003034995),o(1747873779,3602036899),o(1955562222,1575990012),o(2024104815,1125592928),o(2227730452,2716904306),o(2361852424,442776044),o(2428436474,593698344),o(2756734187,3733110249),o(3204031479,2999351573),o(3329325298,3815920427),o(3391569614,3928383900),o(3515267271,566280711),o(3940187606,3454069534),o(4118630271,4000239992),o(116418474,1914138554),o(174292421,2731055270),o(289380356,3203993006),o(460393269,320620315),o(685471733,587496836),o(852142971,1086792851),o(1017036298,365543100),o(1126000580,2618297676),o(1288033470,3409855158),o(1501505948,4234509866),o(1607167915,987167468),o(1816402316,1246189591)],D=[],x=0;80>x;x++)D[x]=o();b=b.SHA512=a.extend({_doReset:function(){this._hash=new g.init([new l.init(1779033703,4089235720),new l.init(3144134277,2227873595),new l.init(1013904242,4271175723),new l.init(2773480762,1595750129),new l.init(1359893119,2917565137),new l.init(2600822924,725511199),new l.init(528734635,4215389547),new l.init(1541459225,327033209)])},_doProcessBlock:function(H,M){for(var $=(K=this._hash.words)[0],z=K[1],X=K[2],te=K[3],re=K[4],k=K[5],N=K[6],K=K[7],W=$.high,Q=$.low,ne=z.high,me=z.low,ae=X.high,Ne=X.low,ye=te.high,Ae=te.low,Ze=re.high,nt=re.low,tt=k.high,Jt=k.low,Ht=N.high,Bt=N.low,ct=K.high,St=K.low,It=W,jt=Q,un=ne,qr=me,cn=ae,zr=Ne,hi=ye,ln=Ae,lr=Ze,rr=nt,xn=tt,dn=Jt,Rn=Ht,fn=Bt,pi=ct,hn=St,dr=0;80>dr;dr++){var Nr=D[dr];if(16>dr)var Er=Nr.high=0|H[M+2*dr],it=Nr.low=0|H[M+2*dr+1];else{Er=((it=(Er=D[dr-15]).high)>>>1|(Fr=Er.low)<<31)^(it>>>8|Fr<<24)^it>>>7;var Fr=(Fr>>>1|it<<31)^(Fr>>>8|it<<24)^(Fr>>>7|it<<25),Gr=((it=(Gr=D[dr-2]).high)>>>19|(Et=Gr.low)<<13)^(it<<3|Et>>>29)^it>>>6,Et=(Et>>>19|it<<13)^(Et<<3|it>>>29)^(Et>>>6|it<<26),gi=(it=D[dr-7]).high,Lr=(Mr=D[dr-16]).high,Mr=Mr.low;Er=(Er=(Er=Er+gi+((it=Fr+it.low)>>>0<Fr>>>0?1:0))+Gr+((it=it+Et)>>>0<Et>>>0?1:0))+Lr+((it=it+Mr)>>>0<Mr>>>0?1:0),Nr.high=Er,Nr.low=it}gi=lr&xn^~lr&Rn,Mr=rr&dn^~rr&fn,Nr=It&un^It&cn^un&cn;var La=jt&qr^jt&zr^qr&zr,Ma=(Fr=(It>>>28|jt<<4)^(It<<30|jt>>>2)^(It<<25|jt>>>7),Gr=(jt>>>28|It<<4)^(jt<<30|It>>>2)^(jt<<25|It>>>7),(Et=T[dr]).high),Io=Et.low;Lr=pi+((lr>>>14|rr<<18)^(lr>>>18|rr<<14)^(lr<<23|rr>>>9))+((Et=hn+((rr>>>14|lr<<18)^(rr>>>18|lr<<14)^(rr<<23|lr>>>9)))>>>0<hn>>>0?1:0),pi=Rn,hn=fn,Rn=xn,fn=dn,xn=lr,dn=rr,lr=hi+(Lr=(Lr=(Lr=Lr+gi+((Et=Et+Mr)>>>0<Mr>>>0?1:0))+Ma+((Et=Et+Io)>>>0<Io>>>0?1:0))+Er+((Et=Et+it)>>>0<it>>>0?1:0))+((rr=ln+Et|0)>>>0<ln>>>0?1:0)|0,hi=cn,ln=zr,cn=un,zr=qr,un=It,qr=jt,It=Lr+(Nr=Fr+Nr+((it=Gr+La)>>>0<Gr>>>0?1:0))+((jt=Et+it|0)>>>0<Et>>>0?1:0)|0}Q=$.low=Q+jt,$.high=W+It+(Q>>>0<jt>>>0?1:0),me=z.low=me+qr,z.high=ne+un+(me>>>0<qr>>>0?1:0),Ne=X.low=Ne+zr,X.high=ae+cn+(Ne>>>0<zr>>>0?1:0),Ae=te.low=Ae+ln,te.high=ye+hi+(Ae>>>0<ln>>>0?1:0),nt=re.low=nt+rr,re.high=Ze+lr+(nt>>>0<rr>>>0?1:0),Jt=k.low=Jt+dn,k.high=tt+xn+(Jt>>>0<dn>>>0?1:0),Bt=N.low=Bt+fn,N.high=Ht+Rn+(Bt>>>0<fn>>>0?1:0),St=K.low=St+hn,K.high=ct+pi+(St>>>0<hn>>>0?1:0)},_doFinalize:function(){var H=this._data,M=H.words,$=8*this._nDataBytes,z=8*H.sigBytes;return M[z>>>5]|=128<<24-z%32,M[30+(z+128>>>10<<5)]=Math.floor($/4294967296),M[31+(z+128>>>10<<5)]=$,H.sigBytes=4*M.length,this._process(),this._hash.toX32()},clone:function(){var H=a.clone.call(this);return H._hash=this._hash.clone(),H},blockSize:32}),i.SHA512=a._createHelper(b),i.HmacSHA512=a._createHmacHelper(b)}(),function(){var o=R,i=(g=o.x64).Word,a=g.WordArray,l=(g=o.algo).SHA512,g=g.SHA384=l.extend({_doReset:function(){this._hash=new a.init([new i.init(3418070365,3238371032),new i.init(1654270250,914150663),new i.init(2438529370,812702999),new i.init(355462360,4144912697),new i.init(1731405415,4290775857),new i.init(2394180231,1750603025),new i.init(3675008525,1694076839),new i.init(1203062813,3204075428)])},_doFinalize:function(){var T=l._doFinalize.call(this);return T.sigBytes-=16,T}});o.SHA384=l._createHelper(g),o.HmacSHA384=l._createHmacHelper(g)}();/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */var V,j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function B(o){var i,a,l="";for(i=0;i+3<=o.length;i+=3)a=parseInt(o.substring(i,i+3),16),l+=j.charAt(a>>6)+j.charAt(63&a);for(i+1==o.length?(a=parseInt(o.substring(i,i+1),16),l+=j.charAt(a<<2)):i+2==o.length&&(a=parseInt(o.substring(i,i+2),16),l+=j.charAt(a>>2)+j.charAt((3&a)<<4)),"=";(3&l.length)>0;)l+="=";return l}function Z(o){var i,a,l,g="",b=0;for(i=0;i<o.length&&o.charAt(i)!="=";++i)(l=j.indexOf(o.charAt(i)))<0||(b==0?(g+=se(l>>2),a=3&l,b=1):b==1?(g+=se(a<<2|l>>4),a=15&l,b=2):b==2?(g+=se(a),g+=se(l>>2),a=3&l,b=3):(g+=se(a<<2|l>>4),g+=se(15&l),b=0));return b==1&&(g+=se(a<<2)),g}function Y(o){var i,a=Z(o),l=new Array;for(i=0;2*i<a.length;++i)l[i]=parseInt(a.substring(2*i,2*i+2),16);return l}function O(o,i,a){o!=null&&(typeof o=="number"?this.fromNumber(o,i,a):i==null&&typeof o!="string"?this.fromString(o,256):this.fromString(o,i))}function oe(){return new O(null)}P.appName=="Microsoft Internet Explorer"?(O.prototype.am=function(i,a,l,g,b,T){for(var D=32767&a,x=a>>15;--T>=0;){var U=32767&this[i],H=this[i++]>>15,M=x*U+H*D;b=((U=D*U+((32767&M)<<15)+l[g]+(1073741823&b))>>>30)+(M>>>15)+x*H+(b>>>30),l[g++]=1073741823&U}return b},V=30):P.appName!="Netscape"?(O.prototype.am=function(i,a,l,g,b,T){for(;--T>=0;){var D=a*this[i++]+l[g]+b;b=Math.floor(D/67108864),l[g++]=67108863&D}return b},V=26):(O.prototype.am=function(i,a,l,g,b,T){for(var D=16383&a,x=a>>14;--T>=0;){var U=16383&this[i],H=this[i++]>>14,M=x*U+H*D;b=((U=D*U+((16383&M)<<14)+l[g]+b)>>28)+(M>>14)+x*H,l[g++]=268435455&U}return b},V=28),O.prototype.DB=V,O.prototype.DM=(1<<V)-1,O.prototype.DV=1<<V,O.prototype.FV=Math.pow(2,52),O.prototype.F1=52-V,O.prototype.F2=2*V-52;var _e,ke,G=new Array;for(_e="0".charCodeAt(0),ke=0;ke<=9;++ke)G[_e++]=ke;for(_e="a".charCodeAt(0),ke=10;ke<36;++ke)G[_e++]=ke;for(_e="A".charCodeAt(0),ke=10;ke<36;++ke)G[_e++]=ke;function se(o){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(o)}function ve(o,i){var a=G[o.charCodeAt(i)];return a==null?-1:a}function Re(o){var i=oe();return i.fromInt(o),i}function Oe(o){var i,a=1;return(i=o>>>16)!=0&&(o=i,a+=16),(i=o>>8)!=0&&(o=i,a+=8),(i=o>>4)!=0&&(o=i,a+=4),(i=o>>2)!=0&&(o=i,a+=2),(i=o>>1)!=0&&(o=i,a+=1),a}function ge(o){this.m=o}function Ue(o){this.m=o,this.mp=o.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<o.DB-15)-1,this.mt2=2*o.t}function qe(o,i){return o&i}function rt(o,i){return o|i}function ht(o,i){return o^i}function mt(o,i){return o&~i}function At(o){if(o==0)return-1;var i=0;return(65535&o)==0&&(o>>=16,i+=16),(255&o)==0&&(o>>=8,i+=8),(15&o)==0&&(o>>=4,i+=4),(3&o)==0&&(o>>=2,i+=2),(1&o)==0&&++i,i}function Wt(o){for(var i=0;o!=0;)o&=o-1,++i;return i}function st(){}function ce(o){return o}function Ee(o){this.r2=oe(),this.q3=oe(),O.ONE.dlShiftTo(2*o.t,this.r2),this.mu=this.r2.divide(o),this.m=o}ge.prototype.convert=function(i){return i.s<0||i.compareTo(this.m)>=0?i.mod(this.m):i},ge.prototype.revert=function(i){return i},ge.prototype.reduce=function(i){i.divRemTo(this.m,null,i)},ge.prototype.mulTo=function(i,a,l){i.multiplyTo(a,l),this.reduce(l)},ge.prototype.sqrTo=function(i,a){i.squareTo(a),this.reduce(a)},Ue.prototype.convert=function(i){var a=oe();return i.abs().dlShiftTo(this.m.t,a),a.divRemTo(this.m,null,a),i.s<0&&a.compareTo(O.ZERO)>0&&this.m.subTo(a,a),a},Ue.prototype.revert=function(i){var a=oe();return i.copyTo(a),this.reduce(a),a},Ue.prototype.reduce=function(i){for(;i.t<=this.mt2;)i[i.t++]=0;for(var a=0;a<this.m.t;++a){var l=32767&i[a],g=l*this.mpl+((l*this.mph+(i[a]>>15)*this.mpl&this.um)<<15)&i.DM;for(i[l=a+this.m.t]+=this.m.am(0,g,i,a,0,this.m.t);i[l]>=i.DV;)i[l]-=i.DV,i[++l]++}i.clamp(),i.drShiftTo(this.m.t,i),i.compareTo(this.m)>=0&&i.subTo(this.m,i)},Ue.prototype.mulTo=function(i,a,l){i.multiplyTo(a,l),this.reduce(l)},Ue.prototype.sqrTo=function(i,a){i.squareTo(a),this.reduce(a)},O.prototype.copyTo=function(i){for(var a=this.t-1;a>=0;--a)i[a]=this[a];i.t=this.t,i.s=this.s},O.prototype.fromInt=function(i){this.t=1,this.s=i<0?-1:0,i>0?this[0]=i:i<-1?this[0]=i+this.DV:this.t=0},O.prototype.fromString=function(i,a){var l;if(a==16)l=4;else if(a==8)l=3;else if(a==256)l=8;else if(a==2)l=1;else if(a==32)l=5;else{if(a!=4)return void this.fromRadix(i,a);l=2}this.t=0,this.s=0;for(var g=i.length,b=!1,T=0;--g>=0;){var D=l==8?255&i[g]:ve(i,g);D<0?i.charAt(g)=="-"&&(b=!0):(b=!1,T==0?this[this.t++]=D:T+l>this.DB?(this[this.t-1]|=(D&(1<<this.DB-T)-1)<<T,this[this.t++]=D>>this.DB-T):this[this.t-1]|=D<<T,(T+=l)>=this.DB&&(T-=this.DB))}l==8&&(128&i[0])!=0&&(this.s=-1,T>0&&(this[this.t-1]|=(1<<this.DB-T)-1<<T)),this.clamp(),b&&O.ZERO.subTo(this,this)},O.prototype.clamp=function(){for(var i=this.s&this.DM;this.t>0&&this[this.t-1]==i;)--this.t},O.prototype.dlShiftTo=function(i,a){var l;for(l=this.t-1;l>=0;--l)a[l+i]=this[l];for(l=i-1;l>=0;--l)a[l]=0;a.t=this.t+i,a.s=this.s},O.prototype.drShiftTo=function(i,a){for(var l=i;l<this.t;++l)a[l-i]=this[l];a.t=Math.max(this.t-i,0),a.s=this.s},O.prototype.lShiftTo=function(i,a){var l,g=i%this.DB,b=this.DB-g,T=(1<<b)-1,D=Math.floor(i/this.DB),x=this.s<<g&this.DM;for(l=this.t-1;l>=0;--l)a[l+D+1]=this[l]>>b|x,x=(this[l]&T)<<g;for(l=D-1;l>=0;--l)a[l]=0;a[D]=x,a.t=this.t+D+1,a.s=this.s,a.clamp()},O.prototype.rShiftTo=function(i,a){a.s=this.s;var l=Math.floor(i/this.DB);if(l>=this.t)a.t=0;else{var g=i%this.DB,b=this.DB-g,T=(1<<g)-1;a[0]=this[l]>>g;for(var D=l+1;D<this.t;++D)a[D-l-1]|=(this[D]&T)<<b,a[D-l]=this[D]>>g;g>0&&(a[this.t-l-1]|=(this.s&T)<<b),a.t=this.t-l,a.clamp()}},O.prototype.subTo=function(i,a){for(var l=0,g=0,b=Math.min(i.t,this.t);l<b;)g+=this[l]-i[l],a[l++]=g&this.DM,g>>=this.DB;if(i.t<this.t){for(g-=i.s;l<this.t;)g+=this[l],a[l++]=g&this.DM,g>>=this.DB;g+=this.s}else{for(g+=this.s;l<i.t;)g-=i[l],a[l++]=g&this.DM,g>>=this.DB;g-=i.s}a.s=g<0?-1:0,g<-1?a[l++]=this.DV+g:g>0&&(a[l++]=g),a.t=l,a.clamp()},O.prototype.multiplyTo=function(i,a){var l=this.abs(),g=i.abs(),b=l.t;for(a.t=b+g.t;--b>=0;)a[b]=0;for(b=0;b<g.t;++b)a[b+l.t]=l.am(0,g[b],a,b,0,l.t);a.s=0,a.clamp(),this.s!=i.s&&O.ZERO.subTo(a,a)},O.prototype.squareTo=function(i){for(var a=this.abs(),l=i.t=2*a.t;--l>=0;)i[l]=0;for(l=0;l<a.t-1;++l){var g=a.am(l,a[l],i,2*l,0,1);(i[l+a.t]+=a.am(l+1,2*a[l],i,2*l+1,g,a.t-l-1))>=a.DV&&(i[l+a.t]-=a.DV,i[l+a.t+1]=1)}i.t>0&&(i[i.t-1]+=a.am(l,a[l],i,2*l,0,1)),i.s=0,i.clamp()},O.prototype.divRemTo=function(i,a,l){var g=i.abs();if(!(g.t<=0)){var b=this.abs();if(b.t<g.t)return a!=null&&a.fromInt(0),void(l!=null&&this.copyTo(l));l==null&&(l=oe());var T=oe(),D=this.s,x=i.s,U=this.DB-Oe(g[g.t-1]);U>0?(g.lShiftTo(U,T),b.lShiftTo(U,l)):(g.copyTo(T),b.copyTo(l));var H=T.t,M=T[H-1];if(M!=0){var $=M*(1<<this.F1)+(H>1?T[H-2]>>this.F2:0),z=this.FV/$,X=(1<<this.F1)/$,te=1<<this.F2,re=l.t,k=re-H,N=a==null?oe():a;for(T.dlShiftTo(k,N),l.compareTo(N)>=0&&(l[l.t++]=1,l.subTo(N,l)),O.ONE.dlShiftTo(H,N),N.subTo(T,T);T.t<H;)T[T.t++]=0;for(;--k>=0;){var K=l[--re]==M?this.DM:Math.floor(l[re]*z+(l[re-1]+te)*X);if((l[re]+=T.am(0,K,l,k,0,H))<K)for(T.dlShiftTo(k,N),l.subTo(N,l);l[re]<--K;)l.subTo(N,l)}a!=null&&(l.drShiftTo(H,a),D!=x&&O.ZERO.subTo(a,a)),l.t=H,l.clamp(),U>0&&l.rShiftTo(U,l),D<0&&O.ZERO.subTo(l,l)}}},O.prototype.invDigit=function(){if(this.t<1)return 0;var i=this[0];if((1&i)==0)return 0;var a=3&i;return(a=(a=(a=(a=a*(2-(15&i)*a)&15)*(2-(255&i)*a)&255)*(2-((65535&i)*a&65535))&65535)*(2-i*a%this.DV)%this.DV)>0?this.DV-a:-a},O.prototype.isEven=function(){return(this.t>0?1&this[0]:this.s)==0},O.prototype.exp=function(i,a){if(i>4294967295||i<1)return O.ONE;var l=oe(),g=oe(),b=a.convert(this),T=Oe(i)-1;for(b.copyTo(l);--T>=0;)if(a.sqrTo(l,g),(i&1<<T)>0)a.mulTo(g,b,l);else{var D=l;l=g,g=D}return a.revert(l)},O.prototype.toString=function(i){if(this.s<0)return"-"+this.negate().toString(i);var a;if(i==16)a=4;else if(i==8)a=3;else if(i==2)a=1;else if(i==32)a=5;else{if(i!=4)return this.toRadix(i);a=2}var l,g=(1<<a)-1,b=!1,T="",D=this.t,x=this.DB-D*this.DB%a;if(D-- >0)for(x<this.DB&&(l=this[D]>>x)>0&&(b=!0,T=se(l));D>=0;)x<a?(l=(this[D]&(1<<x)-1)<<a-x,l|=this[--D]>>(x+=this.DB-a)):(l=this[D]>>(x-=a)&g,x<=0&&(x+=this.DB,--D)),l>0&&(b=!0),b&&(T+=se(l));return b?T:"0"},O.prototype.negate=function(){var i=oe();return O.ZERO.subTo(this,i),i},O.prototype.abs=function(){return this.s<0?this.negate():this},O.prototype.compareTo=function(i){var a=this.s-i.s;if(a!=0)return a;var l=this.t;if((a=l-i.t)!=0)return this.s<0?-a:a;for(;--l>=0;)if((a=this[l]-i[l])!=0)return a;return 0},O.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+Oe(this[this.t-1]^this.s&this.DM)},O.prototype.mod=function(i){var a=oe();return this.abs().divRemTo(i,null,a),this.s<0&&a.compareTo(O.ZERO)>0&&i.subTo(a,a),a},O.prototype.modPowInt=function(i,a){var l;return l=i<256||a.isEven()?new ge(a):new Ue(a),this.exp(i,l)},O.ZERO=Re(0),O.ONE=Re(1),st.prototype.convert=ce,st.prototype.revert=ce,st.prototype.mulTo=function(i,a,l){i.multiplyTo(a,l)},st.prototype.sqrTo=function(i,a){i.squareTo(a)},Ee.prototype.convert=function(i){if(i.s<0||i.t>2*this.m.t)return i.mod(this.m);if(i.compareTo(this.m)<0)return i;var a=oe();return i.copyTo(a),this.reduce(a),a},Ee.prototype.revert=function(i){return i},Ee.prototype.reduce=function(i){for(i.drShiftTo(this.m.t-1,this.r2),i.t>this.m.t+1&&(i.t=this.m.t+1,i.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);i.compareTo(this.r2)<0;)i.dAddOffset(1,this.m.t+1);for(i.subTo(this.r2,i);i.compareTo(this.m)>=0;)i.subTo(this.m,i)},Ee.prototype.mulTo=function(i,a,l){i.multiplyTo(a,l),this.reduce(l)},Ee.prototype.sqrTo=function(i,a){i.squareTo(a),this.reduce(a)};var He=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],J=(1<<26)/He[He.length-1];/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function w(){this.i=0,this.j=0,this.S=new Array}O.prototype.chunkSize=function(i){return Math.floor(Math.LN2*this.DB/Math.log(i))},O.prototype.toRadix=function(i){if(i==null&&(i=10),this.signum()==0||i<2||i>36)return"0";var a=this.chunkSize(i),l=Math.pow(i,a),g=Re(l),b=oe(),T=oe(),D="";for(this.divRemTo(g,b,T);b.signum()>0;)D=(l+T.intValue()).toString(i).substr(1)+D,b.divRemTo(g,b,T);return T.intValue().toString(i)+D},O.prototype.fromRadix=function(i,a){this.fromInt(0),a==null&&(a=10);for(var l=this.chunkSize(a),g=Math.pow(a,l),b=!1,T=0,D=0,x=0;x<i.length;++x){var U=ve(i,x);U<0?i.charAt(x)=="-"&&this.signum()==0&&(b=!0):(D=a*D+U,++T>=l&&(this.dMultiply(g),this.dAddOffset(D,0),T=0,D=0))}T>0&&(this.dMultiply(Math.pow(a,T)),this.dAddOffset(D,0)),b&&O.ZERO.subTo(this,this)},O.prototype.fromNumber=function(i,a,l){if(typeof a=="number")if(i<2)this.fromInt(1);else for(this.fromNumber(i,l),this.testBit(i-1)||this.bitwiseTo(O.ONE.shiftLeft(i-1),rt,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(a);)this.dAddOffset(2,0),this.bitLength()>i&&this.subTo(O.ONE.shiftLeft(i-1),this);else{var g=new Array,b=7&i;g.length=1+(i>>3),a.nextBytes(g),b>0?g[0]&=(1<<b)-1:g[0]=0,this.fromString(g,256)}},O.prototype.bitwiseTo=function(i,a,l){var g,b,T=Math.min(i.t,this.t);for(g=0;g<T;++g)l[g]=a(this[g],i[g]);if(i.t<this.t){for(b=i.s&this.DM,g=T;g<this.t;++g)l[g]=a(this[g],b);l.t=this.t}else{for(b=this.s&this.DM,g=T;g<i.t;++g)l[g]=a(b,i[g]);l.t=i.t}l.s=a(this.s,i.s),l.clamp()},O.prototype.changeBit=function(i,a){var l=O.ONE.shiftLeft(i);return this.bitwiseTo(l,a,l),l},O.prototype.addTo=function(i,a){for(var l=0,g=0,b=Math.min(i.t,this.t);l<b;)g+=this[l]+i[l],a[l++]=g&this.DM,g>>=this.DB;if(i.t<this.t){for(g+=i.s;l<this.t;)g+=this[l],a[l++]=g&this.DM,g>>=this.DB;g+=this.s}else{for(g+=this.s;l<i.t;)g+=i[l],a[l++]=g&this.DM,g>>=this.DB;g+=i.s}a.s=g<0?-1:0,g>0?a[l++]=g:g<-1&&(a[l++]=this.DV+g),a.t=l,a.clamp()},O.prototype.dMultiply=function(i){this[this.t]=this.am(0,i-1,this,0,0,this.t),++this.t,this.clamp()},O.prototype.dAddOffset=function(i,a){if(i!=0){for(;this.t<=a;)this[this.t++]=0;for(this[a]+=i;this[a]>=this.DV;)this[a]-=this.DV,++a>=this.t&&(this[this.t++]=0),++this[a]}},O.prototype.multiplyLowerTo=function(i,a,l){var g,b=Math.min(this.t+i.t,a);for(l.s=0,l.t=b;b>0;)l[--b]=0;for(g=l.t-this.t;b<g;++b)l[b+this.t]=this.am(0,i[b],l,b,0,this.t);for(g=Math.min(i.t,a);b<g;++b)this.am(0,i[b],l,b,0,a-b);l.clamp()},O.prototype.multiplyUpperTo=function(i,a,l){--a;var g=l.t=this.t+i.t-a;for(l.s=0;--g>=0;)l[g]=0;for(g=Math.max(a-this.t,0);g<i.t;++g)l[this.t+g-a]=this.am(a-g,i[g],l,0,0,this.t+g-a);l.clamp(),l.drShiftTo(1,l)},O.prototype.modInt=function(i){if(i<=0)return 0;var a=this.DV%i,l=this.s<0?i-1:0;if(this.t>0)if(a==0)l=this[0]%i;else for(var g=this.t-1;g>=0;--g)l=(a*l+this[g])%i;return l},O.prototype.millerRabin=function(i){var a=this.subtract(O.ONE),l=a.getLowestSetBit();if(l<=0)return!1;var g=a.shiftRight(l);(i=i+1>>1)>He.length&&(i=He.length);for(var b=oe(),T=0;T<i;++T){b.fromInt(He[Math.floor(Math.random()*He.length)]);var D=b.modPow(g,this);if(D.compareTo(O.ONE)!=0&&D.compareTo(a)!=0){for(var x=1;x++<l&&D.compareTo(a)!=0;)if((D=D.modPowInt(2,this)).compareTo(O.ONE)==0)return!1;if(D.compareTo(a)!=0)return!1}}return!0},O.prototype.clone=function(){var i=oe();return this.copyTo(i),i},O.prototype.intValue=function(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},O.prototype.byteValue=function(){return this.t==0?this.s:this[0]<<24>>24},O.prototype.shortValue=function(){return this.t==0?this.s:this[0]<<16>>16},O.prototype.signum=function(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1},O.prototype.toByteArray=function(){var i=this.t,a=new Array;a[0]=this.s;var l,g=this.DB-i*this.DB%8,b=0;if(i-- >0)for(g<this.DB&&(l=this[i]>>g)!=(this.s&this.DM)>>g&&(a[b++]=l|this.s<<this.DB-g);i>=0;)g<8?(l=(this[i]&(1<<g)-1)<<8-g,l|=this[--i]>>(g+=this.DB-8)):(l=this[i]>>(g-=8)&255,g<=0&&(g+=this.DB,--i)),(128&l)!=0&&(l|=-256),b==0&&(128&this.s)!=(128&l)&&++b,(b>0||l!=this.s)&&(a[b++]=l);return a},O.prototype.equals=function(i){return this.compareTo(i)==0},O.prototype.min=function(i){return this.compareTo(i)<0?this:i},O.prototype.max=function(i){return this.compareTo(i)>0?this:i},O.prototype.and=function(i){var a=oe();return this.bitwiseTo(i,qe,a),a},O.prototype.or=function(i){var a=oe();return this.bitwiseTo(i,rt,a),a},O.prototype.xor=function(i){var a=oe();return this.bitwiseTo(i,ht,a),a},O.prototype.andNot=function(i){var a=oe();return this.bitwiseTo(i,mt,a),a},O.prototype.not=function(){for(var i=oe(),a=0;a<this.t;++a)i[a]=this.DM&~this[a];return i.t=this.t,i.s=~this.s,i},O.prototype.shiftLeft=function(i){var a=oe();return i<0?this.rShiftTo(-i,a):this.lShiftTo(i,a),a},O.prototype.shiftRight=function(i){var a=oe();return i<0?this.lShiftTo(-i,a):this.rShiftTo(i,a),a},O.prototype.getLowestSetBit=function(){for(var i=0;i<this.t;++i)if(this[i]!=0)return i*this.DB+At(this[i]);return this.s<0?this.t*this.DB:-1},O.prototype.bitCount=function(){for(var i=0,a=this.s&this.DM,l=0;l<this.t;++l)i+=Wt(this[l]^a);return i},O.prototype.testBit=function(i){var a=Math.floor(i/this.DB);return a>=this.t?this.s!=0:(this[a]&1<<i%this.DB)!=0},O.prototype.setBit=function(i){return this.changeBit(i,rt)},O.prototype.clearBit=function(i){return this.changeBit(i,mt)},O.prototype.flipBit=function(i){return this.changeBit(i,ht)},O.prototype.add=function(i){var a=oe();return this.addTo(i,a),a},O.prototype.subtract=function(i){var a=oe();return this.subTo(i,a),a},O.prototype.multiply=function(i){var a=oe();return this.multiplyTo(i,a),a},O.prototype.divide=function(i){var a=oe();return this.divRemTo(i,a,null),a},O.prototype.remainder=function(i){var a=oe();return this.divRemTo(i,null,a),a},O.prototype.divideAndRemainder=function(i){var a=oe(),l=oe();return this.divRemTo(i,a,l),new Array(a,l)},O.prototype.modPow=function(i,a){var l,g,b=i.bitLength(),T=Re(1);if(b<=0)return T;l=b<18?1:b<48?3:b<144?4:b<768?5:6,g=b<8?new ge(a):a.isEven()?new Ee(a):new Ue(a);var D=new Array,x=3,U=l-1,H=(1<<l)-1;if(D[1]=g.convert(this),l>1){var M=oe();for(g.sqrTo(D[1],M);x<=H;)D[x]=oe(),g.mulTo(M,D[x-2],D[x]),x+=2}var $,z,X=i.t-1,te=!0,re=oe();for(b=Oe(i[X])-1;X>=0;){for(b>=U?$=i[X]>>b-U&H:($=(i[X]&(1<<b+1)-1)<<U-b,X>0&&($|=i[X-1]>>this.DB+b-U)),x=l;(1&$)==0;)$>>=1,--x;if((b-=x)<0&&(b+=this.DB,--X),te)D[$].copyTo(T),te=!1;else{for(;x>1;)g.sqrTo(T,re),g.sqrTo(re,T),x-=2;x>0?g.sqrTo(T,re):(z=T,T=re,re=z),g.mulTo(re,D[$],T)}for(;X>=0&&(i[X]&1<<b)==0;)g.sqrTo(T,re),z=T,T=re,re=z,--b<0&&(b=this.DB-1,--X)}return g.revert(T)},O.prototype.modInverse=function(i){var a=i.isEven();if(this.isEven()&&a||i.signum()==0)return O.ZERO;for(var l=i.clone(),g=this.clone(),b=Re(1),T=Re(0),D=Re(0),x=Re(1);l.signum()!=0;){for(;l.isEven();)l.rShiftTo(1,l),a?(b.isEven()&&T.isEven()||(b.addTo(this,b),T.subTo(i,T)),b.rShiftTo(1,b)):T.isEven()||T.subTo(i,T),T.rShiftTo(1,T);for(;g.isEven();)g.rShiftTo(1,g),a?(D.isEven()&&x.isEven()||(D.addTo(this,D),x.subTo(i,x)),D.rShiftTo(1,D)):x.isEven()||x.subTo(i,x),x.rShiftTo(1,x);l.compareTo(g)>=0?(l.subTo(g,l),a&&b.subTo(D,b),T.subTo(x,T)):(g.subTo(l,g),a&&D.subTo(b,D),x.subTo(T,x))}return g.compareTo(O.ONE)!=0?O.ZERO:x.compareTo(i)>=0?x.subtract(i):x.signum()<0?(x.addTo(i,x),x.signum()<0?x.add(i):x):x},O.prototype.pow=function(i){return this.exp(i,new st)},O.prototype.gcd=function(i){var a=this.s<0?this.negate():this.clone(),l=i.s<0?i.negate():i.clone();if(a.compareTo(l)<0){var g=a;a=l,l=g}var b=a.getLowestSetBit(),T=l.getLowestSetBit();if(T<0)return a;for(b<T&&(T=b),T>0&&(a.rShiftTo(T,a),l.rShiftTo(T,l));a.signum()>0;)(b=a.getLowestSetBit())>0&&a.rShiftTo(b,a),(b=l.getLowestSetBit())>0&&l.rShiftTo(b,l),a.compareTo(l)>=0?(a.subTo(l,a),a.rShiftTo(1,a)):(l.subTo(a,l),l.rShiftTo(1,l));return T>0&&l.lShiftTo(T,l),l},O.prototype.isProbablePrime=function(i){var a,l=this.abs();if(l.t==1&&l[0]<=He[He.length-1]){for(a=0;a<He.length;++a)if(l[0]==He[a])return!0;return!1}if(l.isEven())return!1;for(a=1;a<He.length;){for(var g=He[a],b=a+1;b<He.length&&g<J;)g*=He[b++];for(g=l.modInt(g);a<b;)if(g%He[a++]==0)return!1}return l.millerRabin(i)},O.prototype.square=function(){var i=oe();return this.squareTo(i),i},w.prototype.init=function(i){var a,l,g;for(a=0;a<256;++a)this.S[a]=a;for(l=0,a=0;a<256;++a)l=l+this.S[a]+i[a%i.length]&255,g=this.S[a],this.S[a]=this.S[l],this.S[l]=g;this.i=0,this.j=0},w.prototype.next=function(){var i;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,i=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=i,this.S[i+this.S[this.i]&255]};var S,L,q;/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function ee(){(function(i){L[q++]^=255&i,L[q++]^=i>>8&255,L[q++]^=i>>16&255,L[q++]^=i>>24&255,q>=256&&(q-=256)})(new Date().getTime())}if(L==null){var ie;if(L=new Array,q=0,C!==void 0&&(C.crypto!==void 0||C.msCrypto!==void 0)){var we=C.crypto||C.msCrypto;if(we.getRandomValues){var Ce=new Uint8Array(32);for(we.getRandomValues(Ce),ie=0;ie<32;++ie)L[q++]=Ce[ie]}else if(P.appName=="Netscape"&&P.appVersion<"5"){var Be=C.crypto.random(32);for(ie=0;ie<Be.length;++ie)L[q++]=255&Be.charCodeAt(ie)}}for(;q<256;)ie=Math.floor(65536*Math.random()),L[q++]=ie>>>8,L[q++]=255&ie;q=0,ee()}function Ke(){if(S==null){for(ee(),(S=function(){return new w}()).init(L),q=0;q<L.length;++q)L[q]=0;q=0}return S.next()}function Ge(){}/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function Vt(o,i){return new O(o,i)}function ur(o,i,a){for(var l="",g=0;l.length<i;)l+=a(String.fromCharCode.apply(String,o.concat([(4278190080&g)>>24,(16711680&g)>>16,(65280&g)>>8,255&g]))),g+=1;return l}function Fe(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}/*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
 */function ot(o,i){this.x=i,this.q=o}function Le(o,i,a,l){this.curve=o,this.x=i,this.y=a,this.z=l==null?O.ONE:l,this.zinv=null}function er(o,i,a){this.q=o,this.a=this.fromBigInteger(i),this.b=this.fromBigInteger(a),this.infinity=new Le(this,null,null)}Ge.prototype.nextBytes=function(i){var a;for(a=0;a<i.length;++a)i[a]=Ke()},Fe.prototype.doPublic=function(i){return i.modPowInt(this.e,this.n)},Fe.prototype.setPublic=function(i,a){if(this.isPublic=!0,this.isPrivate=!1,typeof i!="string")this.n=i,this.e=a;else{if(!(i!=null&&a!=null&&i.length>0&&a.length>0))throw"Invalid RSA public key";this.n=Vt(i,16),this.e=parseInt(a,16)}},Fe.prototype.encrypt=function(i){var a=function(T,D){if(D<T.length+11)throw"Message too long for RSA";for(var x=new Array,U=T.length-1;U>=0&&D>0;){var H=T.charCodeAt(U--);H<128?x[--D]=H:H>127&&H<2048?(x[--D]=63&H|128,x[--D]=H>>6|192):(x[--D]=63&H|128,x[--D]=H>>6&63|128,x[--D]=H>>12|224)}x[--D]=0;for(var M=new Ge,$=new Array;D>2;){for($[0]=0;$[0]==0;)M.nextBytes($);x[--D]=$[0]}return x[--D]=2,x[--D]=0,new O(x)}(i,this.n.bitLength()+7>>3);if(a==null)return null;var l=this.doPublic(a);if(l==null)return null;var g=l.toString(16);return(1&g.length)==0?g:"0"+g},Fe.prototype.encryptOAEP=function(i,a,l){var g=function(x,U,H,M){var $=I.crypto.MessageDigest,z=I.crypto.Util,X=null;if(H||(H="sha1"),typeof H=="string"&&(X=$.getCanonicalAlgName(H),M=$.getHashLength(X),H=function(ae){return tr(z.hashHex(hr(ae),X))}),x.length+2*M+2>U)throw"Message too long for RSA";var te,re="";for(te=0;te<U-x.length-2*M-2;te+=1)re+="\0";var k=H("")+re+""+x,N=new Array(M);new Ge().nextBytes(N);var K=ur(N,k.length,H),W=[];for(te=0;te<k.length;te+=1)W[te]=k.charCodeAt(te)^K.charCodeAt(te);var Q=ur(W,N.length,H),ne=[0];for(te=0;te<N.length;te+=1)ne[te+1]=N[te]^Q.charCodeAt(te);return new O(ne.concat(W))}(i,this.n.bitLength()+7>>3,a,l);if(g==null)return null;var b=this.doPublic(g);if(b==null)return null;var T=b.toString(16);return(1&T.length)==0?T:"0"+T},Fe.prototype.type="RSA",ot.prototype.equals=function(i){return i==this||this.q.equals(i.q)&&this.x.equals(i.x)},ot.prototype.toBigInteger=function(){return this.x},ot.prototype.negate=function(){return new ot(this.q,this.x.negate().mod(this.q))},ot.prototype.add=function(i){return new ot(this.q,this.x.add(i.toBigInteger()).mod(this.q))},ot.prototype.subtract=function(i){return new ot(this.q,this.x.subtract(i.toBigInteger()).mod(this.q))},ot.prototype.multiply=function(i){return new ot(this.q,this.x.multiply(i.toBigInteger()).mod(this.q))},ot.prototype.square=function(){return new ot(this.q,this.x.square().mod(this.q))},ot.prototype.divide=function(i){return new ot(this.q,this.x.multiply(i.toBigInteger().modInverse(this.q)).mod(this.q))},Le.prototype.getX=function(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))},Le.prototype.getY=function(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))},Le.prototype.equals=function(i){return i==this||(this.isInfinity()?i.isInfinity():i.isInfinity()?this.isInfinity():!!i.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(i.z)).mod(this.curve.q).equals(O.ZERO)&&i.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(i.z)).mod(this.curve.q).equals(O.ZERO))},Le.prototype.isInfinity=function(){return this.x==null&&this.y==null||this.z.equals(O.ZERO)&&!this.y.toBigInteger().equals(O.ZERO)},Le.prototype.negate=function(){return new Le(this.curve,this.x,this.y.negate(),this.z)},Le.prototype.add=function(i){if(this.isInfinity())return i;if(i.isInfinity())return this;var a=i.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(i.z)).mod(this.curve.q),l=i.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(i.z)).mod(this.curve.q);if(O.ZERO.equals(l))return O.ZERO.equals(a)?this.twice():this.curve.getInfinity();var g=new O("3"),b=this.x.toBigInteger(),T=this.y.toBigInteger(),D=(i.x.toBigInteger(),i.y.toBigInteger(),l.square()),x=D.multiply(l),U=b.multiply(D),H=a.square().multiply(this.z),M=H.subtract(U.shiftLeft(1)).multiply(i.z).subtract(x).multiply(l).mod(this.curve.q),$=U.multiply(g).multiply(a).subtract(T.multiply(x)).subtract(H.multiply(a)).multiply(i.z).add(a.multiply(x)).mod(this.curve.q),z=x.multiply(this.z).multiply(i.z).mod(this.curve.q);return new Le(this.curve,this.curve.fromBigInteger(M),this.curve.fromBigInteger($),z)},Le.prototype.twice=function(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var i=new O("3"),a=this.x.toBigInteger(),l=this.y.toBigInteger(),g=l.multiply(this.z),b=g.multiply(l).mod(this.curve.q),T=this.curve.a.toBigInteger(),D=a.square().multiply(i);O.ZERO.equals(T)||(D=D.add(this.z.square().multiply(T)));var x=(D=D.mod(this.curve.q)).square().subtract(a.shiftLeft(3).multiply(b)).shiftLeft(1).multiply(g).mod(this.curve.q),U=D.multiply(i).multiply(a).subtract(b.shiftLeft(1)).shiftLeft(2).multiply(b).subtract(D.square().multiply(D)).mod(this.curve.q),H=g.square().multiply(g).shiftLeft(3).mod(this.curve.q);return new Le(this.curve,this.curve.fromBigInteger(x),this.curve.fromBigInteger(U),H)},Le.prototype.multiply=function(i){if(this.isInfinity())return this;if(i.signum()==0)return this.curve.getInfinity();var a,l=i,g=l.multiply(new O("3")),b=this.negate(),T=this,D=this.curve.q.subtract(i),x=D.multiply(new O("3")),U=new Le(this.curve,this.x,this.y),H=U.negate();for(a=g.bitLength()-2;a>0;--a){T=T.twice();var M=g.testBit(a);M!=l.testBit(a)&&(T=T.add(M?this:b))}for(a=x.bitLength()-2;a>0;--a){U=U.twice();var $=x.testBit(a);$!=D.testBit(a)&&(U=U.add($?U:H))}return T},Le.prototype.multiplyTwo=function(i,a,l){var g;g=i.bitLength()>l.bitLength()?i.bitLength()-1:l.bitLength()-1;for(var b=this.curve.getInfinity(),T=this.add(a);g>=0;)b=b.twice(),i.testBit(g)?b=l.testBit(g)?b.add(T):b.add(this):l.testBit(g)&&(b=b.add(a)),--g;return b},er.prototype.getQ=function(){return this.q},er.prototype.getA=function(){return this.a},er.prototype.getB=function(){return this.b},er.prototype.equals=function(i){return i==this||this.q.equals(i.q)&&this.a.equals(i.a)&&this.b.equals(i.b)},er.prototype.getInfinity=function(){return this.infinity},er.prototype.fromBigInteger=function(i){return new ot(this.q,i)},er.prototype.decodePointHex=function(i){switch(parseInt(i.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:return null;case 4:case 6:case 7:var a=(i.length-2)/2,l=i.substr(2,a),g=i.substr(a+2,a);return new Le(this,this.fromBigInteger(new O(l,16)),this.fromBigInteger(new O(g,16)));default:return null}},ot.prototype.getByteLength=function(){return Math.floor((this.toBigInteger().bitLength()+7)/8)},Le.prototype.getEncoded=function(o){var i=function(T,D){var x=T.toByteArrayUnsigned();if(D<x.length)x=x.slice(x.length-D);else for(;D>x.length;)x.unshift(0);return x},a=this.getX().toBigInteger(),l=this.getY().toBigInteger(),g=i(a,32);return o?l.isEven()?g.unshift(2):g.unshift(3):(g.unshift(4),g=g.concat(i(l,32))),g},Le.decodeFrom=function(o,i){i[0];var a=i.length-1,l=i.slice(1,1+a/2),g=i.slice(1+a/2,1+a);l.unshift(0),g.unshift(0);var b=new O(l),T=new O(g);return new Le(o,o.fromBigInteger(b),o.fromBigInteger(T))},Le.decodeFromHex=function(o,i){i.substr(0,2);var a=i.length-2,l=i.substr(2,a/2),g=i.substr(2+a/2,a/2),b=new O(l,16),T=new O(g,16);return new Le(o,o.fromBigInteger(b),o.fromBigInteger(T))},Le.prototype.add2D=function(o){if(this.isInfinity())return o;if(o.isInfinity())return this;if(this.x.equals(o.x))return this.y.equals(o.y)?this.twice():this.curve.getInfinity();var i=o.x.subtract(this.x),a=o.y.subtract(this.y).divide(i),l=a.square().subtract(this.x).subtract(o.x),g=a.multiply(this.x.subtract(l)).subtract(this.y);return new Le(this.curve,l,g)},Le.prototype.twice2D=function(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var o=this.curve.fromBigInteger(O.valueOf(2)),i=this.curve.fromBigInteger(O.valueOf(3)),a=this.x.square().multiply(i).add(this.curve.a).divide(this.y.multiply(o)),l=a.square().subtract(this.x.multiply(o)),g=a.multiply(this.x.subtract(l)).subtract(this.y);return new Le(this.curve,l,g)},Le.prototype.multiply2D=function(o){if(this.isInfinity())return this;if(o.signum()==0)return this.curve.getInfinity();var i,a=o,l=a.multiply(new O("3")),g=this.negate(),b=this;for(i=l.bitLength()-2;i>0;--i){b=b.twice();var T=l.testBit(i);T!=a.testBit(i)&&(b=b.add2D(T?this:g))}return b},Le.prototype.isOnCurve=function(){var o=this.getX().toBigInteger(),i=this.getY().toBigInteger(),a=this.curve.getA().toBigInteger(),l=this.curve.getB().toBigInteger(),g=this.curve.getQ(),b=i.multiply(i).mod(g),T=o.multiply(o).multiply(o).add(a.multiply(o)).add(l).mod(g);return b.equals(T)},Le.prototype.toString=function(){return"("+this.getX().toBigInteger().toString()+","+this.getY().toBigInteger().toString()+")"},Le.prototype.validate=function(){var o=this.curve.getQ();if(this.isInfinity())throw new Error("Point is at infinity.");var i=this.getX().toBigInteger(),a=this.getY().toBigInteger();if(i.compareTo(O.ONE)<0||i.compareTo(o.subtract(O.ONE))>0)throw new Error("x coordinate out of bounds");if(a.compareTo(O.ONE)<0||a.compareTo(o.subtract(O.ONE))>0)throw new Error("y coordinate out of bounds");if(!this.isOnCurve())throw new Error("Point is not on the curve.");if(this.multiply(o).isInfinity())throw new Error("Point is not a scalar multiple of G.");return!0};/*! Mike Samuel (c) 2009 | code.google.com/p/json-sans-eval
 */var go=function(){var o=new RegExp('(?:false|true|null|[\\{\\}\\[\\]]|(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)|(?:"(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))*"))',"g"),i=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),a={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"};function l(T,D,x){return D?a[D]:String.fromCharCode(parseInt(x,16))}var g=new String(""),b=Object.hasOwnProperty;return function(T,D){var x,U,H=T.match(o),M=H[0],$=!1;M==="{"?x={}:M==="["?x=[]:(x=[],$=!0);for(var z=[x],X=1-$,te=H.length;X<te;++X){var re;switch((M=H[X]).charCodeAt(0)){default:(re=z[0])[U||re.length]=+M,U=void 0;break;case 34:if((M=M.substring(1,M.length-1)).indexOf("\\")!==-1&&(M=M.replace(i,l)),re=z[0],!U){if(!(re instanceof Array)){U=M||g;break}U=re.length}re[U]=M,U=void 0;break;case 91:re=z[0],z.unshift(re[U||re.length]=[]),U=void 0;break;case 93:z.shift();break;case 102:(re=z[0])[U||re.length]=!1,U=void 0;break;case 110:(re=z[0])[U||re.length]=null,U=void 0;break;case 116:(re=z[0])[U||re.length]=!0,U=void 0;break;case 123:re=z[0],z.unshift(re[U||re.length]={}),U=void 0;break;case 125:z.shift()}}if($){if(z.length!==1)throw new Error;x=x[0]}else if(z.length)throw new Error;return D&&(x=function k(N,K){var W=N[K];if(W&&(W===void 0?"undefined":_(W))==="object"){var Q=null;for(var ne in W)if(b.call(W,ne)&&W!==N){var me=k(W,ne);me!==void 0?W[ne]=me:(Q||(Q=[]),Q.push(ne))}if(Q)for(var ae=Q.length;--ae>=0;)delete W[Q[ae]]}return D.call(N,K,W)}({"":x},"")),x}}();I!==void 0&&I||(r.KJUR=I={}),I.asn1!==void 0&&I.asn1||(I.asn1={}),I.asn1.ASN1Util=new function(){this.integerToByteHex=function(o){var i=o.toString(16);return i.length%2==1&&(i="0"+i),i},this.bigIntToMinTwosComplementsHex=function(o){var i=o.toString(16);if(i.substr(0,1)!="-")i.length%2==1?i="0"+i:i.match(/^[0-7]/)||(i="00"+i);else{var a=i.substr(1).length;a%2==1?a+=1:i.match(/^[0-7]/)||(a+=2);for(var l="",g=0;g<a;g++)l+="f";i=new O(l,16).xor(o).add(O.ONE).toString(16).replace(/^-/,"")}return i},this.getPEMStringFromHex=function(o,i){return $t(o,i)},this.newObject=function(o){var i=I.asn1,a=i.ASN1Object,l=i.DERBoolean,g=i.DERInteger,b=i.DERBitString,T=i.DEROctetString,D=i.DERNull,x=i.DERObjectIdentifier,U=i.DEREnumerated,H=i.DERUTF8String,M=i.DERNumericString,$=i.DERPrintableString,z=i.DERTeletexString,X=i.DERIA5String,te=i.DERUTCTime,re=i.DERGeneralizedTime,k=i.DERVisibleString,N=i.DERBMPString,K=i.DERSequence,W=i.DERSet,Q=i.DERTaggedObject,ne=i.ASN1Util.newObject;if(o instanceof i.ASN1Object)return o;var me=Object.keys(o);if(me.length!=1)throw new Error("key of param shall be only one.");var ae=me[0];if(":asn1:bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:visstr:bmpstr:seq:set:tag:".indexOf(":"+ae+":")==-1)throw new Error("undefined key: "+ae);if(ae=="bool")return new l(o[ae]);if(ae=="int")return new g(o[ae]);if(ae=="bitstr")return new b(o[ae]);if(ae=="octstr")return new T(o[ae]);if(ae=="null")return new D(o[ae]);if(ae=="oid")return new x(o[ae]);if(ae=="enum")return new U(o[ae]);if(ae=="utf8str")return new H(o[ae]);if(ae=="numstr")return new M(o[ae]);if(ae=="prnstr")return new $(o[ae]);if(ae=="telstr")return new z(o[ae]);if(ae=="ia5str")return new X(o[ae]);if(ae=="utctime")return new te(o[ae]);if(ae=="gentime")return new re(o[ae]);if(ae=="visstr")return new k(o[ae]);if(ae=="bmpstr")return new N(o[ae]);if(ae=="asn1")return new a(o[ae]);if(ae=="seq"){for(var Ne=o[ae],ye=[],Ae=0;Ae<Ne.length;Ae++){var Ze=ne(Ne[Ae]);ye.push(Ze)}return new K({array:ye})}if(ae=="set"){for(Ne=o[ae],ye=[],Ae=0;Ae<Ne.length;Ae++)Ze=ne(Ne[Ae]),ye.push(Ze);return new W({array:ye})}if(ae=="tag"){var nt=o[ae];if(Object.prototype.toString.call(nt)==="[object Array]"&&nt.length==3){var tt=ne(nt[2]);return new Q({tag:nt[0],explicit:nt[1],obj:tt})}return new Q(nt)}},this.jsonToASN1HEX=function(o){return this.newObject(o).getEncodedHex()}},I.asn1.ASN1Util.oidHexToInt=function(o){for(var i="",a=parseInt(o.substr(0,2),16),l=(i=Math.floor(a/40)+"."+a%40,""),g=2;g<o.length;g+=2){var b=("00000000"+parseInt(o.substr(g,2),16).toString(2)).slice(-8);l+=b.substr(1,7),b.substr(0,1)=="0"&&(i=i+"."+new O(l,2).toString(10),l="")}return i},I.asn1.ASN1Util.oidIntToHex=function(o){var i=function(x){var U=x.toString(16);return U.length==1&&(U="0"+U),U},a=function(x){var U="",H=new O(x,10).toString(2),M=7-H.length%7;M==7&&(M=0);for(var $="",z=0;z<M;z++)$+="0";for(H=$+H,z=0;z<H.length-1;z+=7){var X=H.substr(z,7);z!=H.length-7&&(X="1"+X),U+=i(parseInt(X,2))}return U};if(!o.match(/^[0-9.]+$/))throw"malformed oid string: "+o;var l="",g=o.split("."),b=40*parseInt(g[0])+parseInt(g[1]);l+=i(b),g.splice(0,2);for(var T=0;T<g.length;T++)l+=a(g[T]);return l},I.asn1.ASN1Object=function(o){this.params=null,this.getLengthHexFromValue=function(){if(this.hV===void 0||this.hV==null)throw new Error("this.hV is null or undefined");if(this.hV.length%2==1)throw new Error("value hex must be even length: n="+0+",v="+this.hV);var i=this.hV.length/2,a=i.toString(16);if(a.length%2==1&&(a="0"+a),i<128)return a;var l=a.length/2;if(l>15)throw"ASN.1 length too long to represent by 8x: n = "+i.toString(16);return(128+l).toString(16)+a},this.getEncodedHex=function(){return(this.hTLV==null||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getValueHex=function(){return this.getEncodedHex(),this.hV},this.getFreshValueHex=function(){return""},this.setByParam=function(i){this.params=i},o!=null&&o.tlv!=null&&(this.hTLV=o.tlv,this.isModified=!1)},I.asn1.DERAbstractString=function(o){I.asn1.DERAbstractString.superclass.constructor.call(this),this.getString=function(){return this.s},this.setString=function(i){this.hTLV=null,this.isModified=!0,this.s=i,this.hV=ci(this.s).toLowerCase()},this.setStringHex=function(i){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=i},this.getFreshValueHex=function(){return this.hV},o!==void 0&&(typeof o=="string"?this.setString(o):o.str!==void 0?this.setString(o.str):o.hex!==void 0&&this.setStringHex(o.hex))},at(I.asn1.DERAbstractString,I.asn1.ASN1Object),I.asn1.DERAbstractTime=function(o){I.asn1.DERAbstractTime.superclass.constructor.call(this),this.localDateToUTC=function(i){var a=i.getTime()+6e4*i.getTimezoneOffset();return new Date(a)},this.formatDate=function(i,a,l){var g=this.zeroPadding,b=this.localDateToUTC(i),T=String(b.getFullYear());a=="utc"&&(T=T.substr(2,2));var D=T+g(String(b.getMonth()+1),2)+g(String(b.getDate()),2)+g(String(b.getHours()),2)+g(String(b.getMinutes()),2)+g(String(b.getSeconds()),2);if(l===!0){var x=b.getMilliseconds();if(x!=0){var U=g(String(x),3);D=D+"."+(U=U.replace(/[0]+$/,""))}}return D+"Z"},this.zeroPadding=function(i,a){return i.length>=a?i:new Array(a-i.length+1).join("0")+i},this.getString=function(){return this.s},this.setString=function(i){this.hTLV=null,this.isModified=!0,this.s=i,this.hV=Sr(i)},this.setByDateValue=function(i,a,l,g,b,T){var D=new Date(Date.UTC(i,a-1,l,g,b,T,0));this.setByDate(D)},this.getFreshValueHex=function(){return this.hV}},at(I.asn1.DERAbstractTime,I.asn1.ASN1Object),I.asn1.DERAbstractStructured=function(o){I.asn1.DERAbstractString.superclass.constructor.call(this),this.setByASN1ObjectArray=function(i){this.hTLV=null,this.isModified=!0,this.asn1Array=i},this.appendASN1Object=function(i){this.hTLV=null,this.isModified=!0,this.asn1Array.push(i)},this.asn1Array=new Array,o!==void 0&&o.array!==void 0&&(this.asn1Array=o.array)},at(I.asn1.DERAbstractStructured,I.asn1.ASN1Object),I.asn1.DERBoolean=function(o){I.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",this.hTLV=o==0?"010100":"0101ff"},at(I.asn1.DERBoolean,I.asn1.ASN1Object),I.asn1.DERInteger=function(o){I.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.setByBigInteger=function(i){this.hTLV=null,this.isModified=!0,this.hV=I.asn1.ASN1Util.bigIntToMinTwosComplementsHex(i)},this.setByInteger=function(i){var a=new O(String(i),10);this.setByBigInteger(a)},this.setValueHex=function(i){this.hV=i},this.getFreshValueHex=function(){return this.hV},o!==void 0&&(o.bigint!==void 0?this.setByBigInteger(o.bigint):o.int!==void 0?this.setByInteger(o.int):typeof o=="number"?this.setByInteger(o):o.hex!==void 0&&this.setValueHex(o.hex))},at(I.asn1.DERInteger,I.asn1.ASN1Object),I.asn1.DERBitString=function(o){if(o!==void 0&&o.obj!==void 0){var i=I.asn1.ASN1Util.newObject(o.obj);o.hex="00"+i.getEncodedHex()}I.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(a){this.hTLV=null,this.isModified=!0,this.hV=a},this.setUnusedBitsAndHexValue=function(a,l){if(a<0||7<a)throw"unused bits shall be from 0 to 7: u = "+a;var g="0"+a;this.hTLV=null,this.isModified=!0,this.hV=g+l},this.setByBinaryString=function(a){var l=8-(a=a.replace(/0+$/,"")).length%8;l==8&&(l=0);for(var g=0;g<=l;g++)a+="0";var b="";for(g=0;g<a.length-1;g+=8){var T=a.substr(g,8),D=parseInt(T,2).toString(16);D.length==1&&(D="0"+D),b+=D}this.hTLV=null,this.isModified=!0,this.hV="0"+l+b},this.setByBooleanArray=function(a){for(var l="",g=0;g<a.length;g++)a[g]==1?l+="1":l+="0";this.setByBinaryString(l)},this.newFalseArray=function(a){for(var l=new Array(a),g=0;g<a;g++)l[g]=!1;return l},this.getFreshValueHex=function(){return this.hV},o!==void 0&&(typeof o=="string"&&o.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(o):o.hex!==void 0?this.setHexValueIncludingUnusedBits(o.hex):o.bin!==void 0?this.setByBinaryString(o.bin):o.array!==void 0&&this.setByBooleanArray(o.array))},at(I.asn1.DERBitString,I.asn1.ASN1Object),I.asn1.DEROctetString=function(o){if(o!==void 0&&o.obj!==void 0){var i=I.asn1.ASN1Util.newObject(o.obj);o.hex=i.getEncodedHex()}I.asn1.DEROctetString.superclass.constructor.call(this,o),this.hT="04"},at(I.asn1.DEROctetString,I.asn1.DERAbstractString),I.asn1.DERNull=function(){I.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},at(I.asn1.DERNull,I.asn1.ASN1Object),I.asn1.DERObjectIdentifier=function(o){I.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(i){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=i},this.setValueOidString=function(i){var a=function(g){var b=function($){var z=$.toString(16);return z.length==1&&(z="0"+z),z},T=function($){var z="",X=parseInt($,10).toString(2),te=7-X.length%7;te==7&&(te=0);for(var re="",k=0;k<te;k++)re+="0";for(X=re+X,k=0;k<X.length-1;k+=7){var N=X.substr(k,7);k!=X.length-7&&(N="1"+N),z+=b(parseInt(N,2))}return z};try{if(!g.match(/^[0-9.]+$/))return null;var D="",x=g.split("."),U=40*parseInt(x[0],10)+parseInt(x[1],10);D+=b(U),x.splice(0,2);for(var H=0;H<x.length;H++)D+=T(x[H]);return D}catch{return null}}(i);if(a==null)throw new Error("malformed oid string: "+i);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=a},this.setValueName=function(i){var a=I.asn1.x509.OID.name2oid(i);if(a==="")throw new Error("DERObjectIdentifier oidName undefined: "+i);this.setValueOidString(a)},this.setValueNameOrOid=function(i){i.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(i):this.setValueName(i)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(i){typeof i=="string"?this.setValueNameOrOid(i):i.oid!==void 0?this.setValueNameOrOid(i.oid):i.name!==void 0?this.setValueNameOrOid(i.name):i.hex!==void 0&&this.setValueHex(i.hex)},o!==void 0&&this.setByParam(o)},at(I.asn1.DERObjectIdentifier,I.asn1.ASN1Object),I.asn1.DEREnumerated=function(o){I.asn1.DEREnumerated.superclass.constructor.call(this),this.hT="0a",this.setByBigInteger=function(i){this.hTLV=null,this.isModified=!0,this.hV=I.asn1.ASN1Util.bigIntToMinTwosComplementsHex(i)},this.setByInteger=function(i){var a=new O(String(i),10);this.setByBigInteger(a)},this.setValueHex=function(i){this.hV=i},this.getFreshValueHex=function(){return this.hV},o!==void 0&&(o.int!==void 0?this.setByInteger(o.int):typeof o=="number"?this.setByInteger(o):o.hex!==void 0&&this.setValueHex(o.hex))},at(I.asn1.DEREnumerated,I.asn1.ASN1Object),I.asn1.DERUTF8String=function(o){I.asn1.DERUTF8String.superclass.constructor.call(this,o),this.hT="0c"},at(I.asn1.DERUTF8String,I.asn1.DERAbstractString),I.asn1.DERNumericString=function(o){I.asn1.DERNumericString.superclass.constructor.call(this,o),this.hT="12"},at(I.asn1.DERNumericString,I.asn1.DERAbstractString),I.asn1.DERPrintableString=function(o){I.asn1.DERPrintableString.superclass.constructor.call(this,o),this.hT="13"},at(I.asn1.DERPrintableString,I.asn1.DERAbstractString),I.asn1.DERTeletexString=function(o){I.asn1.DERTeletexString.superclass.constructor.call(this,o),this.hT="14"},at(I.asn1.DERTeletexString,I.asn1.DERAbstractString),I.asn1.DERIA5String=function(o){I.asn1.DERIA5String.superclass.constructor.call(this,o),this.hT="16"},at(I.asn1.DERIA5String,I.asn1.DERAbstractString),I.asn1.DERVisibleString=function(o){I.asn1.DERIA5String.superclass.constructor.call(this,o),this.hT="1a"},at(I.asn1.DERVisibleString,I.asn1.DERAbstractString),I.asn1.DERBMPString=function(o){I.asn1.DERBMPString.superclass.constructor.call(this,o),this.hT="1e"},at(I.asn1.DERBMPString,I.asn1.DERAbstractString),I.asn1.DERUTCTime=function(o){I.asn1.DERUTCTime.superclass.constructor.call(this,o),this.hT="17",this.setByDate=function(i){this.hTLV=null,this.isModified=!0,this.date=i,this.s=this.formatDate(this.date,"utc"),this.hV=Sr(this.s)},this.getFreshValueHex=function(){return this.date===void 0&&this.s===void 0&&(this.date=new Date,this.s=this.formatDate(this.date,"utc"),this.hV=Sr(this.s)),this.hV},o!==void 0&&(o.str!==void 0?this.setString(o.str):typeof o=="string"&&o.match(/^[0-9]{12}Z$/)?this.setString(o):o.hex!==void 0?this.setStringHex(o.hex):o.date!==void 0&&this.setByDate(o.date))},at(I.asn1.DERUTCTime,I.asn1.DERAbstractTime),I.asn1.DERGeneralizedTime=function(o){I.asn1.DERGeneralizedTime.superclass.constructor.call(this,o),this.hT="18",this.withMillis=!1,this.setByDate=function(i){this.hTLV=null,this.isModified=!0,this.date=i,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=Sr(this.s)},this.getFreshValueHex=function(){return this.date===void 0&&this.s===void 0&&(this.date=new Date,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=Sr(this.s)),this.hV},o!==void 0&&(o.str!==void 0?this.setString(o.str):typeof o=="string"&&o.match(/^[0-9]{14}Z$/)?this.setString(o):o.hex!==void 0?this.setStringHex(o.hex):o.date!==void 0&&this.setByDate(o.date),o.millis===!0&&(this.withMillis=!0))},at(I.asn1.DERGeneralizedTime,I.asn1.DERAbstractTime),I.asn1.DERSequence=function(o){I.asn1.DERSequence.superclass.constructor.call(this,o),this.hT="30",this.getFreshValueHex=function(){for(var i="",a=0;a<this.asn1Array.length;a++)i+=this.asn1Array[a].getEncodedHex();return this.hV=i,this.hV}},at(I.asn1.DERSequence,I.asn1.DERAbstractStructured),I.asn1.DERSet=function(o){I.asn1.DERSet.superclass.constructor.call(this,o),this.hT="31",this.sortFlag=!0,this.getFreshValueHex=function(){for(var i=new Array,a=0;a<this.asn1Array.length;a++){var l=this.asn1Array[a];i.push(l.getEncodedHex())}return this.sortFlag==1&&i.sort(),this.hV=i.join(""),this.hV},o!==void 0&&o.sortflag!==void 0&&o.sortflag==0&&(this.sortFlag=!1)},at(I.asn1.DERSet,I.asn1.DERAbstractStructured),I.asn1.DERTaggedObject=function(o){I.asn1.DERTaggedObject.superclass.constructor.call(this);var i=I.asn1;this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.setASN1Object=function(a,l,g){this.hT=l,this.isExplicit=a,this.asn1Object=g,this.isExplicit?(this.hV=this.asn1Object.getEncodedHex(),this.hTLV=null,this.isModified=!0):(this.hV=null,this.hTLV=g.getEncodedHex(),this.hTLV=this.hTLV.replace(/^../,l),this.isModified=!1)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(a){a.tag!=null&&(this.hT=a.tag),a.explicit!=null&&(this.isExplicit=a.explicit),a.tage!=null&&(this.hT=a.tage,this.isExplicit=!0),a.tagi!=null&&(this.hT=a.tagi,this.isExplicit=!1),a.obj!=null&&(a.obj instanceof i.ASN1Object?(this.asn1Object=a.obj,this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)):_(a.obj)=="object"&&(this.asn1Object=i.ASN1Util.newObject(a.obj),this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)))},o!=null&&this.setByParam(o)},at(I.asn1.DERTaggedObject,I.asn1.ASN1Object);var I,sn,cr,pe=new function(){};function yo(o){for(var i=new Array,a=0;a<o.length;a++)i[a]=o.charCodeAt(a);return i}function vo(o){for(var i="",a=0;a<o.length;a++)i+=String.fromCharCode(o[a]);return i}function Pn(o){for(var i="",a=0;a<o.length;a++){var l=o[a].toString(16);l.length==1&&(l="0"+l),i+=l}return i}function Sr(o){return Pn(yo(o))}function kn(o){return o=(o=(o=o.replace(/\=/g,"")).replace(/\+/g,"-")).replace(/\//g,"_")}function an(o){return o.length%4==2?o+="==":o.length%4==3&&(o+="="),o=(o=o.replace(/-/g,"+")).replace(/_/g,"/")}function _t(o){return o.length%2==1&&(o="0"+o),kn(B(o))}function et(o){return Z(an(o))}function ci(o){return Tn(In(o))}function wt(o){return decodeURIComponent(Cn(o))}function tr(o){for(var i="",a=0;a<o.length-1;a+=2)i+=String.fromCharCode(parseInt(o.substr(a,2),16));return i}function hr(o){for(var i="",a=0;a<o.length;a++)i+=("0"+o.charCodeAt(a).toString(16)).slice(-2);return i}function mo(o){return B(o)}function _o(o){var i=mo(o).replace(/(.{64})/g,`$1\r
`);return i=i.replace(/\r\n$/,"")}function wo(o){return Z(o.replace(/[^0-9A-Za-z\/+=]*/g,""))}function $t(o,i){return"-----BEGIN "+i+`-----\r
`+_o(o)+`\r
-----END `+i+`-----\r
`}function pr(o,i){if(o.indexOf("-----BEGIN ")==-1)throw"can't find PEM header: "+i;return wo(o=i!==void 0?(o=o.replace(new RegExp("^[^]*-----BEGIN "+i+"-----"),"")).replace(new RegExp("-----END "+i+"-----[^]*$"),""):(o=o.replace(/^[^]*-----BEGIN [^-]+-----/,"")).replace(/-----END [^-]+-----[^]*$/,""))}function li(o){var i,a,l,g,b,T,D,x,U,H,M;if(M=o.match(/^(\d{2}|\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(|\.\d+)Z$/))return x=M[1],i=parseInt(x),x.length===2&&(50<=i&&i<100?i=1900+i:0<=i&&i<50&&(i=2e3+i)),a=parseInt(M[2])-1,l=parseInt(M[3]),g=parseInt(M[4]),b=parseInt(M[5]),T=parseInt(M[6]),D=0,(U=M[7])!==""&&(H=(U.substr(1)+"00").substr(0,3),D=parseInt(H)),Date.UTC(i,a,l,g,b,T,D);throw"unsupported zulu format: "+o}function bo(o){return~~(li(o)/1e3)}function Tn(o){return o.replace(/%/g,"")}function Cn(o){return o.replace(/(..)/g,"%$1")}function So(o){var i="malformed IPv6 address";if(!o.match(/^[0-9A-Fa-f:]+$/))throw i;var a=(o=o.toLowerCase()).split(":").length-1;if(a<2)throw i;var l=":".repeat(7-a+2),g=(o=o.replace("::",l)).split(":");if(g.length!=8)throw i;for(var b=0;b<8;b++)g[b]=("0000"+g[b]).slice(-4);return g.join("")}function Eo(o){if(!o.match(/^[0-9A-Fa-f]{32}$/))throw"malformed IPv6 address octet";for(var i=(o=o.toLowerCase()).match(/.{1,4}/g),a=0;a<8;a++)i[a]=i[a].replace(/^0+/,""),i[a]==""&&(i[a]="0");var l=(o=":"+i.join(":")+":").match(/:(0:){2,}/g);if(l===null)return o.slice(1,-1);var g="";for(a=0;a<l.length;a++)l[a].length>g.length&&(g=l[a]);return(o=o.replace(g,"::")).slice(1,-1)}function di(o){var i="malformed hex value";if(!o.match(/^([0-9A-Fa-f][0-9A-Fa-f]){1,}$/))throw i;if(o.length!=8)return o.length==32?Eo(o):o;try{return parseInt(o.substr(0,2),16)+"."+parseInt(o.substr(2,2),16)+"."+parseInt(o.substr(4,2),16)+"."+parseInt(o.substr(6,2),16)}catch{throw i}}function Fo(o){return o.match(/.{4}/g).map(function(a){var l=parseInt(a.substr(0,2),16),g=parseInt(a.substr(2),16);if(l==0&g<128)return String.fromCharCode(g);if(l<8){var b=128|63&g;return wt((192|(7&l)<<3|(192&g)>>6).toString(16)+b.toString(16))}b=128|(15&l)<<2|(192&g)>>6;var T=128|63&g;return wt((224|(240&l)>>4).toString(16)+b.toString(16)+T.toString(16))}).join("")}function In(o){for(var i=encodeURIComponent(o),a="",l=0;l<i.length;l++)i[l]=="%"?(a+=i.substr(l,3),l+=2):a=a+"%"+Sr(i[l]);return a}function Ao(o){return!(o.length%2!=0||!o.match(/^[0-9a-f]+$/)&&!o.match(/^[0-9A-F]+$/))}function fi(o){return o.length%2==1?"0"+o:o.substr(0,1)>"7"?"00"+o:o}pe.getLblen=function(o,i){if(o.substr(i+2,1)!="8")return 1;var a=parseInt(o.substr(i+3,1));return a==0?-1:0<a&&a<10?a+1:-2},pe.getL=function(o,i){var a=pe.getLblen(o,i);return a<1?"":o.substr(i+2,2*a)},pe.getVblen=function(o,i){var a;return(a=pe.getL(o,i))==""?-1:(a.substr(0,1)==="8"?new O(a.substr(2),16):new O(a,16)).intValue()},pe.getVidx=function(o,i){var a=pe.getLblen(o,i);return a<0?a:i+2*(a+1)},pe.getV=function(o,i){var a=pe.getVidx(o,i),l=pe.getVblen(o,i);return o.substr(a,2*l)},pe.getTLV=function(o,i){return o.substr(i,2)+pe.getL(o,i)+pe.getV(o,i)},pe.getTLVblen=function(o,i){return 2+2*pe.getLblen(o,i)+2*pe.getVblen(o,i)},pe.getNextSiblingIdx=function(o,i){return pe.getVidx(o,i)+2*pe.getVblen(o,i)},pe.getChildIdx=function(o,i){var a,l,g,b=pe,T=[];a=b.getVidx(o,i),l=2*b.getVblen(o,i),o.substr(i,2)=="03"&&(a+=2,l-=2),g=0;for(var D=a;g<=l;){var x=b.getTLVblen(o,D);if((g+=x)<=l&&T.push(D),D+=x,g>=l)break}return T},pe.getNthChildIdx=function(o,i,a){return pe.getChildIdx(o,i)[a]},pe.getIdxbyList=function(o,i,a,l){var g,b,T=pe;return a.length==0?l!==void 0&&o.substr(i,2)!==l?-1:i:(g=a.shift())>=(b=T.getChildIdx(o,i)).length?-1:T.getIdxbyList(o,b[g],a,l)},pe.getIdxbyListEx=function(o,i,a,l){var g,b,T=pe;if(a.length==0)return l!==void 0&&o.substr(i,2)!==l?-1:i;g=a.shift(),b=T.getChildIdx(o,i);for(var D=0,x=0;x<b.length;x++){var U=o.substr(b[x],2);if(typeof g=="number"&&!T.isContextTag(U)&&D==g||typeof g=="string"&&T.isContextTag(U,g))return T.getIdxbyListEx(o,b[x],a,l);T.isContextTag(U)||D++}return-1},pe.getTLVbyList=function(o,i,a,l){var g=pe,b=g.getIdxbyList(o,i,a,l);return b==-1||b>=o.length?null:g.getTLV(o,b)},pe.getTLVbyListEx=function(o,i,a,l){var g=pe,b=g.getIdxbyListEx(o,i,a,l);return b==-1?null:g.getTLV(o,b)},pe.getVbyList=function(o,i,a,l,g){var b,T,D=pe;return(b=D.getIdxbyList(o,i,a,l))==-1||b>=o.length?null:(T=D.getV(o,b),g===!0&&(T=T.substr(2)),T)},pe.getVbyListEx=function(o,i,a,l,g){var b,T,D=pe;return(b=D.getIdxbyListEx(o,i,a,l))==-1?null:(T=D.getV(o,b),o.substr(b,2)=="03"&&g!==!1&&(T=T.substr(2)),T)},pe.getInt=function(o,i,a){a==null&&(a=-1);try{var l=o.substr(i,2);if(l!="02"&&l!="03")return a;var g=pe.getV(o,i);return l=="02"?parseInt(g,16):function(T){try{var D=T.substr(0,2);if(D=="00")return parseInt(T.substr(2),16);var x=parseInt(D,16),U=T.substr(2),H=parseInt(U,16).toString(2);return H=="0"&&(H="00000000"),H=H.slice(0,0-x),parseInt(H,2)}catch{return-1}}(g)}catch{return a}},pe.getOID=function(o,i,a){a==null&&(a=null);try{return o.substr(i,2)!="06"?a:function(g){if(!Ao(g))return null;try{var b=[],T=g.substr(0,2),D=parseInt(T,16);b[0]=new String(Math.floor(D/40)),b[1]=new String(D%40);for(var x=g.substr(2),U=[],H=0;H<x.length/2;H++)U.push(parseInt(x.substr(2*H,2),16));var M=[],$="";for(H=0;H<U.length;H++)128&U[H]?$+=Po((127&U[H]).toString(2),7):($+=Po((127&U[H]).toString(2),7),M.push(new String(parseInt($,2))),$="");var z=b.join(".");return M.length>0&&(z=z+"."+M.join(".")),z}catch{return null}}(pe.getV(o,i))}catch{return a}},pe.getOIDName=function(o,i,a){a==null&&(a=null);try{var l=pe.getOID(o,i,a);if(l==a)return a;var g=I.asn1.x509.OID.oid2name(l);return g==""?l:g}catch{return a}},pe.getString=function(o,i,a){a==null&&(a=null);try{return tr(pe.getV(o,i))}catch{return a}},pe.hextooidstr=function(o){var i=function($,z){return $.length>=z?$:new Array(z-$.length+1).join("0")+$},a=[],l=o.substr(0,2),g=parseInt(l,16);a[0]=new String(Math.floor(g/40)),a[1]=new String(g%40);for(var b=o.substr(2),T=[],D=0;D<b.length/2;D++)T.push(parseInt(b.substr(2*D,2),16));var x=[],U="";for(D=0;D<T.length;D++)128&T[D]?U+=i((127&T[D]).toString(2),7):(U+=i((127&T[D]).toString(2),7),x.push(new String(parseInt(U,2))),U="");var H=a.join(".");return x.length>0&&(H=H+"."+x.join(".")),H},pe.dump=function(o,i,a,l){var g=pe,b=g.getV,T=g.dump,D=g.getChildIdx,x=o;o instanceof I.asn1.ASN1Object&&(x=o.getEncodedHex());var U=function(ae,Ne){return ae.length<=2*Ne?ae:ae.substr(0,Ne)+"..(total "+ae.length/2+"bytes).."+ae.substr(ae.length-Ne,Ne)};i===void 0&&(i={ommit_long_octet:32}),a===void 0&&(a=0),l===void 0&&(l="");var H,M=i.ommit_long_octet;if((H=x.substr(a,2))=="01")return($=b(x,a))=="00"?l+`BOOLEAN FALSE
`:l+`BOOLEAN TRUE
`;if(H=="02")return l+"INTEGER "+U($=b(x,a),M)+`
`;if(H=="03"){var $=b(x,a);if(g.isASN1HEX($.substr(2))){var z=l+`BITSTRING, encapsulates
`;return z+=T($.substr(2),i,0,l+"  ")}return l+"BITSTRING "+U($,M)+`
`}if(H=="04")return $=b(x,a),g.isASN1HEX($)?(z=l+`OCTETSTRING, encapsulates
`,z+=T($,i,0,l+"  ")):l+"OCTETSTRING "+U($,M)+`
`;if(H=="05")return l+`NULL
`;if(H=="06"){var X=b(x,a),te=I.asn1.ASN1Util.oidHexToInt(X),re=I.asn1.x509.OID.oid2name(te),k=te.replace(/\./g," ");return re!=""?l+"ObjectIdentifier "+re+" ("+k+`)
`:l+"ObjectIdentifier ("+k+`)
`}if(H=="0a")return l+"ENUMERATED "+parseInt(b(x,a))+`
`;if(H=="0c")return l+"UTF8String '"+wt(b(x,a))+`'
`;if(H=="13")return l+"PrintableString '"+wt(b(x,a))+`'
`;if(H=="14")return l+"TeletexString '"+wt(b(x,a))+`'
`;if(H=="16")return l+"IA5String '"+wt(b(x,a))+`'
`;if(H=="17")return l+"UTCTime "+wt(b(x,a))+`
`;if(H=="18")return l+"GeneralizedTime "+wt(b(x,a))+`
`;if(H=="1a")return l+"VisualString '"+wt(b(x,a))+`'
`;if(H=="1e")return l+"BMPString '"+Fo(b(x,a))+`'
`;if(H=="30"){if(x.substr(a,4)=="3000")return l+`SEQUENCE {}
`;z=l+`SEQUENCE
`;var N=i;if(((Q=D(x,a)).length==2||Q.length==3)&&x.substr(Q[0],2)=="06"&&x.substr(Q[Q.length-1],2)=="04"){re=g.oidname(b(x,Q[0]));var K=JSON.parse(JSON.stringify(i));K.x509ExtName=re,N=K}for(var W=0;W<Q.length;W++)z+=T(x,N,Q[W],l+"  ");return z}if(H=="31"){z=l+`SET
`;var Q=D(x,a);for(W=0;W<Q.length;W++)z+=T(x,i,Q[W],l+"  ");return z}if((128&(H=parseInt(H,16)))!=0){var ne=31&H;if((32&H)!=0){for(z=l+"["+ne+`]
`,Q=D(x,a),W=0;W<Q.length;W++)z+=T(x,i,Q[W],l+"  ");return z}if($=b(x,a),pe.isASN1HEX($)){var z=l+"["+ne+`]
`;return z+=T($,i,0,l+"  ")}return($.substr(0,8)=="68747470"||i.x509ExtName==="subjectAltName"&&ne==2)&&($=wt($)),z=l+"["+ne+"] "+$+`
`}return l+"UNKNOWN("+H+") "+b(x,a)+`
`},pe.isContextTag=function(o,i){var a,l;o=o.toLowerCase();try{a=parseInt(o,16)}catch{return-1}if(i===void 0)return(192&a)==128;try{return i.match(/^\[[0-9]+\]$/)!=null&&!((l=parseInt(i.substr(1,i.length-1),10))>31)&&(192&a)==128&&(31&a)==l}catch{return!1}},pe.isASN1HEX=function(o){var i=pe;if(o.length%2==1)return!1;var a=i.getVblen(o,0),l=o.substr(0,2),g=i.getL(o,0);return o.length-l.length-g.length==2*a},pe.checkStrictDER=function(o,i,a,l,g){var b=pe;if(a===void 0){if(typeof o!="string")throw new Error("not hex string");if(o=o.toLowerCase(),!I.lang.String.isHex(o))throw new Error("not hex string");a=o.length,g=(l=o.length/2)<128?1:Math.ceil(l.toString(16))+1}if(b.getL(o,i).length>2*g)throw new Error("L of TLV too long: idx="+i);var T=b.getVblen(o,i);if(T>l)throw new Error("value of L too long than hex: idx="+i);var D=b.getTLV(o,i),x=D.length-2-b.getL(o,i).length;if(x!==2*T)throw new Error("V string length and L's value not the same:"+x+"/"+2*T);if(i===0&&o.length!=D.length)throw new Error("total length and TLV length unmatch:"+o.length+"!="+D.length);var U=o.substr(i,2);if(U==="02"){var H=b.getVidx(o,i);if(o.substr(H,2)=="00"&&o.charCodeAt(H+2)<56)throw new Error("not least zeros for DER INTEGER")}if(32&parseInt(U,16)){for(var M=b.getVblen(o,i),$=0,z=b.getChildIdx(o,i),X=0;X<z.length;X++)$+=b.getTLV(o,z[X]).length,b.checkStrictDER(o,z[X],a,l,g);if(2*M!=$)throw new Error("sum of children's TLV length and L unmatch: "+2*M+"!="+$)}},pe.oidname=function(o){var i=I.asn1;I.lang.String.isHex(o)&&(o=i.ASN1Util.oidHexToInt(o));var a=i.x509.OID.oid2name(o);return a===""&&(a=o),a},I!==void 0&&I||(r.KJUR=I={}),I.lang!==void 0&&I.lang||(I.lang={}),I.lang.String=function(){},typeof c=="function"?(r.utf8tob64u=sn=function(i){return kn(c.from(i,"utf8").toString("base64"))},r.b64utoutf8=cr=function(i){return c.from(an(i),"base64").toString("utf8")}):(r.utf8tob64u=sn=function(i){return _t(Tn(In(i)))},r.b64utoutf8=cr=function(i){return decodeURIComponent(Cn(et(i)))}),I.lang.String.isInteger=function(o){return!!o.match(/^[0-9]+$/)||!!o.match(/^-[0-9]+$/)},I.lang.String.isHex=function(o){return Ao(o)},I.lang.String.isBase64=function(o){return!(!(o=o.replace(/\s+/g,"")).match(/^[0-9A-Za-z+\/]+={0,3}$/)||o.length%4!=0)},I.lang.String.isBase64URL=function(o){return!o.match(/[+/=]/)&&(o=an(o),I.lang.String.isBase64(o))},I.lang.String.isIntegerArray=function(o){return!!(o=o.replace(/\s+/g,"")).match(/^\[[0-9,]+\]$/)},I.lang.String.isPrintable=function(o){return o.match(/^[0-9A-Za-z '()+,-./:=?]*$/)!==null},I.lang.String.isIA5=function(o){return o.match(/^[\x20-\x21\x23-\x7f]*$/)!==null},I.lang.String.isMail=function(o){return o.match(/^[A-Za-z0-9]{1}[A-Za-z0-9_.-]*@{1}[A-Za-z0-9_.-]{1,}\.[A-Za-z0-9]{1,}$/)!==null};var Po=function(i,a,l){return l==null&&(l="0"),i.length>=a?i:new Array(a-i.length+1).join(l)+i};function at(o,i){var a=function(){};a.prototype=i.prototype,o.prototype=new a,o.prototype.constructor=o,o.superclass=i.prototype,i.prototype.constructor==Object.prototype.constructor&&(i.prototype.constructor=i)}I!==void 0&&I||(r.KJUR=I={}),I.crypto!==void 0&&I.crypto||(I.crypto={}),I.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHAwithRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:R.algo.MD5,sha1:R.algo.SHA1,sha224:R.algo.SHA224,sha256:R.algo.SHA256,sha384:R.algo.SHA384,sha512:R.algo.SHA512,ripemd160:R.algo.RIPEMD160},this.getDigestInfoHex=function(o,i){if(this.DIGESTINFOHEAD[i]===void 0)throw"alg not supported in Util.DIGESTINFOHEAD: "+i;return this.DIGESTINFOHEAD[i]+o},this.getPaddedDigestInfoHex=function(o,i,a){var l=this.getDigestInfoHex(o,i),g=a/4;if(l.length+22>g)throw"key is too short for SigAlg: keylen="+a+","+i;for(var b="0001",T="00"+l,D="",x=g-b.length-T.length,U=0;U<x;U+=2)D+="ff";return b+D+T},this.hashString=function(o,i){return new I.crypto.MessageDigest({alg:i}).digestString(o)},this.hashHex=function(o,i){return new I.crypto.MessageDigest({alg:i}).digestHex(o)},this.sha1=function(o){return this.hashString(o,"sha1")},this.sha256=function(o){return this.hashString(o,"sha256")},this.sha256Hex=function(o){return this.hashHex(o,"sha256")},this.sha512=function(o){return this.hashString(o,"sha512")},this.sha512Hex=function(o){return this.hashHex(o,"sha512")},this.isKey=function(o){return o instanceof Fe||o instanceof I.crypto.DSA||o instanceof I.crypto.ECDSA}},I.crypto.Util.md5=function(o){return new I.crypto.MessageDigest({alg:"md5",prov:"cryptojs"}).digestString(o)},I.crypto.Util.ripemd160=function(o){return new I.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"}).digestString(o)},I.crypto.Util.SECURERANDOMGEN=new Ge,I.crypto.Util.getRandomHexOfNbytes=function(o){var i=new Array(o);return I.crypto.Util.SECURERANDOMGEN.nextBytes(i),Pn(i)},I.crypto.Util.getRandomBigIntegerOfNbytes=function(o){return new O(I.crypto.Util.getRandomHexOfNbytes(o),16)},I.crypto.Util.getRandomHexOfNbits=function(o){var i=o%8,a=new Array((o-i)/8+1);return I.crypto.Util.SECURERANDOMGEN.nextBytes(a),a[0]=(255<<i&255^255)&a[0],Pn(a)},I.crypto.Util.getRandomBigIntegerOfNbits=function(o){return new O(I.crypto.Util.getRandomHexOfNbits(o),16)},I.crypto.Util.getRandomBigIntegerZeroToMax=function(o){for(var i=o.bitLength();;){var a=I.crypto.Util.getRandomBigIntegerOfNbits(i);if(o.compareTo(a)!=-1)return a}},I.crypto.Util.getRandomBigIntegerMinToMax=function(o,i){var a=o.compareTo(i);if(a==1)throw"biMin is greater than biMax";if(a==0)return o;var l=i.subtract(o);return I.crypto.Util.getRandomBigIntegerZeroToMax(l).add(o)},I.crypto.MessageDigest=function(o){this.setAlgAndProvider=function(i,a){if((i=I.crypto.MessageDigest.getCanonicalAlgName(i))!==null&&a===void 0&&(a=I.crypto.Util.DEFAULTPROVIDER[i]),":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(i)!=-1&&a=="cryptojs"){try{this.md=I.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[i].create()}catch(l){throw"setAlgAndProvider hash alg set fail alg="+i+"/"+l}this.updateString=function(l){this.md.update(l)},this.updateHex=function(l){var g=R.enc.Hex.parse(l);this.md.update(g)},this.digest=function(){return this.md.finalize().toString(R.enc.Hex)},this.digestString=function(l){return this.updateString(l),this.digest()},this.digestHex=function(l){return this.updateHex(l),this.digest()}}if(":sha256:".indexOf(i)!=-1&&a=="sjcl"){try{this.md=new sjcl.hash.sha256}catch(l){throw"setAlgAndProvider hash alg set fail alg="+i+"/"+l}this.updateString=function(l){this.md.update(l)},this.updateHex=function(l){var g=sjcl.codec.hex.toBits(l);this.md.update(g)},this.digest=function(){var l=this.md.finalize();return sjcl.codec.hex.fromBits(l)},this.digestString=function(l){return this.updateString(l),this.digest()},this.digestHex=function(l){return this.updateHex(l),this.digest()}}},this.updateString=function(i){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(i){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(i){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(i){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},o!==void 0&&o.alg!==void 0&&(this.algName=o.alg,o.prov===void 0&&(this.provName=I.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))},I.crypto.MessageDigest.getCanonicalAlgName=function(o){return typeof o=="string"&&(o=(o=o.toLowerCase()).replace(/-/,"")),o},I.crypto.MessageDigest.getHashLength=function(o){var i=I.crypto.MessageDigest,a=i.getCanonicalAlgName(o);if(i.HASHLENGTH[a]===void 0)throw"not supported algorithm: "+o;return i.HASHLENGTH[a]},I.crypto.MessageDigest.HASHLENGTH={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,ripemd160:20},I.crypto.Mac=function(o){this.setAlgAndProvider=function(i,a){if((i=i.toLowerCase())==null&&(i="hmacsha1"),(i=i.toLowerCase()).substr(0,4)!="hmac")throw"setAlgAndProvider unsupported HMAC alg: "+i;a===void 0&&(a=I.crypto.Util.DEFAULTPROVIDER[i]),this.algProv=i+"/"+a;var l=i.substr(4);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(l)!=-1&&a=="cryptojs"){try{var g=I.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[l];this.mac=R.algo.HMAC.create(g,this.pass)}catch(b){throw"setAlgAndProvider hash alg set fail hashAlg="+l+"/"+b}this.updateString=function(b){this.mac.update(b)},this.updateHex=function(b){var T=R.enc.Hex.parse(b);this.mac.update(T)},this.doFinal=function(){return this.mac.finalize().toString(R.enc.Hex)},this.doFinalString=function(b){return this.updateString(b),this.doFinal()},this.doFinalHex=function(b){return this.updateHex(b),this.doFinal()}}},this.updateString=function(i){throw"updateString(str) not supported for this alg/prov: "+this.algProv},this.updateHex=function(i){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv},this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv},this.doFinalString=function(i){throw"digestString(str) not supported for this alg/prov: "+this.algProv},this.doFinalHex=function(i){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv},this.setPassword=function(i){if(typeof i=="string"){var a=i;return i.length%2!=1&&i.match(/^[0-9A-Fa-f]+$/)||(a=hr(i)),void(this.pass=R.enc.Hex.parse(a))}if((i===void 0?"undefined":_(i))!="object")throw"KJUR.crypto.Mac unsupported password type: "+i;if(a=null,i.hex!==void 0){if(i.hex.length%2!=0||!i.hex.match(/^[0-9A-Fa-f]+$/))throw"Mac: wrong hex password: "+i.hex;a=i.hex}if(i.utf8!==void 0&&(a=ci(i.utf8)),i.rstr!==void 0&&(a=hr(i.rstr)),i.b64!==void 0&&(a=Z(i.b64)),i.b64u!==void 0&&(a=et(i.b64u)),a==null)throw"KJUR.crypto.Mac unsupported password type: "+i;this.pass=R.enc.Hex.parse(a)},o!==void 0&&(o.pass!==void 0&&this.setPassword(o.pass),o.alg!==void 0&&(this.algName=o.alg,o.prov===void 0&&(this.provName=I.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))},I.crypto.Signature=function(o){var i=null;if(this._setAlgNames=function(){var a=this.algName.match(/^(.+)with(.+)$/);a&&(this.mdAlgName=a[1].toLowerCase(),this.pubkeyAlgName=a[2].toLowerCase(),this.pubkeyAlgName=="rsaandmgf1"&&this.mdAlgName=="sha"&&(this.mdAlgName="sha1"))},this._zeroPaddingOfSignature=function(a,l){for(var g="",b=l/4-a.length,T=0;T<b;T++)g+="0";return g+a},this.setAlgAndProvider=function(a,l){if(this._setAlgNames(),l!="cryptojs/jsrsa")throw new Error("provider not supported: "+l);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)!=-1){try{this.md=new I.crypto.MessageDigest({alg:this.mdAlgName})}catch(g){throw new Error("setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+g)}this.init=function(g,b){var T=null;try{T=b===void 0?pt.getKey(g):pt.getKey(g,b)}catch(D){throw"init failed:"+D}if(T.isPrivate===!0)this.prvKey=T,this.state="SIGN";else{if(T.isPublic!==!0)throw"init failed.:"+T;this.pubKey=T,this.state="VERIFY"}},this.updateString=function(g){this.md.updateString(g)},this.updateHex=function(g){this.md.updateHex(g)},this.sign=function(){if(this.sHashHex=this.md.digest(),this.prvKey===void 0&&this.ecprvhex!==void 0&&this.eccurvename!==void 0&&I.crypto.ECDSA!==void 0&&(this.prvKey=new I.crypto.ECDSA({curve:this.eccurvename,prv:this.ecprvhex})),this.prvKey instanceof Fe&&this.pubkeyAlgName==="rsaandmgf1")this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if(this.prvKey instanceof Fe&&this.pubkeyAlgName==="rsa")this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof I.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else{if(!(this.prvKey instanceof I.crypto.DSA))throw"Signature: unsupported private key alg: "+this.pubkeyAlgName;this.hSign=this.prvKey.signWithMessageHash(this.sHashHex)}return this.hSign},this.signString=function(g){return this.updateString(g),this.sign()},this.signHex=function(g){return this.updateHex(g),this.sign()},this.verify=function(g){if(this.sHashHex=this.md.digest(),this.pubKey===void 0&&this.ecpubhex!==void 0&&this.eccurvename!==void 0&&I.crypto.ECDSA!==void 0&&(this.pubKey=new I.crypto.ECDSA({curve:this.eccurvename,pub:this.ecpubhex})),this.pubKey instanceof Fe&&this.pubkeyAlgName==="rsaandmgf1")return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,g,this.mdAlgName,this.pssSaltLen);if(this.pubKey instanceof Fe&&this.pubkeyAlgName==="rsa")return this.pubKey.verifyWithMessageHash(this.sHashHex,g);if(I.crypto.ECDSA!==void 0&&this.pubKey instanceof I.crypto.ECDSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,g);if(I.crypto.DSA!==void 0&&this.pubKey instanceof I.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,g);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(a,l){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.updateString=function(a){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(a){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName},this.signString=function(a){throw"digestString(str) not supported for this alg:prov="+this.algProvName},this.signHex=function(a){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(a){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},this.initParams=o,o!==void 0&&(o.alg!==void 0&&(this.algName=o.alg,o.prov===void 0?this.provName=I.crypto.Util.DEFAULTPROVIDER[this.algName]:this.provName=o.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),o.psssaltlen!==void 0&&(this.pssSaltLen=o.psssaltlen),o.prvkeypem!==void 0)){if(o.prvkeypas!==void 0)throw"both prvkeypem and prvkeypas parameters not supported";try{i=pt.getKey(o.prvkeypem),this.init(i)}catch(a){throw"fatal error to load pem private key: "+a}}},I.crypto.Cipher=function(o){},I.crypto.Cipher.encrypt=function(o,i,a){if(i instanceof Fe&&i.isPublic){var l=I.crypto.Cipher.getAlgByKeyAndName(i,a);if(l==="RSA")return i.encrypt(o);if(l==="RSAOAEP")return i.encryptOAEP(o,"sha1");var g=l.match(/^RSAOAEP(\d+)$/);if(g!==null)return i.encryptOAEP(o,"sha"+g[1]);throw"Cipher.encrypt: unsupported algorithm for RSAKey: "+a}throw"Cipher.encrypt: unsupported key or algorithm"},I.crypto.Cipher.decrypt=function(o,i,a){if(i instanceof Fe&&i.isPrivate){var l=I.crypto.Cipher.getAlgByKeyAndName(i,a);if(l==="RSA")return i.decrypt(o);if(l==="RSAOAEP")return i.decryptOAEP(o,"sha1");var g=l.match(/^RSAOAEP(\d+)$/);if(g!==null)return i.decryptOAEP(o,"sha"+g[1]);throw"Cipher.decrypt: unsupported algorithm for RSAKey: "+a}throw"Cipher.decrypt: unsupported key or algorithm"},I.crypto.Cipher.getAlgByKeyAndName=function(o,i){if(o instanceof Fe){if(":RSA:RSAOAEP:RSAOAEP224:RSAOAEP256:RSAOAEP384:RSAOAEP512:".indexOf(i)!=-1)return i;if(i==null)return"RSA";throw"getAlgByKeyAndName: not supported algorithm name for RSAKey: "+i}throw"getAlgByKeyAndName: not supported algorithm name: "+i},I.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040023":"secp521r1","2b81040022":"secp384r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}},I!==void 0&&I||(r.KJUR=I={}),I.crypto!==void 0&&I.crypto||(I.crypto={}),I.crypto.ECDSA=function(o){var i=Error,a=O,l=Le,g=I.crypto.ECDSA,b=I.crypto.ECParameterDB,T=g.getName,D=pe,x=D.getVbyListEx,U=D.isASN1HEX,H=new Ge;this.type="EC",this.isPrivate=!1,this.isPublic=!1,this.getBigRandom=function(M){return new a(M.bitLength(),H).mod(M.subtract(a.ONE)).add(a.ONE)},this.setNamedCurve=function(M){this.ecparams=b.getByName(M),this.prvKeyHex=null,this.pubKeyHex=null,this.curveName=M},this.setPrivateKeyHex=function(M){this.isPrivate=!0,this.prvKeyHex=M},this.setPublicKeyHex=function(M){this.isPublic=!0,this.pubKeyHex=M},this.getPublicKeyXYHex=function(){var M=this.pubKeyHex;if(M.substr(0,2)!=="04")throw"this method supports uncompressed format(04) only";var $=this.ecparams.keylen/4;if(M.length!==2+2*$)throw"malformed public key hex length";var z={};return z.x=M.substr(2,$),z.y=M.substr(2+$),z},this.getShortNISTPCurveName=function(){var M=this.curveName;return M==="secp256r1"||M==="NIST P-256"||M==="P-256"||M==="prime256v1"?"P-256":M==="secp384r1"||M==="NIST P-384"||M==="P-384"?"P-384":null},this.generateKeyPairHex=function(){var M=this.ecparams.n,$=this.getBigRandom(M),z=this.ecparams.G.multiply($),X=z.getX().toBigInteger(),te=z.getY().toBigInteger(),re=this.ecparams.keylen/4,k=("0000000000"+$.toString(16)).slice(-re),N="04"+("0000000000"+X.toString(16)).slice(-re)+("0000000000"+te.toString(16)).slice(-re);return this.setPrivateKeyHex(k),this.setPublicKeyHex(N),{ecprvhex:k,ecpubhex:N}},this.signWithMessageHash=function(M){return this.signHex(M,this.prvKeyHex)},this.signHex=function(M,$){var z=new a($,16),X=this.ecparams.n,te=new a(M.substring(0,this.ecparams.keylen/4),16);do var re=this.getBigRandom(X),k=this.ecparams.G.multiply(re).getX().toBigInteger().mod(X);while(k.compareTo(a.ZERO)<=0);var N=re.modInverse(X).multiply(te.add(z.multiply(k))).mod(X);return g.biRSSigToASN1Sig(k,N)},this.sign=function(M,$){var z=$,X=this.ecparams.n,te=a.fromByteArrayUnsigned(M);do var re=this.getBigRandom(X),k=this.ecparams.G.multiply(re).getX().toBigInteger().mod(X);while(k.compareTo(O.ZERO)<=0);var N=re.modInverse(X).multiply(te.add(z.multiply(k))).mod(X);return this.serializeSig(k,N)},this.verifyWithMessageHash=function(M,$){return this.verifyHex(M,$,this.pubKeyHex)},this.verifyHex=function(M,$,z){try{var X,te,re=g.parseSigHex($);X=re.r,te=re.s;var k=l.decodeFromHex(this.ecparams.curve,z),N=new a(M.substring(0,this.ecparams.keylen/4),16);return this.verifyRaw(N,X,te,k)}catch{return!1}},this.verify=function(M,$,z){var X,te,re;if(Bitcoin.Util.isArray($)){var k=this.parseSig($);X=k.r,te=k.s}else{if(($===void 0?"undefined":_($))!=="object"||!$.r||!$.s)throw"Invalid value for signature";X=$.r,te=$.s}if(z instanceof Le)re=z;else{if(!Bitcoin.Util.isArray(z))throw"Invalid format for pubkey value, must be byte array or ECPointFp";re=l.decodeFrom(this.ecparams.curve,z)}var N=a.fromByteArrayUnsigned(M);return this.verifyRaw(N,X,te,re)},this.verifyRaw=function(M,$,z,X){var te=this.ecparams.n,re=this.ecparams.G;if($.compareTo(a.ONE)<0||$.compareTo(te)>=0||z.compareTo(a.ONE)<0||z.compareTo(te)>=0)return!1;var k=z.modInverse(te),N=M.multiply(k).mod(te),K=$.multiply(k).mod(te);return re.multiply(N).add(X.multiply(K)).getX().toBigInteger().mod(te).equals($)},this.serializeSig=function(M,$){var z=M.toByteArraySigned(),X=$.toByteArraySigned(),te=[];return te.push(2),te.push(z.length),(te=te.concat(z)).push(2),te.push(X.length),(te=te.concat(X)).unshift(te.length),te.unshift(48),te},this.parseSig=function(M){var $;if(M[0]!=48)throw new Error("Signature not a valid DERSequence");if(M[$=2]!=2)throw new Error("First element in signature must be a DERInteger");var z=M.slice($+2,$+2+M[$+1]);if(M[$+=2+M[$+1]]!=2)throw new Error("Second element in signature must be a DERInteger");var X=M.slice($+2,$+2+M[$+1]);return $+=2+M[$+1],{r:a.fromByteArrayUnsigned(z),s:a.fromByteArrayUnsigned(X)}},this.parseSigCompact=function(M){if(M.length!==65)throw"Signature has the wrong length";var $=M[0]-27;if($<0||$>7)throw"Invalid signature type";var z=this.ecparams.n;return{r:a.fromByteArrayUnsigned(M.slice(1,33)).mod(z),s:a.fromByteArrayUnsigned(M.slice(33,65)).mod(z),i:$}},this.readPKCS5PrvKeyHex=function(M){if(U(M)===!1)throw new Error("not ASN.1 hex string");var $,z,X;try{$=x(M,0,["[0]",0],"06"),z=x(M,0,[1],"04");try{X=x(M,0,["[1]",0],"03")}catch{}}catch{throw new Error("malformed PKCS#1/5 plain ECC private key")}if(this.curveName=T($),this.curveName===void 0)throw"unsupported curve name";this.setNamedCurve(this.curveName),this.setPublicKeyHex(X),this.setPrivateKeyHex(z),this.isPublic=!1},this.readPKCS8PrvKeyHex=function(M){if(U(M)===!1)throw new i("not ASN.1 hex string");var $,z,X;try{x(M,0,[1,0],"06"),$=x(M,0,[1,1],"06"),z=x(M,0,[2,0,1],"04");try{X=x(M,0,[2,0,"[1]",0],"03")}catch{}}catch{throw new i("malformed PKCS#8 plain ECC private key")}if(this.curveName=T($),this.curveName===void 0)throw new i("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(X),this.setPrivateKeyHex(z),this.isPublic=!1},this.readPKCS8PubKeyHex=function(M){if(U(M)===!1)throw new i("not ASN.1 hex string");var $,z;try{x(M,0,[0,0],"06"),$=x(M,0,[0,1],"06"),z=x(M,0,[1],"03")}catch{throw new i("malformed PKCS#8 ECC public key")}if(this.curveName=T($),this.curveName===null)throw new i("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(z)},this.readCertPubKeyHex=function(M,$){if(U(M)===!1)throw new i("not ASN.1 hex string");var z,X;try{z=x(M,0,[0,5,0,1],"06"),X=x(M,0,[0,5,1],"03")}catch{throw new i("malformed X.509 certificate ECC public key")}if(this.curveName=T(z),this.curveName===null)throw new i("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(X)},o!==void 0&&o.curve!==void 0&&(this.curveName=o.curve),this.curveName===void 0&&(this.curveName="secp256r1"),this.setNamedCurve(this.curveName),o!==void 0&&(o.prv!==void 0&&this.setPrivateKeyHex(o.prv),o.pub!==void 0&&this.setPublicKeyHex(o.pub))},I.crypto.ECDSA.parseSigHex=function(o){var i=I.crypto.ECDSA.parseSigHexInHexRS(o);return{r:new O(i.r,16),s:new O(i.s,16)}},I.crypto.ECDSA.parseSigHexInHexRS=function(o){var i=pe,a=i.getChildIdx,l=i.getV;if(i.checkStrictDER(o,0),o.substr(0,2)!="30")throw new Error("signature is not a ASN.1 sequence");var g=a(o,0);if(g.length!=2)throw new Error("signature shall have two elements");var b=g[0],T=g[1];if(o.substr(b,2)!="02")throw new Error("1st item not ASN.1 integer");if(o.substr(T,2)!="02")throw new Error("2nd item not ASN.1 integer");return{r:l(o,b),s:l(o,T)}},I.crypto.ECDSA.asn1SigToConcatSig=function(o){var i=I.crypto.ECDSA.parseSigHexInHexRS(o),a=i.r,l=i.s;if(a.substr(0,2)=="00"&&a.length%32==2&&(a=a.substr(2)),l.substr(0,2)=="00"&&l.length%32==2&&(l=l.substr(2)),a.length%32==30&&(a="00"+a),l.length%32==30&&(l="00"+l),a.length%32!=0)throw"unknown ECDSA sig r length error";if(l.length%32!=0)throw"unknown ECDSA sig s length error";return a+l},I.crypto.ECDSA.concatSigToASN1Sig=function(o){if(o.length/2*8%128!=0)throw"unknown ECDSA concatinated r-s sig  length error";var i=o.substr(0,o.length/2),a=o.substr(o.length/2);return I.crypto.ECDSA.hexRSSigToASN1Sig(i,a)},I.crypto.ECDSA.hexRSSigToASN1Sig=function(o,i){var a=new O(o,16),l=new O(i,16);return I.crypto.ECDSA.biRSSigToASN1Sig(a,l)},I.crypto.ECDSA.biRSSigToASN1Sig=function(o,i){var a=I.asn1,l=new a.DERInteger({bigint:o}),g=new a.DERInteger({bigint:i});return new a.DERSequence({array:[l,g]}).getEncodedHex()},I.crypto.ECDSA.getName=function(o){return o==="2b8104001f"?"secp192k1":o==="2a8648ce3d030107"?"secp256r1":o==="2b8104000a"?"secp256k1":o==="2b81040021"?"secp224r1":o==="2b81040022"?"secp384r1":"|secp256r1|NIST P-256|P-256|prime256v1|".indexOf(o)!==-1?"secp256r1":"|secp256k1|".indexOf(o)!==-1?"secp256k1":"|secp224r1|NIST P-224|P-224|".indexOf(o)!==-1?"secp224r1":"|secp384r1|NIST P-384|P-384|".indexOf(o)!==-1?"secp384r1":null},I!==void 0&&I||(r.KJUR=I={}),I.crypto!==void 0&&I.crypto||(I.crypto={}),I.crypto.ECParameterDB=new function(){var o={},i={};function a(l){return new O(l,16)}this.getByName=function(l){var g=l;if(i[g]!==void 0&&(g=i[l]),o[g]!==void 0)return o[g];throw"unregistered EC curve name: "+g},this.regist=function(l,g,b,T,D,x,U,H,M,$,z,X){o[l]={};var te=a(b),re=a(T),k=a(D),N=a(x),K=a(U),W=new er(te,re,k),Q=W.decodePointHex("04"+H+M);o[l].name=l,o[l].keylen=g,o[l].curve=W,o[l].G=Q,o[l].n=N,o[l].h=K,o[l].oid=z,o[l].info=X;for(var ne=0;ne<$.length;ne++)i[$[ne]]=l}},I.crypto.ECParameterDB.regist("secp128r1",128,"FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFC","E87579C11079F43DD824993C2CEE5ED3","FFFFFFFE0000000075A30D1B9038A115","1","161FF7528B899B2D0C28607CA52C5B86","CF5AC8395BAFEB13C02DA292DDED7A83",[],"","secp128r1 : SECG curve over a 128 bit prime field"),I.crypto.ECParameterDB.regist("secp160k1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFAC73","0","7","0100000000000000000001B8FA16DFAB9ACA16B6B3","1","3B4C382CE37AA192A4019E763036F4F5DD4D7EBB","938CF935318FDCED6BC28286531733C3F03C4FEE",[],"","secp160k1 : SECG curve over a 160 bit prime field"),I.crypto.ECParameterDB.regist("secp160r1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFC","1C97BEFC54BD7A8B65ACF89F81D4D4ADC565FA45","0100000000000000000001F4C8F927AED3CA752257","1","4A96B5688EF573284664698968C38BB913CBFC82","23A628553168947D59DCC912042351377AC5FB32",[],"","secp160r1 : SECG curve over a 160 bit prime field"),I.crypto.ECParameterDB.regist("secp192k1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFEE37","0","3","FFFFFFFFFFFFFFFFFFFFFFFE26F2FC170F69466A74DEFD8D","1","DB4FF10EC057E9AE26B07D0280B7F4341DA5D1B1EAE06C7D","9B2F2F6D9C5628A7844163D015BE86344082AA88D95E2F9D",[]),I.crypto.ECParameterDB.regist("secp192r1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC","64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1","FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831","1","188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF1012","07192B95FFC8DA78631011ED6B24CDD573F977A11E794811",[]),I.crypto.ECParameterDB.regist("secp224r1",224,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE","B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4","FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D","1","B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21","BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34",[]),I.crypto.ECParameterDB.regist("secp256k1",256,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F","0","7","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141","1","79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798","483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8",[]),I.crypto.ECParameterDB.regist("secp256r1",256,"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC","5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B","FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551","1","6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296","4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5",["NIST P-256","P-256","prime256v1"]),I.crypto.ECParameterDB.regist("secp384r1",384,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFC","B3312FA7E23EE7E4988E056BE3F82D19181D9C6EFE8141120314088F5013875AC656398D8A2ED19D2A85C8EDD3EC2AEF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC7634D81F4372DDF581A0DB248B0A77AECEC196ACCC52973","1","AA87CA22BE8B05378EB1C71EF320AD746E1D3B628BA79B9859F741E082542A385502F25DBF55296C3A545E3872760AB7","3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f",["NIST P-384","P-384"]),I.crypto.ECParameterDB.regist("secp521r1",521,"1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC","051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409","1","C6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66","011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650",["NIST P-521","P-521"]);var pt=function(){var o=function(U,H,M){return i(R.AES,U,H,M)},i=function(U,H,M,$){var z=R.enc.Hex.parse(H),X=R.enc.Hex.parse(M),te=R.enc.Hex.parse($),re={};re.key=X,re.iv=te,re.ciphertext=z;var k=U.decrypt(re,X,{iv:te});return R.enc.Hex.stringify(k)},a=function(U,H,M){return l(R.AES,U,H,M)},l=function(U,H,M,$){var z=R.enc.Hex.parse(H),X=R.enc.Hex.parse(M),te=R.enc.Hex.parse($),re=U.encrypt(z,X,{iv:te}),k=R.enc.Hex.parse(re.toString());return R.enc.Base64.stringify(k)},g={"AES-256-CBC":{proc:o,eproc:a,keylen:32,ivlen:16},"AES-192-CBC":{proc:o,eproc:a,keylen:24,ivlen:16},"AES-128-CBC":{proc:o,eproc:a,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:function(U,H,M){return i(R.TripleDES,U,H,M)},eproc:function(U,H,M){return l(R.TripleDES,U,H,M)},keylen:24,ivlen:8},"DES-CBC":{proc:function(U,H,M){return i(R.DES,U,H,M)},eproc:function(U,H,M){return l(R.DES,U,H,M)},keylen:8,ivlen:8}},b=function(U){var H={},M=U.match(new RegExp("DEK-Info: ([^,]+),([0-9A-Fa-f]+)","m"));M&&(H.cipher=M[1],H.ivsalt=M[2]);var $=U.match(new RegExp("-----BEGIN ([A-Z]+) PRIVATE KEY-----"));$&&(H.type=$[1]);var z=-1,X=0;U.indexOf(`\r
\r
`)!=-1&&(z=U.indexOf(`\r
\r
`),X=2),U.indexOf(`

`)!=-1&&(z=U.indexOf(`

`),X=1);var te=U.indexOf("-----END");if(z!=-1&&te!=-1){var re=U.substring(z+2*X,te-X);re=re.replace(/\s+/g,""),H.data=re}return H},T=function(U,H,M){for(var $=M.substring(0,16),z=R.enc.Hex.parse($),X=R.enc.Utf8.parse(H),te=g[U].keylen+g[U].ivlen,re="",k=null;;){var N=R.algo.MD5.create();if(k!=null&&N.update(k),N.update(X),N.update(z),k=N.finalize(),(re+=R.enc.Hex.stringify(k)).length>=2*te)break}var K={};return K.keyhex=re.substr(0,2*g[U].keylen),K.ivhex=re.substr(2*g[U].keylen,2*g[U].ivlen),K},D=function(U,H,M,$){var z=R.enc.Base64.parse(U),X=R.enc.Hex.stringify(z);return(0,g[H].proc)(X,M,$)};return{version:"1.0.0",parsePKCS5PEM:function(U){return b(U)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(U,H,M){return T(U,H,M)},decryptKeyB64:function(U,H,M,$){return D(U,H,M,$)},getDecryptedKeyHex:function(U,H){var M=b(U),$=M.cipher,z=M.ivsalt,X=M.data,te=T($,H,z).keyhex;return D(X,$,te,z)},getEncryptedPKCS5PEMFromPrvKeyHex:function(U,H,M,$,z){var X="";if($!==void 0&&$!=null||($="AES-256-CBC"),g[$]===void 0)throw new Error("KEYUTIL unsupported algorithm: "+$);z!==void 0&&z!=null||(z=function(k){var N=R.lib.WordArray.random(k);return R.enc.Hex.stringify(N)}(g[$].ivlen).toUpperCase());var te=function(k,N,K,W){return(0,g[N].eproc)(k,K,W)}(H,$,T($,M,z).keyhex,z);return X="-----BEGIN "+U+` PRIVATE KEY-----\r
`,X+=`Proc-Type: 4,ENCRYPTED\r
`,X+="DEK-Info: "+$+","+z+`\r
`,X+=`\r
`,X+=te.replace(/(.{64})/g,`$1\r
`),X+=`\r
-----END `+U+` PRIVATE KEY-----\r
`},parseHexOfEncryptedPKCS8:function(U){var H=pe,M=H.getChildIdx,$=H.getV,z={},X=M(U,0);if(X.length!=2)throw new Error("malformed format: SEQUENCE(0).items != 2: "+X.length);z.ciphertext=$(U,X[1]);var te=M(U,X[0]);if(te.length!=2)throw new Error("malformed format: SEQUENCE(0.0).items != 2: "+te.length);if($(U,te[0])!="2a864886f70d01050d")throw new Error("this only supports pkcs5PBES2");var re=M(U,te[1]);if(te.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1).items != 2: "+re.length);var k=M(U,re[1]);if(k.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1.1).items != 2: "+k.length);if($(U,k[0])!="2a864886f70d0307")throw"this only supports TripleDES";z.encryptionSchemeAlg="TripleDES",z.encryptionSchemeIV=$(U,k[1]);var N=M(U,re[0]);if(N.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1.0).items != 2: "+N.length);if($(U,N[0])!="2a864886f70d01050c")throw new Error("this only supports pkcs5PBKDF2");var K=M(U,N[1]);if(K.length<2)throw new Error("malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+K.length);z.pbkdf2Salt=$(U,K[0]);var W=$(U,K[1]);try{z.pbkdf2Iter=parseInt(W,16)}catch{throw new Error("malformed format pbkdf2Iter: "+W)}return z},getPBKDF2KeyHexFromParam:function(U,H){var M=R.enc.Hex.parse(U.pbkdf2Salt),$=U.pbkdf2Iter,z=R.PBKDF2(H,M,{keySize:6,iterations:$});return R.enc.Hex.stringify(z)},_getPlainPKCS8HexFromEncryptedPKCS8PEM:function(U,H){var M=pr(U,"ENCRYPTED PRIVATE KEY"),$=this.parseHexOfEncryptedPKCS8(M),z=pt.getPBKDF2KeyHexFromParam($,H),X={};X.ciphertext=R.enc.Hex.parse($.ciphertext);var te=R.enc.Hex.parse(z),re=R.enc.Hex.parse($.encryptionSchemeIV),k=R.TripleDES.decrypt(X,te,{iv:re});return R.enc.Hex.stringify(k)},getKeyFromEncryptedPKCS8PEM:function(U,H){var M=this._getPlainPKCS8HexFromEncryptedPKCS8PEM(U,H);return this.getKeyFromPlainPrivatePKCS8Hex(M)},parsePlainPrivatePKCS8Hex:function(U){var H=pe,M=H.getChildIdx,$=H.getV,z={algparam:null};if(U.substr(0,2)!="30")throw new Error("malformed plain PKCS8 private key(code:001)");var X=M(U,0);if(X.length<3)throw new Error("malformed plain PKCS8 private key(code:002)");if(U.substr(X[1],2)!="30")throw new Error("malformed PKCS8 private key(code:003)");var te=M(U,X[1]);if(te.length!=2)throw new Error("malformed PKCS8 private key(code:004)");if(U.substr(te[0],2)!="06")throw new Error("malformed PKCS8 private key(code:005)");if(z.algoid=$(U,te[0]),U.substr(te[1],2)=="06"&&(z.algparam=$(U,te[1])),U.substr(X[2],2)!="04")throw new Error("malformed PKCS8 private key(code:006)");return z.keyidx=H.getVidx(U,X[2]),z},getKeyFromPlainPrivatePKCS8PEM:function(U){var H=pr(U,"PRIVATE KEY");return this.getKeyFromPlainPrivatePKCS8Hex(H)},getKeyFromPlainPrivatePKCS8Hex:function(U){var H,M=this.parsePlainPrivatePKCS8Hex(U);if(M.algoid=="2a864886f70d010101")H=new Fe;else if(M.algoid=="2a8648ce380401")H=new I.crypto.DSA;else{if(M.algoid!="2a8648ce3d0201")throw new Error("unsupported private key algorithm");H=new I.crypto.ECDSA}return H.readPKCS8PrvKeyHex(U),H},_getKeyFromPublicPKCS8Hex:function(U){var H,M=pe.getVbyList(U,0,[0,0],"06");if(M==="2a864886f70d010101")H=new Fe;else if(M==="2a8648ce380401")H=new I.crypto.DSA;else{if(M!=="2a8648ce3d0201")throw new Error("unsupported PKCS#8 public key hex");H=new I.crypto.ECDSA}return H.readPKCS8PubKeyHex(U),H},parsePublicRawRSAKeyHex:function(U){var H=pe,M=H.getChildIdx,$=H.getV,z={};if(U.substr(0,2)!="30")throw new Error("malformed RSA key(code:001)");var X=M(U,0);if(X.length!=2)throw new Error("malformed RSA key(code:002)");if(U.substr(X[0],2)!="02")throw new Error("malformed RSA key(code:003)");if(z.n=$(U,X[0]),U.substr(X[1],2)!="02")throw new Error("malformed RSA key(code:004)");return z.e=$(U,X[1]),z},parsePublicPKCS8Hex:function(U){var H=pe,M=H.getChildIdx,$=H.getV,z={algparam:null},X=M(U,0);if(X.length!=2)throw new Error("outer DERSequence shall have 2 elements: "+X.length);var te=X[0];if(U.substr(te,2)!="30")throw new Error("malformed PKCS8 public key(code:001)");var re=M(U,te);if(re.length!=2)throw new Error("malformed PKCS8 public key(code:002)");if(U.substr(re[0],2)!="06")throw new Error("malformed PKCS8 public key(code:003)");if(z.algoid=$(U,re[0]),U.substr(re[1],2)=="06"?z.algparam=$(U,re[1]):U.substr(re[1],2)=="30"&&(z.algparam={},z.algparam.p=H.getVbyList(U,re[1],[0],"02"),z.algparam.q=H.getVbyList(U,re[1],[1],"02"),z.algparam.g=H.getVbyList(U,re[1],[2],"02")),U.substr(X[1],2)!="03")throw new Error("malformed PKCS8 public key(code:004)");return z.key=$(U,X[1]).substr(2),z}}}();pt.getKey=function(o,i,a){var l=(re=pe).getChildIdx,g=(re.getV,re.getVbyList),b=I.crypto,T=b.ECDSA,D=b.DSA,x=Fe,U=pr,H=pt;if(x!==void 0&&o instanceof x||T!==void 0&&o instanceof T||D!==void 0&&o instanceof D)return o;if(o.curve!==void 0&&o.xy!==void 0&&o.d===void 0)return new T({pub:o.xy,curve:o.curve});if(o.curve!==void 0&&o.d!==void 0)return new T({prv:o.d,curve:o.curve});if(o.kty===void 0&&o.n!==void 0&&o.e!==void 0&&o.d===void 0)return(Ae=new x).setPublic(o.n,o.e),Ae;if(o.kty===void 0&&o.n!==void 0&&o.e!==void 0&&o.d!==void 0&&o.p!==void 0&&o.q!==void 0&&o.dp!==void 0&&o.dq!==void 0&&o.co!==void 0&&o.qi===void 0)return(Ae=new x).setPrivateEx(o.n,o.e,o.d,o.p,o.q,o.dp,o.dq,o.co),Ae;if(o.kty===void 0&&o.n!==void 0&&o.e!==void 0&&o.d!==void 0&&o.p===void 0)return(Ae=new x).setPrivate(o.n,o.e,o.d),Ae;if(o.p!==void 0&&o.q!==void 0&&o.g!==void 0&&o.y!==void 0&&o.x===void 0)return(Ae=new D).setPublic(o.p,o.q,o.g,o.y),Ae;if(o.p!==void 0&&o.q!==void 0&&o.g!==void 0&&o.y!==void 0&&o.x!==void 0)return(Ae=new D).setPrivate(o.p,o.q,o.g,o.y,o.x),Ae;if(o.kty==="RSA"&&o.n!==void 0&&o.e!==void 0&&o.d===void 0)return(Ae=new x).setPublic(et(o.n),et(o.e)),Ae;if(o.kty==="RSA"&&o.n!==void 0&&o.e!==void 0&&o.d!==void 0&&o.p!==void 0&&o.q!==void 0&&o.dp!==void 0&&o.dq!==void 0&&o.qi!==void 0)return(Ae=new x).setPrivateEx(et(o.n),et(o.e),et(o.d),et(o.p),et(o.q),et(o.dp),et(o.dq),et(o.qi)),Ae;if(o.kty==="RSA"&&o.n!==void 0&&o.e!==void 0&&o.d!==void 0)return(Ae=new x).setPrivate(et(o.n),et(o.e),et(o.d)),Ae;if(o.kty==="EC"&&o.crv!==void 0&&o.x!==void 0&&o.y!==void 0&&o.d===void 0){var M=(ye=new T({curve:o.crv})).ecparams.keylen/4,$="04"+("0000000000"+et(o.x)).slice(-M)+("0000000000"+et(o.y)).slice(-M);return ye.setPublicKeyHex($),ye}if(o.kty==="EC"&&o.crv!==void 0&&o.x!==void 0&&o.y!==void 0&&o.d!==void 0){M=(ye=new T({curve:o.crv})).ecparams.keylen/4,$="04"+("0000000000"+et(o.x)).slice(-M)+("0000000000"+et(o.y)).slice(-M);var z=("0000000000"+et(o.d)).slice(-M);return ye.setPublicKeyHex($),ye.setPrivateKeyHex(z),ye}if(a==="pkcs5prv"){var X,te=o,re=pe;if((X=l(te,0)).length===9)(Ae=new x).readPKCS5PrvKeyHex(te);else if(X.length===6)(Ae=new D).readPKCS5PrvKeyHex(te);else{if(!(X.length>2&&te.substr(X[1],2)==="04"))throw new Error("unsupported PKCS#1/5 hexadecimal key");(Ae=new T).readPKCS5PrvKeyHex(te)}return Ae}if(a==="pkcs8prv")return Ae=H.getKeyFromPlainPrivatePKCS8Hex(o);if(a==="pkcs8pub")return H._getKeyFromPublicPKCS8Hex(o);if(a==="x509pub")return bt.getPublicKeyFromCertHex(o);if(o.indexOf("-END CERTIFICATE-",0)!=-1||o.indexOf("-END X509 CERTIFICATE-",0)!=-1||o.indexOf("-END TRUSTED CERTIFICATE-",0)!=-1)return bt.getPublicKeyFromCertPEM(o);if(o.indexOf("-END PUBLIC KEY-")!=-1){var k=pr(o,"PUBLIC KEY");return H._getKeyFromPublicPKCS8Hex(k)}if(o.indexOf("-END RSA PRIVATE KEY-")!=-1&&o.indexOf("4,ENCRYPTED")==-1){var N=U(o,"RSA PRIVATE KEY");return H.getKey(N,null,"pkcs5prv")}if(o.indexOf("-END DSA PRIVATE KEY-")!=-1&&o.indexOf("4,ENCRYPTED")==-1){var K=g(tt=U(o,"DSA PRIVATE KEY"),0,[1],"02"),W=g(tt,0,[2],"02"),Q=g(tt,0,[3],"02"),ne=g(tt,0,[4],"02"),me=g(tt,0,[5],"02");return(Ae=new D).setPrivate(new O(K,16),new O(W,16),new O(Q,16),new O(ne,16),new O(me,16)),Ae}if(o.indexOf("-END EC PRIVATE KEY-")!=-1&&o.indexOf("4,ENCRYPTED")==-1)return N=U(o,"EC PRIVATE KEY"),H.getKey(N,null,"pkcs5prv");if(o.indexOf("-END PRIVATE KEY-")!=-1)return H.getKeyFromPlainPrivatePKCS8PEM(o);if(o.indexOf("-END RSA PRIVATE KEY-")!=-1&&o.indexOf("4,ENCRYPTED")!=-1){var ae=H.getDecryptedKeyHex(o,i),Ne=new Fe;return Ne.readPKCS5PrvKeyHex(ae),Ne}if(o.indexOf("-END EC PRIVATE KEY-")!=-1&&o.indexOf("4,ENCRYPTED")!=-1){var ye,Ae=g(tt=H.getDecryptedKeyHex(o,i),0,[1],"04"),Ze=g(tt,0,[2,0],"06"),nt=g(tt,0,[3,0],"03").substr(2);if(I.crypto.OID.oidhex2name[Ze]===void 0)throw new Error("undefined OID(hex) in KJUR.crypto.OID: "+Ze);return(ye=new T({curve:I.crypto.OID.oidhex2name[Ze]})).setPublicKeyHex(nt),ye.setPrivateKeyHex(Ae),ye.isPublic=!1,ye}if(o.indexOf("-END DSA PRIVATE KEY-")!=-1&&o.indexOf("4,ENCRYPTED")!=-1){var tt;return K=g(tt=H.getDecryptedKeyHex(o,i),0,[1],"02"),W=g(tt,0,[2],"02"),Q=g(tt,0,[3],"02"),ne=g(tt,0,[4],"02"),me=g(tt,0,[5],"02"),(Ae=new D).setPrivate(new O(K,16),new O(W,16),new O(Q,16),new O(ne,16),new O(me,16)),Ae}if(o.indexOf("-END ENCRYPTED PRIVATE KEY-")!=-1)return H.getKeyFromEncryptedPKCS8PEM(o,i);throw new Error("not supported argument")},pt.generateKeypair=function(o,i){if(o=="RSA"){var a=i;(T=new Fe).generate(a,"10001"),T.isPrivate=!0,T.isPublic=!0;var l=new Fe,g=T.n.toString(16),b=T.e.toString(16);return l.setPublic(g,b),l.isPrivate=!1,l.isPublic=!0,(D={}).prvKeyObj=T,D.pubKeyObj=l,D}if(o=="EC"){var T,D,x=i,U=new I.crypto.ECDSA({curve:x}).generateKeyPairHex();return(T=new I.crypto.ECDSA({curve:x})).setPublicKeyHex(U.ecpubhex),T.setPrivateKeyHex(U.ecprvhex),T.isPrivate=!0,T.isPublic=!1,(l=new I.crypto.ECDSA({curve:x})).setPublicKeyHex(U.ecpubhex),l.isPrivate=!1,l.isPublic=!0,(D={}).prvKeyObj=T,D.pubKeyObj=l,D}throw new Error("unknown algorithm: "+o)},pt.getPEM=function(o,i,a,l,g,b){var T=I,D=T.asn1,x=D.DERObjectIdentifier,U=D.DERInteger,H=D.ASN1Util.newObject,M=D.x509.SubjectPublicKeyInfo,$=T.crypto,z=$.DSA,X=$.ECDSA,te=Fe;function re(ye){return H({seq:[{int:0},{int:{bigint:ye.n}},{int:ye.e},{int:{bigint:ye.d}},{int:{bigint:ye.p}},{int:{bigint:ye.q}},{int:{bigint:ye.dmp1}},{int:{bigint:ye.dmq1}},{int:{bigint:ye.coeff}}]})}function k(ye){return H({seq:[{int:1},{octstr:{hex:ye.prvKeyHex}},{tag:["a0",!0,{oid:{name:ye.curveName}}]},{tag:["a1",!0,{bitstr:{hex:"00"+ye.pubKeyHex}}]}]})}function N(ye){return H({seq:[{int:0},{int:{bigint:ye.p}},{int:{bigint:ye.q}},{int:{bigint:ye.g}},{int:{bigint:ye.y}},{int:{bigint:ye.x}}]})}if((te!==void 0&&o instanceof te||z!==void 0&&o instanceof z||X!==void 0&&o instanceof X)&&o.isPublic==1&&(i===void 0||i=="PKCS8PUB"))return $t(ne=new M(o).getEncodedHex(),"PUBLIC KEY");if(i=="PKCS1PRV"&&te!==void 0&&o instanceof te&&(a===void 0||a==null)&&o.isPrivate==1)return $t(ne=re(o).getEncodedHex(),"RSA PRIVATE KEY");if(i=="PKCS1PRV"&&X!==void 0&&o instanceof X&&(a===void 0||a==null)&&o.isPrivate==1){var K=new x({name:o.curveName}).getEncodedHex(),W=k(o).getEncodedHex(),Q="";return Q+=$t(K,"EC PARAMETERS"),Q+=$t(W,"EC PRIVATE KEY")}if(i=="PKCS1PRV"&&z!==void 0&&o instanceof z&&(a===void 0||a==null)&&o.isPrivate==1)return $t(ne=N(o).getEncodedHex(),"DSA PRIVATE KEY");if(i=="PKCS5PRV"&&te!==void 0&&o instanceof te&&a!==void 0&&a!=null&&o.isPrivate==1){var ne=re(o).getEncodedHex();return l===void 0&&(l="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",ne,a,l,b)}if(i=="PKCS5PRV"&&X!==void 0&&o instanceof X&&a!==void 0&&a!=null&&o.isPrivate==1)return ne=k(o).getEncodedHex(),l===void 0&&(l="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("EC",ne,a,l,b);if(i=="PKCS5PRV"&&z!==void 0&&o instanceof z&&a!==void 0&&a!=null&&o.isPrivate==1)return ne=N(o).getEncodedHex(),l===void 0&&(l="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("DSA",ne,a,l,b);var me=function(Ae,Ze){var nt=ae(Ae,Ze);return new H({seq:[{seq:[{oid:{name:"pkcs5PBES2"}},{seq:[{seq:[{oid:{name:"pkcs5PBKDF2"}},{seq:[{octstr:{hex:nt.pbkdf2Salt}},{int:nt.pbkdf2Iter}]}]},{seq:[{oid:{name:"des-EDE3-CBC"}},{octstr:{hex:nt.encryptionSchemeIV}}]}]}]},{octstr:{hex:nt.ciphertext}}]}).getEncodedHex()},ae=function(Ae,Ze){var nt=R.lib.WordArray.random(8),tt=R.lib.WordArray.random(8),Jt=R.PBKDF2(Ze,nt,{keySize:6,iterations:100}),Ht=R.enc.Hex.parse(Ae),Bt=R.TripleDES.encrypt(Ht,Jt,{iv:tt})+"",ct={};return ct.ciphertext=Bt,ct.pbkdf2Salt=R.enc.Hex.stringify(nt),ct.pbkdf2Iter=100,ct.encryptionSchemeAlg="DES-EDE3-CBC",ct.encryptionSchemeIV=R.enc.Hex.stringify(tt),ct};if(i=="PKCS8PRV"&&te!=null&&o instanceof te&&o.isPrivate==1){var Ne=re(o).getEncodedHex();return ne=H({seq:[{int:0},{seq:[{oid:{name:"rsaEncryption"}},{null:!0}]},{octstr:{hex:Ne}}]}).getEncodedHex(),a===void 0||a==null?$t(ne,"PRIVATE KEY"):$t(W=me(ne,a),"ENCRYPTED PRIVATE KEY")}if(i=="PKCS8PRV"&&X!==void 0&&o instanceof X&&o.isPrivate==1)return Ne=new H({seq:[{int:1},{octstr:{hex:o.prvKeyHex}},{tag:["a1",!0,{bitstr:{hex:"00"+o.pubKeyHex}}]}]}).getEncodedHex(),ne=H({seq:[{int:0},{seq:[{oid:{name:"ecPublicKey"}},{oid:{name:o.curveName}}]},{octstr:{hex:Ne}}]}).getEncodedHex(),a===void 0||a==null?$t(ne,"PRIVATE KEY"):$t(W=me(ne,a),"ENCRYPTED PRIVATE KEY");if(i=="PKCS8PRV"&&z!==void 0&&o instanceof z&&o.isPrivate==1)return Ne=new U({bigint:o.x}).getEncodedHex(),ne=H({seq:[{int:0},{seq:[{oid:{name:"dsa"}},{seq:[{int:{bigint:o.p}},{int:{bigint:o.q}},{int:{bigint:o.g}}]}]},{octstr:{hex:Ne}}]}).getEncodedHex(),a===void 0||a==null?$t(ne,"PRIVATE KEY"):$t(W=me(ne,a),"ENCRYPTED PRIVATE KEY");throw new Error("unsupported object nor format")},pt.getKeyFromCSRPEM=function(o){var i=pr(o,"CERTIFICATE REQUEST");return pt.getKeyFromCSRHex(i)},pt.getKeyFromCSRHex=function(o){var i=pt.parseCSRHex(o);return pt.getKey(i.p8pubkeyhex,null,"pkcs8pub")},pt.parseCSRHex=function(o){var i=pe,a=i.getChildIdx,l=i.getTLV,g={},b=o;if(b.substr(0,2)!="30")throw new Error("malformed CSR(code:001)");var T=a(b,0);if(T.length<1)throw new Error("malformed CSR(code:002)");if(b.substr(T[0],2)!="30")throw new Error("malformed CSR(code:003)");var D=a(b,T[0]);if(D.length<3)throw new Error("malformed CSR(code:004)");return g.p8pubkeyhex=l(b,D[2]),g},pt.getKeyID=function(o){var i=pt,a=pe;typeof o=="string"&&o.indexOf("BEGIN ")!=-1&&(o=i.getKey(o));var l=pr(i.getPEM(o)),g=a.getIdxbyList(l,0,[1]),b=a.getV(l,g).substring(2);return I.crypto.Util.hashHex(b,"sha1")},pt.getJWKFromKey=function(o){var i={};if(o instanceof Fe&&o.isPrivate)return i.kty="RSA",i.n=_t(o.n.toString(16)),i.e=_t(o.e.toString(16)),i.d=_t(o.d.toString(16)),i.p=_t(o.p.toString(16)),i.q=_t(o.q.toString(16)),i.dp=_t(o.dmp1.toString(16)),i.dq=_t(o.dmq1.toString(16)),i.qi=_t(o.coeff.toString(16)),i;if(o instanceof Fe&&o.isPublic)return i.kty="RSA",i.n=_t(o.n.toString(16)),i.e=_t(o.e.toString(16)),i;if(o instanceof I.crypto.ECDSA&&o.isPrivate){if((l=o.getShortNISTPCurveName())!=="P-256"&&l!=="P-384")throw new Error("unsupported curve name for JWT: "+l);var a=o.getPublicKeyXYHex();return i.kty="EC",i.crv=l,i.x=_t(a.x),i.y=_t(a.y),i.d=_t(o.prvKeyHex),i}if(o instanceof I.crypto.ECDSA&&o.isPublic){var l;if((l=o.getShortNISTPCurveName())!=="P-256"&&l!=="P-384")throw new Error("unsupported curve name for JWT: "+l);return a=o.getPublicKeyXYHex(),i.kty="EC",i.crv=l,i.x=_t(a.x),i.y=_t(a.y),i}throw new Error("not supported key object")},Fe.getPosArrayOfChildrenFromHex=function(o){return pe.getChildIdx(o,0)},Fe.getHexValueArrayOfChildrenFromHex=function(o){var i,a=pe.getV,l=a(o,(i=Fe.getPosArrayOfChildrenFromHex(o))[0]),g=a(o,i[1]),b=a(o,i[2]),T=a(o,i[3]),D=a(o,i[4]),x=a(o,i[5]),U=a(o,i[6]),H=a(o,i[7]),M=a(o,i[8]);return(i=new Array).push(l,g,b,T,D,x,U,H,M),i},Fe.prototype.readPrivateKeyFromPEMString=function(o){var i=pr(o),a=Fe.getHexValueArrayOfChildrenFromHex(i);this.setPrivateEx(a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])},Fe.prototype.readPKCS5PrvKeyHex=function(o){var i=Fe.getHexValueArrayOfChildrenFromHex(o);this.setPrivateEx(i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8])},Fe.prototype.readPKCS8PrvKeyHex=function(o){var i,a,l,g,b,T,D,x,U=pe,H=U.getVbyListEx;if(U.isASN1HEX(o)===!1)throw new Error("not ASN.1 hex string");try{i=H(o,0,[2,0,1],"02"),a=H(o,0,[2,0,2],"02"),l=H(o,0,[2,0,3],"02"),g=H(o,0,[2,0,4],"02"),b=H(o,0,[2,0,5],"02"),T=H(o,0,[2,0,6],"02"),D=H(o,0,[2,0,7],"02"),x=H(o,0,[2,0,8],"02")}catch{throw new Error("malformed PKCS#8 plain RSA private key")}this.setPrivateEx(i,a,l,g,b,T,D,x)},Fe.prototype.readPKCS5PubKeyHex=function(o){var i=pe,a=i.getV;if(i.isASN1HEX(o)===!1)throw new Error("keyHex is not ASN.1 hex string");var l=i.getChildIdx(o,0);if(l.length!==2||o.substr(l[0],2)!=="02"||o.substr(l[1],2)!=="02")throw new Error("wrong hex for PKCS#5 public key");var g=a(o,l[0]),b=a(o,l[1]);this.setPublic(g,b)},Fe.prototype.readPKCS8PubKeyHex=function(o){var i=pe;if(i.isASN1HEX(o)===!1)throw new Error("not ASN.1 hex string");if(i.getTLVbyListEx(o,0,[0,0])!=="06092a864886f70d010101")throw new Error("not PKCS8 RSA public key");var a=i.getTLVbyListEx(o,0,[1,0]);this.readPKCS5PubKeyHex(a)},Fe.prototype.readCertPubKeyHex=function(o,i){var a,l;(a=new bt).readCertHex(o),l=a.getPublicKeyHex(),this.readPKCS8PubKeyHex(l)};function ko(o,i){for(var a="",l=i/4-o.length,g=0;g<l;g++)a+="0";return a+o}function To(o,i,a){for(var l="",g=0;l.length<i;)l+=tr(a(hr(o+String.fromCharCode.apply(String,[(4278190080&g)>>24,(16711680&g)>>16,(65280&g)>>8,255&g])))),g+=1;return l}function Co(o){for(var i in I.crypto.Util.DIGESTINFOHEAD){var a=I.crypto.Util.DIGESTINFOHEAD[i],l=a.length;if(o.substring(0,l)==a)return[i,o.substring(l)]}return[]}function bt(o){var i,a=pe,l=a.getChildIdx,g=a.getV,b=a.getTLV,T=a.getVbyList,D=a.getVbyListEx,x=a.getTLVbyList,U=a.getTLVbyListEx,H=a.getIdxbyList,M=a.getIdxbyListEx,$=a.getVidx,z=a.getInt,X=a.oidname,te=a.hextooidstr,re=pr;try{i=I.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV}catch{}this.HEX2STAG={"0c":"utf8",13:"prn",16:"ia5","1a":"vis","1e":"bmp"},this.hex=null,this.version=0,this.foffset=0,this.aExtInfo=null,this.getVersion=function(){if(this.hex===null||this.version!==0)return this.version;var k=x(this.hex,0,[0,0]);if(k.substr(0,2)=="a0"){var N=x(k,0,[0]),K=z(N,0);if(K<0||2<K)throw new Error("malformed version field");return this.version=K+1,this.version}return this.version=1,this.foffset=-1,1},this.getSerialNumberHex=function(){return D(this.hex,0,[0,0],"02")},this.getSignatureAlgorithmField=function(){var k=U(this.hex,0,[0,1]);return this.getAlgorithmIdentifierName(k)},this.getAlgorithmIdentifierName=function(k){for(var N in i)if(k===i[N])return N;return X(D(k,0,[0],"06"))},this.getIssuer=function(){return this.getX500Name(this.getIssuerHex())},this.getIssuerHex=function(){return x(this.hex,0,[0,3+this.foffset],"30")},this.getIssuerString=function(){return this.getIssuer().str},this.getSubject=function(){return this.getX500Name(this.getSubjectHex())},this.getSubjectHex=function(){return x(this.hex,0,[0,5+this.foffset],"30")},this.getSubjectString=function(){return this.getSubject().str},this.getNotBefore=function(){var k=T(this.hex,0,[0,4+this.foffset,0]);return k=k.replace(/(..)/g,"%$1"),k=decodeURIComponent(k)},this.getNotAfter=function(){var k=T(this.hex,0,[0,4+this.foffset,1]);return k=k.replace(/(..)/g,"%$1"),k=decodeURIComponent(k)},this.getPublicKeyHex=function(){return a.getTLVbyList(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyIdx=function(){return H(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyContentIdx=function(){var k=this.getPublicKeyIdx();return H(this.hex,k,[1,0],"30")},this.getPublicKey=function(){return pt.getKey(this.getPublicKeyHex(),null,"pkcs8pub")},this.getSignatureAlgorithmName=function(){var k=x(this.hex,0,[1],"30");return this.getAlgorithmIdentifierName(k)},this.getSignatureValueHex=function(){return T(this.hex,0,[2],"03",!0)},this.verifySignature=function(k){var N=this.getSignatureAlgorithmField(),K=this.getSignatureValueHex(),W=x(this.hex,0,[0],"30"),Q=new I.crypto.Signature({alg:N});return Q.init(k),Q.updateHex(W),Q.verify(K)},this.parseExt=function(k){var N,K,W;if(k===void 0){if(W=this.hex,this.version!==3)return-1;N=H(W,0,[0,7,0],"30"),K=l(W,N)}else{W=pr(k);var Q=H(W,0,[0,3,0,0],"06");if(g(W,Q)!="2a864886f70d01090e")return void(this.aExtInfo=new Array);N=H(W,0,[0,3,0,1,0],"30"),K=l(W,N),this.hex=W}this.aExtInfo=new Array;for(var ne=0;ne<K.length;ne++){var me={critical:!1},ae=0;l(W,K[ne]).length===3&&(me.critical=!0,ae=1),me.oid=a.hextooidstr(T(W,K[ne],[0],"06"));var Ne=H(W,K[ne],[1+ae]);me.vidx=$(W,Ne),this.aExtInfo.push(me)}},this.getExtInfo=function(k){var N=this.aExtInfo,K=k;if(k.match(/^[0-9.]+$/)||(K=I.asn1.x509.OID.name2oid(k)),K!==""){for(var W=0;W<N.length;W++)if(N[W].oid===K)return N[W]}},this.getExtBasicConstraints=function(k,N){if(k===void 0&&N===void 0){var K=this.getExtInfo("basicConstraints");if(K===void 0)return;k=b(this.hex,K.vidx),N=K.critical}var W={extname:"basicConstraints"};if(N&&(W.critical=!0),k==="3000")return W;if(k==="30030101ff")return W.cA=!0,W;if(k.substr(0,12)==="30060101ff02"){var Q=g(k,10),ne=parseInt(Q,16);return W.cA=!0,W.pathLen=ne,W}throw new Error("hExtV parse error: "+k)},this.getExtKeyUsage=function(k,N){if(k===void 0&&N===void 0){var K=this.getExtInfo("keyUsage");if(K===void 0)return;k=b(this.hex,K.vidx),N=K.critical}var W={extname:"keyUsage"};return N&&(W.critical=!0),W.names=this.getExtKeyUsageString(k).split(","),W},this.getExtKeyUsageBin=function(k){if(k===void 0){var N=this.getExtInfo("keyUsage");if(N===void 0)return"";k=b(this.hex,N.vidx)}if(k.length!=8&&k.length!=10)throw new Error("malformed key usage value: "+k);var K="000000000000000"+parseInt(k.substr(6),16).toString(2);return k.length==8&&(K=K.slice(-8)),k.length==10&&(K=K.slice(-16)),(K=K.replace(/0+$/,""))==""&&(K="0"),K},this.getExtKeyUsageString=function(k){for(var N=this.getExtKeyUsageBin(k),K=new Array,W=0;W<N.length;W++)N.substr(W,1)=="1"&&K.push(bt.KEYUSAGE_NAME[W]);return K.join(",")},this.getExtSubjectKeyIdentifier=function(k,N){if(k===void 0&&N===void 0){var K=this.getExtInfo("subjectKeyIdentifier");if(K===void 0)return;k=b(this.hex,K.vidx),N=K.critical}var W={extname:"subjectKeyIdentifier"};N&&(W.critical=!0);var Q=g(k,0);return W.kid={hex:Q},W},this.getExtAuthorityKeyIdentifier=function(k,N){if(k===void 0&&N===void 0){var K=this.getExtInfo("authorityKeyIdentifier");if(K===void 0)return;k=b(this.hex,K.vidx),N=K.critical}var W={extname:"authorityKeyIdentifier"};N&&(W.critical=!0);for(var Q=l(k,0),ne=0;ne<Q.length;ne++){var me=k.substr(Q[ne],2);if(me==="80"&&(W.kid={hex:g(k,Q[ne])}),me==="a1"){var ae=b(k,Q[ne]),Ne=this.getGeneralNames(ae);W.issuer=Ne[0].dn}me==="82"&&(W.sn={hex:g(k,Q[ne])})}return W},this.getExtExtKeyUsage=function(k,N){if(k===void 0&&N===void 0){var K=this.getExtInfo("extKeyUsage");if(K===void 0)return;k=b(this.hex,K.vidx),N=K.critical}var W={extname:"extKeyUsage",array:[]};N&&(W.critical=!0);for(var Q=l(k,0),ne=0;ne<Q.length;ne++)W.array.push(X(g(k,Q[ne])));return W},this.getExtExtKeyUsageName=function(){var k=this.getExtInfo("extKeyUsage");if(k===void 0)return k;var N=new Array,K=b(this.hex,k.vidx);if(K==="")return N;for(var W=l(K,0),Q=0;Q<W.length;Q++)N.push(X(g(K,W[Q])));return N},this.getExtSubjectAltName=function(k,N){if(k===void 0&&N===void 0){var K=this.getExtInfo("subjectAltName");if(K===void 0)return;k=b(this.hex,K.vidx),N=K.critical}var W={extname:"subjectAltName",array:[]};return N&&(W.critical=!0),W.array=this.getGeneralNames(k),W},this.getExtIssuerAltName=function(k,N){if(k===void 0&&N===void 0){var K=this.getExtInfo("issuerAltName");if(K===void 0)return;k=b(this.hex,K.vidx),N=K.critical}var W={extname:"issuerAltName",array:[]};return N&&(W.critical=!0),W.array=this.getGeneralNames(k),W},this.getGeneralNames=function(k){for(var N=l(k,0),K=[],W=0;W<N.length;W++){var Q=this.getGeneralName(b(k,N[W]));Q!==void 0&&K.push(Q)}return K},this.getGeneralName=function(k){var N=k.substr(0,2),K=g(k,0),W=tr(K);return N=="81"?{rfc822:W}:N=="82"?{dns:W}:N=="86"?{uri:W}:N=="87"?{ip:di(K)}:N=="a4"?{dn:this.getX500Name(K)}:void 0},this.getExtSubjectAltName2=function(){var k,N,K,W=this.getExtInfo("subjectAltName");if(W===void 0)return W;for(var Q=new Array,ne=b(this.hex,W.vidx),me=l(ne,0),ae=0;ae<me.length;ae++)K=ne.substr(me[ae],2),k=g(ne,me[ae]),K==="81"&&(N=wt(k),Q.push(["MAIL",N])),K==="82"&&(N=wt(k),Q.push(["DNS",N])),K==="84"&&(N=bt.hex2dn(k,0),Q.push(["DN",N])),K==="86"&&(N=wt(k),Q.push(["URI",N])),K==="87"&&(N=di(k),Q.push(["IP",N]));return Q},this.getExtCRLDistributionPoints=function(k,N){if(k===void 0&&N===void 0){var K=this.getExtInfo("cRLDistributionPoints");if(K===void 0)return;k=b(this.hex,K.vidx),N=K.critical}var W={extname:"cRLDistributionPoints",array:[]};N&&(W.critical=!0);for(var Q=l(k,0),ne=0;ne<Q.length;ne++){var me=b(k,Q[ne]);W.array.push(this.getDistributionPoint(me))}return W},this.getDistributionPoint=function(k){for(var N={},K=l(k,0),W=0;W<K.length;W++){var Q=k.substr(K[W],2),ne=b(k,K[W]);Q=="a0"&&(N.dpname=this.getDistributionPointName(ne))}return N},this.getDistributionPointName=function(k){for(var N={},K=l(k,0),W=0;W<K.length;W++){var Q=k.substr(K[W],2),ne=b(k,K[W]);Q=="a0"&&(N.full=this.getGeneralNames(ne))}return N},this.getExtCRLDistributionPointsURI=function(){var k=this.getExtInfo("cRLDistributionPoints");if(k===void 0)return k;for(var N=new Array,K=l(this.hex,k.vidx),W=0;W<K.length;W++)try{var Q=wt(T(this.hex,K[W],[0,0,0],"86"));N.push(Q)}catch{}return N},this.getExtAIAInfo=function(){var k=this.getExtInfo("authorityInfoAccess");if(k===void 0)return k;for(var N={ocsp:[],caissuer:[]},K=l(this.hex,k.vidx),W=0;W<K.length;W++){var Q=T(this.hex,K[W],[0],"06"),ne=T(this.hex,K[W],[1],"86");Q==="2b06010505073001"&&N.ocsp.push(wt(ne)),Q==="2b06010505073002"&&N.caissuer.push(wt(ne))}return N},this.getExtAuthorityInfoAccess=function(k,N){if(k===void 0&&N===void 0){var K=this.getExtInfo("authorityInfoAccess");if(K===void 0)return;k=b(this.hex,K.vidx),N=K.critical}var W={extname:"authorityInfoAccess",array:[]};N&&(W.critical=!0);for(var Q=l(k,0),ne=0;ne<Q.length;ne++){var me=D(k,Q[ne],[0],"06"),ae=wt(T(k,Q[ne],[1],"86"));if(me=="2b06010505073001")W.array.push({ocsp:ae});else{if(me!="2b06010505073002")throw new Error("unknown method: "+me);W.array.push({caissuer:ae})}}return W},this.getExtCertificatePolicies=function(k,N){if(k===void 0&&N===void 0){var K=this.getExtInfo("certificatePolicies");if(K===void 0)return;k=b(this.hex,K.vidx),N=K.critical}var W={extname:"certificatePolicies",array:[]};N&&(W.critical=!0);for(var Q=l(k,0),ne=0;ne<Q.length;ne++){var me=b(k,Q[ne]),ae=this.getPolicyInformation(me);W.array.push(ae)}return W},this.getPolicyInformation=function(k){var N={},K=T(k,0,[0],"06");N.policyoid=X(K);var W=M(k,0,[1],"30");if(W!=-1){N.array=[];for(var Q=l(k,W),ne=0;ne<Q.length;ne++){var me=b(k,Q[ne]),ae=this.getPolicyQualifierInfo(me);N.array.push(ae)}}return N},this.getPolicyQualifierInfo=function(k){var N={},K=T(k,0,[0],"06");if(K==="2b06010505070201"){var W=D(k,0,[1],"16");N.cps=tr(W)}else if(K==="2b06010505070202"){var Q=x(k,0,[1],"30");N.unotice=this.getUserNotice(Q)}return N},this.getUserNotice=function(k){for(var N={},K=l(k,0),W=0;W<K.length;W++){var Q=b(k,K[W]);Q.substr(0,2)!="30"&&(N.exptext=this.getDisplayText(Q))}return N},this.getDisplayText=function(k){var N={};return N.type={"0c":"utf8",16:"ia5","1a":"vis","1e":"bmp"}[k.substr(0,2)],N.str=tr(g(k,0)),N},this.getExtCRLNumber=function(k,N){var K={extname:"cRLNumber"};if(N&&(K.critical=!0),k.substr(0,2)=="02")return K.num={hex:g(k,0)},K;throw new Error("hExtV parse error: "+k)},this.getExtCRLReason=function(k,N){var K={extname:"cRLReason"};if(N&&(K.critical=!0),k.substr(0,2)=="0a")return K.code=parseInt(g(k,0),16),K;throw new Error("hExtV parse error: "+k)},this.getExtOcspNonce=function(k,N){var K={extname:"ocspNonce"};N&&(K.critical=!0);var W=g(k,0);return K.hex=W,K},this.getExtOcspNoCheck=function(k,N){var K={extname:"ocspNoCheck"};return N&&(K.critical=!0),K},this.getExtAdobeTimeStamp=function(k,N){if(k===void 0&&N===void 0){var K=this.getExtInfo("adobeTimeStamp");if(K===void 0)return;k=b(this.hex,K.vidx),N=K.critical}var W={extname:"adobeTimeStamp"};N&&(W.critical=!0);var Q=l(k,0);if(Q.length>1){var ne=b(k,Q[1]),me=this.getGeneralName(ne);me.uri!=null&&(W.uri=me.uri)}if(Q.length>2){var ae=b(k,Q[2]);ae=="0101ff"&&(W.reqauth=!0),ae=="010100"&&(W.reqauth=!1)}return W},this.getX500NameRule=function(k){for(var N=null,K=[],W=0;W<k.length;W++)for(var Q=k[W],ne=0;ne<Q.length;ne++)K.push(Q[ne]);for(W=0;W<K.length;W++){var me=K[W],ae=me.ds,Ne=me.value,ye=me.type;if(ae!="prn"&&ae!="utf8"&&ae!="ia5")return"mixed";if(ae=="ia5"){if(ye!="CN")return"mixed";if(I.lang.String.isMail(Ne))continue;return"mixed"}if(ye=="C"){if(ae=="prn")continue;return"mixed"}if(N==null)N=ae;else if(N!==ae)return"mixed"}return N==null?"prn":N},this.getX500Name=function(k){var N=this.getX500NameArray(k);return{array:N,str:this.dnarraytostr(N)}},this.getX500NameArray=function(k){for(var N=[],K=l(k,0),W=0;W<K.length;W++)N.push(this.getRDN(b(k,K[W])));return N},this.getRDN=function(k){for(var N=[],K=l(k,0),W=0;W<K.length;W++)N.push(this.getAttrTypeAndValue(b(k,K[W])));return N},this.getAttrTypeAndValue=function(k){var N={type:null,value:null,ds:null},K=l(k,0),W=T(k,K[0],[],"06"),Q=T(k,K[1],[]),ne=I.asn1.ASN1Util.oidHexToInt(W);return N.type=I.asn1.x509.OID.oid2atype(ne),N.ds=this.HEX2STAG[k.substr(K[1],2)],N.ds!="bmp"?N.value=wt(Q):N.value=Fo(Q),N},this.readCertPEM=function(k){this.readCertHex(re(k))},this.readCertHex=function(k){this.hex=k,this.getVersion();try{H(this.hex,0,[0,7],"a3"),this.parseExt()}catch{}},this.getParam=function(){var k={};return k.version=this.getVersion(),k.serial={hex:this.getSerialNumberHex()},k.sigalg=this.getSignatureAlgorithmField(),k.issuer=this.getIssuer(),k.notbefore=this.getNotBefore(),k.notafter=this.getNotAfter(),k.subject=this.getSubject(),k.sbjpubkey=$t(this.getPublicKeyHex(),"PUBLIC KEY"),this.aExtInfo.length>0&&(k.ext=this.getExtParamArray()),k.sighex=this.getSignatureValueHex(),k},this.getExtParamArray=function(k){k==null&&M(this.hex,0,[0,"[3]"])!=-1&&(k=U(this.hex,0,[0,"[3]",0],"30"));for(var N=[],K=l(k,0),W=0;W<K.length;W++){var Q=b(k,K[W]),ne=this.getExtParam(Q);ne!=null&&N.push(ne)}return N},this.getExtParam=function(k){var N=l(k,0).length;if(N!=2&&N!=3)throw new Error("wrong number elements in Extension: "+N+" "+k);var K=te(T(k,0,[0],"06")),W=!1;N==3&&x(k,0,[1])=="0101ff"&&(W=!0);var Q=x(k,0,[N-1,0]),ne=void 0;if(K=="2.5.29.14"?ne=this.getExtSubjectKeyIdentifier(Q,W):K=="2.5.29.15"?ne=this.getExtKeyUsage(Q,W):K=="2.5.29.17"?ne=this.getExtSubjectAltName(Q,W):K=="2.5.29.18"?ne=this.getExtIssuerAltName(Q,W):K=="2.5.29.19"?ne=this.getExtBasicConstraints(Q,W):K=="2.5.29.31"?ne=this.getExtCRLDistributionPoints(Q,W):K=="2.5.29.32"?ne=this.getExtCertificatePolicies(Q,W):K=="2.5.29.35"?ne=this.getExtAuthorityKeyIdentifier(Q,W):K=="2.5.29.37"?ne=this.getExtExtKeyUsage(Q,W):K=="1.3.6.1.5.5.7.1.1"?ne=this.getExtAuthorityInfoAccess(Q,W):K=="2.5.29.20"?ne=this.getExtCRLNumber(Q,W):K=="2.5.29.21"?ne=this.getExtCRLReason(Q,W):K=="1.3.6.1.5.5.7.48.1.2"?ne=this.getExtOcspNonce(Q,W):K=="1.3.6.1.5.5.7.48.1.5"?ne=this.getExtOcspNoCheck(Q,W):K=="1.2.840.113583.1.1.9.1"&&(ne=this.getExtAdobeTimeStamp(Q,W)),ne!=null)return ne;var me={extname:K,extn:Q};return W&&(me.critical=!0),me},this.findExt=function(k,N){for(var K=0;K<k.length;K++)if(k[K].extname==N)return k[K];return null},this.updateExtCDPFullURI=function(k,N){var K=this.findExt(k,"cRLDistributionPoints");if(K!=null&&K.array!=null){for(var W=K.array,Q=0;Q<W.length;Q++)if(W[Q].dpname!=null&&W[Q].dpname.full!=null)for(var ne=W[Q].dpname.full,me=0;me<ne.length;me++){var ae=ne[Q];ae.uri!=null&&(ae.uri=N)}}},this.updateExtAIAOCSP=function(k,N){var K=this.findExt(k,"authorityInfoAccess");if(K!=null&&K.array!=null)for(var W=K.array,Q=0;Q<W.length;Q++)W[Q].ocsp!=null&&(W[Q].ocsp=N)},this.updateExtAIACAIssuer=function(k,N){var K=this.findExt(k,"authorityInfoAccess");if(K!=null&&K.array!=null)for(var W=K.array,Q=0;Q<W.length;Q++)W[Q].caissuer!=null&&(W[Q].caissuer=N)},this.dnarraytostr=function(k){return"/"+k.map(function(N){return function(W){return W.map(function(Q){return function(me){return me.type+"="+me.value}(Q).replace(/\+/,"\\+")}).join("+")}(N).replace(/\//,"\\/")}).join("/")},this.getInfo=function(){var k,N,K,W=function(Jt){return JSON.stringify(Jt.array).replace(/[\[\]\{\}\"]/g,"")},Q=function(Jt){for(var Ht="",Bt=Jt.array,ct=0;ct<Bt.length;ct++){var St=Bt[ct];if(Ht+="    policy oid: "+St.policyoid+`
`,St.array!==void 0)for(var It=0;It<St.array.length;It++){var jt=St.array[It];jt.cps!==void 0&&(Ht+="    cps: "+jt.cps+`
`)}}return Ht},ne=function(Jt){for(var Ht="",Bt=Jt.array,ct=0;ct<Bt.length;ct++){var St=Bt[ct];try{St.dpname.full[0].uri!==void 0&&(Ht+="    "+St.dpname.full[0].uri+`
`)}catch{}try{St.dname.full[0].dn.hex!==void 0&&(Ht+="    "+bt.hex2dn(St.dpname.full[0].dn.hex)+`
`)}catch{}}return Ht},me=function(Jt){for(var Ht="",Bt=Jt.array,ct=0;ct<Bt.length;ct++){var St=Bt[ct];St.caissuer!==void 0&&(Ht+="    caissuer: "+St.caissuer+`
`),St.ocsp!==void 0&&(Ht+="    ocsp: "+St.ocsp+`
`)}return Ht};if(k=`Basic Fields
`,k+="  serial number: "+this.getSerialNumberHex()+`
`,k+="  signature algorithm: "+this.getSignatureAlgorithmField()+`
`,k+="  issuer: "+this.getIssuerString()+`
`,k+="  notBefore: "+this.getNotBefore()+`
`,k+="  notAfter: "+this.getNotAfter()+`
`,k+="  subject: "+this.getSubjectString()+`
`,k+=`  subject public key info: 
`,k+="    key algorithm: "+(N=this.getPublicKey()).type+`
`,N.type==="RSA"&&(k+="    n="+fi(N.n.toString(16)).substr(0,16)+`...
`,k+="    e="+fi(N.e.toString(16))+`
`),(K=this.aExtInfo)!=null){k+=`X509v3 Extensions:
`;for(var ae=0;ae<K.length;ae++){var Ne=K[ae],ye=I.asn1.x509.OID.oid2name(Ne.oid);ye===""&&(ye=Ne.oid);var Ae="";if(Ne.critical===!0&&(Ae="CRITICAL"),k+="  "+ye+" "+Ae+`:
`,ye==="basicConstraints"){var Ze=this.getExtBasicConstraints();Ze.cA===void 0?k+=`    {}
`:(k+="    cA=true",Ze.pathLen!==void 0&&(k+=", pathLen="+Ze.pathLen),k+=`
`)}else if(ye==="keyUsage")k+="    "+this.getExtKeyUsageString()+`
`;else if(ye==="subjectKeyIdentifier")k+="    "+this.getExtSubjectKeyIdentifier().kid.hex+`
`;else if(ye==="authorityKeyIdentifier"){var nt=this.getExtAuthorityKeyIdentifier();nt.kid!==void 0&&(k+="    kid="+nt.kid.hex+`
`)}else ye==="extKeyUsage"?k+="    "+this.getExtExtKeyUsage().array.join(", ")+`
`:ye==="subjectAltName"?k+="    "+W(this.getExtSubjectAltName())+`
`:ye==="cRLDistributionPoints"?k+=ne(this.getExtCRLDistributionPoints()):ye==="authorityInfoAccess"?k+=me(this.getExtAuthorityInfoAccess()):ye==="certificatePolicies"&&(k+=Q(this.getExtCertificatePolicies()))}}return k+="signature algorithm: "+this.getSignatureAlgorithmName()+`
`,k+="signature: "+this.getSignatureValueHex().substr(0,16)+`...
`},typeof o=="string"&&(o.indexOf("-----BEGIN")!=-1?this.readCertPEM(o):I.lang.String.isHex(o)&&this.readCertHex(o))}Fe.prototype.sign=function(o,i){var a=function(g){return I.crypto.Util.hashString(g,i)}(o);return this.signWithMessageHash(a,i)},Fe.prototype.signWithMessageHash=function(o,i){var a=Vt(I.crypto.Util.getPaddedDigestInfoHex(o,i,this.n.bitLength()),16);return ko(this.doPrivate(a).toString(16),this.n.bitLength())},Fe.prototype.signPSS=function(o,i,a){var l=function(b){return I.crypto.Util.hashHex(b,i)}(hr(o));return a===void 0&&(a=-1),this.signWithMessageHashPSS(l,i,a)},Fe.prototype.signWithMessageHashPSS=function(o,i,a){var l,g=tr(o),b=g.length,T=this.n.bitLength()-1,D=Math.ceil(T/8),x=function(k){return I.crypto.Util.hashHex(k,i)};if(a===-1||a===void 0)a=b;else if(a===-2)a=D-b-2;else if(a<-2)throw new Error("invalid salt length");if(D<b+a+2)throw new Error("data too long");var U="";a>0&&(U=new Array(a),new Ge().nextBytes(U),U=String.fromCharCode.apply(String,U));var H=tr(x(hr("\0\0\0\0\0\0\0\0"+g+U))),M=[];for(l=0;l<D-a-b-2;l+=1)M[l]=0;var $=String.fromCharCode.apply(String,M)+""+U,z=To(H,$.length,x),X=[];for(l=0;l<$.length;l+=1)X[l]=$.charCodeAt(l)^z.charCodeAt(l);var te=65280>>8*D-T&255;for(X[0]&=~te,l=0;l<b;l++)X.push(H.charCodeAt(l));return X.push(188),ko(this.doPrivate(new O(X)).toString(16),this.n.bitLength())},Fe.prototype.verify=function(o,i){if((i=i.toLowerCase()).match(/^[0-9a-f]+$/)==null)return!1;var a=Vt(i,16),l=this.n.bitLength();if(a.bitLength()>l)return!1;var g=this.doPublic(a).toString(16);if(g.length+3!=l/4)return!1;var b=Co(g.replace(/^1f+00/,""));if(b.length==0)return!1;var T=b[0];return b[1]==function(x){return I.crypto.Util.hashString(x,T)}(o)},Fe.prototype.verifyWithMessageHash=function(o,i){if(i.length!=Math.ceil(this.n.bitLength()/4))return!1;var a=Vt(i,16);if(a.bitLength()>this.n.bitLength())return 0;var l=Co(this.doPublic(a).toString(16).replace(/^1f+00/,""));return l.length==0?!1:(l[0],l[1]==o)},Fe.prototype.verifyPSS=function(o,i,a,l){var g=function(T){return I.crypto.Util.hashHex(T,a)}(hr(o));return l===void 0&&(l=-1),this.verifyWithMessageHashPSS(g,i,a,l)},Fe.prototype.verifyWithMessageHashPSS=function(o,i,a,l){if(i.length!=Math.ceil(this.n.bitLength()/4))return!1;var g,b=new O(i,16),T=function(K){return I.crypto.Util.hashHex(K,a)},D=tr(o),x=D.length,U=this.n.bitLength()-1,H=Math.ceil(U/8);if(l===-1||l===void 0)l=x;else if(l===-2)l=H-x-2;else if(l<-2)throw new Error("invalid salt length");if(H<x+l+2)throw new Error("data too long");var M=this.doPublic(b).toByteArray();for(g=0;g<M.length;g+=1)M[g]&=255;for(;M.length<H;)M.unshift(0);if(M[H-1]!==188)throw new Error("encoded message does not end in 0xbc");var $=(M=String.fromCharCode.apply(String,M)).substr(0,H-x-1),z=M.substr($.length,x),X=65280>>8*H-U&255;if(($.charCodeAt(0)&X)!=0)throw new Error("bits beyond keysize not zero");var te=To(z,$.length,T),re=[];for(g=0;g<$.length;g+=1)re[g]=$.charCodeAt(g)^te.charCodeAt(g);re[0]&=~X;var k=H-x-l-2;for(g=0;g<k;g+=1)if(re[g]!==0)throw new Error("leftmost octets not zero");if(re[k]!==1)throw new Error("0x01 marker not found");return z===tr(T(hr("\0\0\0\0\0\0\0\0"+D+String.fromCharCode.apply(String,re.slice(-l)))))},Fe.SALT_LEN_HLEN=-1,Fe.SALT_LEN_MAX=-2,Fe.SALT_LEN_RECOVER=-2,bt.hex2dn=function(o,i){i===void 0&&(i=0);var a=new bt;return pe.getTLV(o,i),a.getX500Name(o).str},bt.hex2rdn=function(o,i){if(i===void 0&&(i=0),o.substr(i,2)!=="31")throw new Error("malformed RDN");for(var a=new Array,l=pe.getChildIdx(o,i),g=0;g<l.length;g++)a.push(bt.hex2attrTypeValue(o,l[g]));return(a=a.map(function(b){return b.replace("+","\\+")})).join("+")},bt.hex2attrTypeValue=function(o,i){var a=pe,l=a.getV;if(i===void 0&&(i=0),o.substr(i,2)!=="30")throw new Error("malformed attribute type and value");var g=a.getChildIdx(o,i);g.length!==2||o.substr(g[0],2);var b=l(o,g[0]),T=I.asn1.ASN1Util.oidHexToInt(b);return I.asn1.x509.OID.oid2atype(T)+"="+tr(l(o,g[1]))},bt.getPublicKeyFromCertHex=function(o){var i=new bt;return i.readCertHex(o),i.getPublicKey()},bt.getPublicKeyFromCertPEM=function(o){var i=new bt;return i.readCertPEM(o),i.getPublicKey()},bt.getPublicKeyInfoPropOfCertPEM=function(o){var i,a,l=pe.getVbyList,g={};return g.algparam=null,(i=new bt).readCertPEM(o),a=i.getPublicKeyHex(),g.keyhex=l(a,0,[1],"03").substr(2),g.algoid=l(a,0,[0,0],"06"),g.algoid==="2a8648ce3d0201"&&(g.algparam=l(a,0,[0,1],"06")),g},bt.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"],I!==void 0&&I||(r.KJUR=I={}),I.jws!==void 0&&I.jws||(I.jws={}),I.jws.JWS=function(){var o=I.jws.JWS.isSafeJSONString;this.parseJWS=function(i,a){if(this.parsedJWS===void 0||!a&&this.parsedJWS.sigvalH===void 0){var l=i.match(/^([^.]+)\.([^.]+)\.([^.]+)$/);if(l==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var g=l[1],b=l[2],T=l[3],D=g+"."+b;if(this.parsedJWS={},this.parsedJWS.headB64U=g,this.parsedJWS.payloadB64U=b,this.parsedJWS.sigvalB64U=T,this.parsedJWS.si=D,!a){var x=et(T),U=Vt(x,16);this.parsedJWS.sigvalH=x,this.parsedJWS.sigvalBI=U}var H=cr(g),M=cr(b);if(this.parsedJWS.headS=H,this.parsedJWS.payloadS=M,!o(H,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+H}}},I.jws.JWS.sign=function(o,i,a,l,g){var b,T,D,x=I,U=x.jws.JWS,H=U.readSafeJSONString,M=U.isSafeJSONString,$=x.crypto,z=($.ECDSA,$.Mac),X=$.Signature,te=JSON;if(typeof i!="string"&&(i===void 0?"undefined":_(i))!="object")throw"spHeader must be JSON string or object: "+i;if((i===void 0?"undefined":_(i))=="object"&&(T=i,b=te.stringify(T)),typeof i=="string"){if(!M(b=i))throw"JWS Head is not safe JSON string: "+b;T=H(b)}if(D=a,(a===void 0?"undefined":_(a))=="object"&&(D=te.stringify(a)),o!=""&&o!=null||T.alg===void 0||(o=T.alg),o!=""&&o!=null&&T.alg===void 0&&(T.alg=o,b=te.stringify(T)),o!==T.alg)throw"alg and sHeader.alg doesn't match: "+o+"!="+T.alg;var re=null;if(U.jwsalg2sigalg[o]===void 0)throw"unsupported alg name: "+o;re=U.jwsalg2sigalg[o];var k=sn(b)+"."+sn(D),N="";if(re.substr(0,4)=="Hmac"){if(l===void 0)throw"mac key shall be specified for HS* alg";var K=new z({alg:re,prov:"cryptojs",pass:l});K.updateString(k),N=K.doFinal()}else if(re.indexOf("withECDSA")!=-1){(Q=new X({alg:re})).init(l,g),Q.updateString(k);var W=Q.sign();N=I.crypto.ECDSA.asn1SigToConcatSig(W)}else{var Q;re!="none"&&((Q=new X({alg:re})).init(l,g),Q.updateString(k),N=Q.sign())}return k+"."+_t(N)},I.jws.JWS.verify=function(o,i,a){var l,g=I,b=g.jws.JWS,T=b.readSafeJSONString,D=g.crypto,x=D.ECDSA,U=D.Mac,H=D.Signature;_(Fe)!==void 0&&(l=Fe);var M=o.split(".");if(M.length!==3)return!1;var $=M[0]+"."+M[1],z=et(M[2]),X=T(cr(M[0])),te=null,re=null;if(X.alg===void 0)throw"algorithm not specified in header";if(re=(te=X.alg).substr(0,2),a!=null&&Object.prototype.toString.call(a)==="[object Array]"&&a.length>0&&(":"+a.join(":")+":").indexOf(":"+te+":")==-1)throw"algorithm '"+te+"' not accepted in the list";if(te!="none"&&i===null)throw"key shall be specified to verify.";if(typeof i=="string"&&i.indexOf("-----BEGIN ")!=-1&&(i=pt.getKey(i)),!(re!="RS"&&re!="PS"||i instanceof l))throw"key shall be a RSAKey obj for RS* and PS* algs";if(re=="ES"&&!(i instanceof x))throw"key shall be a ECDSA obj for ES* algs";var k=null;if(b.jwsalg2sigalg[X.alg]===void 0)throw"unsupported alg name: "+te;if((k=b.jwsalg2sigalg[te])=="none")throw"not supported";if(k.substr(0,4)=="Hmac"){if(i===void 0)throw"hexadecimal key shall be specified for HMAC";var N=new U({alg:k,pass:i});return N.updateString($),z==N.doFinal()}if(k.indexOf("withECDSA")!=-1){var K,W=null;try{W=x.concatSigToASN1Sig(z)}catch{return!1}return(K=new H({alg:k})).init(i),K.updateString($),K.verify(W)}return(K=new H({alg:k})).init(i),K.updateString($),K.verify(z)},I.jws.JWS.parse=function(o){var i,a,l,g=o.split("."),b={};if(g.length!=2&&g.length!=3)throw"malformed sJWS: wrong number of '.' splitted elements";return i=g[0],a=g[1],g.length==3&&(l=g[2]),b.headerObj=I.jws.JWS.readSafeJSONString(cr(i)),b.payloadObj=I.jws.JWS.readSafeJSONString(cr(a)),b.headerPP=JSON.stringify(b.headerObj,null,"  "),b.payloadObj==null?b.payloadPP=cr(a):b.payloadPP=JSON.stringify(b.payloadObj,null,"  "),l!==void 0&&(b.sigHex=et(l)),b},I.jws.JWS.verifyJWT=function(o,i,a){var l=I.jws,g=l.JWS,b=g.readSafeJSONString,T=g.inArray,D=g.includedArray,x=o.split("."),U=x[0],H=x[1],M=(et(x[2]),b(cr(U))),$=b(cr(H));if(M.alg===void 0)return!1;if(a.alg===void 0)throw"acceptField.alg shall be specified";if(!T(M.alg,a.alg)||$.iss!==void 0&&_(a.iss)==="object"&&!T($.iss,a.iss)||$.sub!==void 0&&_(a.sub)==="object"&&!T($.sub,a.sub))return!1;if($.aud!==void 0&&_(a.aud)==="object"){if(typeof $.aud=="string"){if(!T($.aud,a.aud))return!1}else if(_($.aud)=="object"&&!D($.aud,a.aud))return!1}var z=l.IntDate.getNow();return a.verifyAt!==void 0&&typeof a.verifyAt=="number"&&(z=a.verifyAt),a.gracePeriod!==void 0&&typeof a.gracePeriod=="number"||(a.gracePeriod=0),!($.exp!==void 0&&typeof $.exp=="number"&&$.exp+a.gracePeriod<z)&&!($.nbf!==void 0&&typeof $.nbf=="number"&&z<$.nbf-a.gracePeriod)&&!($.iat!==void 0&&typeof $.iat=="number"&&z<$.iat-a.gracePeriod)&&($.jti===void 0||a.jti===void 0||$.jti===a.jti)&&!!g.verify(o,i,a.alg)},I.jws.JWS.includedArray=function(o,i){var a=I.jws.JWS.inArray;if(o===null||(o===void 0?"undefined":_(o))!=="object"||typeof o.length!="number")return!1;for(var l=0;l<o.length;l++)if(!a(o[l],i))return!1;return!0},I.jws.JWS.inArray=function(o,i){if(i===null||(i===void 0?"undefined":_(i))!=="object"||typeof i.length!="number")return!1;for(var a=0;a<i.length;a++)if(i[a]==o)return!0;return!1},I.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS384:"HmacSHA384",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"},I.jws.JWS.isSafeJSONString=function(o,i,a){var l=null;try{return((l=go(o))===void 0?"undefined":_(l))!="object"||l.constructor===Array?0:(i&&(i[a]=l),1)}catch{return 0}},I.jws.JWS.readSafeJSONString=function(o){var i=null;try{return((i=go(o))===void 0?"undefined":_(i))!="object"||i.constructor===Array?null:i}catch{return null}},I.jws.JWS.getEncodedSignatureValueFromJWS=function(o){var i=o.match(/^[^.]+\.[^.]+\.([^.]+)$/);if(i==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return i[1]},I.jws.JWS.getJWKthumbprint=function(o){if(o.kty!=="RSA"&&o.kty!=="EC"&&o.kty!=="oct")throw"unsupported algorithm for JWK Thumprint";var i="{";if(o.kty==="RSA"){if(typeof o.n!="string"||typeof o.e!="string")throw"wrong n and e value for RSA key";i+='"e":"'+o.e+'",',i+='"kty":"'+o.kty+'",',i+='"n":"'+o.n+'"}'}else if(o.kty==="EC"){if(typeof o.crv!="string"||typeof o.x!="string"||typeof o.y!="string")throw"wrong crv, x and y value for EC key";i+='"crv":"'+o.crv+'",',i+='"kty":"'+o.kty+'",',i+='"x":"'+o.x+'",',i+='"y":"'+o.y+'"}'}else if(o.kty==="oct"){if(typeof o.k!="string")throw"wrong k value for oct(symmetric) key";i+='"kty":"'+o.kty+'",',i+='"k":"'+o.k+'"}'}var a=hr(i);return _t(I.crypto.Util.hashHex(a,"sha256"))},I.jws.IntDate={},I.jws.IntDate.get=function(o){var i=I.jws.IntDate,a=i.getNow,l=i.getZulu;if(o=="now")return a();if(o=="now + 1hour")return a()+3600;if(o=="now + 1day")return a()+86400;if(o=="now + 1month")return a()+2592e3;if(o=="now + 1year")return a()+31536e3;if(o.match(/Z$/))return l(o);if(o.match(/^[0-9]+$/))return parseInt(o);throw"unsupported format: "+o},I.jws.IntDate.getZulu=function(o){return bo(o)},I.jws.IntDate.getNow=function(){return~~(new Date/1e3)},I.jws.IntDate.intDate2UTCString=function(o){return new Date(1e3*o).toUTCString()},I.jws.IntDate.intDate2Zulu=function(o){var i=new Date(1e3*o);return("0000"+i.getUTCFullYear()).slice(-4)+("00"+(i.getUTCMonth()+1)).slice(-2)+("00"+i.getUTCDate()).slice(-2)+("00"+i.getUTCHours()).slice(-2)+("00"+i.getUTCMinutes()).slice(-2)+("00"+i.getUTCSeconds()).slice(-2)+"Z"},r.SecureRandom=Ge,r.rng_seed_time=ee,r.BigInteger=O,r.RSAKey=Fe;var Ta=I.crypto.EDSA;r.EDSA=Ta;var Ca=I.crypto.DSA;r.DSA=Ca;var Ia=I.crypto.Signature;r.Signature=Ia;var xa=I.crypto.MessageDigest;r.MessageDigest=xa;var Ra=I.crypto.Mac;r.Mac=Ra;var Ua=I.crypto.Cipher;r.Cipher=Ua,r.KEYUTIL=pt,r.ASN1HEX=pe,r.X509=bt,r.CryptoJS=R,r.b64tohex=Z,r.b64toBA=Y,r.stoBA=yo,r.BAtos=vo,r.BAtohex=Pn,r.stohex=Sr,r.stob64=function(i){return B(Sr(i))},r.stob64u=function(i){return kn(B(Sr(i)))},r.b64utos=function(i){return vo(Y(an(i)))},r.b64tob64u=kn,r.b64utob64=an,r.hex2b64=B,r.hextob64u=_t,r.b64utohex=et,r.utf8tob64u=sn,r.b64utoutf8=cr,r.utf8tob64=function(i){return B(Tn(In(i)))},r.b64toutf8=function(i){return decodeURIComponent(Cn(Z(i)))},r.utf8tohex=ci,r.hextoutf8=wt,r.hextorstr=tr,r.rstrtohex=hr,r.hextob64=mo,r.hextob64nl=_o,r.b64nltohex=wo,r.hextopem=$t,r.pemtohex=pr,r.hextoArrayBuffer=function(i){if(i.length%2!=0)throw"input is not even length";if(i.match(/^[0-9A-Fa-f]+$/)==null)throw"input is not hexadecimal";for(var a=new ArrayBuffer(i.length/2),l=new DataView(a),g=0;g<i.length/2;g++)l.setUint8(g,parseInt(i.substr(2*g,2),16));return a},r.ArrayBuffertohex=function(i){for(var a="",l=new DataView(i),g=0;g<i.byteLength;g++)a+=("00"+l.getUint8(g).toString(16)).slice(-2);return a},r.zulutomsec=li,r.zulutosec=bo,r.zulutodate=function(i){return new Date(li(i))},r.datetozulu=function(i,a,l){var g,b=i.getUTCFullYear();if(a){if(b<1950||2049<b)throw"not proper year for UTCTime: "+b;g=(""+b).slice(-2)}else g=("000"+b).slice(-4);if(g+=("0"+(i.getUTCMonth()+1)).slice(-2),g+=("0"+i.getUTCDate()).slice(-2),g+=("0"+i.getUTCHours()).slice(-2),g+=("0"+i.getUTCMinutes()).slice(-2),g+=("0"+i.getUTCSeconds()).slice(-2),l){var T=i.getUTCMilliseconds();T!==0&&(g+="."+(T=(T=("00"+T).slice(-3)).replace(/0+$/g,"")))}return g+="Z"},r.uricmptohex=Tn,r.hextouricmp=Cn,r.ipv6tohex=So,r.hextoipv6=Eo,r.hextoip=di,r.iptohex=function(i){var a="malformed IP address";if(!(i=i.toLowerCase(i)).match(/^[0-9.]+$/)){if(i.match(/^[0-9a-f:]+$/)&&i.indexOf(":")!==-1)return So(i);throw a}var l=i.split(".");if(l.length!==4)throw a;var g="";try{for(var b=0;b<4;b++)g+=("0"+parseInt(l[b]).toString(16)).slice(-2);return g}catch{throw a}},r.encodeURIComponentAll=In,r.newline_toUnix=function(i){return i=i.replace(/\r\n/gm,`
`)},r.newline_toDos=function(i){return i=(i=i.replace(/\r\n/gm,`
`)).replace(/\n/gm,`\r
`)},r.hextoposhex=fi,r.intarystrtohex=function(i){i=(i=(i=i.replace(/^\s*\[\s*/,"")).replace(/\s*\]\s*$/,"")).replace(/\s*/g,"");try{return i.split(/,/).map(function(a,l,g){var b=parseInt(a);if(b<0||255<b)throw"integer not in range 0-255";return("00"+b.toString(16)).slice(-2)}).join("")}catch(a){throw"malformed integer array string: "+a}},r.strdiffidx=function(i,a){var l=i.length;i.length>a.length&&(l=a.length);for(var g=0;g<l;g++)if(i.charCodeAt(g)!=a.charCodeAt(g))return g;return i.length!=a.length?l:-1},r.KJUR=I;var Da=I.crypto;r.crypto=Da;var Oa=I.asn1;r.asn1=Oa;var Ha=I.jws;r.jws=Ha;var Na=I.lang;r.lang=Na}).call(this,s(28).Buffer)},function(n,r,s){(function(c){/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */var u=s(30),p=s(31),y=s(32);function f(){return h.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function d(J,w){if(f()<w)throw new RangeError("Invalid typed array length");return h.TYPED_ARRAY_SUPPORT?(J=new Uint8Array(w)).__proto__=h.prototype:(J===null&&(J=new h(w)),J.length=w),J}function h(J,w,S){if(!(h.TYPED_ARRAY_SUPPORT||this instanceof h))return new h(J,w,S);if(typeof J=="number"){if(typeof w=="string")throw new Error("If encoding is specified then the first argument must be a string");return m(this,J)}return v(this,J,w,S)}function v(J,w,S,L){if(typeof w=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer!="undefined"&&w instanceof ArrayBuffer?function(ee,ie,we,Ce){if(ie.byteLength,we<0||ie.byteLength<we)throw new RangeError("'offset' is out of bounds");if(ie.byteLength<we+(Ce||0))throw new RangeError("'length' is out of bounds");return ie=we===void 0&&Ce===void 0?new Uint8Array(ie):Ce===void 0?new Uint8Array(ie,we):new Uint8Array(ie,we,Ce),h.TYPED_ARRAY_SUPPORT?(ee=ie).__proto__=h.prototype:ee=A(ee,ie),ee}(J,w,S,L):typeof w=="string"?function(ee,ie,we){if(typeof we=="string"&&we!==""||(we="utf8"),!h.isEncoding(we))throw new TypeError('"encoding" must be a valid string encoding');var Ce=0|_(ie,we),Be=(ee=d(ee,Ce)).write(ie,we);return Be!==Ce&&(ee=ee.slice(0,Be)),ee}(J,w,S):function(ee,ie){if(h.isBuffer(ie)){var we=0|F(ie.length);return(ee=d(ee,we)).length===0||ie.copy(ee,0,0,we),ee}if(ie){if(typeof ArrayBuffer!="undefined"&&ie.buffer instanceof ArrayBuffer||"length"in ie)return typeof ie.length!="number"||function(Be){return Be!=Be}(ie.length)?d(ee,0):A(ee,ie);if(ie.type==="Buffer"&&y(ie.data))return A(ee,ie.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(J,w)}function E(J){if(typeof J!="number")throw new TypeError('"size" argument must be a number');if(J<0)throw new RangeError('"size" argument must not be negative')}function m(J,w){if(E(w),J=d(J,w<0?0:0|F(w)),!h.TYPED_ARRAY_SUPPORT)for(var S=0;S<w;++S)J[S]=0;return J}function A(J,w){var S=w.length<0?0:0|F(w.length);J=d(J,S);for(var L=0;L<S;L+=1)J[L]=255&w[L];return J}function F(J){if(J>=f())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+f().toString(16)+" bytes");return 0|J}function _(J,w){if(h.isBuffer(J))return J.length;if(typeof ArrayBuffer!="undefined"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(J)||J instanceof ArrayBuffer))return J.byteLength;typeof J!="string"&&(J=""+J);var S=J.length;if(S===0)return 0;for(var L=!1;;)switch(w){case"ascii":case"latin1":case"binary":return S;case"utf8":case"utf-8":case void 0:return ce(J).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*S;case"hex":return S>>>1;case"base64":return Ee(J).length;default:if(L)return ce(J).length;w=(""+w).toLowerCase(),L=!0}}function P(J,w,S){var L=!1;if((w===void 0||w<0)&&(w=0),w>this.length||((S===void 0||S>this.length)&&(S=this.length),S<=0)||(S>>>=0)<=(w>>>=0))return"";for(J||(J="utf8");;)switch(J){case"hex":return Re(this,w,S);case"utf8":case"utf-8":return ke(this,w,S);case"ascii":return se(this,w,S);case"latin1":case"binary":return ve(this,w,S);case"base64":return _e(this,w,S);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Oe(this,w,S);default:if(L)throw new TypeError("Unknown encoding: "+J);J=(J+"").toLowerCase(),L=!0}}function C(J,w,S){var L=J[w];J[w]=J[S],J[S]=L}function R(J,w,S,L,q){if(J.length===0)return-1;if(typeof S=="string"?(L=S,S=0):S>2147483647?S=2147483647:S<-2147483648&&(S=-2147483648),S=+S,isNaN(S)&&(S=q?0:J.length-1),S<0&&(S=J.length+S),S>=J.length){if(q)return-1;S=J.length-1}else if(S<0){if(!q)return-1;S=0}if(typeof w=="string"&&(w=h.from(w,L)),h.isBuffer(w))return w.length===0?-1:V(J,w,S,L,q);if(typeof w=="number")return w&=255,h.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?q?Uint8Array.prototype.indexOf.call(J,w,S):Uint8Array.prototype.lastIndexOf.call(J,w,S):V(J,[w],S,L,q);throw new TypeError("val must be string, number or Buffer")}function V(J,w,S,L,q){var ee,ie=1,we=J.length,Ce=w.length;if(L!==void 0&&((L=String(L).toLowerCase())==="ucs2"||L==="ucs-2"||L==="utf16le"||L==="utf-16le")){if(J.length<2||w.length<2)return-1;ie=2,we/=2,Ce/=2,S/=2}function Be(ur,Fe){return ie===1?ur[Fe]:ur.readUInt16BE(Fe*ie)}if(q){var Ke=-1;for(ee=S;ee<we;ee++)if(Be(J,ee)===Be(w,Ke===-1?0:ee-Ke)){if(Ke===-1&&(Ke=ee),ee-Ke+1===Ce)return Ke*ie}else Ke!==-1&&(ee-=ee-Ke),Ke=-1}else for(S+Ce>we&&(S=we-Ce),ee=S;ee>=0;ee--){for(var Ge=!0,Vt=0;Vt<Ce;Vt++)if(Be(J,ee+Vt)!==Be(w,Vt)){Ge=!1;break}if(Ge)return ee}return-1}function j(J,w,S,L){S=Number(S)||0;var q=J.length-S;L?(L=Number(L))>q&&(L=q):L=q;var ee=w.length;if(ee%2!=0)throw new TypeError("Invalid hex string");L>ee/2&&(L=ee/2);for(var ie=0;ie<L;++ie){var we=parseInt(w.substr(2*ie,2),16);if(isNaN(we))return ie;J[S+ie]=we}return ie}function B(J,w,S,L){return He(ce(w,J.length-S),J,S,L)}function Z(J,w,S,L){return He(function(ee){for(var ie=[],we=0;we<ee.length;++we)ie.push(255&ee.charCodeAt(we));return ie}(w),J,S,L)}function Y(J,w,S,L){return Z(J,w,S,L)}function O(J,w,S,L){return He(Ee(w),J,S,L)}function oe(J,w,S,L){return He(function(ee,ie){for(var we,Ce,Be,Ke=[],Ge=0;Ge<ee.length&&!((ie-=2)<0);++Ge)Ce=(we=ee.charCodeAt(Ge))>>8,Be=we%256,Ke.push(Be),Ke.push(Ce);return Ke}(w,J.length-S),J,S,L)}function _e(J,w,S){return w===0&&S===J.length?u.fromByteArray(J):u.fromByteArray(J.slice(w,S))}function ke(J,w,S){S=Math.min(J.length,S);for(var L=[],q=w;q<S;){var ee,ie,we,Ce,Be=J[q],Ke=null,Ge=Be>239?4:Be>223?3:Be>191?2:1;if(q+Ge<=S)switch(Ge){case 1:Be<128&&(Ke=Be);break;case 2:(192&(ee=J[q+1]))==128&&(Ce=(31&Be)<<6|63&ee)>127&&(Ke=Ce);break;case 3:ee=J[q+1],ie=J[q+2],(192&ee)==128&&(192&ie)==128&&(Ce=(15&Be)<<12|(63&ee)<<6|63&ie)>2047&&(Ce<55296||Ce>57343)&&(Ke=Ce);break;case 4:ee=J[q+1],ie=J[q+2],we=J[q+3],(192&ee)==128&&(192&ie)==128&&(192&we)==128&&(Ce=(15&Be)<<18|(63&ee)<<12|(63&ie)<<6|63&we)>65535&&Ce<1114112&&(Ke=Ce)}Ke===null?(Ke=65533,Ge=1):Ke>65535&&(Ke-=65536,L.push(Ke>>>10&1023|55296),Ke=56320|1023&Ke),L.push(Ke),q+=Ge}return function(ur){var Fe=ur.length;if(Fe<=G)return String.fromCharCode.apply(String,ur);for(var ot="",Le=0;Le<Fe;)ot+=String.fromCharCode.apply(String,ur.slice(Le,Le+=G));return ot}(L)}r.Buffer=h,r.SlowBuffer=function(w){return+w!=w&&(w=0),h.alloc(+w)},r.INSPECT_MAX_BYTES=50,h.TYPED_ARRAY_SUPPORT=c.TYPED_ARRAY_SUPPORT!==void 0?c.TYPED_ARRAY_SUPPORT:function(){try{var w=new Uint8Array(1);return w.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},w.foo()===42&&typeof w.subarray=="function"&&w.subarray(1,1).byteLength===0}catch{return!1}}(),r.kMaxLength=f(),h.poolSize=8192,h._augment=function(J){return J.__proto__=h.prototype,J},h.from=function(J,w,S){return v(null,J,w,S)},h.TYPED_ARRAY_SUPPORT&&(h.prototype.__proto__=Uint8Array.prototype,h.__proto__=Uint8Array,typeof Symbol!="undefined"&&Symbol.species&&h[Symbol.species]===h&&Object.defineProperty(h,Symbol.species,{value:null,configurable:!0})),h.alloc=function(J,w,S){return function(q,ee,ie,we){return E(ee),ee<=0?d(q,ee):ie!==void 0?typeof we=="string"?d(q,ee).fill(ie,we):d(q,ee).fill(ie):d(q,ee)}(null,J,w,S)},h.allocUnsafe=function(J){return m(null,J)},h.allocUnsafeSlow=function(J){return m(null,J)},h.isBuffer=function(w){return!(w==null||!w._isBuffer)},h.compare=function(w,S){if(!h.isBuffer(w)||!h.isBuffer(S))throw new TypeError("Arguments must be Buffers");if(w===S)return 0;for(var L=w.length,q=S.length,ee=0,ie=Math.min(L,q);ee<ie;++ee)if(w[ee]!==S[ee]){L=w[ee],q=S[ee];break}return L<q?-1:q<L?1:0},h.isEncoding=function(w){switch(String(w).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},h.concat=function(w,S){if(!y(w))throw new TypeError('"list" argument must be an Array of Buffers');if(w.length===0)return h.alloc(0);var L;if(S===void 0)for(S=0,L=0;L<w.length;++L)S+=w[L].length;var q=h.allocUnsafe(S),ee=0;for(L=0;L<w.length;++L){var ie=w[L];if(!h.isBuffer(ie))throw new TypeError('"list" argument must be an Array of Buffers');ie.copy(q,ee),ee+=ie.length}return q},h.byteLength=_,h.prototype._isBuffer=!0,h.prototype.swap16=function(){var w=this.length;if(w%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var S=0;S<w;S+=2)C(this,S,S+1);return this},h.prototype.swap32=function(){var w=this.length;if(w%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var S=0;S<w;S+=4)C(this,S,S+3),C(this,S+1,S+2);return this},h.prototype.swap64=function(){var w=this.length;if(w%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var S=0;S<w;S+=8)C(this,S,S+7),C(this,S+1,S+6),C(this,S+2,S+5),C(this,S+3,S+4);return this},h.prototype.toString=function(){var w=0|this.length;return w===0?"":arguments.length===0?ke(this,0,w):P.apply(this,arguments)},h.prototype.equals=function(w){if(!h.isBuffer(w))throw new TypeError("Argument must be a Buffer");return this===w||h.compare(this,w)===0},h.prototype.inspect=function(){var w="",S=r.INSPECT_MAX_BYTES;return this.length>0&&(w=this.toString("hex",0,S).match(/.{2}/g).join(" "),this.length>S&&(w+=" ... ")),"<Buffer "+w+">"},h.prototype.compare=function(w,S,L,q,ee){if(!h.isBuffer(w))throw new TypeError("Argument must be a Buffer");if(S===void 0&&(S=0),L===void 0&&(L=w?w.length:0),q===void 0&&(q=0),ee===void 0&&(ee=this.length),S<0||L>w.length||q<0||ee>this.length)throw new RangeError("out of range index");if(q>=ee&&S>=L)return 0;if(q>=ee)return-1;if(S>=L)return 1;if(this===w)return 0;for(var ie=(ee>>>=0)-(q>>>=0),we=(L>>>=0)-(S>>>=0),Ce=Math.min(ie,we),Be=this.slice(q,ee),Ke=w.slice(S,L),Ge=0;Ge<Ce;++Ge)if(Be[Ge]!==Ke[Ge]){ie=Be[Ge],we=Ke[Ge];break}return ie<we?-1:we<ie?1:0},h.prototype.includes=function(w,S,L){return this.indexOf(w,S,L)!==-1},h.prototype.indexOf=function(w,S,L){return R(this,w,S,L,!0)},h.prototype.lastIndexOf=function(w,S,L){return R(this,w,S,L,!1)},h.prototype.write=function(w,S,L,q){if(S===void 0)q="utf8",L=this.length,S=0;else if(L===void 0&&typeof S=="string")q=S,L=this.length,S=0;else{if(!isFinite(S))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");S|=0,isFinite(L)?(L|=0,q===void 0&&(q="utf8")):(q=L,L=void 0)}var ee=this.length-S;if((L===void 0||L>ee)&&(L=ee),w.length>0&&(L<0||S<0)||S>this.length)throw new RangeError("Attempt to write outside buffer bounds");q||(q="utf8");for(var ie=!1;;)switch(q){case"hex":return j(this,w,S,L);case"utf8":case"utf-8":return B(this,w,S,L);case"ascii":return Z(this,w,S,L);case"latin1":case"binary":return Y(this,w,S,L);case"base64":return O(this,w,S,L);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return oe(this,w,S,L);default:if(ie)throw new TypeError("Unknown encoding: "+q);q=(""+q).toLowerCase(),ie=!0}},h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var G=4096;function se(J,w,S){var L="";S=Math.min(J.length,S);for(var q=w;q<S;++q)L+=String.fromCharCode(127&J[q]);return L}function ve(J,w,S){var L="";S=Math.min(J.length,S);for(var q=w;q<S;++q)L+=String.fromCharCode(J[q]);return L}function Re(J,w,S){var L=J.length;(!w||w<0)&&(w=0),(!S||S<0||S>L)&&(S=L);for(var q="",ee=w;ee<S;++ee)q+=st(J[ee]);return q}function Oe(J,w,S){for(var L=J.slice(w,S),q="",ee=0;ee<L.length;ee+=2)q+=String.fromCharCode(L[ee]+256*L[ee+1]);return q}function ge(J,w,S){if(J%1!=0||J<0)throw new RangeError("offset is not uint");if(J+w>S)throw new RangeError("Trying to access beyond buffer length")}function Ue(J,w,S,L,q,ee){if(!h.isBuffer(J))throw new TypeError('"buffer" argument must be a Buffer instance');if(w>q||w<ee)throw new RangeError('"value" argument is out of bounds');if(S+L>J.length)throw new RangeError("Index out of range")}function qe(J,w,S,L){w<0&&(w=65535+w+1);for(var q=0,ee=Math.min(J.length-S,2);q<ee;++q)J[S+q]=(w&255<<8*(L?q:1-q))>>>8*(L?q:1-q)}function rt(J,w,S,L){w<0&&(w=4294967295+w+1);for(var q=0,ee=Math.min(J.length-S,4);q<ee;++q)J[S+q]=w>>>8*(L?q:3-q)&255}function ht(J,w,S,L,q,ee){if(S+L>J.length)throw new RangeError("Index out of range");if(S<0)throw new RangeError("Index out of range")}function mt(J,w,S,L,q){return q||ht(J,0,S,4),p.write(J,w,S,L,23,4),S+4}function At(J,w,S,L,q){return q||ht(J,0,S,8),p.write(J,w,S,L,52,8),S+8}h.prototype.slice=function(w,S){var L,q=this.length;if((w=~~w)<0?(w+=q)<0&&(w=0):w>q&&(w=q),(S=S===void 0?q:~~S)<0?(S+=q)<0&&(S=0):S>q&&(S=q),S<w&&(S=w),h.TYPED_ARRAY_SUPPORT)(L=this.subarray(w,S)).__proto__=h.prototype;else{var ee=S-w;L=new h(ee,void 0);for(var ie=0;ie<ee;++ie)L[ie]=this[ie+w]}return L},h.prototype.readUIntLE=function(w,S,L){w|=0,S|=0,L||ge(w,S,this.length);for(var q=this[w],ee=1,ie=0;++ie<S&&(ee*=256);)q+=this[w+ie]*ee;return q},h.prototype.readUIntBE=function(w,S,L){w|=0,S|=0,L||ge(w,S,this.length);for(var q=this[w+--S],ee=1;S>0&&(ee*=256);)q+=this[w+--S]*ee;return q},h.prototype.readUInt8=function(w,S){return S||ge(w,1,this.length),this[w]},h.prototype.readUInt16LE=function(w,S){return S||ge(w,2,this.length),this[w]|this[w+1]<<8},h.prototype.readUInt16BE=function(w,S){return S||ge(w,2,this.length),this[w]<<8|this[w+1]},h.prototype.readUInt32LE=function(w,S){return S||ge(w,4,this.length),(this[w]|this[w+1]<<8|this[w+2]<<16)+16777216*this[w+3]},h.prototype.readUInt32BE=function(w,S){return S||ge(w,4,this.length),16777216*this[w]+(this[w+1]<<16|this[w+2]<<8|this[w+3])},h.prototype.readIntLE=function(w,S,L){w|=0,S|=0,L||ge(w,S,this.length);for(var q=this[w],ee=1,ie=0;++ie<S&&(ee*=256);)q+=this[w+ie]*ee;return q>=(ee*=128)&&(q-=Math.pow(2,8*S)),q},h.prototype.readIntBE=function(w,S,L){w|=0,S|=0,L||ge(w,S,this.length);for(var q=S,ee=1,ie=this[w+--q];q>0&&(ee*=256);)ie+=this[w+--q]*ee;return ie>=(ee*=128)&&(ie-=Math.pow(2,8*S)),ie},h.prototype.readInt8=function(w,S){return S||ge(w,1,this.length),128&this[w]?-1*(255-this[w]+1):this[w]},h.prototype.readInt16LE=function(w,S){S||ge(w,2,this.length);var L=this[w]|this[w+1]<<8;return 32768&L?4294901760|L:L},h.prototype.readInt16BE=function(w,S){S||ge(w,2,this.length);var L=this[w+1]|this[w]<<8;return 32768&L?4294901760|L:L},h.prototype.readInt32LE=function(w,S){return S||ge(w,4,this.length),this[w]|this[w+1]<<8|this[w+2]<<16|this[w+3]<<24},h.prototype.readInt32BE=function(w,S){return S||ge(w,4,this.length),this[w]<<24|this[w+1]<<16|this[w+2]<<8|this[w+3]},h.prototype.readFloatLE=function(w,S){return S||ge(w,4,this.length),p.read(this,w,!0,23,4)},h.prototype.readFloatBE=function(w,S){return S||ge(w,4,this.length),p.read(this,w,!1,23,4)},h.prototype.readDoubleLE=function(w,S){return S||ge(w,8,this.length),p.read(this,w,!0,52,8)},h.prototype.readDoubleBE=function(w,S){return S||ge(w,8,this.length),p.read(this,w,!1,52,8)},h.prototype.writeUIntLE=function(w,S,L,q){w=+w,S|=0,L|=0,q||Ue(this,w,S,L,Math.pow(2,8*L)-1,0);var ee=1,ie=0;for(this[S]=255&w;++ie<L&&(ee*=256);)this[S+ie]=w/ee&255;return S+L},h.prototype.writeUIntBE=function(w,S,L,q){w=+w,S|=0,L|=0,q||Ue(this,w,S,L,Math.pow(2,8*L)-1,0);var ee=L-1,ie=1;for(this[S+ee]=255&w;--ee>=0&&(ie*=256);)this[S+ee]=w/ie&255;return S+L},h.prototype.writeUInt8=function(w,S,L){return w=+w,S|=0,L||Ue(this,w,S,1,255,0),h.TYPED_ARRAY_SUPPORT||(w=Math.floor(w)),this[S]=255&w,S+1},h.prototype.writeUInt16LE=function(w,S,L){return w=+w,S|=0,L||Ue(this,w,S,2,65535,0),h.TYPED_ARRAY_SUPPORT?(this[S]=255&w,this[S+1]=w>>>8):qe(this,w,S,!0),S+2},h.prototype.writeUInt16BE=function(w,S,L){return w=+w,S|=0,L||Ue(this,w,S,2,65535,0),h.TYPED_ARRAY_SUPPORT?(this[S]=w>>>8,this[S+1]=255&w):qe(this,w,S,!1),S+2},h.prototype.writeUInt32LE=function(w,S,L){return w=+w,S|=0,L||Ue(this,w,S,4,4294967295,0),h.TYPED_ARRAY_SUPPORT?(this[S+3]=w>>>24,this[S+2]=w>>>16,this[S+1]=w>>>8,this[S]=255&w):rt(this,w,S,!0),S+4},h.prototype.writeUInt32BE=function(w,S,L){return w=+w,S|=0,L||Ue(this,w,S,4,4294967295,0),h.TYPED_ARRAY_SUPPORT?(this[S]=w>>>24,this[S+1]=w>>>16,this[S+2]=w>>>8,this[S+3]=255&w):rt(this,w,S,!1),S+4},h.prototype.writeIntLE=function(w,S,L,q){if(w=+w,S|=0,!q){var ee=Math.pow(2,8*L-1);Ue(this,w,S,L,ee-1,-ee)}var ie=0,we=1,Ce=0;for(this[S]=255&w;++ie<L&&(we*=256);)w<0&&Ce===0&&this[S+ie-1]!==0&&(Ce=1),this[S+ie]=(w/we>>0)-Ce&255;return S+L},h.prototype.writeIntBE=function(w,S,L,q){if(w=+w,S|=0,!q){var ee=Math.pow(2,8*L-1);Ue(this,w,S,L,ee-1,-ee)}var ie=L-1,we=1,Ce=0;for(this[S+ie]=255&w;--ie>=0&&(we*=256);)w<0&&Ce===0&&this[S+ie+1]!==0&&(Ce=1),this[S+ie]=(w/we>>0)-Ce&255;return S+L},h.prototype.writeInt8=function(w,S,L){return w=+w,S|=0,L||Ue(this,w,S,1,127,-128),h.TYPED_ARRAY_SUPPORT||(w=Math.floor(w)),w<0&&(w=255+w+1),this[S]=255&w,S+1},h.prototype.writeInt16LE=function(w,S,L){return w=+w,S|=0,L||Ue(this,w,S,2,32767,-32768),h.TYPED_ARRAY_SUPPORT?(this[S]=255&w,this[S+1]=w>>>8):qe(this,w,S,!0),S+2},h.prototype.writeInt16BE=function(w,S,L){return w=+w,S|=0,L||Ue(this,w,S,2,32767,-32768),h.TYPED_ARRAY_SUPPORT?(this[S]=w>>>8,this[S+1]=255&w):qe(this,w,S,!1),S+2},h.prototype.writeInt32LE=function(w,S,L){return w=+w,S|=0,L||Ue(this,w,S,4,2147483647,-2147483648),h.TYPED_ARRAY_SUPPORT?(this[S]=255&w,this[S+1]=w>>>8,this[S+2]=w>>>16,this[S+3]=w>>>24):rt(this,w,S,!0),S+4},h.prototype.writeInt32BE=function(w,S,L){return w=+w,S|=0,L||Ue(this,w,S,4,2147483647,-2147483648),w<0&&(w=4294967295+w+1),h.TYPED_ARRAY_SUPPORT?(this[S]=w>>>24,this[S+1]=w>>>16,this[S+2]=w>>>8,this[S+3]=255&w):rt(this,w,S,!1),S+4},h.prototype.writeFloatLE=function(w,S,L){return mt(this,w,S,!0,L)},h.prototype.writeFloatBE=function(w,S,L){return mt(this,w,S,!1,L)},h.prototype.writeDoubleLE=function(w,S,L){return At(this,w,S,!0,L)},h.prototype.writeDoubleBE=function(w,S,L){return At(this,w,S,!1,L)},h.prototype.copy=function(w,S,L,q){if(L||(L=0),q||q===0||(q=this.length),S>=w.length&&(S=w.length),S||(S=0),q>0&&q<L&&(q=L),q===L||w.length===0||this.length===0)return 0;if(S<0)throw new RangeError("targetStart out of bounds");if(L<0||L>=this.length)throw new RangeError("sourceStart out of bounds");if(q<0)throw new RangeError("sourceEnd out of bounds");q>this.length&&(q=this.length),w.length-S<q-L&&(q=w.length-S+L);var ee,ie=q-L;if(this===w&&L<S&&S<q)for(ee=ie-1;ee>=0;--ee)w[ee+S]=this[ee+L];else if(ie<1e3||!h.TYPED_ARRAY_SUPPORT)for(ee=0;ee<ie;++ee)w[ee+S]=this[ee+L];else Uint8Array.prototype.set.call(w,this.subarray(L,L+ie),S);return ie},h.prototype.fill=function(w,S,L,q){if(typeof w=="string"){if(typeof S=="string"?(q=S,S=0,L=this.length):typeof L=="string"&&(q=L,L=this.length),w.length===1){var ee=w.charCodeAt(0);ee<256&&(w=ee)}if(q!==void 0&&typeof q!="string")throw new TypeError("encoding must be a string");if(typeof q=="string"&&!h.isEncoding(q))throw new TypeError("Unknown encoding: "+q)}else typeof w=="number"&&(w&=255);if(S<0||this.length<S||this.length<L)throw new RangeError("Out of range index");if(L<=S)return this;var ie;if(S>>>=0,L=L===void 0?this.length:L>>>0,w||(w=0),typeof w=="number")for(ie=S;ie<L;++ie)this[ie]=w;else{var we=h.isBuffer(w)?w:ce(new h(w,q).toString()),Ce=we.length;for(ie=0;ie<L-S;++ie)this[ie+S]=we[ie%Ce]}return this};var Wt=/[^+\/0-9A-Za-z-_]/g;function st(J){return J<16?"0"+J.toString(16):J.toString(16)}function ce(J,w){var S;w=w||1/0;for(var L=J.length,q=null,ee=[],ie=0;ie<L;++ie){if((S=J.charCodeAt(ie))>55295&&S<57344){if(!q){if(S>56319){(w-=3)>-1&&ee.push(239,191,189);continue}if(ie+1===L){(w-=3)>-1&&ee.push(239,191,189);continue}q=S;continue}if(S<56320){(w-=3)>-1&&ee.push(239,191,189),q=S;continue}S=65536+(q-55296<<10|S-56320)}else q&&(w-=3)>-1&&ee.push(239,191,189);if(q=null,S<128){if((w-=1)<0)break;ee.push(S)}else if(S<2048){if((w-=2)<0)break;ee.push(S>>6|192,63&S|128)}else if(S<65536){if((w-=3)<0)break;ee.push(S>>12|224,S>>6&63|128,63&S|128)}else{if(!(S<1114112))throw new Error("Invalid code point");if((w-=4)<0)break;ee.push(S>>18|240,S>>12&63|128,S>>6&63|128,63&S|128)}}return ee}function Ee(J){return u.toByteArray(function(S){if((S=function(q){return q.trim?q.trim():q.replace(/^\s+|\s+$/g,"")}(S).replace(Wt,"")).length<2)return"";for(;S.length%4!=0;)S+="=";return S}(J))}function He(J,w,S,L){for(var q=0;q<L&&!(q+S>=w.length||q>=J.length);++q)w[q+S]=J[q];return q}}).call(this,s(29))},function(n,r){var s;s=function(){return this}();try{s=s||new Function("return this")()}catch{typeof window=="object"&&(s=window)}n.exports=s},function(n,r,s){r.byteLength=function(m){var A=h(m),F=A[0],_=A[1];return 3*(F+_)/4-_},r.toByteArray=function(m){var A,F,_=h(m),P=_[0],C=_[1],R=new p(function(Z,Y,O){return 3*(Y+O)/4-O}(0,P,C)),V=0,j=C>0?P-4:P;for(F=0;F<j;F+=4)A=u[m.charCodeAt(F)]<<18|u[m.charCodeAt(F+1)]<<12|u[m.charCodeAt(F+2)]<<6|u[m.charCodeAt(F+3)],R[V++]=A>>16&255,R[V++]=A>>8&255,R[V++]=255&A;return C===2&&(A=u[m.charCodeAt(F)]<<2|u[m.charCodeAt(F+1)]>>4,R[V++]=255&A),C===1&&(A=u[m.charCodeAt(F)]<<10|u[m.charCodeAt(F+1)]<<4|u[m.charCodeAt(F+2)]>>2,R[V++]=A>>8&255,R[V++]=255&A),R},r.fromByteArray=function(m){for(var A,F=m.length,_=F%3,P=[],C=16383,R=0,V=F-_;R<V;R+=C)P.push(v(m,R,R+C>V?V:R+C));return _===1?(A=m[F-1],P.push(c[A>>2]+c[A<<4&63]+"==")):_===2&&(A=(m[F-2]<<8)+m[F-1],P.push(c[A>>10]+c[A>>4&63]+c[A<<2&63]+"=")),P.join("")};for(var c=[],u=[],p=typeof Uint8Array!="undefined"?Uint8Array:Array,y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f=0,d=y.length;f<d;++f)c[f]=y[f],u[y.charCodeAt(f)]=f;function h(E){var m=E.length;if(m%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var A=E.indexOf("=");return A===-1&&(A=m),[A,A===m?0:4-A%4]}function v(E,m,A){for(var F,_,P=[],C=m;C<A;C+=3)F=(E[C]<<16&16711680)+(E[C+1]<<8&65280)+(255&E[C+2]),P.push(c[(_=F)>>18&63]+c[_>>12&63]+c[_>>6&63]+c[63&_]);return P.join("")}u["-".charCodeAt(0)]=62,u["_".charCodeAt(0)]=63},function(n,r){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */r.read=function(s,c,u,p,y){var f,d,h=8*y-p-1,v=(1<<h)-1,E=v>>1,m=-7,A=u?y-1:0,F=u?-1:1,_=s[c+A];for(A+=F,f=_&(1<<-m)-1,_>>=-m,m+=h;m>0;f=256*f+s[c+A],A+=F,m-=8);for(d=f&(1<<-m)-1,f>>=-m,m+=p;m>0;d=256*d+s[c+A],A+=F,m-=8);if(f===0)f=1-E;else{if(f===v)return d?NaN:1/0*(_?-1:1);d+=Math.pow(2,p),f-=E}return(_?-1:1)*d*Math.pow(2,f-p)},r.write=function(s,c,u,p,y,f){var d,h,v,E=8*f-y-1,m=(1<<E)-1,A=m>>1,F=y===23?Math.pow(2,-24)-Math.pow(2,-77):0,_=p?0:f-1,P=p?1:-1,C=c<0||c===0&&1/c<0?1:0;for(c=Math.abs(c),isNaN(c)||c===1/0?(h=isNaN(c)?1:0,d=m):(d=Math.floor(Math.log(c)/Math.LN2),c*(v=Math.pow(2,-d))<1&&(d--,v*=2),(c+=d+A>=1?F/v:F*Math.pow(2,1-A))*v>=2&&(d++,v/=2),d+A>=m?(h=0,d=m):d+A>=1?(h=(c*v-1)*Math.pow(2,y),d+=A):(h=c*Math.pow(2,A-1)*Math.pow(2,y),d=0));y>=8;s[u+_]=255&h,_+=P,h/=256,y-=8);for(d=d<<y|h,E+=y;E>0;s[u+_]=255&d,_+=P,d/=256,E-=8);s[u+_-P]|=128*C}},function(n,r){var s={}.toString;n.exports=Array.isArray||function(c){return s.call(c)=="[object Array]"}},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(p){var y=p.jws,f=p.KeyUtil,d=p.X509,h=p.crypto,v=p.hextob64u,E=p.b64tohex,m=p.AllowedSigningAlgs;return function(){function A(){(function(_,P){if(!(_ instanceof P))throw new TypeError("Cannot call a class as a function")})(this,A)}return A.parseJwt=function(_){c.Log.debug("JoseUtil.parseJwt");try{var P=y.JWS.parse(_);return{header:P.headerObj,payload:P.payloadObj}}catch(C){c.Log.error(C)}},A.validateJwt=function(_,P,C,R,V,j,B){c.Log.debug("JoseUtil.validateJwt");try{if(P.kty==="RSA")if(P.e&&P.n)P=f.getKey(P);else{if(!P.x5c||!P.x5c.length)return c.Log.error("JoseUtil.validateJwt: RSA key missing key material",P),Promise.reject(new Error("RSA key missing key material"));var Z=E(P.x5c[0]);P=d.getPublicKeyFromCertHex(Z)}else{if(P.kty!=="EC")return c.Log.error("JoseUtil.validateJwt: Unsupported key type",P&&P.kty),Promise.reject(new Error(P.kty));if(!(P.crv&&P.x&&P.y))return c.Log.error("JoseUtil.validateJwt: EC key missing key material",P),Promise.reject(new Error("EC key missing key material"));P=f.getKey(P)}return A._validateJwt(_,P,C,R,V,j,B)}catch(Y){return c.Log.error(Y&&Y.message||Y),Promise.reject("JWT validation failed")}},A.validateJwtAttributes=function(_,P,C,R,V,j){R||(R=0),V||(V=parseInt(Date.now()/1e3));var B=A.parseJwt(_).payload;if(!B.iss)return c.Log.error("JoseUtil._validateJwt: issuer was not provided"),Promise.reject(new Error("issuer was not provided"));if(B.iss!==P)return c.Log.error("JoseUtil._validateJwt: Invalid issuer in token",B.iss),Promise.reject(new Error("Invalid issuer in token: "+B.iss));if(!B.aud)return c.Log.error("JoseUtil._validateJwt: aud was not provided"),Promise.reject(new Error("aud was not provided"));if(!(B.aud===C||Array.isArray(B.aud)&&B.aud.indexOf(C)>=0))return c.Log.error("JoseUtil._validateJwt: Invalid audience in token",B.aud),Promise.reject(new Error("Invalid audience in token: "+B.aud));if(B.azp&&B.azp!==C)return c.Log.error("JoseUtil._validateJwt: Invalid azp in token",B.azp),Promise.reject(new Error("Invalid azp in token: "+B.azp));if(!j){var Z=V+R,Y=V-R;if(!B.iat)return c.Log.error("JoseUtil._validateJwt: iat was not provided"),Promise.reject(new Error("iat was not provided"));if(Z<B.iat)return c.Log.error("JoseUtil._validateJwt: iat is in the future",B.iat),Promise.reject(new Error("iat is in the future: "+B.iat));if(B.nbf&&Z<B.nbf)return c.Log.error("JoseUtil._validateJwt: nbf is in the future",B.nbf),Promise.reject(new Error("nbf is in the future: "+B.nbf));if(!B.exp)return c.Log.error("JoseUtil._validateJwt: exp was not provided"),Promise.reject(new Error("exp was not provided"));if(B.exp<Y)return c.Log.error("JoseUtil._validateJwt: exp is in the past",B.exp),Promise.reject(new Error("exp is in the past:"+B.exp))}return Promise.resolve(B)},A._validateJwt=function(_,P,C,R,V,j,B){return A.validateJwtAttributes(_,C,R,V,j,B).then(function(Z){try{return y.JWS.verify(_,P,m)?Z:(c.Log.error("JoseUtil._validateJwt: signature validation failed"),Promise.reject(new Error("signature validation failed")))}catch(Y){return c.Log.error(Y&&Y.message||Y),Promise.reject(new Error("signature validation failed"))}})},A.hashString=function(_,P){try{return h.Util.hashString(_,P)}catch(C){c.Log.error(C)}},A.hexToBase64Url=function(_){try{return v(_)}catch(P){c.Log.error(P)}},A}()};var c=s(0);n.exports=r.default},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.SigninResponse=void 0;var c=function(){function y(f,d){for(var h=0;h<d.length;h++){var v=d[h];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(f,v.key,v)}}return function(f,d,h){return d&&y(f.prototype,d),h&&y(f,h),f}}(),u=s(3);function p(y,f){if(!(y instanceof f))throw new TypeError("Cannot call a class as a function")}r.SigninResponse=function(){function y(f){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#";p(this,y);var h=u.UrlUtility.parseUrlFragment(f,d);this.error=h.error,this.error_description=h.error_description,this.error_uri=h.error_uri,this.code=h.code,this.state=h.state,this.id_token=h.id_token,this.session_state=h.session_state,this.access_token=h.access_token,this.token_type=h.token_type,this.scope=h.scope,this.profile=void 0,this.expires_in=h.expires_in}return c(y,[{key:"expires_in",get:function(){if(this.expires_at){var d=parseInt(Date.now()/1e3);return this.expires_at-d}},set:function(d){var h=parseInt(d);if(typeof h=="number"&&h>0){var v=parseInt(Date.now()/1e3);this.expires_at=v+h}}},{key:"expired",get:function(){var d=this.expires_in;if(d!==void 0)return d<=0}},{key:"scopes",get:function(){return(this.scope||"").split(" ")}},{key:"isOpenIdConnect",get:function(){return this.scopes.indexOf("openid")>=0||!!this.id_token}}]),y}()},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.SignoutRequest=void 0;var c=s(0),u=s(3),p=s(9);r.SignoutRequest=function y(f){var d=f.url,h=f.id_token_hint,v=f.post_logout_redirect_uri,E=f.data,m=f.extraQueryParams,A=f.request_type;if(function(P,C){if(!(P instanceof C))throw new TypeError("Cannot call a class as a function")}(this,y),!d)throw c.Log.error("SignoutRequest.ctor: No url passed"),new Error("url");for(var F in h&&(d=u.UrlUtility.addQueryParam(d,"id_token_hint",h)),v&&(d=u.UrlUtility.addQueryParam(d,"post_logout_redirect_uri",v),E&&(this.state=new p.State({data:E,request_type:A}),d=u.UrlUtility.addQueryParam(d,"state",this.state.id))),m)d=u.UrlUtility.addQueryParam(d,F,m[F]);this.url=d}},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.SignoutResponse=void 0;var c=s(3);r.SignoutResponse=function u(p){(function(d,h){if(!(d instanceof h))throw new TypeError("Cannot call a class as a function")})(this,u);var y=c.UrlUtility.parseUrlFragment(p,"?");this.error=y.error,this.error_description=y.error_description,this.error_uri=y.error_uri,this.state=y.state}},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.InMemoryWebStorage=void 0;var c=function(){function p(y,f){for(var d=0;d<f.length;d++){var h=f[d];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(y,h.key,h)}}return function(y,f,d){return f&&p(y.prototype,f),d&&p(y,d),y}}(),u=s(0);r.InMemoryWebStorage=function(){function p(){(function(f,d){if(!(f instanceof d))throw new TypeError("Cannot call a class as a function")})(this,p),this._data={}}return p.prototype.getItem=function(f){return u.Log.debug("InMemoryWebStorage.getItem",f),this._data[f]},p.prototype.setItem=function(f,d){u.Log.debug("InMemoryWebStorage.setItem",f),this._data[f]=d},p.prototype.removeItem=function(f){u.Log.debug("InMemoryWebStorage.removeItem",f),delete this._data[f]},p.prototype.key=function(f){return Object.getOwnPropertyNames(this._data)[f]},c(p,[{key:"length",get:function(){return Object.getOwnPropertyNames(this._data).length}}]),p}()},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.UserManager=void 0;var c=function(){function C(R,V){for(var j=0;j<V.length;j++){var B=V[j];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(R,B.key,B)}}return function(R,V,j){return V&&C(R.prototype,V),j&&C(R,j),R}}(),u=s(0),p=s(10),y=s(39),f=s(15),d=s(45),h=s(47),v=s(18),E=s(8),m=s(20),A=s(11),F=s(4);function _(C,R){if(!(C instanceof R))throw new TypeError("Cannot call a class as a function")}function P(C,R){if(!C)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!R||typeof R!="object"&&typeof R!="function"?C:R}r.UserManager=function(C){function R(){var V=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:h.SilentRenewService,B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:v.SessionMonitor,Z=arguments.length>3&&arguments[3]!==void 0?arguments[3]:m.TokenRevocationClient,Y=arguments.length>4&&arguments[4]!==void 0?arguments[4]:A.TokenClient,O=arguments.length>5&&arguments[5]!==void 0?arguments[5]:F.JoseUtil;_(this,R),V instanceof y.UserManagerSettings||(V=new y.UserManagerSettings(V));var oe=P(this,C.call(this,V));return oe._events=new d.UserManagerEvents(V),oe._silentRenewService=new j(oe),oe.settings.automaticSilentRenew&&(u.Log.debug("UserManager.ctor: automaticSilentRenew is configured, setting up silent renew"),oe.startSilentRenew()),oe.settings.monitorSession&&(u.Log.debug("UserManager.ctor: monitorSession is configured, setting up session monitor"),oe._sessionMonitor=new B(oe)),oe._tokenRevocationClient=new Z(oe._settings),oe._tokenClient=new Y(oe._settings),oe._joseUtil=O,oe}return function(j,B){if(typeof B!="function"&&B!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof B);j.prototype=Object.create(B&&B.prototype,{constructor:{value:j,enumerable:!1,writable:!0,configurable:!0}}),B&&(Object.setPrototypeOf?Object.setPrototypeOf(j,B):j.__proto__=B)}(R,C),R.prototype.getUser=function(){var j=this;return this._loadUser().then(function(B){return B?(u.Log.info("UserManager.getUser: user loaded"),j._events.load(B,!1),B):(u.Log.info("UserManager.getUser: user not found in storage"),null)})},R.prototype.removeUser=function(){var j=this;return this.storeUser(null).then(function(){u.Log.info("UserManager.removeUser: user removed from storage"),j._events.unload()})},R.prototype.signinRedirect=function(){var j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(j=Object.assign({},j)).request_type="si:r";var B={useReplaceToNavigate:j.useReplaceToNavigate};return this._signinStart(j,this._redirectNavigator,B).then(function(){u.Log.info("UserManager.signinRedirect: successful")})},R.prototype.signinRedirectCallback=function(j){return this._signinEnd(j||this._redirectNavigator.url).then(function(B){return B.profile&&B.profile.sub?u.Log.info("UserManager.signinRedirectCallback: successful, signed in sub: ",B.profile.sub):u.Log.info("UserManager.signinRedirectCallback: no sub"),B})},R.prototype.signinPopup=function(){var j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(j=Object.assign({},j)).request_type="si:p";var B=j.redirect_uri||this.settings.popup_redirect_uri||this.settings.redirect_uri;return B?(j.redirect_uri=B,j.display="popup",this._signin(j,this._popupNavigator,{startUrl:B,popupWindowFeatures:j.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:j.popupWindowTarget||this.settings.popupWindowTarget}).then(function(Z){return Z&&(Z.profile&&Z.profile.sub?u.Log.info("UserManager.signinPopup: signinPopup successful, signed in sub: ",Z.profile.sub):u.Log.info("UserManager.signinPopup: no sub")),Z})):(u.Log.error("UserManager.signinPopup: No popup_redirect_uri or redirect_uri configured"),Promise.reject(new Error("No popup_redirect_uri or redirect_uri configured")))},R.prototype.signinPopupCallback=function(j){return this._signinCallback(j,this._popupNavigator).then(function(B){return B&&(B.profile&&B.profile.sub?u.Log.info("UserManager.signinPopupCallback: successful, signed in sub: ",B.profile.sub):u.Log.info("UserManager.signinPopupCallback: no sub")),B}).catch(function(B){u.Log.error(B.message)})},R.prototype.signinSilent=function(){var j=this,B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return B=Object.assign({},B),this._loadUser().then(function(Z){return Z&&Z.refresh_token?(B.refresh_token=Z.refresh_token,j._useRefreshToken(B)):(B.request_type="si:s",B.id_token_hint=B.id_token_hint||j.settings.includeIdTokenInSilentRenew&&Z&&Z.id_token,Z&&j._settings.validateSubOnSilentRenew&&(u.Log.debug("UserManager.signinSilent, subject prior to silent renew: ",Z.profile.sub),B.current_sub=Z.profile.sub),j._signinSilentIframe(B))})},R.prototype._useRefreshToken=function(){var j=this,B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._tokenClient.exchangeRefreshToken(B).then(function(Z){return Z?Z.access_token?j._loadUser().then(function(Y){if(Y){var O=Promise.resolve();return Z.id_token&&(O=j._validateIdTokenFromTokenRefreshToken(Y.profile,Z.id_token)),O.then(function(){return u.Log.debug("UserManager._useRefreshToken: refresh token response success"),Y.id_token=Z.id_token||Y.id_token,Y.access_token=Z.access_token,Y.refresh_token=Z.refresh_token||Y.refresh_token,Y.expires_in=Z.expires_in,j.storeUser(Y).then(function(){return j._events.load(Y),Y})})}return null}):(u.Log.error("UserManager._useRefreshToken: No access token returned from token endpoint"),Promise.reject("No access token returned from token endpoint")):(u.Log.error("UserManager._useRefreshToken: No response returned from token endpoint"),Promise.reject("No response returned from token endpoint"))})},R.prototype._validateIdTokenFromTokenRefreshToken=function(j,B){var Z=this;return this._metadataService.getIssuer().then(function(Y){return Z.settings.getEpochTime().then(function(O){return Z._joseUtil.validateJwtAttributes(B,Y,Z._settings.client_id,Z._settings.clockSkew,O).then(function(oe){return oe?oe.sub!==j.sub?(u.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: sub in id_token does not match current sub"),Promise.reject(new Error("sub in id_token does not match current sub"))):oe.auth_time&&oe.auth_time!==j.auth_time?(u.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: auth_time in id_token does not match original auth_time"),Promise.reject(new Error("auth_time in id_token does not match original auth_time"))):oe.azp&&oe.azp!==j.azp?(u.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: azp in id_token does not match original azp"),Promise.reject(new Error("azp in id_token does not match original azp"))):!oe.azp&&j.azp?(u.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: azp not in id_token, but present in original id_token"),Promise.reject(new Error("azp not in id_token, but present in original id_token"))):void 0:(u.Log.error("UserManager._validateIdTokenFromTokenRefreshToken: Failed to validate id_token"),Promise.reject(new Error("Failed to validate id_token")))})})})},R.prototype._signinSilentIframe=function(){var j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},B=j.redirect_uri||this.settings.silent_redirect_uri||this.settings.redirect_uri;return B?(j.redirect_uri=B,j.prompt=j.prompt||"none",this._signin(j,this._iframeNavigator,{startUrl:B,silentRequestTimeout:j.silentRequestTimeout||this.settings.silentRequestTimeout}).then(function(Z){return Z&&(Z.profile&&Z.profile.sub?u.Log.info("UserManager.signinSilent: successful, signed in sub: ",Z.profile.sub):u.Log.info("UserManager.signinSilent: no sub")),Z})):(u.Log.error("UserManager.signinSilent: No silent_redirect_uri configured"),Promise.reject(new Error("No silent_redirect_uri configured")))},R.prototype.signinSilentCallback=function(j){return this._signinCallback(j,this._iframeNavigator).then(function(B){return B&&(B.profile&&B.profile.sub?u.Log.info("UserManager.signinSilentCallback: successful, signed in sub: ",B.profile.sub):u.Log.info("UserManager.signinSilentCallback: no sub")),B})},R.prototype.signinCallback=function(j){var B=this;return this.readSigninResponseState(j).then(function(Z){var Y=Z.state;return Z.response,Y.request_type==="si:r"?B.signinRedirectCallback(j):Y.request_type==="si:p"?B.signinPopupCallback(j):Y.request_type==="si:s"?B.signinSilentCallback(j):Promise.reject(new Error("invalid response_type in state"))})},R.prototype.signoutCallback=function(j,B){var Z=this;return this.readSignoutResponseState(j).then(function(Y){var O=Y.state,oe=Y.response;return O?O.request_type==="so:r"?Z.signoutRedirectCallback(j):O.request_type==="so:p"?Z.signoutPopupCallback(j,B):Promise.reject(new Error("invalid response_type in state")):oe})},R.prototype.querySessionStatus=function(){var j=this,B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(B=Object.assign({},B)).request_type="si:s";var Z=B.redirect_uri||this.settings.silent_redirect_uri||this.settings.redirect_uri;return Z?(B.redirect_uri=Z,B.prompt="none",B.response_type=B.response_type||this.settings.query_status_response_type,B.scope=B.scope||"openid",B.skipUserInfo=!0,this._signinStart(B,this._iframeNavigator,{startUrl:Z,silentRequestTimeout:B.silentRequestTimeout||this.settings.silentRequestTimeout}).then(function(Y){return j.processSigninResponse(Y.url).then(function(O){if(u.Log.debug("UserManager.querySessionStatus: got signin response"),O.session_state&&O.profile.sub)return u.Log.info("UserManager.querySessionStatus: querySessionStatus success for sub: ",O.profile.sub),{session_state:O.session_state,sub:O.profile.sub,sid:O.profile.sid};u.Log.info("querySessionStatus successful, user not authenticated")}).catch(function(O){if(O.session_state&&j.settings.monitorAnonymousSession&&(O.message=="login_required"||O.message=="consent_required"||O.message=="interaction_required"||O.message=="account_selection_required"))return u.Log.info("UserManager.querySessionStatus: querySessionStatus success for anonymous user"),{session_state:O.session_state};throw O})})):(u.Log.error("UserManager.querySessionStatus: No silent_redirect_uri configured"),Promise.reject(new Error("No silent_redirect_uri configured")))},R.prototype._signin=function(j,B){var Z=this,Y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._signinStart(j,B,Y).then(function(O){return Z._signinEnd(O.url,j)})},R.prototype._signinStart=function(j,B){var Z=this,Y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return B.prepare(Y).then(function(O){return u.Log.debug("UserManager._signinStart: got navigator window handle"),Z.createSigninRequest(j).then(function(oe){return u.Log.debug("UserManager._signinStart: got signin request"),Y.url=oe.url,Y.id=oe.state.id,O.navigate(Y)}).catch(function(oe){throw O.close&&(u.Log.debug("UserManager._signinStart: Error after preparing navigator, closing navigator window"),O.close()),oe})})},R.prototype._signinEnd=function(j){var B=this,Z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.processSigninResponse(j).then(function(Y){u.Log.debug("UserManager._signinEnd: got signin response");var O=new f.User(Y);if(Z.current_sub){if(Z.current_sub!==O.profile.sub)return u.Log.debug("UserManager._signinEnd: current user does not match user returned from signin. sub from signin: ",O.profile.sub),Promise.reject(new Error("login_required"));u.Log.debug("UserManager._signinEnd: current user matches user returned from signin")}return B.storeUser(O).then(function(){return u.Log.debug("UserManager._signinEnd: user stored"),B._events.load(O),O})})},R.prototype._signinCallback=function(j,B){u.Log.debug("UserManager._signinCallback");var Z=this._settings.response_mode==="query"||!this._settings.response_mode&&E.SigninRequest.isCode(this._settings.response_type)?"?":"#";return B.callback(j,void 0,Z)},R.prototype.signoutRedirect=function(){var j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(j=Object.assign({},j)).request_type="so:r";var B=j.post_logout_redirect_uri||this.settings.post_logout_redirect_uri;B&&(j.post_logout_redirect_uri=B);var Z={useReplaceToNavigate:j.useReplaceToNavigate};return this._signoutStart(j,this._redirectNavigator,Z).then(function(){u.Log.info("UserManager.signoutRedirect: successful")})},R.prototype.signoutRedirectCallback=function(j){return this._signoutEnd(j||this._redirectNavigator.url).then(function(B){return u.Log.info("UserManager.signoutRedirectCallback: successful"),B})},R.prototype.signoutPopup=function(){var j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(j=Object.assign({},j)).request_type="so:p";var B=j.post_logout_redirect_uri||this.settings.popup_post_logout_redirect_uri||this.settings.post_logout_redirect_uri;return j.post_logout_redirect_uri=B,j.display="popup",j.post_logout_redirect_uri&&(j.state=j.state||{}),this._signout(j,this._popupNavigator,{startUrl:B,popupWindowFeatures:j.popupWindowFeatures||this.settings.popupWindowFeatures,popupWindowTarget:j.popupWindowTarget||this.settings.popupWindowTarget}).then(function(){u.Log.info("UserManager.signoutPopup: successful")})},R.prototype.signoutPopupCallback=function(j,B){return B===void 0&&typeof j=="boolean"&&(B=j,j=null),this._popupNavigator.callback(j,B,"?").then(function(){u.Log.info("UserManager.signoutPopupCallback: successful")})},R.prototype._signout=function(j,B){var Z=this,Y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._signoutStart(j,B,Y).then(function(O){return Z._signoutEnd(O.url)})},R.prototype._signoutStart=function(){var j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},B=this,Z=arguments[1],Y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Z.prepare(Y).then(function(O){return u.Log.debug("UserManager._signoutStart: got navigator window handle"),B._loadUser().then(function(oe){return u.Log.debug("UserManager._signoutStart: loaded current user from storage"),(B._settings.revokeAccessTokenOnSignout?B._revokeInternal(oe):Promise.resolve()).then(function(){var _e=j.id_token_hint||oe&&oe.id_token;return _e&&(u.Log.debug("UserManager._signoutStart: Setting id_token into signout request"),j.id_token_hint=_e),B.removeUser().then(function(){return u.Log.debug("UserManager._signoutStart: user removed, creating signout request"),B.createSignoutRequest(j).then(function(ke){return u.Log.debug("UserManager._signoutStart: got signout request"),Y.url=ke.url,ke.state&&(Y.id=ke.state.id),O.navigate(Y)})})})}).catch(function(oe){throw O.close&&(u.Log.debug("UserManager._signoutStart: Error after preparing navigator, closing navigator window"),O.close()),oe})})},R.prototype._signoutEnd=function(j){return this.processSignoutResponse(j).then(function(B){return u.Log.debug("UserManager._signoutEnd: got signout response"),B})},R.prototype.revokeAccessToken=function(){var j=this;return this._loadUser().then(function(B){return j._revokeInternal(B,!0).then(function(Z){if(Z)return u.Log.debug("UserManager.revokeAccessToken: removing token properties from user and re-storing"),B.access_token=null,B.refresh_token=null,B.expires_at=null,B.token_type=null,j.storeUser(B).then(function(){u.Log.debug("UserManager.revokeAccessToken: user stored"),j._events.load(B)})})}).then(function(){u.Log.info("UserManager.revokeAccessToken: access token revoked successfully")})},R.prototype._revokeInternal=function(j,B){var Z=this;if(j){var Y=j.access_token,O=j.refresh_token;return this._revokeAccessTokenInternal(Y,B).then(function(oe){return Z._revokeRefreshTokenInternal(O,B).then(function(_e){return oe||_e||u.Log.debug("UserManager.revokeAccessToken: no need to revoke due to no token(s), or JWT format"),oe||_e})})}return Promise.resolve(!1)},R.prototype._revokeAccessTokenInternal=function(j,B){return!j||j.indexOf(".")>=0?Promise.resolve(!1):this._tokenRevocationClient.revoke(j,B).then(function(){return!0})},R.prototype._revokeRefreshTokenInternal=function(j,B){return j?this._tokenRevocationClient.revoke(j,B,"refresh_token").then(function(){return!0}):Promise.resolve(!1)},R.prototype.startSilentRenew=function(){this._silentRenewService.start()},R.prototype.stopSilentRenew=function(){this._silentRenewService.stop()},R.prototype._loadUser=function(){return this._userStore.get(this._userStoreKey).then(function(j){return j?(u.Log.debug("UserManager._loadUser: user storageString loaded"),f.User.fromStorageString(j)):(u.Log.debug("UserManager._loadUser: no user storageString"),null)})},R.prototype.storeUser=function(j){if(j){u.Log.debug("UserManager.storeUser: storing user");var B=j.toStorageString();return this._userStore.set(this._userStoreKey,B)}return u.Log.debug("storeUser.storeUser: removing user"),this._userStore.remove(this._userStoreKey)},c(R,[{key:"_redirectNavigator",get:function(){return this.settings.redirectNavigator}},{key:"_popupNavigator",get:function(){return this.settings.popupNavigator}},{key:"_iframeNavigator",get:function(){return this.settings.iframeNavigator}},{key:"_userStore",get:function(){return this.settings.userStore}},{key:"events",get:function(){return this._events}},{key:"_userStoreKey",get:function(){return"user:"+this.settings.authority+":"+this.settings.client_id}}]),R}(p.OidcClient)},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.UserManagerSettings=void 0;var c=function(){function A(F,_){for(var P=0;P<_.length;P++){var C=_[P];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(F,C.key,C)}}return function(F,_,P){return _&&A(F.prototype,_),P&&A(F,P),F}}(),u=(s(0),s(5)),p=s(40),y=s(41),f=s(43),d=s(6),h=s(1),v=s(8);function E(A,F){if(!(A instanceof F))throw new TypeError("Cannot call a class as a function")}function m(A,F){if(!A)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!F||typeof F!="object"&&typeof F!="function"?A:F}r.UserManagerSettings=function(A){function F(){var _=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},P=_.popup_redirect_uri,C=_.popup_post_logout_redirect_uri,R=_.popupWindowFeatures,V=_.popupWindowTarget,j=_.silent_redirect_uri,B=_.silentRequestTimeout,Z=_.automaticSilentRenew,Y=Z!==void 0&&Z,O=_.validateSubOnSilentRenew,oe=O!==void 0&&O,_e=_.includeIdTokenInSilentRenew,ke=_e===void 0||_e,G=_.monitorSession,se=G===void 0||G,ve=_.monitorAnonymousSession,Re=ve!==void 0&&ve,Oe=_.checkSessionInterval,ge=Oe===void 0?2e3:Oe,Ue=_.stopCheckSessionOnError,qe=Ue===void 0||Ue,rt=_.query_status_response_type,ht=_.revokeAccessTokenOnSignout,mt=ht!==void 0&&ht,At=_.accessTokenExpiringNotificationTime,Wt=At===void 0?60:At,st=_.redirectNavigator,ce=st===void 0?new p.RedirectNavigator:st,Ee=_.popupNavigator,He=Ee===void 0?new y.PopupNavigator:Ee,J=_.iframeNavigator,w=J===void 0?new f.IFrameNavigator:J,S=_.userStore,L=S===void 0?new d.WebStorageStateStore({store:h.Global.sessionStorage}):S;E(this,F);var q=m(this,A.call(this,arguments[0]));return q._popup_redirect_uri=P,q._popup_post_logout_redirect_uri=C,q._popupWindowFeatures=R,q._popupWindowTarget=V,q._silent_redirect_uri=j,q._silentRequestTimeout=B,q._automaticSilentRenew=Y,q._validateSubOnSilentRenew=oe,q._includeIdTokenInSilentRenew=ke,q._accessTokenExpiringNotificationTime=Wt,q._monitorSession=se,q._monitorAnonymousSession=Re,q._checkSessionInterval=ge,q._stopCheckSessionOnError=qe,rt?q._query_status_response_type=rt:arguments[0]&&arguments[0].response_type?q._query_status_response_type=v.SigninRequest.isOidc(arguments[0].response_type)?"id_token":"code":q._query_status_response_type="id_token",q._revokeAccessTokenOnSignout=mt,q._redirectNavigator=ce,q._popupNavigator=He,q._iframeNavigator=w,q._userStore=L,q}return function(P,C){if(typeof C!="function"&&C!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof C);P.prototype=Object.create(C&&C.prototype,{constructor:{value:P,enumerable:!1,writable:!0,configurable:!0}}),C&&(Object.setPrototypeOf?Object.setPrototypeOf(P,C):P.__proto__=C)}(F,A),c(F,[{key:"popup_redirect_uri",get:function(){return this._popup_redirect_uri}},{key:"popup_post_logout_redirect_uri",get:function(){return this._popup_post_logout_redirect_uri}},{key:"popupWindowFeatures",get:function(){return this._popupWindowFeatures}},{key:"popupWindowTarget",get:function(){return this._popupWindowTarget}},{key:"silent_redirect_uri",get:function(){return this._silent_redirect_uri}},{key:"silentRequestTimeout",get:function(){return this._silentRequestTimeout}},{key:"automaticSilentRenew",get:function(){return this._automaticSilentRenew}},{key:"validateSubOnSilentRenew",get:function(){return this._validateSubOnSilentRenew}},{key:"includeIdTokenInSilentRenew",get:function(){return this._includeIdTokenInSilentRenew}},{key:"accessTokenExpiringNotificationTime",get:function(){return this._accessTokenExpiringNotificationTime}},{key:"monitorSession",get:function(){return this._monitorSession}},{key:"monitorAnonymousSession",get:function(){return this._monitorAnonymousSession}},{key:"checkSessionInterval",get:function(){return this._checkSessionInterval}},{key:"stopCheckSessionOnError",get:function(){return this._stopCheckSessionOnError}},{key:"query_status_response_type",get:function(){return this._query_status_response_type}},{key:"revokeAccessTokenOnSignout",get:function(){return this._revokeAccessTokenOnSignout}},{key:"redirectNavigator",get:function(){return this._redirectNavigator}},{key:"popupNavigator",get:function(){return this._popupNavigator}},{key:"iframeNavigator",get:function(){return this._iframeNavigator}},{key:"userStore",get:function(){return this._userStore}}]),F}(u.OidcClientSettings)},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.RedirectNavigator=void 0;var c=function(){function p(y,f){for(var d=0;d<f.length;d++){var h=f[d];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(y,h.key,h)}}return function(y,f,d){return f&&p(y.prototype,f),d&&p(y,d),y}}(),u=s(0);r.RedirectNavigator=function(){function p(){(function(f,d){if(!(f instanceof d))throw new TypeError("Cannot call a class as a function")})(this,p)}return p.prototype.prepare=function(){return Promise.resolve(this)},p.prototype.navigate=function(f){return f&&f.url?(f.useReplaceToNavigate?window.location.replace(f.url):window.location=f.url,Promise.resolve()):(u.Log.error("RedirectNavigator.navigate: No url provided"),Promise.reject(new Error("No url provided")))},c(p,[{key:"url",get:function(){return window.location.href}}]),p}()},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.PopupNavigator=void 0;var c=s(0),u=s(42);r.PopupNavigator=function(){function p(){(function(f,d){if(!(f instanceof d))throw new TypeError("Cannot call a class as a function")})(this,p)}return p.prototype.prepare=function(f){var d=new u.PopupWindow(f);return Promise.resolve(d)},p.prototype.callback=function(f,d,h){c.Log.debug("PopupNavigator.callback");try{return u.PopupWindow.notifyOpener(f,d,h),Promise.resolve()}catch(v){return Promise.reject(v)}},p}()},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.PopupWindow=void 0;var c=function(){function y(f,d){for(var h=0;h<d.length;h++){var v=d[h];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(f,v.key,v)}}return function(f,d,h){return d&&y(f.prototype,d),h&&y(f,h),f}}(),u=s(0),p=s(3);r.PopupWindow=function(){function y(f){var d=this;(function(m,A){if(!(m instanceof A))throw new TypeError("Cannot call a class as a function")})(this,y),this._promise=new Promise(function(E,m){d._resolve=E,d._reject=m});var h=f.popupWindowTarget||"_blank",v=f.popupWindowFeatures||"location=no,toolbar=no,width=500,height=500,left=100,top=100;";this._popup=window.open("",h,v),this._popup&&(u.Log.debug("PopupWindow.ctor: popup successfully created"),this._checkForPopupClosedTimer=window.setInterval(this._checkForPopupClosed.bind(this),500))}return y.prototype.navigate=function(d){return this._popup?d&&d.url?(u.Log.debug("PopupWindow.navigate: Setting URL in popup"),this._id=d.id,this._id&&(window["popupCallback_"+d.id]=this._callback.bind(this)),this._popup.focus(),this._popup.window.location=d.url):(this._error("PopupWindow.navigate: no url provided"),this._error("No url provided")):this._error("PopupWindow.navigate: Error opening popup window"),this.promise},y.prototype._success=function(d){u.Log.debug("PopupWindow.callback: Successful response from popup window"),this._cleanup(),this._resolve(d)},y.prototype._error=function(d){u.Log.error("PopupWindow.error: ",d),this._cleanup(),this._reject(new Error(d))},y.prototype.close=function(){this._cleanup(!1)},y.prototype._cleanup=function(d){u.Log.debug("PopupWindow.cleanup"),window.clearInterval(this._checkForPopupClosedTimer),this._checkForPopupClosedTimer=null,delete window["popupCallback_"+this._id],this._popup&&!d&&this._popup.close(),this._popup=null},y.prototype._checkForPopupClosed=function(){this._popup&&!this._popup.closed||this._error("Popup window closed")},y.prototype._callback=function(d,h){this._cleanup(h),d?(u.Log.debug("PopupWindow.callback success"),this._success({url:d})):(u.Log.debug("PopupWindow.callback: Invalid response from popup"),this._error("Invalid response from popup"))},y.notifyOpener=function(d,h,v){if(window.opener){if(d=d||window.location.href){var E=p.UrlUtility.parseUrlFragment(d,v);if(E.state){var m="popupCallback_"+E.state,A=window.opener[m];A?(u.Log.debug("PopupWindow.notifyOpener: passing url message to opener"),A(d,h)):u.Log.warn("PopupWindow.notifyOpener: no matching callback found on opener")}else u.Log.warn("PopupWindow.notifyOpener: no state found in response url")}}else u.Log.warn("PopupWindow.notifyOpener: no window.opener. Can't complete notification.")},c(y,[{key:"promise",get:function(){return this._promise}}]),y}()},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.IFrameNavigator=void 0;var c=s(0),u=s(44);r.IFrameNavigator=function(){function p(){(function(f,d){if(!(f instanceof d))throw new TypeError("Cannot call a class as a function")})(this,p)}return p.prototype.prepare=function(f){var d=new u.IFrameWindow(f);return Promise.resolve(d)},p.prototype.callback=function(f){c.Log.debug("IFrameNavigator.callback");try{return u.IFrameWindow.notifyParent(f),Promise.resolve()}catch(d){return Promise.reject(d)}},p}()},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.IFrameWindow=void 0;var c=function(){function p(y,f){for(var d=0;d<f.length;d++){var h=f[d];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(y,h.key,h)}}return function(y,f,d){return f&&p(y.prototype,f),d&&p(y,d),y}}(),u=s(0);r.IFrameWindow=function(){function p(y){var f=this;(function(h,v){if(!(h instanceof v))throw new TypeError("Cannot call a class as a function")})(this,p),this._promise=new Promise(function(d,h){f._resolve=d,f._reject=h}),this._boundMessageEvent=this._message.bind(this),window.addEventListener("message",this._boundMessageEvent,!1),this._frame=window.document.createElement("iframe"),this._frame.style.visibility="hidden",this._frame.style.position="absolute",this._frame.width=0,this._frame.height=0,window.document.body.appendChild(this._frame)}return p.prototype.navigate=function(f){if(f&&f.url){var d=f.silentRequestTimeout||1e4;u.Log.debug("IFrameWindow.navigate: Using timeout of:",d),this._timer=window.setTimeout(this._timeout.bind(this),d),this._frame.src=f.url}else this._error("No url provided");return this.promise},p.prototype._success=function(f){this._cleanup(),u.Log.debug("IFrameWindow: Successful response from frame window"),this._resolve(f)},p.prototype._error=function(f){this._cleanup(),u.Log.error(f),this._reject(new Error(f))},p.prototype.close=function(){this._cleanup()},p.prototype._cleanup=function(){this._frame&&(u.Log.debug("IFrameWindow: cleanup"),window.removeEventListener("message",this._boundMessageEvent,!1),window.clearTimeout(this._timer),window.document.body.removeChild(this._frame),this._timer=null,this._frame=null,this._boundMessageEvent=null)},p.prototype._timeout=function(){u.Log.debug("IFrameWindow.timeout"),this._error("Frame window timed out")},p.prototype._message=function(f){if(u.Log.debug("IFrameWindow.message"),this._timer&&f.origin===this._origin&&f.source===this._frame.contentWindow&&typeof f.data=="string"&&(f.data.startsWith("http://")||f.data.startsWith("https://"))){var d=f.data;d?this._success({url:d}):this._error("Invalid response from frame")}},p.notifyParent=function(f){u.Log.debug("IFrameWindow.notifyParent"),(f=f||window.location.href)&&(u.Log.debug("IFrameWindow.notifyParent: posting url message to parent"),window.parent.postMessage(f,location.protocol+"//"+location.host))},c(p,[{key:"promise",get:function(){return this._promise}},{key:"_origin",get:function(){return location.protocol+"//"+location.host}}]),p}()},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.UserManagerEvents=void 0;var c=s(0),u=s(16),p=s(17);r.UserManagerEvents=function(y){function f(d){(function(E,m){if(!(E instanceof m))throw new TypeError("Cannot call a class as a function")})(this,f);var h=function(E,m){if(!E)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!m||typeof m!="object"&&typeof m!="function"?E:m}(this,y.call(this,d));return h._userLoaded=new p.Event("User loaded"),h._userUnloaded=new p.Event("User unloaded"),h._silentRenewError=new p.Event("Silent renew error"),h._userSignedIn=new p.Event("User signed in"),h._userSignedOut=new p.Event("User signed out"),h._userSessionChanged=new p.Event("User session changed"),h}return function(h,v){if(typeof v!="function"&&v!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof v);h.prototype=Object.create(v&&v.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),v&&(Object.setPrototypeOf?Object.setPrototypeOf(h,v):h.__proto__=v)}(f,y),f.prototype.load=function(h){var v=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];c.Log.debug("UserManagerEvents.load"),y.prototype.load.call(this,h),v&&this._userLoaded.raise(h)},f.prototype.unload=function(){c.Log.debug("UserManagerEvents.unload"),y.prototype.unload.call(this),this._userUnloaded.raise()},f.prototype.addUserLoaded=function(h){this._userLoaded.addHandler(h)},f.prototype.removeUserLoaded=function(h){this._userLoaded.removeHandler(h)},f.prototype.addUserUnloaded=function(h){this._userUnloaded.addHandler(h)},f.prototype.removeUserUnloaded=function(h){this._userUnloaded.removeHandler(h)},f.prototype.addSilentRenewError=function(h){this._silentRenewError.addHandler(h)},f.prototype.removeSilentRenewError=function(h){this._silentRenewError.removeHandler(h)},f.prototype._raiseSilentRenewError=function(h){c.Log.debug("UserManagerEvents._raiseSilentRenewError",h.message),this._silentRenewError.raise(h)},f.prototype.addUserSignedIn=function(h){this._userSignedIn.addHandler(h)},f.prototype.removeUserSignedIn=function(h){this._userSignedIn.removeHandler(h)},f.prototype._raiseUserSignedIn=function(){c.Log.debug("UserManagerEvents._raiseUserSignedIn"),this._userSignedIn.raise()},f.prototype.addUserSignedOut=function(h){this._userSignedOut.addHandler(h)},f.prototype.removeUserSignedOut=function(h){this._userSignedOut.removeHandler(h)},f.prototype._raiseUserSignedOut=function(){c.Log.debug("UserManagerEvents._raiseUserSignedOut"),this._userSignedOut.raise()},f.prototype.addUserSessionChanged=function(h){this._userSessionChanged.addHandler(h)},f.prototype.removeUserSessionChanged=function(h){this._userSessionChanged.removeHandler(h)},f.prototype._raiseUserSessionChanged=function(){c.Log.debug("UserManagerEvents._raiseUserSessionChanged"),this._userSessionChanged.raise()},f}(u.AccessTokenEvents)},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.Timer=void 0;var c=function(){function h(v,E){for(var m=0;m<E.length;m++){var A=E[m];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(v,A.key,A)}}return function(v,E,m){return E&&h(v.prototype,E),m&&h(v,m),v}}(),u=s(0),p=s(1),y=s(17);function f(h,v){if(!(h instanceof v))throw new TypeError("Cannot call a class as a function")}function d(h,v){if(!h)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!v||typeof v!="object"&&typeof v!="function"?h:v}r.Timer=function(h){function v(E){var m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:p.Global.timer,A=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;f(this,v);var F=d(this,h.call(this,E));return F._timer=m,F._nowFunc=A||function(){return Date.now()/1e3},F}return function(m,A){if(typeof A!="function"&&A!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof A);m.prototype=Object.create(A&&A.prototype,{constructor:{value:m,enumerable:!1,writable:!0,configurable:!0}}),A&&(Object.setPrototypeOf?Object.setPrototypeOf(m,A):m.__proto__=A)}(v,h),v.prototype.init=function(m){m<=0&&(m=1),m=parseInt(m);var A=this.now+m;if(this.expiration===A&&this._timerHandle)u.Log.debug("Timer.init timer "+this._name+" skipping initialization since already initialized for expiration:",this.expiration);else{this.cancel(),u.Log.debug("Timer.init timer "+this._name+" for duration:",m),this._expiration=A;var F=5;m<F&&(F=m),this._timerHandle=this._timer.setInterval(this._callback.bind(this),1e3*F)}},v.prototype.cancel=function(){this._timerHandle&&(u.Log.debug("Timer.cancel: ",this._name),this._timer.clearInterval(this._timerHandle),this._timerHandle=null)},v.prototype._callback=function(){var m=this._expiration-this.now;u.Log.debug("Timer.callback; "+this._name+" timer expires in:",m),this._expiration<=this.now&&(this.cancel(),h.prototype.raise.call(this))},c(v,[{key:"now",get:function(){return parseInt(this._nowFunc())}},{key:"expiration",get:function(){return this._expiration}}]),v}(y.Event)},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.SilentRenewService=void 0;var c=s(0);r.SilentRenewService=function(){function u(p){(function(f,d){if(!(f instanceof d))throw new TypeError("Cannot call a class as a function")})(this,u),this._userManager=p}return u.prototype.start=function(){this._callback||(this._callback=this._tokenExpiring.bind(this),this._userManager.events.addAccessTokenExpiring(this._callback),this._userManager.getUser().then(function(y){}).catch(function(y){c.Log.error("SilentRenewService.start: Error from getUser:",y.message)}))},u.prototype.stop=function(){this._callback&&(this._userManager.events.removeAccessTokenExpiring(this._callback),delete this._callback)},u.prototype._tokenExpiring=function(){var y=this;this._userManager.signinSilent().then(function(f){c.Log.debug("SilentRenewService._tokenExpiring: Silent token renewal successful")},function(f){c.Log.error("SilentRenewService._tokenExpiring: Error from signinSilent:",f.message),y._userManager.events._raiseSilentRenewError(f)})},u}()},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.CordovaPopupNavigator=void 0;var c=s(21);r.CordovaPopupNavigator=function(){function u(){(function(y,f){if(!(y instanceof f))throw new TypeError("Cannot call a class as a function")})(this,u)}return u.prototype.prepare=function(y){var f=new c.CordovaPopupWindow(y);return Promise.resolve(f)},u}()},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.CordovaIFrameNavigator=void 0;var c=s(21);r.CordovaIFrameNavigator=function(){function u(){(function(y,f){if(!(y instanceof f))throw new TypeError("Cannot call a class as a function")})(this,u)}return u.prototype.prepare=function(y){y.popupWindowFeatures="hidden=yes";var f=new c.CordovaPopupWindow(y);return Promise.resolve(f)},u}()},function(n,r,s){Object.defineProperty(r,"__esModule",{value:!0}),r.Version="1.11.6"}])})})(qt);function Al(t,e){var n,r,s,c;throw t.error==="invalid_redirect_uri"?new Error(`Dynamic client registration failed: the provided redirect uri [${(n=e.redirectUrl)===null||n===void 0?void 0:n.toString()}] is invalid - ${(r=t.error_description)!==null&&r!==void 0?r:""}`):t.error==="invalid_client_metadata"?new Error(`Dynamic client registration failed: the provided client metadata ${JSON.stringify(e)} is invalid - ${(s=t.error_description)!==null&&s!==void 0?s:""}`):new Error(`Dynamic client registration failed: ${t.error} - ${(c=t.error_description)!==null&&c!==void 0?c:""}`)}function Pl(t,e){if(t.client_id===void 0)throw new Error(`Dynamic client registration failed: no client_id has been found on ${JSON.stringify(t)}`);if(e.redirectUrl&&(t.redirect_uris===void 0||t.redirect_uris[0]!==e.redirectUrl.toString()))throw new Error(`Dynamic client registration failed: the returned redirect URIs ${JSON.stringify(t.redirect_uris)} don't match the provided ${JSON.stringify([e.redirectUrl.toString()])}`)}async function kl(t,e){var n;if(!e.registrationEndpoint)throw new Error("Dynamic Registration could not be completed because the issuer has no registration endpoint.");if(!Array.isArray(e.idTokenSigningAlgValuesSupported))throw new Error("The OIDC issuer discovery profile is missing the 'id_token_signing_alg_values_supported' value, which is mandatory.");const r=ze.determineSigningAlg(e.idTokenSigningAlgValuesSupported,ze.PREFERRED_SIGNING_ALG),s={client_name:t.clientName,application_type:"web",redirect_uris:[(n=t.redirectUrl)===null||n===void 0?void 0:n.toString()],subject_type:"public",token_endpoint_auth_method:"client_secret_basic",id_token_signed_response_alg:r,grant_types:["authorization_code","refresh_token"]},c={"Content-Type":"application/json"},u=await fetch(e.registrationEndpoint.toString(),{method:"POST",headers:c,body:JSON.stringify(s)});if(u.ok){const p=await u.json();return Pl(p,t),{clientId:p.client_id,clientSecret:p.client_secret,idTokenSignedResponseAlg:p.id_token_signed_response_alg,clientType:"dynamic"}}throw u.status===400&&Al(await u.json(),t),new Error(`Dynamic client registration failed: the server returned ${u.status} ${u.statusText} - ${await u.text()}`)}function Tl(t){return t.error!==void 0&&typeof t.error=="string"}function Vo(t){return t.error_description!==void 0&&typeof t.error_description=="string"}function Cl(t){return t.error_uri!==void 0&&typeof t.error_uri=="string"}function Il(t){return t.access_token!==void 0&&typeof t.access_token=="string"}function xl(t){return t.id_token!==void 0&&typeof t.id_token=="string"}function Rl(t){return t.refresh_token!==void 0&&typeof t.refresh_token=="string"}function Ul(t){return t.token_type!==void 0&&typeof t.token_type=="string"}function Dl(t){return t.expires_in===void 0||typeof t.expires_in=="number"}function Ol(t,e){if(e.grantType&&(!t.grantTypesSupported||!t.grantTypesSupported.includes(e.grantType)))throw new Error(`The issuer [${t.issuer}] does not support the [${e.grantType}] grant`);if(!t.tokenEndpoint)throw new Error(`This issuer [${t.issuer}] does not have a token endpoint`)}function ba(t,e){if(Tl(t))throw new ze.OidcProviderError(`Token endpoint returned error [${t.error}]${Vo(t)?`: ${t.error_description}`:""}${Cl(t)?` (see ${t.error_uri})`:""}`,t.error,Vo(t)?t.error_description:void 0);if(!Il(t))throw new ze.InvalidResponseError(["access_token"]);if(!xl(t))throw new ze.InvalidResponseError(["id_token"]);if(!Ul(t))throw new ze.InvalidResponseError(["token_type"]);if(!Dl(t))throw new ze.InvalidResponseError(["expires_in"]);if(!e&&t.token_type.toLowerCase()!=="bearer")throw new Error(`Invalid token endpoint response: requested a [Bearer] token, but got a 'token_type' value of [${t.token_type}].`);return t}async function Hl(t,e,n,r){Ol(t,n);const s={"content-type":"application/x-www-form-urlencoded"};let c;r&&(c=await ze.generateDpopKeyPair(),s.DPoP=await ze.createDpopHeader(t.tokenEndpoint,"POST",c)),e.clientSecret&&(s.Authorization=`Basic ${btoa(`${e.clientId}:${e.clientSecret}`)}`);const u={grant_type:n.grantType,redirect_uri:n.redirectUrl,code:n.code,code_verifier:n.codeVerifier,client_id:e.clientId},p={method:"POST",headers:s,body:new URLSearchParams(u).toString()},f=await(await await fetch(t.tokenEndpoint,p)).json(),d=ba(f,r),h=await ze.getWebidFromTokenPayload(d.id_token,t.jwksUri,t.issuer,e.clientId);return{accessToken:d.access_token,idToken:d.id_token,refreshToken:Rl(d)?d.refresh_token:void 0,webId:h,dpopKey:c,expiresIn:d.expires_in}}async function Nl(t){let e;try{const n=new qt.exports.OidcClient({response_mode:"query",loadUserInfo:!1});if(e=await n.processSigninResponse(t),n.settings.metadata===void 0)throw new Error("Cannot retrieve issuer metadata from client information in storage.");if(n.settings.metadata.jwks_uri===void 0)throw new Error("Missing some issuer metadata from client information in storage: 'jwks_uri' is undefined");if(n.settings.metadata.issuer===void 0)throw new Error("Missing some issuer metadata from client information in storage: 'issuer' is undefined");if(n.settings.client_id===void 0)throw new Error("Missing some client information in storage: 'client_id' is undefined");const r=await ze.getWebidFromTokenPayload(e.id_token,n.settings.metadata.jwks_uri,n.settings.metadata.issuer,n.settings.client_id);return{accessToken:e.access_token,idToken:e.id_token,webId:r,refreshToken:e.refresh_token}}catch(n){throw new Error(`Problem handling Auth Code Grant (Flow) redirect - URL [${t}]: ${n}`)}}async function Ll(t,e,n){return Hl(t,e,n,!0)}const Ml=t=>{try{return new URL(t),!0}catch{return!1}};async function Kl(t,e,n,r){if(n.clientId===void 0)throw new Error("No client ID available when trying to refresh the access token.");const s={grant_type:"refresh_token",refresh_token:t,scope:ze.DEFAULT_SCOPES};let c={};r!==void 0&&(c={DPoP:await ze.createDpopHeader(e.tokenEndpoint,"POST",r)});let u={};n.clientSecret!==void 0?u={Authorization:`Basic ${btoa(`${n.clientId}:${n.clientSecret}`)}`}:Ml(n.clientId)&&(s.client_id=n.clientId);const p=await fetch(e.tokenEndpoint,{method:"POST",body:new URLSearchParams(s).toString(),headers:{...c,...u,"Content-Type":"application/x-www-form-urlencoded"}});let y;try{y=await p.json()}catch{throw new Error(`The token endpoint of issuer ${e.issuer} returned a malformed response.`)}const f=ba(y,r!==void 0),d=await ze.getWebidFromTokenPayload(f.id_token,e.jwksUri,e.issuer,n.clientId);return{accessToken:f.access_token,idToken:f.id_token,refreshToken:typeof f.refresh_token=="string"?f.refresh_token:void 0,webId:d,dpopKey:r,expiresIn:f.expires_in}}function Bl(t){const e=new URL(t);return e.searchParams.delete("code"),e.searchParams.delete("state"),e.hash="",e.toString()}async function jl(){await new qt.exports.OidcClient({response_mode:"query"}).clearStaleState(new qt.exports.WebStorageStateStore({}));const e=window.localStorage,n=[];for(let r=0;r<=e.length;r+=1){const s=e.key(r);s&&(s.match(/^oidc\..+$/)||s.match(/^solidClientAuthenticationUser:.+$/))&&n.push(s)}n.forEach(r=>e.removeItem(r))}var Wl=Object.freeze(Object.defineProperty({__proto__:null,clearOidcPersistentStorage:jl,getBearerToken:Nl,getDpopToken:Ll,refresh:Kl,registerClient:kl,removeOidcQueryParam:Bl,CordovaIFrameNavigator:qt.exports.CordovaIFrameNavigator,CordovaPopupNavigator:qt.exports.CordovaPopupNavigator,InMemoryWebStorage:qt.exports.InMemoryWebStorage,Log:qt.exports.Log,OidcClient:qt.exports.OidcClient,SessionMonitor:qt.exports.SessionMonitor,User:qt.exports.User,UserManager:qt.exports.UserManager,Version:qt.exports.Version,WebStorageStateStore:qt.exports.WebStorageStateStore},Symbol.toStringTag,{value:"Module"})),on=Li(Wl);Object.defineProperty(oo,"__esModule",{value:!0});const Vl=ze,$l=on,$o=(t,e)=>window.fetch(t,e);class Jl{constructor(e,n,r,s,c){this.loginHandler=e,this.redirectHandler=n,this.logoutHandler=r,this.sessionInfoManager=s,this.issuerConfigFetcher=c,this.login=async(u,p)=>{var y,f;await this.sessionInfoManager.clear(u.sessionId);const d=(0,$l.removeOidcQueryParam)((y=u.redirectUrl)!==null&&y!==void 0?y:window.location.href);await this.loginHandler.handle({...u,redirectUrl:d,clientName:(f=u.clientName)!==null&&f!==void 0?f:u.clientId,eventEmitter:p})},this.fetch=$o,this.logout=async u=>{await this.logoutHandler.handle(u),this.fetch=$o},this.getSessionInfo=async u=>this.sessionInfoManager.get(u),this.getAllSessionInfo=async()=>this.sessionInfoManager.getAll(),this.validateCurrentSession=async u=>{const p=await this.sessionInfoManager.get(u);return p===void 0||p.clientAppId===void 0||p.issuer===void 0?null:p},this.handleIncomingRedirect=async(u,p)=>{try{const y=await this.redirectHandler.handle(u,p);return this.fetch=y.fetch.bind(window),this.cleanUrlAfterRedirect(u),{isLoggedIn:y.isLoggedIn,webId:y.webId,sessionId:y.sessionId,expirationDate:y.expirationDate}}catch(y){this.cleanUrlAfterRedirect(u),p.emit(Vl.EVENTS.ERROR,"redirect",y);return}}}cleanUrlAfterRedirect(e){const n=new URL(e);n.searchParams.delete("state"),n.searchParams.delete("code"),n.searchParams.delete("id_token"),n.searchParams.delete("access_token"),n.searchParams.delete("error"),n.searchParams.delete("error_description"),window.history.replaceState(null,"",n.toString())}}oo.default=Jl;var so={};Object.defineProperty(so,"__esModule",{value:!0});const Ai=ze;function Jo(t){return typeof t.oidcIssuer=="string"}function qo(t){return typeof t.redirectUrl=="string"}class ql{constructor(e,n,r,s){this.storageUtility=e,this.oidcHandler=n,this.issuerConfigFetcher=r,this.clientRegistrar=s}async canHandle(e){return Jo(e)&&qo(e)}async handle(e){if(!Jo(e))throw new Ai.ConfigurationError(`OidcLoginHandler requires an OIDC issuer: missing property 'oidcIssuer' in ${JSON.stringify(e)}`);if(!qo(e))throw new Ai.ConfigurationError(`OidcLoginHandler requires a redirect URL: missing property 'redirectUrl' in ${JSON.stringify(e)}`);const n=await this.issuerConfigFetcher.fetchConfig(e.oidcIssuer),r=await(0,Ai.handleRegistration)(e,n,this.storageUtility,this.clientRegistrar),s={issuer:n.issuer,dpop:e.tokenType.toLowerCase()==="dpop",...e,issuerConfiguration:n,client:r};return this.oidcHandler.handle(s)}}so.default=ql;var ao={};Object.defineProperty(ao,"__esModule",{value:!0});const zl=ze,Gl=on;class Yl{constructor(e,n){this.storageUtility=e,this.redirector=n}async canHandle(e){return!!(e.issuerConfiguration.grantTypesSupported&&e.issuerConfiguration.grantTypesSupported.indexOf("authorization_code")>-1)}async handle(e){var n;const r={authority:e.issuer.toString(),client_id:e.client.clientId,client_secret:e.client.clientSecret,redirect_uri:e.redirectUrl.toString(),post_logout_redirect_uri:e.redirectUrl.toString(),response_type:"code",scope:zl.DEFAULT_SCOPES,filterProtocolClaims:!0,loadUserInfo:!1,code_verifier:!0,prompt:(n=e.prompt)!==null&&n!==void 0?n:"consent"},s=new Gl.OidcClient(r),{redirector:c}=this,u=this.storageUtility;try{const p=await s.createSigninRequest();await Promise.all([u.setForUser(p.state._id,{sessionId:e.sessionId}),u.setForUser(e.sessionId,{codeVerifier:p.state._code_verifier,issuer:e.issuer.toString(),redirectUrl:e.redirectUrl,dpop:e.dpop?"true":"false"})]),c.redirect(p.url.toString(),{handleRedirect:e.handleRedirect})}catch(p){console.error(p)}}}ao.default=Yl;var Sa={},oi={};Object.defineProperty(oi,"__esModule",{value:!0});oi.appendToUrlPathname=void 0;function Xl(t,e){const n=new URL(t),r=n.pathname;return n.pathname=`${r}${r.endsWith("/")?"":"/"}${e.startsWith("/")?e.substring(1):e}`,n.toString()}oi.appendToUrlPathname=Xl;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.WELL_KNOWN_OPENID_CONFIG=void 0;const e=ze,n=oi;t.WELL_KNOWN_OPENID_CONFIG=".well-known/openid-configuration";const r={issuer:{toKey:"issuer",convertToUrl:!0},authorization_endpoint:{toKey:"authorizationEndpoint",convertToUrl:!0},token_endpoint:{toKey:"tokenEndpoint",convertToUrl:!0},userinfo_endpoint:{toKey:"userinfoEndpoint",convertToUrl:!0},jwks_uri:{toKey:"jwksUri",convertToUrl:!0},registration_endpoint:{toKey:"registrationEndpoint",convertToUrl:!0},scopes_supported:{toKey:"scopesSupported"},response_types_supported:{toKey:"responseTypesSupported"},response_modes_supported:{toKey:"responseModesSupported"},grant_types_supported:{toKey:"grantTypesSupported"},acr_values_supported:{toKey:"acrValuesSupported"},subject_types_supported:{toKey:"subjectTypesSupported"},id_token_signing_alg_values_supported:{toKey:"idTokenSigningAlgValuesSupported"},id_token_encryption_alg_values_supported:{toKey:"idTokenEncryptionAlgValuesSupported"},id_token_encryption_enc_values_supported:{toKey:"idTokenEncryptionEncValuesSupported"},userinfo_signing_alg_values_supported:{toKey:"userinfoSigningAlgValuesSupported"},userinfo_encryption_alg_values_supported:{toKey:"userinfoEncryptionAlgValuesSupported"},userinfo_encryption_enc_values_supported:{toKey:"userinfoEncryptionEncValuesSupported"},request_object_signing_alg_values_supported:{toKey:"requestObjectSigningAlgValuesSupported"},request_object_encryption_alg_values_supported:{toKey:"requestObjectEncryptionAlgValuesSupported"},request_object_encryption_enc_values_supported:{toKey:"requestObjectEncryptionEncValuesSupported"},token_endpoint_auth_methods_supported:{toKey:"tokenEndpointAuthMethodsSupported"},token_endpoint_auth_signing_alg_values_supported:{toKey:"tokenEndpointAuthSigningAlgValuesSupported"},display_values_supported:{toKey:"displayValuesSupported"},claim_types_supported:{toKey:"claimTypesSupported"},claims_supported:{toKey:"claimsSupported"},service_documentation:{toKey:"serviceDocumentation"},claims_locales_supported:{toKey:"claimsLocalesSupported"},ui_locales_supported:{toKey:"uiLocalesSupported"},claims_parameter_supported:{toKey:"claimsParameterSupported"},request_parameter_supported:{toKey:"requestParameterSupported"},request_uri_parameter_supported:{toKey:"requestUriParameterSupported"},require_request_uri_registration:{toKey:"requireRequestUriRegistration"},op_policy_uri:{toKey:"opPolicyUri",convertToUrl:!0},op_tos_uri:{toKey:"opTosUri",convertToUrl:!0}};function s(u){const p={};return Object.keys(u).forEach(y=>{r[y]&&(p[r[y].toKey]=u[y])}),Array.isArray(p.scopesSupported)||(p.scopesSupported=["openid"]),p}class c{constructor(p){this.storageUtility=p}static getLocalStorageKey(p){return`issuerConfig:${p}`}async fetchConfig(p){let y;const f=(0,n.appendToUrlPathname)(p,t.WELL_KNOWN_OPENID_CONFIG),d=await window.fetch(f);try{y=s(await d.json())}catch(h){throw new e.ConfigurationError(`[${p.toString()}] has an invalid configuration: ${h.message}`)}return await this.storageUtility.set(c.getLocalStorageKey(p),JSON.stringify(y)),y}}t.default=c})(Sa);var si={},wr={};Object.defineProperty(wr,"__esModule",{value:!0});wr.SessionInfoManager=wr.clear=wr.getUnauthenticatedSession=void 0;const Ql=ze,Zl=no,ed=on;function td(){return{isLoggedIn:!1,sessionId:(0,Zl.v4)(),fetch}}wr.getUnauthenticatedSession=td;async function Ea(t,e){await Promise.all([e.deleteAllUserData(t,{secure:!1}),e.deleteAllUserData(t,{secure:!0}),e.delete("clientKey",{secure:!1})]),await(0,ed.clearOidcPersistentStorage)()}wr.clear=Ea;class rd{constructor(e){this.storageUtility=e}update(e,n){throw new Error("Not Implemented")}async get(e){var n;const r=await this.storageUtility.getForUser(e,"isLoggedIn",{secure:!0}),s=await this.storageUtility.getForUser(e,"webId",{secure:!0}),c=await this.storageUtility.getForUser(e,"clientId",{secure:!1}),u=await this.storageUtility.getForUser(e,"clientSecret",{secure:!1}),p=await this.storageUtility.getForUser(e,"redirectUrl",{secure:!1}),y=await this.storageUtility.getForUser(e,"refreshToken",{secure:!0}),f=await this.storageUtility.getForUser(e,"issuer",{secure:!1}),d=(n=await this.storageUtility.getForUser(e,"tokenType",{secure:!1}))!==null&&n!==void 0?n:"DPoP";if(!(0,Ql.isSupportedTokenType)(d))throw new Error(`Tokens of type [${d}] are not supported.`);if(!(c===void 0&&r===void 0&&s===void 0&&y===void 0))return{sessionId:e,webId:s,isLoggedIn:r==="true",redirectUrl:p,refreshToken:y,issuer:f,clientAppId:c,clientAppSecret:u,tokenType:d}}async getAll(){throw new Error("Not implemented")}async clear(e){return Ea(e,this.storageUtility)}async register(e){throw new Error("Not implemented")}async getRegisteredSessionIdAll(){throw new Error("Not implemented")}async clearAll(){throw new Error("Not implemented")}}wr.SessionInfoManager=rd;Object.defineProperty(si,"__esModule",{value:!0});si.FallbackRedirectHandler=void 0;const nd=wr;class id{async canHandle(e){try{return new URL(e),!0}catch(n){throw new Error(`[${e}] is not a valid URL, and cannot be used as a redirect URL: ${n}`)}}async handle(e){return(0,nd.getUnauthenticatedSession)()}}si.FallbackRedirectHandler=id;var uo={};Object.defineProperty(uo,"__esModule",{value:!0});class od{constructor(e){this.sessionInfoManager=e}async canHandle(){return!0}async handle(e){await this.sessionInfoManager.clear(e)}}uo.default=od;var ai={};Object.defineProperty(ai,"__esModule",{value:!0});ai.AuthCodeRedirectHandler=void 0;const zo=ze,Go=on;class sd{constructor(e,n,r,s,c){this.storageUtility=e,this.sessionInfoManager=n,this.issuerConfigFetcher=r,this.clientRegistrar=s,this.tokerRefresher=c}async canHandle(e){try{const n=new URL(e);return n.searchParams.get("code")!==null&&n.searchParams.get("state")!==null}catch(n){throw new Error(`[${e}] is not a valid URL, and cannot be used as a redirect URL: ${n}`)}}async handle(e,n){if(!await this.canHandle(e))throw new Error(`AuthCodeRedirectHandler cannot handle [${e}]: it is missing one of [code, state].`);const r=new URL(e),s=r.searchParams.get("state"),c=await this.storageUtility.getForUser(s,"sessionId",{errorIfNull:!0}),{issuerConfig:u,codeVerifier:p,redirectUrl:y,dpop:f}=await(0,zo.loadOidcContextFromStorage)(c,this.storageUtility,this.issuerConfigFetcher);if(p===void 0)throw new Error(`The code verifier for session ${c} is missing from storage.`);if(y===void 0)throw new Error(`The redirect URL for session ${c} is missing from storage.`);const d=await this.clientRegistrar.getClient({sessionId:c},u);let h;const v=Date.now();f?(h=await(0,Go.getDpopToken)(u,d,{grantType:"authorization_code",code:r.searchParams.get("code"),codeVerifier:p,redirectUrl:y}),window.localStorage.removeItem(`oidc.${s}`)):h=await(0,Go.getBearerToken)(r.toString());let E;h.refreshToken!==void 0&&(E={sessionId:c,refreshToken:h.refreshToken,tokenRefresher:this.tokerRefresher});const m=await(0,zo.buildAuthenticatedFetch)(fetch,h.accessToken,{dpopKey:h.dpopKey,refreshOptions:E,eventEmitter:n,expiresIn:h.expiresIn});await this.storageUtility.setForUser(c,{webId:h.webId,isLoggedIn:"true"},{secure:!0}),r.searchParams.delete("code"),await this.storageUtility.setForUser(c,{redirectUrl:r.toString()},{secure:!1});const A=await this.sessionInfoManager.get(c);if(!A)throw new Error(`Could not retrieve session: [${c}].`);return Object.assign(A,{fetch:m,expirationDate:typeof h.expiresIn=="number"?v+h.expiresIn*1e3:null})}}ai.AuthCodeRedirectHandler=sd;var co={};Object.defineProperty(co,"__esModule",{value:!0});const ad=ze;class ud extends ad.AggregateHandler{constructor(e){super(e)}}co.default=ud;var lo={};Object.defineProperty(lo,"__esModule",{value:!0});class cd{get storage(){return window.localStorage}async get(e){return this.storage.getItem(e)||void 0}async set(e,n){this.storage.setItem(e,n)}async delete(e){this.storage.removeItem(e)}}lo.default=cd;var fo={};Object.defineProperty(fo,"__esModule",{value:!0});class ld{redirect(e,n){n&&n.handleRedirect?n.handleRedirect(e):n&&n.redirectByReplacingState?window.history.replaceState({},"",e):window.location.href=e}}fo.default=ld;var ho={};Object.defineProperty(ho,"__esModule",{value:!0});const dd=on;class fd{constructor(e){this.storageUtility=e}async getClient(e,n){const[r,s]=await Promise.all([this.storageUtility.getForUser(e.sessionId,"clientId",{secure:!1}),this.storageUtility.getForUser(e.sessionId,"clientSecret",{secure:!1})]);if(r)return{clientId:r,clientSecret:s,clientType:"dynamic"};try{const c=await(0,dd.registerClient)(e,n),u={clientId:c.clientId};return c.clientSecret&&(u.clientSecret=c.clientSecret),c.idTokenSignedResponseAlg&&(u.idTokenSignedResponseAlg=c.idTokenSignedResponseAlg),await this.storageUtility.setForUser(e.sessionId,u,{secure:!1}),c}catch(c){throw new Error(`Client registration failed: [${c}]`)}}}ho.default=fd;var ui={};Object.defineProperty(ui,"__esModule",{value:!0});ui.ErrorOidcHandler=void 0;const hd=ze,pd=wr;class gd{async canHandle(e){try{return new URL(e).searchParams.has("error")}catch(n){throw new Error(`[${e}] is not a valid URL, and cannot be used as a redirect URL: ${n}`)}}async handle(e,n){if(n!==void 0){const r=new URL(e),s=r.searchParams.get("error"),c=r.searchParams.get("error_description");n.emit(hd.EVENTS.ERROR,s,c)}return(0,pd.getUnauthenticatedSession)()}}ui.ErrorOidcHandler=gd;var po={};Object.defineProperty(po,"__esModule",{value:!0});const Yo=ze,yd=on;class vd{constructor(e,n,r){this.storageUtility=e,this.issuerConfigFetcher=n,this.clientRegistrar=r}async refresh(e,n,r,s){const c=await(0,Yo.loadOidcContextFromStorage)(e,this.storageUtility,this.issuerConfigFetcher),u=await this.clientRegistrar.getClient({sessionId:e},c.issuerConfig);if(n===void 0)throw new Error(`Session [${e}] has no refresh token to allow it to refresh its access token.`);if(c.dpop&&r===void 0)throw new Error(`For session [${e}], the key bound to the DPoP access token must be provided to refresh said access token.`);const p=await(0,yd.refresh)(n,c.issuerConfig,u,r);return p.refreshToken!==void 0&&(s==null||s.emit(Yo.EVENTS.NEW_REFRESH_TOKEN,p.refreshToken),await this.storageUtility.setForUser(e,{refreshToken:p.refreshToken})),p}}po.default=vd;var fr=gt&&gt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(An,"__esModule",{value:!0});An.getClientAuthenticationWithDependencies=void 0;const md=ze,_d=fr(io),wd=fr(oo),bd=fr(so),Sd=fr(ao),Ed=fr(Sa),Fd=si,Ad=fr(uo),Pd=wr,kd=ai,Td=fr(co),Cd=fr(lo),Id=fr(fo),xd=fr(ho),Rd=ui,Ud=fr(po);function Dd(t){const e=new md.InMemoryStorage,n=t.secureStorage||e,r=t.insecureStorage||new Cd.default,s=new _d.default(n,r),c=new Ed.default(s),u=new xd.default(s),p=new Pd.SessionInfoManager(s),y=new Ud.default(s,c,u),f=new bd.default(s,new Sd.default(s,new Id.default),c,u),d=new Td.default([new Rd.ErrorOidcHandler,new kd.AuthCodeRedirectHandler(s,p,c,u,y),new Fd.FallbackRedirectHandler]);return new wd.default(f,d,new Ad.default(p),p,c)}An.getClientAuthenticationWithDependencies=Dd;var nn={};Object.defineProperty(nn,"__esModule",{value:!0});nn.KEY_CURRENT_URL=nn.KEY_CURRENT_SESSION=void 0;const Fa=ze;nn.KEY_CURRENT_SESSION=`${Fa.SOLID_CLIENT_AUTHN_KEY_PREFIX}currentSession`;nn.KEY_CURRENT_URL=`${Fa.SOLID_CLIENT_AUTHN_KEY_PREFIX}currentUrl`;Object.defineProperty(jr,"__esModule",{value:!0});jr.Session=jr.silentlyAuthenticate=void 0;const Od=Mi.exports,nr=ze,Hd=no,Xo=An,Yr=nn;async function Aa(t,e,n){var r;const s=await e.validateCurrentSession(t);return s!==null?(window.localStorage.setItem(Yr.KEY_CURRENT_URL,window.location.href),await e.login({sessionId:t,prompt:"none",oidcIssuer:s.issuer,redirectUrl:s.redirectUrl,clientId:s.clientAppId,clientSecret:s.clientAppSecret,tokenType:(r=s.tokenType)!==null&&r!==void 0?r:"DPoP"},n),!0):!1}jr.silentlyAuthenticate=Aa;function Nd(t){return!!(t!=null&&t.isLoggedIn)}class Ld extends Od.EventEmitter{constructor(e={},n){super(),this.tokenRequestInProgress=!1,this.login=async r=>{var s;return await this.clientAuthentication.login({sessionId:this.info.sessionId,...r,tokenType:(s=r.tokenType)!==null&&s!==void 0?s:"DPoP"},this),new Promise(()=>{})},this.fetch=async(r,s)=>this.clientAuthentication.fetch(r,s),this.internalLogout=async r=>{window.localStorage.removeItem(Yr.KEY_CURRENT_SESSION),await this.clientAuthentication.logout(this.info.sessionId),this.info.isLoggedIn=!1,r&&this.emit(nr.EVENTS.LOGOUT)},this.logout=async()=>this.internalLogout(!0),this.handleIncomingRedirect=async(r={})=>{var s;if(this.info.isLoggedIn)return this.info;if(this.tokenRequestInProgress)return;const c=typeof r=="string"?{url:r}:r,u=(s=c.url)!==null&&s!==void 0?s:window.location.href;this.tokenRequestInProgress=!0;const p=await this.clientAuthentication.handleIncomingRedirect(u,this);if(Nd(p)){this.setSessionInfo(p);const y=window.localStorage.getItem(Yr.KEY_CURRENT_URL);y===null?this.emit(nr.EVENTS.LOGIN):(window.localStorage.removeItem(Yr.KEY_CURRENT_URL),this.emit(nr.EVENTS.SESSION_RESTORED,y))}else if(c.restorePreviousSession===!0){const y=window.localStorage.getItem(Yr.KEY_CURRENT_SESSION);if(y!==null&&await Aa(y,this.clientAuthentication,this))return new Promise(()=>{})}return this.tokenRequestInProgress=!1,p},e.clientAuthentication?this.clientAuthentication=e.clientAuthentication:e.secureStorage&&e.insecureStorage?this.clientAuthentication=(0,Xo.getClientAuthenticationWithDependencies)({secureStorage:e.secureStorage,insecureStorage:e.insecureStorage}):this.clientAuthentication=(0,Xo.getClientAuthenticationWithDependencies)({}),e.sessionInfo?this.info={sessionId:e.sessionInfo.sessionId,isLoggedIn:!1,webId:e.sessionInfo.webId}:this.info={sessionId:n!=null?n:(0,Hd.v4)(),isLoggedIn:!1},this.on(nr.EVENTS.LOGIN,()=>window.localStorage.setItem(Yr.KEY_CURRENT_SESSION,this.info.sessionId)),this.on(nr.EVENTS.SESSION_EXPIRED,()=>this.internalLogout(!1)),this.on(nr.EVENTS.ERROR,()=>this.internalLogout(!1))}onLogin(e){this.on(nr.EVENTS.LOGIN,e)}onLogout(e){this.on(nr.EVENTS.LOGOUT,e)}onError(e){this.on(nr.EVENTS.ERROR,e)}onSessionRestore(e){this.on(nr.EVENTS.SESSION_RESTORED,e)}onSessionExpiration(e){this.on(nr.EVENTS.SESSION_EXPIRED,e)}setSessionInfo(e){this.info.isLoggedIn=e.isLoggedIn,this.info.webId=e.webId,this.info.sessionId=e.sessionId,this.info.expirationDate=e.expirationDate,this.on(nr.EVENTS.SESSION_EXTENDED,n=>{this.info.expirationDate=Date.now()+n*1e3})}}jr.Session=Ld;var Pt={};Object.defineProperty(Pt,"__esModule",{value:!0});Pt.onSessionRestore=Pt.onLogout=Pt.onLogin=Pt.handleIncomingRedirect=Pt.logout=Pt.login=Pt.fetch=Pt.getDefaultSession=void 0;const Md=jr;let Pi;function Hr(){return typeof Pi=="undefined"&&(Pi=new Md.Session),Pi}Pt.getDefaultSession=Hr;const Kd=(...t)=>Hr().fetch(...t);Pt.fetch=Kd;const Bd=(...t)=>Hr().login(...t);Pt.login=Bd;const jd=(...t)=>Hr().logout(...t);Pt.logout=jd;const Wd=(...t)=>Hr().handleIncomingRedirect(...t);Pt.handleIncomingRedirect=Wd;const Vd=(...t)=>Hr().onLogin(...t);Pt.onLogin=Vd;const $d=(...t)=>Hr().onLogout(...t);Pt.onLogout=$d;const Jd=(...t)=>Hr().onSessionRestore(...t);Pt.onSessionRestore=Jd;(function(t){var e=gt&&gt.__createBinding||(Object.create?function(u,p,y,f){f===void 0&&(f=y);var d=Object.getOwnPropertyDescriptor(p,y);(!d||("get"in d?!p.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return p[y]}}),Object.defineProperty(u,f,d)}:function(u,p,y,f){f===void 0&&(f=y),u[f]=p[y]}),n=gt&&gt.__exportStar||function(u,p){for(var y in u)y!=="default"&&!Object.prototype.hasOwnProperty.call(p,y)&&e(p,u,y)};Object.defineProperty(t,"__esModule",{value:!0}),t.InMemoryStorage=t.ConfigurationError=t.NotImplementedError=t.getClientAuthenticationWithDependencies=t.Session=void 0;var r=jr;Object.defineProperty(t,"Session",{enumerable:!0,get:function(){return r.Session}});var s=An;Object.defineProperty(t,"getClientAuthenticationWithDependencies",{enumerable:!0,get:function(){return s.getClientAuthenticationWithDependencies}}),n(Pt,t);var c=ze;Object.defineProperty(t,"NotImplementedError",{enumerable:!0,get:function(){return c.NotImplementedError}}),Object.defineProperty(t,"ConfigurationError",{enumerable:!0,get:function(){return c.ConfigurationError}}),Object.defineProperty(t,"InMemoryStorage",{enumerable:!0,get:function(){return c.InMemoryStorage}})})(yn);function qd(t){return typeof t=="object"&&t!==null&&"message"in t&&typeof t.message=="string"}function zd(t){if(qd(t))return t;try{return new Error(JSON.stringify(t))}catch{return new Error(String(t))}}const Gd=t=>({}),Qo=t=>({});function Yd(t){let e;return{c(){e=dt(t[1])},l(n){e=ft(n,t[1])},m(n,r){Me(n,e,r)},p(n,r){r&2&&Yt(e,n[1])},i:Zt,o:Zt,d(n){n&&de(e)}}}function Xd(t){let e;const n=t[8].label,r=xr(n,t,t[7],Qo);return{c(){r&&r.c()},l(s){r&&r.l(s)},m(s,c){r&&r.m(s,c),e=!0},p(s,c){r&&r.p&&(!e||c&128)&&Rr(r,n,s,s[7],e?Dr(n,s[7],c,Gd):Ur(s[7]),Qo)},i(s){e||(le(r,s),e=!0)},o(s){he(r,s),e=!1},d(s){r&&r.d(s)}}}function Qd(t){let e,n,r,s;return{c(){e=be("input"),this.h()},l(c){e=Se(c,"INPUT",{id:!0,class:!0,type:!0,placeholder:!0}),this.h()},h(){fe(e,"id",t[5]),fe(e,"class","rounded-md p-2 w-full bg-slate-100 hover:ring transition-all"),fe(e,"type","text"),fe(e,"placeholder",n=t[2]||t[1]),Ye(e,"ring",t[3]),Ye(e,"ring-red-500",t[3])},m(c,u){Me(c,e,u),kt(e,t[0]),r||(s=vt(e,"input",t[13]),r=!0)},p(c,u){u&6&&n!==(n=c[2]||c[1])&&fe(e,"placeholder",n),u&1&&e.value!==c[0]&&kt(e,c[0]),u&8&&Ye(e,"ring",c[3]),u&8&&Ye(e,"ring-red-500",c[3])},d(c){c&&de(e),r=!1,s()}}}function Zd(t){let e,n,r,s;return{c(){e=be("input"),this.h()},l(c){e=Se(c,"INPUT",{id:!0,class:!0,type:!0,placeholder:!0}),this.h()},h(){fe(e,"id",t[5]),fe(e,"class","rounded-md p-2 w-full bg-slate-100 hover:ring transition-all"),fe(e,"type","time"),fe(e,"placeholder",n=t[2]||t[1]),Ye(e,"ring",t[3]),Ye(e,"ring-red-500",t[3])},m(c,u){Me(c,e,u),kt(e,t[0]),r||(s=[vt(e,"input",t[12]),vt(e,"change",t[10])],r=!0)},p(c,u){u&6&&n!==(n=c[2]||c[1])&&fe(e,"placeholder",n),u&1&&kt(e,c[0]),u&8&&Ye(e,"ring",c[3]),u&8&&Ye(e,"ring-red-500",c[3])},d(c){c&&de(e),r=!1,Vr(s)}}}function ef(t){let e,n,r,s;return{c(){e=be("input"),this.h()},l(c){e=Se(c,"INPUT",{id:!0,class:!0,type:!0,placeholder:!0}),this.h()},h(){fe(e,"id",t[5]),fe(e,"class","rounded-md p-2 w-full bg-slate-100 hover:ring transition-all"),fe(e,"type","date"),fe(e,"placeholder",n=t[2]||t[1]),Ye(e,"ring",t[3]),Ye(e,"ring-red-500",t[3])},m(c,u){Me(c,e,u),kt(e,t[0]),r||(s=[vt(e,"input",t[11]),vt(e,"change",t[9])],r=!0)},p(c,u){u&6&&n!==(n=c[2]||c[1])&&fe(e,"placeholder",n),u&1&&kt(e,c[0]),u&8&&Ye(e,"ring",c[3]),u&8&&Ye(e,"ring-red-500",c[3])},d(c){c&&de(e),r=!1,Vr(s)}}}function tf(t){let e,n,r,s,c,u,p,y,f;const d=[Xd,Yd],h=[];function v(F,_){return F[6].label?0:F[1]?1:-1}~(r=v(t))&&(s=h[r]=d[r](t));function E(F,_){return F[4]=="date"?ef:F[4]=="time"?Zd:Qd}let m=E(t),A=m(t);return{c(){e=be("label"),n=be("div"),s&&s.c(),c=Ie(),A.c(),u=Ie(),p=be("div"),y=dt(t[3]),this.h()},l(F){e=Se(F,"LABEL",{class:!0,for:!0});var _=Te(e);n=Se(_,"DIV",{class:!0});var P=Te(n);s&&s.l(P),P.forEach(de),c=xe(_),A.l(_),u=xe(_),p=Se(_,"DIV",{class:!0});var C=Te(p);y=ft(C,t[3]),C.forEach(de),_.forEach(de),this.h()},h(){fe(n,"class","mx-1 mb-px text-sm capitalize"),fe(p,"class","text-sm h-2 text-red-700 "),Ye(p,"opacity-0",!t[3]),fe(e,"class","my-4 block"),fe(e,"for",t[5])},m(F,_){Me(F,e,_),ue(e,n),~r&&h[r].m(n,null),ue(e,c),A.m(e,null),ue(e,u),ue(e,p),ue(p,y),f=!0},p(F,[_]){let P=r;r=v(F),r===P?~r&&h[r].p(F,_):(s&&(Ut(),he(h[P],1,1,()=>{h[P]=null}),Dt()),~r?(s=h[r],s?s.p(F,_):(s=h[r]=d[r](F),s.c()),le(s,1),s.m(n,null)):s=null),m===(m=E(F))&&A?A.p(F,_):(A.d(1),A=m(F),A&&(A.c(),A.m(e,u))),(!f||_&8)&&Yt(y,F[3]),_&8&&Ye(p,"opacity-0",!F[3])},i(F){f||(le(s),f=!0)},o(F){he(s),f=!1},d(F){F&&de(e),~r&&h[r].d(),A.d()}}}function rf(t,e,n){let{$$slots:r={},$$scope:s}=e;const c=_n(r);let{label:u=""}=e,{placeholder:p=""}=e,{error:y=""}=e,{value:f=""}=e,{type:d="text"}=e,h=Wa();function v(_){Nn.call(this,t,_)}function E(_){Nn.call(this,t,_)}function m(){f=this.value,n(0,f)}function A(){f=this.value,n(0,f)}function F(){f=this.value,n(0,f)}return t.$$set=_=>{"label"in _&&n(1,u=_.label),"placeholder"in _&&n(2,p=_.placeholder),"error"in _&&n(3,y=_.error),"value"in _&&n(0,f=_.value),"type"in _&&n(4,d=_.type),"$$scope"in _&&n(7,s=_.$$scope)},[f,u,p,y,d,h,c,s,r,v,E,m,A,F]}class Pr extends or{constructor(e){super(),sr(this,e,rf,tf,ar,{label:1,placeholder:2,error:3,value:0,type:4})}}function nf(t){let e;return{c(){e=dt("Login with pod")},l(n){e=ft(n,"Login with pod")},m(n,r){Me(n,e,r)},d(n){n&&de(e)}}}function of(t){let e,n,r,s,c,u,p,y,f,d,h,v;function E(_){t[5](_)}let m={label:"pod url",error:t[1]};t[0]!==void 0&&(m.value=t[0]),c=new Pr({props:m}),gr.push(()=>yr(c,"value",E));function A(_){t[6](_)}let F={label:"webId",error:t[3]};return t[2]!==void 0&&(F.value=t[2]),y=new Pr({props:F}),gr.push(()=>yr(y,"value",A)),h=new Or({props:{focused:!0,$$slots:{default:[nf]},$$scope:{ctx:t}}}),h.$on("click",t[4]),{c(){e=be("div"),n=be("h1"),r=dt("Welcome to the pod"),s=Ie(),je(c.$$.fragment),p=Ie(),je(y.$$.fragment),d=Ie(),je(h.$$.fragment),this.h()},l(_){e=Se(_,"DIV",{class:!0});var P=Te(e);n=Se(P,"H1",{class:!0});var C=Te(n);r=ft(C,"Welcome to the pod"),C.forEach(de),s=xe(P),We(c.$$.fragment,P),p=xe(P),We(y.$$.fragment,P),d=xe(P),We(h.$$.fragment,P),P.forEach(de),this.h()},h(){fe(n,"class","text-2xl"),fe(e,"class","max-w-lg my-16 mx-auto")},m(_,P){Me(_,e,P),ue(e,n),ue(n,r),ue(e,s),Ve(c,e,null),ue(e,p),Ve(y,e,null),ue(e,d),Ve(h,e,null),v=!0},p(_,[P]){const C={};P&2&&(C.error=_[1]),!u&&P&1&&(u=!0,C.value=_[0],vr(()=>u=!1)),c.$set(C);const R={};P&8&&(R.error=_[3]),!f&&P&4&&(f=!0,R.value=_[2],vr(()=>f=!1)),y.$set(R);const V={};P&256&&(V.$$scope={dirty:P,ctx:_}),h.$set(V)},i(_){v||(le(c.$$.fragment,_),le(y.$$.fragment,_),le(h.$$.fragment,_),v=!0)},o(_){he(c.$$.fragment,_),he(y.$$.fragment,_),he(h.$$.fragment,_),v=!1},d(_){_&&de(e),$e(c),$e(y),$e(h)}}}function sf(t,e,n){let r,s="http://localhost:3000",c="",u="johndoe",p="";async function y(){if(n(1,c=""),n(3,p=""),!s)return n(1,c="Please enter a pod URL");if(!u)return n(3,p="Please enter a web ID");s.indexOf("//")<0&&n(0,s="http://"+s),localStorage.setItem("podUrl",s),localStorage.setItem("webID",u);try{yn.getDefaultSession().info.isLoggedIn||await yn.login({oidcIssuer:s,clientName:"Project-IDLab",redirectUrl:r})}catch(h){n(1,c=zd(h).message)}}bs(async()=>{await yn.handleIncomingRedirect({restorePreviousSession:!0}),r=window.location.href,n(0,s=localStorage.getItem("podUrl")||"http://localhost:3000"),n(2,u=localStorage.getItem("webID")||"johndoe")});function f(h){s=h,n(0,s)}function d(h){u=h,n(2,u)}return[s,c,u,p,y,f,d]}class af extends or{constructor(e){super(),sr(this,e,sf,of,ar,{})}}function uf(t){let e,n,r=t[0][0]+"",s,c,u=t[1][t[1].length-1][0]+"",p,y,f;return{c(){e=be("div"),n=be("span"),s=dt(r),c=Ie(),p=dt(u),this.h()},l(d){e=Se(d,"DIV",{class:!0});var h=Te(e);n=Se(h,"SPAN",{class:!0});var v=Te(n);s=ft(v,r),c=xe(v),p=ft(v,u),v.forEach(de),h.forEach(de),this.h()},h(){fe(n,"class","w-full text-center"),fe(e,"class","rounded-full bg-green-600 text-green-100 h-12 w-12 flex items-center cursor-pointer")},m(d,h){Me(d,e,h),ue(e,n),ue(n,s),ue(n,c),ue(n,p),y||(f=vt(e,"click",t[3]),y=!0)},p(d,[h]){h&1&&r!==(r=d[0][0]+"")&&Yt(s,r),h&2&&u!==(u=d[1][d[1].length-1][0]+"")&&Yt(p,u)},i:Zt,o:Zt,d(d){d&&de(e),y=!1,f()}}}function cf(t,e,n){let r,{firstname:s}=e,{lastname:c}=e;function u(p){Nn.call(this,t,p)}return t.$$set=p=>{"firstname"in p&&n(0,s=p.firstname),"lastname"in p&&n(2,c=p.lastname)},t.$$.update=()=>{t.$$.dirty&4&&n(1,r=c.split(" "))},[s,r,c,u]}class lf extends or{constructor(e){super(),sr(this,e,cf,uf,ar,{firstname:0,lastname:2})}}function Zo(t){let e,n,r,s,c;const u=t[3].default,p=xr(u,t,t[2],null);return{c(){e=be("div"),n=be("div"),p&&p.c(),this.h()},l(y){e=Se(y,"DIV",{class:!0});var f=Te(e);n=Se(f,"DIV",{class:!0});var d=Te(n);p&&p.l(d),d.forEach(de),f.forEach(de),this.h()},h(){fe(n,"class","fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-3xl bg-white z-20 p-4 rounded-lg"),fe(e,"class","fixed top-0 left-0 w-full h-[100%] bg-slate-900/30 z-10 cursor-pointer")},m(y,f){Me(y,e,f),ue(e,n),p&&p.m(n,null),r=!0,s||(c=[vt(n,"click",Ka(t[4])),vt(e,"click",t[1])],s=!0)},p(y,f){p&&p.p&&(!r||f&4)&&Rr(p,u,y,y[2],r?Dr(u,y[2],f,null):Ur(y[2]),null)},i(y){r||(le(p,y),r=!0)},o(y){he(p,y),r=!1},d(y){y&&de(e),p&&p.d(y),s=!1,Vr(c)}}}function df(t){let e,n,r=t[0]&&Zo(t);return{c(){r&&r.c(),e=Cr()},l(s){r&&r.l(s),e=Cr()},m(s,c){r&&r.m(s,c),Me(s,e,c),n=!0},p(s,[c]){s[0]?r?(r.p(s,c),c&1&&le(r,1)):(r=Zo(s),r.c(),le(r,1),r.m(e.parentNode,e)):r&&(Ut(),he(r,1,1,()=>{r=null}),Dt())},i(s){n||(le(r),n=!0)},o(s){he(r),n=!1},d(s){r&&r.d(s),s&&de(e)}}}function ff(t,e,n){let{$$slots:r={},$$scope:s}=e,{visible:c=!1}=e;const u=Ba();function p(){u("close"),n(0,c=!1)}function y(f){Nn.call(this,t,f)}return t.$$set=f=>{"visible"in f&&n(0,c=f.visible),"$$scope"in f&&n(2,s=f.$$scope)},[c,p,s,r,y]}class es extends or{constructor(e){super(),sr(this,e,ff,df,ar,{visible:0})}}$r.disable_scroll_handling;const hf=$r.goto;$r.invalidate;$r.prefetch;$r.prefetch_routes;$r.before_navigate;$r.after_navigate;function ts(t,e,n){const r=t.slice();return r[9]=e[n],r}const pf=t=>({}),rs=t=>({});function gf(t){let e;return{c(){e=dt(t[2])},l(n){e=ft(n,t[2])},m(n,r){Me(n,e,r)},p(n,r){r&4&&Yt(e,n[2])},i:Zt,o:Zt,d(n){n&&de(e)}}}function yf(t){let e;const n=t[7].label,r=xr(n,t,t[6],rs);return{c(){r&&r.c()},l(s){r&&r.l(s)},m(s,c){r&&r.m(s,c),e=!0},p(s,c){r&&r.p&&(!e||c&64)&&Rr(r,n,s,s[6],e?Dr(n,s[6],c,pf):Ur(s[6]),rs)},i(s){e||(le(r,s),e=!0)},o(s){he(r,s),e=!1},d(s){r&&r.d(s)}}}function ns(t){let e,n;return e=new Hi({props:{src:t[9].icon,size:"16"}}),{c(){je(e.$$.fragment)},l(r){We(e.$$.fragment,r)},m(r,s){Ve(e,r,s),n=!0},p(r,s){const c={};s&2&&(c.src=r[9].icon),e.$set(c)},i(r){n||(le(e.$$.fragment,r),n=!0)},o(r){he(e.$$.fragment,r),n=!1},d(r){$e(e,r)}}}function is(t){let e,n,r,s=t[9].title+"",c,u,p,y,f,d=t[9].icon&&ns(t);function h(){return t[8](t[9])}return{c(){e=be("div"),d&&d.c(),n=Ie(),r=be("div"),c=dt(s),u=Ie(),this.h()},l(v){e=Se(v,"DIV",{class:!0});var E=Te(e);d&&d.l(E),n=xe(E),r=Se(E,"DIV",{});var m=Te(r);c=ft(m,s),m.forEach(de),u=xe(E),E.forEach(de),this.h()},h(){Ye(r,"text-sm",t[9].icon),fe(e,"class","px-3 py-2 rounded bg-blue-50 text-blue-700 flex flex-col items-center justify-center svelte-1mwawgl"),Ye(e,"active",t[0].has(t[9].title)),Ye(e,"grow",t[3])},m(v,E){Me(v,e,E),d&&d.m(e,null),ue(e,n),ue(e,r),ue(r,c),ue(e,u),p=!0,y||(f=vt(e,"click",h),y=!0)},p(v,E){t=v,t[9].icon?d?(d.p(t,E),E&2&&le(d,1)):(d=ns(t),d.c(),le(d,1),d.m(e,n)):d&&(Ut(),he(d,1,1,()=>{d=null}),Dt()),(!p||E&2)&&s!==(s=t[9].title+"")&&Yt(c,s),E&2&&Ye(r,"text-sm",t[9].icon),E&3&&Ye(e,"active",t[0].has(t[9].title)),E&8&&Ye(e,"grow",t[3])},i(v){p||(le(d),p=!0)},o(v){he(d),p=!1},d(v){v&&de(e),d&&d.d(),y=!1,f()}}}function vf(t){let e,n,r,s,c,u,p;const y=[yf,gf],f=[];function d(m,A){return m[5].label?0:m[2]?1:-1}~(r=d(t))&&(s=f[r]=y[r](t));let h=t[1],v=[];for(let m=0;m<h.length;m+=1)v[m]=is(ts(t,h,m));const E=m=>he(v[m],1,1,()=>{v[m]=null});return{c(){e=be("div"),n=be("div"),s&&s.c(),c=Ie(),u=be("div");for(let m=0;m<v.length;m+=1)v[m].c();this.h()},l(m){e=Se(m,"DIV",{class:!0});var A=Te(e);n=Se(A,"DIV",{class:!0});var F=Te(n);s&&s.l(F),F.forEach(de),c=xe(A),u=Se(A,"DIV",{class:!0});var _=Te(u);for(let P=0;P<v.length;P+=1)v[P].l(_);_.forEach(de),A.forEach(de),this.h()},h(){fe(n,"class","mx-1 mb-px text-sm"),fe(u,"class","flex gap-2"),fe(e,"class","my-4 block box-border")},m(m,A){Me(m,e,A),ue(e,n),~r&&f[r].m(n,null),ue(e,c),ue(e,u);for(let F=0;F<v.length;F+=1)v[F].m(u,null);p=!0},p(m,[A]){let F=r;if(r=d(m),r===F?~r&&f[r].p(m,A):(s&&(Ut(),he(f[F],1,1,()=>{f[F]=null}),Dt()),~r?(s=f[r],s?s.p(m,A):(s=f[r]=y[r](m),s.c()),le(s,1),s.m(n,null)):s=null),A&27){h=m[1];let _;for(_=0;_<h.length;_+=1){const P=ts(m,h,_);v[_]?(v[_].p(P,A),le(v[_],1)):(v[_]=is(P),v[_].c(),le(v[_],1),v[_].m(u,null))}for(Ut(),_=h.length;_<v.length;_+=1)E(_);Dt()}},i(m){if(!p){le(s);for(let A=0;A<h.length;A+=1)le(v[A]);p=!0}},o(m){he(s),v=v.filter(Boolean);for(let A=0;A<v.length;A+=1)he(v[A]);p=!1},d(m){m&&de(e),~r&&f[r].d(),wn(v,m)}}}function mf(t,e,n){let{$$slots:r={},$$scope:s}=e;const c=_n(r);let{value:u=new Set([])}=e,{options:p=[]}=e,{label:y=""}=e,{grow:f=!1}=e;function d(v){u.has(v.title)?(u.delete(v.title),n(0,u=new Set(u))):(u.add(v.title),n(0,u=new Set(u)))}const h=v=>d(v);return t.$$set=v=>{"value"in v&&n(0,u=v.value),"options"in v&&n(1,p=v.options),"label"in v&&n(2,y=v.label),"grow"in v&&n(3,f=v.grow),"$$scope"in v&&n(6,s=v.$$scope)},[u,p,y,f,d,c,s,r,h]}class Pa extends or{constructor(e){super(),sr(this,e,mf,vf,ar,{value:0,options:1,label:2,grow:3})}}function os(t,e,n){const r=t.slice();return r[9]=e[n],r}const _f=t=>({}),ss=t=>({});function wf(t){let e;return{c(){e=dt(t[2])},l(n){e=ft(n,t[2])},m(n,r){Me(n,e,r)},p(n,r){r&4&&Yt(e,n[2])},i:Zt,o:Zt,d(n){n&&de(e)}}}function bf(t){let e;const n=t[7].label,r=xr(n,t,t[6],ss);return{c(){r&&r.c()},l(s){r&&r.l(s)},m(s,c){r&&r.m(s,c),e=!0},p(s,c){r&&r.p&&(!e||c&64)&&Rr(r,n,s,s[6],e?Dr(n,s[6],c,_f):Ur(s[6]),ss)},i(s){e||(le(r,s),e=!0)},o(s){he(r,s),e=!1},d(s){r&&r.d(s)}}}function as(t){let e,n;return e=new Hi({props:{src:t[9].icon,size:"16"}}),{c(){je(e.$$.fragment)},l(r){We(e.$$.fragment,r)},m(r,s){Ve(e,r,s),n=!0},p(r,s){const c={};s&2&&(c.src=r[9].icon),e.$set(c)},i(r){n||(le(e.$$.fragment,r),n=!0)},o(r){he(e.$$.fragment,r),n=!1},d(r){$e(e,r)}}}function us(t){let e,n,r,s=t[9].title+"",c,u,p,y,f,d=t[9].icon&&as(t);function h(){return t[8](t[9])}return{c(){e=be("div"),d&&d.c(),n=Ie(),r=be("div"),c=dt(s),u=Ie(),this.h()},l(v){e=Se(v,"DIV",{class:!0});var E=Te(e);d&&d.l(E),n=xe(E),r=Se(E,"DIV",{});var m=Te(r);c=ft(m,s),m.forEach(de),u=xe(E),E.forEach(de),this.h()},h(){Ye(r,"text-sm",t[9].icon),fe(e,"class","px-3 py-2 rounded bg-blue-50 text-blue-700 flex flex-col items-center justify-center svelte-1mwawgl"),Ye(e,"active",t[0]==t[9].title),Ye(e,"grow",t[3])},m(v,E){Me(v,e,E),d&&d.m(e,null),ue(e,n),ue(e,r),ue(r,c),ue(e,u),p=!0,y||(f=vt(e,"click",h),y=!0)},p(v,E){t=v,t[9].icon?d?(d.p(t,E),E&2&&le(d,1)):(d=as(t),d.c(),le(d,1),d.m(e,n)):d&&(Ut(),he(d,1,1,()=>{d=null}),Dt()),(!p||E&2)&&s!==(s=t[9].title+"")&&Yt(c,s),E&2&&Ye(r,"text-sm",t[9].icon),E&3&&Ye(e,"active",t[0]==t[9].title),E&8&&Ye(e,"grow",t[3])},i(v){p||(le(d),p=!0)},o(v){he(d),p=!1},d(v){v&&de(e),d&&d.d(),y=!1,f()}}}function Sf(t){let e,n,r,s,c,u,p;const y=[bf,wf],f=[];function d(m,A){return m[5].label?0:m[2]?1:-1}~(r=d(t))&&(s=f[r]=y[r](t));let h=t[1],v=[];for(let m=0;m<h.length;m+=1)v[m]=us(os(t,h,m));const E=m=>he(v[m],1,1,()=>{v[m]=null});return{c(){e=be("div"),n=be("div"),s&&s.c(),c=Ie(),u=be("div");for(let m=0;m<v.length;m+=1)v[m].c();this.h()},l(m){e=Se(m,"DIV",{class:!0});var A=Te(e);n=Se(A,"DIV",{class:!0});var F=Te(n);s&&s.l(F),F.forEach(de),c=xe(A),u=Se(A,"DIV",{class:!0});var _=Te(u);for(let P=0;P<v.length;P+=1)v[P].l(_);_.forEach(de),A.forEach(de),this.h()},h(){fe(n,"class","mx-1 mb-px text-sm"),fe(u,"class","flex gap-2"),fe(e,"class","my-4 block box-border")},m(m,A){Me(m,e,A),ue(e,n),~r&&f[r].m(n,null),ue(e,c),ue(e,u);for(let F=0;F<v.length;F+=1)v[F].m(u,null);p=!0},p(m,[A]){let F=r;if(r=d(m),r===F?~r&&f[r].p(m,A):(s&&(Ut(),he(f[F],1,1,()=>{f[F]=null}),Dt()),~r?(s=f[r],s?s.p(m,A):(s=f[r]=y[r](m),s.c()),le(s,1),s.m(n,null)):s=null),A&27){h=m[1];let _;for(_=0;_<h.length;_+=1){const P=os(m,h,_);v[_]?(v[_].p(P,A),le(v[_],1)):(v[_]=us(P),v[_].c(),le(v[_],1),v[_].m(u,null))}for(Ut(),_=h.length;_<v.length;_+=1)E(_);Dt()}},i(m){if(!p){le(s);for(let A=0;A<h.length;A+=1)le(v[A]);p=!0}},o(m){he(s),v=v.filter(Boolean);for(let A=0;A<v.length;A+=1)he(v[A]);p=!1},d(m){m&&de(e),~r&&f[r].d(),wn(v,m)}}}function Ef(t,e,n){let{$$slots:r={},$$scope:s}=e;const c=_n(r);let{options:u=[]}=e,{value:p=u[0].title}=e,{label:y=""}=e,{grow:f=!1}=e;const d=v=>n(0,p=v.title),h=v=>d(v);return t.$$set=v=>{"options"in v&&n(1,u=v.options),"value"in v&&n(0,p=v.value),"label"in v&&n(2,y=v.label),"grow"in v&&n(3,f=v.grow),"$$scope"in v&&n(6,s=v.$$scope)},[p,u,y,f,d,c,s,r,h]}class ka extends or{constructor(e){super(),sr(this,e,Ef,Sf,ar,{options:1,value:0,label:2,grow:3})}}function cs(t,e,n){const r=t.slice();return r[15]=e[n],r[16]=e,r[17]=n,r}const Ff=t=>({}),ls=t=>({});function Af(t){let e;return{c(){e=dt(t[1])},l(n){e=ft(n,t[1])},m(n,r){Me(n,e,r)},p(n,r){r&2&&Yt(e,n[1])},i:Zt,o:Zt,d(n){n&&de(e)}}}function Pf(t){let e;const n=t[9].label,r=xr(n,t,t[8],ls);return{c(){r&&r.c()},l(s){r&&r.l(s)},m(s,c){r&&r.m(s,c),e=!0},p(s,c){r&&r.p&&(!e||c&256)&&Rr(r,n,s,s[8],e?Dr(n,s[8],c,Ff):Ur(s[8]),ls)},i(s){e||(le(r,s),e=!0)},o(s){he(r,s),e=!1},d(s){r&&r.d(s)}}}function ds(t){let e,n,r,s,c,u,p;function y(){t[10].call(n,t[17])}function f(){return t[11](t[17])}return s=new Or({props:{destructive:!0,icon:Ss}}),s.$on("click",f),{c(){e=be("div"),n=be("input"),r=Ie(),je(s.$$.fragment),this.h()},l(d){e=Se(d,"DIV",{class:!0});var h=Te(e);n=Se(h,"INPUT",{class:!0,type:!0}),r=xe(h),We(s.$$.fragment,h),h.forEach(de),this.h()},h(){fe(n,"class","w-full"),fe(n,"type","date"),fe(e,"class","flex gap-2")},m(d,h){Me(d,e,h),ue(e,n),kt(n,t[0][t[17]]),ue(e,r),Ve(s,e,null),c=!0,u||(p=vt(n,"input",y),u=!0)},p(d,h){t=d,h&1&&kt(n,t[0][t[17]])},i(d){c||(le(s.$$.fragment,d),c=!0)},o(d){he(s.$$.fragment,d),c=!1},d(d){d&&de(e),$e(s),u=!1,p()}}}function fs(t){let e,n,r,s,c,u,p;return s=new Or({props:{icon:Ni}}),s.$on("click",t[4]),{c(){e=be("div"),n=be("input"),r=Ie(),je(s.$$.fragment),this.h()},l(y){e=Se(y,"DIV",{class:!0});var f=Te(e);n=Se(f,"INPUT",{class:!0,type:!0}),r=xe(f),We(s.$$.fragment,f),f.forEach(de),this.h()},h(){fe(n,"class","w-full"),fe(n,"type","date"),fe(e,"class","newDate flex gap-2")},m(y,f){Me(y,e,f),ue(e,n),kt(n,t[3]),ue(e,r),Ve(s,e,null),c=!0,u||(p=vt(n,"input",t[12]),u=!0)},p(y,f){f&8&&kt(n,y[3])},i(y){c||(le(s.$$.fragment,y),c=!0)},o(y){he(s.$$.fragment,y),c=!1},d(y){y&&de(e),$e(s),u=!1,p()}}}function kf(t){let e,n,r,s,c,u,p,y;const f=[Pf,Af],d=[];function h(F,_){return F[6].label?0:F[1]?1:-1}~(r=h(t))&&(s=d[r]=f[r](t));let v=t[0],E=[];for(let F=0;F<v.length;F+=1)E[F]=ds(cs(t,v,F));const m=F=>he(E[F],1,1,()=>{E[F]=null});let A=(t[2]==-1||t[0].length<t[2])&&fs(t);return{c(){e=be("div"),n=be("div"),s&&s.c(),c=Ie(),u=be("div");for(let F=0;F<E.length;F+=1)E[F].c();p=Ie(),A&&A.c(),this.h()},l(F){e=Se(F,"DIV",{class:!0});var _=Te(e);n=Se(_,"DIV",{class:!0});var P=Te(n);s&&s.l(P),P.forEach(de),c=xe(_),u=Se(_,"DIV",{class:!0});var C=Te(u);for(let R=0;R<E.length;R+=1)E[R].l(C);p=xe(C),A&&A.l(C),C.forEach(de),_.forEach(de),this.h()},h(){fe(n,"class","mx-1 mb-px text-sm"),fe(u,"class","dates flex flex-col gap-4"),fe(e,"class","pb-3")},m(F,_){Me(F,e,_),ue(e,n),~r&&d[r].m(n,null),ue(e,c),ue(e,u);for(let P=0;P<E.length;P+=1)E[P].m(u,null);ue(u,p),A&&A.m(u,null),y=!0},p(F,[_]){let P=r;if(r=h(F),r===P?~r&&d[r].p(F,_):(s&&(Ut(),he(d[P],1,1,()=>{d[P]=null}),Dt()),~r?(s=d[r],s?s.p(F,_):(s=d[r]=f[r](F),s.c()),le(s,1),s.m(n,null)):s=null),_&33){v=F[0];let C;for(C=0;C<v.length;C+=1){const R=cs(F,v,C);E[C]?(E[C].p(R,_),le(E[C],1)):(E[C]=ds(R),E[C].c(),le(E[C],1),E[C].m(u,p))}for(Ut(),C=v.length;C<E.length;C+=1)m(C);Dt()}F[2]==-1||F[0].length<F[2]?A?(A.p(F,_),_&5&&le(A,1)):(A=fs(F),A.c(),le(A,1),A.m(u,null)):A&&(Ut(),he(A,1,1,()=>{A=null}),Dt())},i(F){if(!y){le(s);for(let _=0;_<v.length;_+=1)le(E[_]);le(A),y=!0}},o(F){he(s),E=E.filter(Boolean);for(let _=0;_<E.length;_+=1)he(E[_]);he(A),y=!1},d(F){F&&de(e),~r&&d[r].d(),wn(E,F),A&&A.d()}}}function Tf(t,e,n){let{$$slots:r={},$$scope:s}=e;const c=_n(r);let{dates:u=[]}=e,{dateStrings:p=[]}=e,{label:y=""}=e,{maxDates:f=5}=e,d="",h="";function v(){!d||(n(0,p=[...p,d]),p.sort(),n(3,d=""))}function E(P){n(0,p=[...p.slice(0,P),...p.slice(P+1)])}function m(){p.toString()!=h&&(n(0,p=p.filter(P=>P!="")),n(7,u=p.map(P=>vn.PlainDate.from(P))),h=p.toString())}function A(P){p[P]=this.value,n(0,p)}const F=P=>E(P);function _(){d=this.value,n(3,d)}return t.$$set=P=>{"dates"in P&&n(7,u=P.dates),"dateStrings"in P&&n(0,p=P.dateStrings),"label"in P&&n(1,y=P.label),"maxDates"in P&&n(2,f=P.maxDates),"$$scope"in P&&n(8,s=P.$$scope)},t.$$.update=()=>{t.$$.dirty&1&&p&&m()},[p,y,f,d,v,E,c,u,s,r,A,F,_]}class Cf extends or{constructor(e){super(),sr(this,e,Tf,kf,ar,{dates:7,dateStrings:0,label:1,maxDates:2})}}function hs(t,e,n){const r=t.slice();return r[17]=e[n],r[18]=e,r[19]=n,r}const If=t=>({}),ps=t=>({});function xf(t){let e;return{c(){e=dt(t[1])},l(n){e=ft(n,t[1])},m(n,r){Me(n,e,r)},p(n,r){r&2&&Yt(e,n[1])},i:Zt,o:Zt,d(n){n&&de(e)}}}function Rf(t){let e;const n=t[9].label,r=xr(n,t,t[8],ps);return{c(){r&&r.c()},l(s){r&&r.l(s)},m(s,c){r&&r.m(s,c),e=!0},p(s,c){r&&r.p&&(!e||c&256)&&Rr(r,n,s,s[8],e?Dr(n,s[8],c,If):Ur(s[8]),ps)},i(s){e||(le(r,s),e=!0)},o(s){he(r,s),e=!1},d(s){r&&r.d(s)}}}function gs(t){let e,n,r,s,c,u,p,y,f;function d(){t[10].call(n,t[19])}function h(){t[11].call(s,t[19])}function v(){return t[12](t[19])}return u=new Or({props:{destructive:!0,icon:Ss}}),u.$on("click",v),{c(){e=be("div"),n=be("input"),r=Ie(),s=be("input"),c=Ie(),je(u.$$.fragment),this.h()},l(E){e=Se(E,"DIV",{class:!0});var m=Te(e);n=Se(m,"INPUT",{class:!0,type:!0}),r=xe(m),s=Se(m,"INPUT",{class:!0,type:!0}),c=xe(m),We(u.$$.fragment,m),m.forEach(de),this.h()},h(){fe(n,"class","w-full"),fe(n,"type","time"),fe(s,"class","w-full"),fe(s,"type","time"),fe(e,"class","flex gap-2")},m(E,m){Me(E,e,m),ue(e,n),kt(n,t[0][t[19]].from),ue(e,r),ue(e,s),kt(s,t[0][t[19]].to),ue(e,c),Ve(u,e,null),p=!0,y||(f=[vt(n,"input",d),vt(s,"input",h)],y=!0)},p(E,m){t=E,m&1&&kt(n,t[0][t[19]].from),m&1&&kt(s,t[0][t[19]].to)},i(E){p||(le(u.$$.fragment,E),p=!0)},o(E){he(u.$$.fragment,E),p=!1},d(E){E&&de(e),$e(u),y=!1,Vr(f)}}}function ys(t){let e,n,r,s,c,u,p,y,f;return u=new Or({props:{icon:Ni}}),u.$on("click",t[4]),{c(){e=be("div"),n=be("input"),r=Ie(),s=be("input"),c=Ie(),je(u.$$.fragment),this.h()},l(d){e=Se(d,"DIV",{class:!0});var h=Te(e);n=Se(h,"INPUT",{class:!0,type:!0}),r=xe(h),s=Se(h,"INPUT",{class:!0,type:!0}),c=xe(h),We(u.$$.fragment,h),h.forEach(de),this.h()},h(){fe(n,"class","w-full"),fe(n,"type","time"),fe(s,"class","w-full"),fe(s,"type","time"),fe(e,"class","newTime flex gap-2")},m(d,h){Me(d,e,h),ue(e,n),kt(n,t[3].from),ue(e,r),ue(e,s),kt(s,t[3].to),ue(e,c),Ve(u,e,null),p=!0,y||(f=[vt(n,"input",t[13]),vt(s,"input",t[14])],y=!0)},p(d,h){h&8&&kt(n,d[3].from),h&8&&kt(s,d[3].to)},i(d){p||(le(u.$$.fragment,d),p=!0)},o(d){he(u.$$.fragment,d),p=!1},d(d){d&&de(e),$e(u),y=!1,Vr(f)}}}function Uf(t){let e,n,r,s,c,u,p,y;const f=[Rf,xf],d=[];function h(F,_){return F[6].label?0:F[1]?1:-1}~(r=h(t))&&(s=d[r]=f[r](t));let v=t[0],E=[];for(let F=0;F<v.length;F+=1)E[F]=gs(hs(t,v,F));const m=F=>he(E[F],1,1,()=>{E[F]=null});let A=(t[2]==-1||t[0].length<t[2])&&ys(t);return{c(){e=be("div"),n=be("div"),s&&s.c(),c=Ie(),u=be("div");for(let F=0;F<E.length;F+=1)E[F].c();p=Ie(),A&&A.c(),this.h()},l(F){e=Se(F,"DIV",{});var _=Te(e);n=Se(_,"DIV",{class:!0});var P=Te(n);s&&s.l(P),P.forEach(de),c=xe(_),u=Se(_,"DIV",{class:!0});var C=Te(u);for(let R=0;R<E.length;R+=1)E[R].l(C);p=xe(C),A&&A.l(C),C.forEach(de),_.forEach(de),this.h()},h(){fe(n,"class","mx-1 mb-px text-sm"),fe(u,"class","times flex flex-col gap-4")},m(F,_){Me(F,e,_),ue(e,n),~r&&d[r].m(n,null),ue(e,c),ue(e,u);for(let P=0;P<E.length;P+=1)E[P].m(u,null);ue(u,p),A&&A.m(u,null),y=!0},p(F,[_]){let P=r;if(r=h(F),r===P?~r&&d[r].p(F,_):(s&&(Ut(),he(d[P],1,1,()=>{d[P]=null}),Dt()),~r?(s=d[r],s?s.p(F,_):(s=d[r]=f[r](F),s.c()),le(s,1),s.m(n,null)):s=null),_&33){v=F[0];let C;for(C=0;C<v.length;C+=1){const R=hs(F,v,C);E[C]?(E[C].p(R,_),le(E[C],1)):(E[C]=gs(R),E[C].c(),le(E[C],1),E[C].m(u,p))}for(Ut(),C=v.length;C<E.length;C+=1)m(C);Dt()}F[2]==-1||F[0].length<F[2]?A?(A.p(F,_),_&5&&le(A,1)):(A=ys(F),A.c(),le(A,1),A.m(u,null)):A&&(Ut(),he(A,1,1,()=>{A=null}),Dt())},i(F){if(!y){le(s);for(let _=0;_<v.length;_+=1)le(E[_]);le(A),y=!0}},o(F){he(s),E=E.filter(Boolean);for(let _=0;_<E.length;_+=1)he(E[_]);he(A),y=!1},d(F){F&&de(e),~r&&d[r].d(),wn(E,F),A&&A.d()}}}function Df(t,e,n){let{$$slots:r={},$$scope:s}=e;const c=_n(r);let{times:u=[]}=e,{timeStrings:p=[]}=e,{label:y="init"}=e,{maxTimes:f=5}=e,d={from:"",to:""},h="";function v(){!d.from||!d.to||(n(0,p=[d,...p]),n(3,d={from:"",to:""}))}function E(R){n(0,p=[...p.slice(0,R),...p.slice(R+1)])}function m(){var V;const R=(V=JSON.stringify(p))!=null?V:"";R!=h&&(n(0,p=p.filter(j=>j.from!=""||j.to!="")),h=R,n(7,u=p.map(j=>{const B=vn.PlainTime.from(j.from),Z=vn.PlainTime.from(j.to),Y={from:Z,to:B};return B.until(Z).hours<0||B.until(Z).hours==0&&B.until(Z).minutes<0?Y:{from:B,to:Z}})))}function A(R){p[R].from=this.value,n(0,p)}function F(R){p[R].to=this.value,n(0,p)}const _=R=>E(R);function P(){d.from=this.value,n(3,d)}function C(){d.to=this.value,n(3,d)}return t.$$set=R=>{"times"in R&&n(7,u=R.times),"timeStrings"in R&&n(0,p=R.timeStrings),"label"in R&&n(1,y=R.label),"maxTimes"in R&&n(2,f=R.maxTimes),"$$scope"in R&&n(8,s=R.$$scope)},t.$$.update=()=>{t.$$.dirty&1&&p&&m()},[p,y,f,d,v,E,c,u,s,r,A,F,_,P,C]}class Of extends or{constructor(e){super(),sr(this,e,Df,Uf,ar,{times:7,timeStrings:0,label:1,maxTimes:2})}}function vs(t){let e,n,r=t[0].editMode?"Edit":"Create New",s,c,u,p,y,f,d,h,v,E,m,A,F,_,P,C,R,V,j,B,Z,Y,O,oe,_e,ke,G,se,ve,Re;function Oe(ce){t[6](ce)}let ge={type:"text",label:"title"};t[0].activity.title!==void 0&&(ge.value=t[0].activity.title),f=new Pr({props:ge}),gr.push(()=>yr(f,"value",Oe));function Ue(ce){t[7](ce)}let qe={dateStrings:t[2],label:"Enter possible dates"};t[0].activity.dates!==void 0&&(qe.dates=t[0].activity.dates),v=new Cf({props:qe}),gr.push(()=>yr(v,"dates",Ue));function rt(ce){t[8](ce)}let ht={timeStrings:t[1],label:"Enter possible times"};t[0].activity.times!==void 0&&(ht.times=t[0].activity.times),A=new Of({props:ht}),gr.push(()=>yr(A,"times",rt)),C=new Pr({props:{type:"text",placeholder:"Where?",label:"Location"}});function mt(ce){t[9](ce)}let At={grow:!0,label:"Get notified if it will",options:[{title:"Sun",icon:Es},{title:"Windy"},{title:"Rain"},{title:"Snow"},{title:"Thunder",icon:Fs}]};t[0].activity.notifyOnWeather!==void 0&&(At.value=t[0].activity.notifyOnWeather),V=new Pa({props:At}),gr.push(()=>yr(V,"value",mt));function Wt(ce){t[10](ce)}let st={grow:!0,label:"Activity type",options:[{title:"Work",icon:As},{title:"Food"},{title:"Fun"},{title:"Workout"},{title:"Relax"}]};return t[0].activity.actitityType!==void 0&&(st.value=t[0].activity.actitityType),Z=new ka({props:st}),gr.push(()=>yr(Z,"value",Wt)),_e=new Or({props:{destructive:!0,$$slots:{default:[Hf]},$$scope:{ctx:t}}}),_e.$on("click",t[5]),{c(){e=be("form"),n=be("h3"),s=dt(r),c=dt(" activity"),u=Ie(),p=be("div"),y=be("div"),je(f.$$.fragment),h=Ie(),je(v.$$.fragment),m=Ie(),je(A.$$.fragment),_=Ie(),P=be("div"),je(C.$$.fragment),R=Ie(),je(V.$$.fragment),B=Ie(),je(Z.$$.fragment),O=Ie(),oe=be("div"),je(_e.$$.fragment),ke=Ie(),G=be("input"),this.h()},l(ce){e=Se(ce,"FORM",{});var Ee=Te(e);n=Se(Ee,"H3",{class:!0});var He=Te(n);s=ft(He,r),c=ft(He," activity"),He.forEach(de),u=xe(Ee),p=Se(Ee,"DIV",{class:!0});var J=Te(p);y=Se(J,"DIV",{class:!0});var w=Te(y);We(f.$$.fragment,w),h=xe(w),We(v.$$.fragment,w),m=xe(w),We(A.$$.fragment,w),w.forEach(de),_=xe(J),P=Se(J,"DIV",{class:!0});var S=Te(P);We(C.$$.fragment,S),R=xe(S),We(V.$$.fragment,S),B=xe(S),We(Z.$$.fragment,S),S.forEach(de),J.forEach(de),O=xe(Ee),oe=Se(Ee,"DIV",{class:!0});var L=Te(oe);We(_e.$$.fragment,L),ke=xe(L),G=Se(L,"INPUT",{class:!0,type:!0}),L.forEach(de),Ee.forEach(de),this.h()},h(){fe(n,"class","text-xl border-b border-b-black/50 border-solid mb-4 pb-2 capitalize"),fe(y,"class","left grow"),fe(P,"class","right grow"),fe(p,"class","flex gap-4 w-full"),fe(G,"class","bg-slate-100 hover:bg-slate-300 transition-colors px-3 py-2 rounded cursor-pointer"),fe(G,"type","submit"),G.value="submit",fe(oe,"class","flex justify-end gap-4")},m(ce,Ee){Me(ce,e,Ee),ue(e,n),ue(n,s),ue(n,c),ue(e,u),ue(e,p),ue(p,y),Ve(f,y,null),ue(y,h),Ve(v,y,null),ue(y,m),Ve(A,y,null),ue(p,_),ue(p,P),Ve(C,P,null),ue(P,R),Ve(V,P,null),ue(P,B),Ve(Z,P,null),ue(e,O),ue(e,oe),Ve(_e,oe,null),ue(oe,ke),ue(oe,G),se=!0,ve||(Re=[vt(G,"click",Ln(t[4])),vt(e,"submit",Ln(t[4]))],ve=!0)},p(ce,Ee){(!se||Ee&1)&&r!==(r=ce[0].editMode?"Edit":"Create New")&&Yt(s,r);const He={};!d&&Ee&1&&(d=!0,He.value=ce[0].activity.title,vr(()=>d=!1)),f.$set(He);const J={};Ee&4&&(J.dateStrings=ce[2]),!E&&Ee&1&&(E=!0,J.dates=ce[0].activity.dates,vr(()=>E=!1)),v.$set(J);const w={};Ee&2&&(w.timeStrings=ce[1]),!F&&Ee&1&&(F=!0,w.times=ce[0].activity.times,vr(()=>F=!1)),A.$set(w);const S={};!j&&Ee&1&&(j=!0,S.value=ce[0].activity.notifyOnWeather,vr(()=>j=!1)),V.$set(S);const L={};!Y&&Ee&1&&(Y=!0,L.value=ce[0].activity.actitityType,vr(()=>Y=!1)),Z.$set(L);const q={};Ee&2049&&(q.$$scope={dirty:Ee,ctx:ce}),_e.$set(q)},i(ce){se||(le(f.$$.fragment,ce),le(v.$$.fragment,ce),le(A.$$.fragment,ce),le(C.$$.fragment,ce),le(V.$$.fragment,ce),le(Z.$$.fragment,ce),le(_e.$$.fragment,ce),se=!0)},o(ce){he(f.$$.fragment,ce),he(v.$$.fragment,ce),he(A.$$.fragment,ce),he(C.$$.fragment,ce),he(V.$$.fragment,ce),he(Z.$$.fragment,ce),he(_e.$$.fragment,ce),se=!1},d(ce){ce&&de(e),$e(f),$e(v),$e(A),$e(C),$e(V),$e(Z),$e(_e),ve=!1,Vr(Re)}}}function Hf(t){let e=t[0].editMode?"Remove":"Cancel",n;return{c(){n=dt(e)},l(r){n=ft(r,e)},m(r,s){Me(r,n,s)},p(r,s){s&1&&e!==(e=r[0].editMode?"Remove":"Cancel")&&Yt(n,e)},d(r){r&&de(n)}}}function Nf(t){let e,n,r=t[0]&&t[3]&&vs(t);return{c(){r&&r.c(),e=Cr()},l(s){r&&r.l(s),e=Cr()},m(s,c){r&&r.m(s,c),Me(s,e,c),n=!0},p(s,[c]){s[0]&&s[3]?r?(r.p(s,c),c&9&&le(r,1)):(r=vs(s),r.c(),le(r,1),r.m(e.parentNode,e)):r&&(Ut(),he(r,1,1,()=>{r=null}),Dt())},i(s){n||(le(r),n=!0)},o(s){he(r),n=!1},d(s){r&&r.d(s),s&&de(e)}}}function Lf(t,e,n){let r,s,c;Br(t,Xr,m=>n(3,c=m));let u=c;function p(){!u||(u.editMode?Qr.updateActivity(u.activity):Qr.add(u.activity),hf("./planning"),Xr.reset())}function y(){u!=null&&u.editMode&&Qr.deleteActivity(u.activity),Xr.reset()}function f(m){t.$$.not_equal(u.activity.title,m)&&(u.activity.title=m,n(0,u))}function d(m){t.$$.not_equal(u.activity.dates,m)&&(u.activity.dates=m,n(0,u))}function h(m){t.$$.not_equal(u.activity.times,m)&&(u.activity.times=m,n(0,u))}function v(m){t.$$.not_equal(u.activity.notifyOnWeather,m)&&(u.activity.notifyOnWeather=m,n(0,u))}function E(m){t.$$.not_equal(u.activity.actitityType,m)&&(u.activity.actitityType=m,n(0,u))}return t.$$.update=()=>{t.$$.dirty&1&&n(2,r=u==null?void 0:u.activity.dates.map(m=>m.toString())),t.$$.dirty&1&&n(1,s=u==null?void 0:u.activity.times.map(({from:m,to:A})=>({from:m.round({smallestUnit:"minute"}).toString(),to:A.round({smallestUnit:"minute"}).toString()})))},[u,s,r,c,p,y,f,d,h,v,E]}class Mf extends or{constructor(e){super(),sr(this,e,Lf,Nf,ar,{})}}function ms(t){var mt,At,Wt,st;let e,n,r=t[0].editMode?"Edit":"Create New",s,c,u,p,y,f,d,h,v,E,m,A,F,_,P,C,R,V,j,B,Z,Y,O,oe,_e,ke,G,se,ve,Re;function Oe(ce){t[4](ce)}let ge={type:"text",label:"title"};t[0].activity.title!==void 0&&(ge.value=t[0].activity.title),f=new Pr({props:ge}),gr.push(()=>yr(f,"value",Oe)),v=new Pr({props:{type:"date",label:"date",value:t[0].activity.date.toString()}}),v.$on("change",t[5]),m=new Pr({props:{type:"time",label:"from",value:(At=(mt=t[0])==null?void 0:mt.activity.time)==null?void 0:At.from.toString({smallestUnit:"minute"})}}),m.$on("change",t[6]),F=new Pr({props:{type:"time",label:"to",value:(st=(Wt=t[0])==null?void 0:Wt.activity.time)==null?void 0:st.to.toString({smallestUnit:"minute"})}}),F.$on("change",t[7]),C=new Pr({props:{type:"text",placeholder:"Where?",label:"Location"}});function Ue(ce){t[8](ce)}let qe={grow:!0,label:"Get notified if it will",options:[{title:"Sun",icon:Es},{title:"Windy"},{title:"Rain"},{title:"Snow"},{title:"Thunder",icon:Fs}]};t[0].activity.notifyOnWeather!==void 0&&(qe.value=t[0].activity.notifyOnWeather),V=new Pa({props:qe}),gr.push(()=>yr(V,"value",Ue));function rt(ce){t[9](ce)}let ht={grow:!0,label:"Activity type",options:[{title:"Work",icon:As},{title:"Food"},{title:"Fun"},{title:"Workout"},{title:"Relax"}]};return t[0].activity.actitityType!==void 0&&(ht.value=t[0].activity.actitityType),Z=new ka({props:ht}),gr.push(()=>yr(Z,"value",rt)),_e=new Or({props:{destructive:!0,$$slots:{default:[Kf]},$$scope:{ctx:t}}}),_e.$on("click",t[3]),{c(){e=be("form"),n=be("h3"),s=dt(r),c=dt(" activity"),u=Ie(),p=be("div"),y=be("div"),je(f.$$.fragment),h=Ie(),je(v.$$.fragment),E=Ie(),je(m.$$.fragment),A=Ie(),je(F.$$.fragment),_=Ie(),P=be("div"),je(C.$$.fragment),R=Ie(),je(V.$$.fragment),B=Ie(),je(Z.$$.fragment),O=Ie(),oe=be("div"),je(_e.$$.fragment),ke=Ie(),G=be("input"),this.h()},l(ce){e=Se(ce,"FORM",{});var Ee=Te(e);n=Se(Ee,"H3",{class:!0});var He=Te(n);s=ft(He,r),c=ft(He," activity"),He.forEach(de),u=xe(Ee),p=Se(Ee,"DIV",{class:!0});var J=Te(p);y=Se(J,"DIV",{class:!0});var w=Te(y);We(f.$$.fragment,w),h=xe(w),We(v.$$.fragment,w),E=xe(w),We(m.$$.fragment,w),A=xe(w),We(F.$$.fragment,w),w.forEach(de),_=xe(J),P=Se(J,"DIV",{class:!0});var S=Te(P);We(C.$$.fragment,S),R=xe(S),We(V.$$.fragment,S),B=xe(S),We(Z.$$.fragment,S),S.forEach(de),J.forEach(de),O=xe(Ee),oe=Se(Ee,"DIV",{class:!0});var L=Te(oe);We(_e.$$.fragment,L),ke=xe(L),G=Se(L,"INPUT",{class:!0,type:!0}),L.forEach(de),Ee.forEach(de),this.h()},h(){fe(n,"class","text-xl border-b border-b-black/50 border-solid mb-4 pb-2 capitalize"),fe(y,"class","left grow"),fe(P,"class","right grow"),fe(p,"class","flex gap-4 w-full"),fe(G,"class","bg-slate-100 hover:bg-slate-300 transition-colors px-3 py-2 rounded cursor-pointer"),fe(G,"type","submit"),G.value="submit",fe(oe,"class","flex justify-end gap-4")},m(ce,Ee){Me(ce,e,Ee),ue(e,n),ue(n,s),ue(n,c),ue(e,u),ue(e,p),ue(p,y),Ve(f,y,null),ue(y,h),Ve(v,y,null),ue(y,E),Ve(m,y,null),ue(y,A),Ve(F,y,null),ue(p,_),ue(p,P),Ve(C,P,null),ue(P,R),Ve(V,P,null),ue(P,B),Ve(Z,P,null),ue(e,O),ue(e,oe),Ve(_e,oe,null),ue(oe,ke),ue(oe,G),se=!0,ve||(Re=[vt(G,"click",Ln(t[2])),vt(e,"submit",Ln(t[2]))],ve=!0)},p(ce,Ee){var ie,we,Ce,Be;(!se||Ee&1)&&r!==(r=ce[0].editMode?"Edit":"Create New")&&Yt(s,r);const He={};!d&&Ee&1&&(d=!0,He.value=ce[0].activity.title,vr(()=>d=!1)),f.$set(He);const J={};Ee&1&&(J.value=ce[0].activity.date.toString()),v.$set(J);const w={};Ee&1&&(w.value=(we=(ie=ce[0])==null?void 0:ie.activity.time)==null?void 0:we.from.toString({smallestUnit:"minute"})),m.$set(w);const S={};Ee&1&&(S.value=(Be=(Ce=ce[0])==null?void 0:Ce.activity.time)==null?void 0:Be.to.toString({smallestUnit:"minute"})),F.$set(S);const L={};!j&&Ee&1&&(j=!0,L.value=ce[0].activity.notifyOnWeather,vr(()=>j=!1)),V.$set(L);const q={};!Y&&Ee&1&&(Y=!0,q.value=ce[0].activity.actitityType,vr(()=>Y=!1)),Z.$set(q);const ee={};Ee&1025&&(ee.$$scope={dirty:Ee,ctx:ce}),_e.$set(ee)},i(ce){se||(le(f.$$.fragment,ce),le(v.$$.fragment,ce),le(m.$$.fragment,ce),le(F.$$.fragment,ce),le(C.$$.fragment,ce),le(V.$$.fragment,ce),le(Z.$$.fragment,ce),le(_e.$$.fragment,ce),se=!0)},o(ce){he(f.$$.fragment,ce),he(v.$$.fragment,ce),he(m.$$.fragment,ce),he(F.$$.fragment,ce),he(C.$$.fragment,ce),he(V.$$.fragment,ce),he(Z.$$.fragment,ce),he(_e.$$.fragment,ce),se=!1},d(ce){ce&&de(e),$e(f),$e(v),$e(m),$e(F),$e(C),$e(V),$e(Z),$e(_e),ve=!1,Vr(Re)}}}function Kf(t){let e=t[0].editMode?"Remove":"Cancel",n;return{c(){n=dt(e)},l(r){n=ft(r,e)},m(r,s){Me(r,n,s)},p(r,s){s&1&&e!==(e=r[0].editMode?"Remove":"Cancel")&&Yt(n,e)},d(r){r&&de(n)}}}function Bf(t){let e,n,r=t[0]&&t[1]&&ms(t);return{c(){r&&r.c(),e=Cr()},l(s){r&&r.l(s),e=Cr()},m(s,c){r&&r.m(s,c),Me(s,e,c),n=!0},p(s,[c]){s[0]&&s[1]?r?(r.p(s,c),c&3&&le(r,1)):(r=ms(s),r.c(),le(r,1),r.m(e.parentNode,e)):r&&(Ut(),he(r,1,1,()=>{r=null}),Dt())},i(s){n||(le(r),n=!0)},o(s){he(r),n=!1},d(s){r&&r.d(s),s&&de(e)}}}function jf(t,e,n){let r;Br(t,gn,E=>n(1,r=E));let s=r;function c(){!s||(s.editMode?Zr.updateActivity(s.activity):Zr.add(s.activity),gn.reset())}function u(){s!=null&&s.editMode&&Zr.deleteActivity(s.activity),gn.reset()}function p(E){t.$$.not_equal(s.activity.title,E)&&(s.activity.title=E,n(0,s))}const y=E=>s==null?void 0:s.activity.setDate(E),f=E=>s==null?void 0:s.activity.setFromTime(E),d=E=>s==null?void 0:s.activity.setToTime(E);function h(E){t.$$.not_equal(s.activity.notifyOnWeather,E)&&(s.activity.notifyOnWeather=E,n(0,s))}function v(E){t.$$.not_equal(s.activity.actitityType,E)&&(s.activity.actitityType=E,n(0,s))}return[s,r,c,u,p,y,f,d,h,v]}class Wf extends or{constructor(e){super(),sr(this,e,jf,Bf,ar,{})}}const Vf=()=>{const t=ja("__svelte__");return{page:{subscribe:t.page.subscribe},navigating:{subscribe:t.navigating.subscribe},get preloading(){return console.error("stores.preloading is deprecated; use stores.navigating instead"),{subscribe:t.navigating.subscribe}},session:t.session,updated:t.updated}},$f={subscribe(t){return Vf().page.subscribe(t)}};function _s(t,e,n){const r=t.slice();return r[6]=e[n],r}function ws(t){let e,n,r,s=t[6].title+"",c,u,p,y;return n=new Hi({props:{src:t[6].icon,size:"16"}}),{c(){e=be("a"),je(n.$$.fragment),r=Ie(),c=dt(s),u=Ie(),this.h()},l(f){e=Se(f,"A",{href:!0,class:!0});var d=Te(e);We(n.$$.fragment,d),r=xe(d),c=ft(d,s),u=xe(d),d.forEach(de),this.h()},h(){fe(e,"href",p=Va+"/"+t[6].url[0]),fe(e,"class","flex flex-row items-center justify-start px-2 gap-3 svelte-g314rs"),Ye(e,"active",t[6].url.includes(t[0].routeId||"upcomming"))},m(f,d){Me(f,e,d),Ve(n,e,null),ue(e,r),ue(e,c),ue(e,u),y=!0},p(f,d){d&9&&Ye(e,"active",f[6].url.includes(f[0].routeId||"upcomming"))},i(f){y||(le(n.$$.fragment,f),y=!0)},o(f){he(n.$$.fragment,f),y=!1},d(f){f&&de(e),$e(n)}}}function Jf(t){let e;return{c(){e=dt("Create new event")},l(n){e=ft(n,"Create new event")},m(n,r){Me(n,e,r)},d(n){n&&de(e)}}}function qf(t){let e,n;return e=new Mf({}),{c(){je(e.$$.fragment)},l(r){We(e.$$.fragment,r)},m(r,s){Ve(e,r,s),n=!0},i(r){n||(le(e.$$.fragment,r),n=!0)},o(r){he(e.$$.fragment,r),n=!1},d(r){$e(e,r)}}}function zf(t){let e,n;return e=new Wf({}),{c(){je(e.$$.fragment)},l(r){We(e.$$.fragment,r)},m(r,s){Ve(e,r,s),n=!0},i(r){n||(le(e.$$.fragment,r),n=!0)},o(r){he(e.$$.fragment,r),n=!1},d(r){$e(e,r)}}}function Gf(t){let e,n,r,s,c,u,p,y,f,d,h,v,E,m,A,F,_,P,C,R=t[3],V=[];for(let Y=0;Y<R.length;Y+=1)V[Y]=ws(_s(t,R,Y));const j=Y=>he(V[Y],1,1,()=>{V[Y]=null});h=new Or({props:{icon:Ni,$$slots:{default:[Jf]},$$scope:{ctx:t}}}),h.$on("click",Xr.new),E=new lf({props:{firstname:"Abel",lastname:"de Bruijn"}});const B=t[4].default,Z=xr(B,t,t[5],null);return F=new es({props:{visible:t[1]!==void 0,$$slots:{default:[qf]},$$scope:{ctx:t}}}),F.$on("close",Xr.reset),P=new es({props:{visible:t[2]!==void 0,$$slots:{default:[zf]},$$scope:{ctx:t}}}),P.$on("close",gn.reset),{c(){e=be("div"),n=be("aside"),r=be("nav"),s=be("h1"),c=dt("PodPlanner"),u=Ie(),p=be("div");for(let Y=0;Y<V.length;Y+=1)V[Y].c();y=Ie(),f=be("main"),d=be("div"),je(h.$$.fragment),v=Ie(),je(E.$$.fragment),m=Ie(),Z&&Z.c(),A=Ie(),je(F.$$.fragment),_=Ie(),je(P.$$.fragment),this.h()},l(Y){e=Se(Y,"DIV",{class:!0});var O=Te(e);n=Se(O,"ASIDE",{class:!0});var oe=Te(n);r=Se(oe,"NAV",{class:!0});var _e=Te(r);s=Se(_e,"H1",{class:!0});var ke=Te(s);c=ft(ke,"PodPlanner"),ke.forEach(de),u=xe(_e),p=Se(_e,"DIV",{class:!0});var G=Te(p);for(let Re=0;Re<V.length;Re+=1)V[Re].l(G);G.forEach(de),_e.forEach(de),oe.forEach(de),y=xe(O),f=Se(O,"MAIN",{class:!0});var se=Te(f);d=Se(se,"DIV",{class:!0});var ve=Te(d);We(h.$$.fragment,ve),v=xe(ve),We(E.$$.fragment,ve),ve.forEach(de),m=xe(se),Z&&Z.l(se),se.forEach(de),O.forEach(de),A=xe(Y),We(F.$$.fragment,Y),_=xe(Y),We(P.$$.fragment,Y),this.h()},h(){fe(s,"class","text-3xl font-bold border-b-2 border-green-700 text-green-700 mb-4"),fe(p,"class","flex flex-col gap-2"),fe(r,"class","w-64 p-4 border-r-2 border-slate-200 fixed left-0 top-0 h-[100vh]"),fe(n,"class","w-64 p-4"),fe(d,"class","flex gap-4 justify-end "),fe(f,"class","grow p-5"),fe(e,"class","flex")},m(Y,O){Me(Y,e,O),ue(e,n),ue(n,r),ue(r,s),ue(s,c),ue(r,u),ue(r,p);for(let oe=0;oe<V.length;oe+=1)V[oe].m(p,null);ue(e,y),ue(e,f),ue(f,d),Ve(h,d,null),ue(d,v),Ve(E,d,null),ue(f,m),Z&&Z.m(f,null),Me(Y,A,O),Ve(F,Y,O),Me(Y,_,O),Ve(P,Y,O),C=!0},p(Y,[O]){if(O&9){R=Y[3];let G;for(G=0;G<R.length;G+=1){const se=_s(Y,R,G);V[G]?(V[G].p(se,O),le(V[G],1)):(V[G]=ws(se),V[G].c(),le(V[G],1),V[G].m(p,null))}for(Ut(),G=R.length;G<V.length;G+=1)j(G);Dt()}const oe={};O&32&&(oe.$$scope={dirty:O,ctx:Y}),h.$set(oe),Z&&Z.p&&(!C||O&32)&&Rr(Z,B,Y,Y[5],C?Dr(B,Y[5],O,null):Ur(Y[5]),null);const _e={};O&2&&(_e.visible=Y[1]!==void 0),O&32&&(_e.$$scope={dirty:O,ctx:Y}),F.$set(_e);const ke={};O&4&&(ke.visible=Y[2]!==void 0),O&32&&(ke.$$scope={dirty:O,ctx:Y}),P.$set(ke)},i(Y){if(!C){for(let O=0;O<R.length;O+=1)le(V[O]);le(h.$$.fragment,Y),le(E.$$.fragment,Y),le(Z,Y),le(F.$$.fragment,Y),le(P.$$.fragment,Y),C=!0}},o(Y){V=V.filter(Boolean);for(let O=0;O<V.length;O+=1)he(V[O]);he(h.$$.fragment,Y),he(E.$$.fragment,Y),he(Z,Y),he(F.$$.fragment,Y),he(P.$$.fragment,Y),C=!1},d(Y){Y&&de(e),wn(V,Y),$e(h),$e(E),Z&&Z.d(Y),Y&&de(A),$e(F,Y),Y&&de(_),$e(P,Y)}}}function Yf(t,e,n){let r,s,c;Br(t,$f,f=>n(0,r=f)),Br(t,Xr,f=>n(1,s=f)),Br(t,gn,f=>n(2,c=f));let{$$slots:u={},$$scope:p}=e;const y=[{title:"Planning view",url:["planning",""],icon:yi},{title:"Upcomming activities",url:["upcomming"],icon:yi},{title:"Past activities",url:["past"],icon:yi}];return t.$$set=f=>{"$$scope"in f&&n(5,p=f.$$scope)},[r,s,c,y,u,p]}class Xf extends or{constructor(e){super(),sr(this,e,Yf,Gf,ar,{})}}function Qf(t){let e,n;return e=new af({}),{c(){je(e.$$.fragment)},l(r){We(e.$$.fragment,r)},m(r,s){Ve(e,r,s),n=!0},p:Zt,i(r){n||(le(e.$$.fragment,r),n=!0)},o(r){he(e.$$.fragment,r),n=!1},d(r){$e(e,r)}}}function Zf(t){let e,n;return e=new Xf({props:{$$slots:{default:[eh]},$$scope:{ctx:t}}}),{c(){je(e.$$.fragment)},l(r){We(e.$$.fragment,r)},m(r,s){Ve(e,r,s),n=!0},p(r,s){const c={};s&2&&(c.$$scope={dirty:s,ctx:r}),e.$set(c)},i(r){n||(le(e.$$.fragment,r),n=!0)},o(r){he(e.$$.fragment,r),n=!1},d(r){$e(e,r)}}}function eh(t){let e;const n=t[0].default,r=xr(n,t,t[1],null);return{c(){r&&r.c()},l(s){r&&r.l(s)},m(s,c){r&&r.m(s,c),e=!0},p(s,c){r&&r.p&&(!e||c&2)&&Rr(r,n,s,s[1],e?Dr(n,s[1],c,null):Ur(s[1]),null)},i(s){e||(le(r,s),e=!0)},o(s){he(r,s),e=!1},d(s){r&&r.d(s)}}}function th(t){let e,n,r,s;const c=[Zf,Qf],u=[];function p(y,f){var d;return(d=yn.getDefaultSession())!=null&&d.info.isLoggedIn,0;return 1}return e=p(),n=u[e]=c[e](t),{c(){n.c(),r=Cr()},l(y){n.l(y),r=Cr()},m(y,f){u[e].m(y,f),Me(y,r,f),s=!0},p(y,[f]){n.p(y,f)},i(y){s||(le(n),s=!0)},o(y){he(n),s=!1},d(y){u[e].d(y),y&&de(r)}}}function rh(t,e,n){let r,s;Br(t,Zr,A=>n(2,r=A)),Br(t,Qr,A=>n(3,s=A));let{$$slots:c={},$$scope:u}=e;const p=vn.Now.plainDateISO(xo),y=p.add({days:1}),f=p.add({days:2}),d=vn.Now.plainTimeISO(xo),h={from:d,to:d.add({minutes:30})},v={from:d.add({minutes:90}),to:d.add({minutes:180})};function E(){const A=new Ro("Test1","Work",new Set(["Windy","Rain"]),[p,y]),F=new Ro("Test2","Fun",new Set(["Windy","Rain"]),[p,f],[h,v]);Qr.add(A),Qr.add(F)}function m(){const A=new Uo("Test1","Work",new Set(["Windy","Rain"]),y),F=new Uo("Test2","Fun",new Set(["Windy","Rain"]),p.subtract({days:1}),h);Zr.add(A),Zr.add(F)}return bs(()=>{s.length||E(),r.length||m()}),t.$$set=A=>{"$$scope"in A&&n(1,u=A.$$scope)},[c,u]}class lh extends or{constructor(e){super(),sr(this,e,rh,th,ar,{})}}export{lh as default};
